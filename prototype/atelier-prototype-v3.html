<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒˆãƒªã‚¨éŒ¬é‡‘è¡“ - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— v3</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', 'Yu Gothic UI', sans-serif;
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
            background: #1a1a2e;
            color: #eee;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            font-size: 24px;
        }

        .state {
            background: #16213e;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px solid #0f3460;
        }
        .state-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .state-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #0f3460;
            border-radius: 4px;
            margin: 0 5px;
        }
        .state-label { font-size: 12px; color: #aaa; }
        .state-value { font-size: 24px; font-weight: bold; }

        /* æŒ‡æ¨™ãƒãƒ¼ */
        .gauge-container {
            margin-bottom: 10px;
        }
        .gauge-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .gauge {
            height: 20px;
            background: #0f3460;
            border-radius: 10px;
            overflow: hidden;
        }
        .gauge-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        .gauge-pioneer { background: linear-gradient(90deg, #4caf50, #8bc34a); }
        .gauge-fatigue { background: linear-gradient(90deg, #ff9800, #f44336); }

        /* ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆè¡¨ç¤º */
        .artifacts {
            background: #2a2a4a;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
        }
        .artifact-item {
            display: inline-block;
            background: #6a5acd;
            padding: 3px 8px;
            border-radius: 4px;
            margin: 2px;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .action-group {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #0f3460;
        }
        .action-title {
            font-size: 14px;
            color: #ffd700;
            margin-bottom: 10px;
            text-align: center;
        }
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .action-btn {
            padding: 12px 15px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background: #3498db;
            color: white;
            transition: all 0.2s;
        }
        .action-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        .action-btn.gather { background: #27ae60; }
        .action-btn.gather:hover { background: #1e8449; }
        .action-btn.craft { background: #e67e22; }
        .action-btn.craft:hover { background: #d35400; }
        .action-btn.deliver { background: #9b59b6; }
        .action-btn.deliver:hover { background: #8e44ad; }
        .action-btn.shop { background: #3498db; }
        .action-btn.shop:hover { background: #2980b9; }

        .action-cost {
            font-size: 10px;
            opacity: 0.8;
            display: block;
            margin-top: 3px;
        }

        /* ãƒ­ã‚° */
        .log {
            background: #0a0a1a;
            color: #0f0;
            padding: 15px;
            height: 180px;
            overflow-y: auto;
            font-size: 13px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
        }
        .log p { margin: 3px 0; }
        .log .success { color: #4caf50; }
        .log .warning { color: #ff9800; }
        .log .danger { color: #f44336; }
        .log .info { color: #2196f3; }
        .log .gold { color: #ffd700; }

        /* ãƒªã‚»ãƒƒãƒˆ */
        .reset {
            margin-top: 15px;
            text-align: center;
        }
        .reset button {
            padding: 12px 40px;
            font-size: 16px;
            cursor: pointer;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
        }
        .reset button:hover { background: #c0392b; }

        /* çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .game-over {
            color: #f44336;
            font-weight: bold;
            font-size: 24px;
            margin: 15px 0;
            text-align: center;
            text-shadow: 0 0 10px #f44336;
        }
        .victory {
            color: #4caf50;
            font-weight: bold;
            font-size: 24px;
            margin: 15px 0;
            text-align: center;
            text-shadow: 0 0 10px #4caf50;
        }

        /* å±é™ºçŠ¶æ…‹ã®è­¦å‘Š */
        .danger-warning {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <h1>æ¡ã£ã¦ã€æ··ãœã¦ã€ç¨¼ã„ã§ã€é–‹æ‹“ã—ã‚ã€‚</h1>

    <!-- çŠ¶æ…‹è¡¨ç¤º -->
    <div class="state">
        <!-- æŒ‡æ¨™ãƒãƒ¼ -->
        <div class="gauge-container">
            <div class="gauge-label">
                <span>é–‹æ‹“åº¦</span>
                <span id="pioneer-text">0%</span>
            </div>
            <div class="gauge">
                <div class="gauge-fill gauge-pioneer" id="pioneer-bar" style="width: 0%"></div>
            </div>
        </div>
        <div class="gauge-container">
            <div class="gauge-label">
                <span>æ¶ˆè€—åº¦</span>
                <span id="fatigue-text">0%</span>
            </div>
            <div class="gauge">
                <div class="gauge-fill gauge-fatigue" id="fatigue-bar" style="width: 0%"></div>
            </div>
        </div>

        <!-- ãƒªã‚½ãƒ¼ã‚¹è¡¨ç¤º -->
        <div class="state-row">
            <div class="state-item">
                <div class="state-label">ç´ æ</div>
                <div class="state-value" id="materials">5</div>
            </div>
            <div class="state-item">
                <div class="state-label">ãŠé‡‘</div>
                <div class="state-value" id="money">50G</div>
            </div>
            <div class="state-item">
                <div class="state-label">ã‚¿ãƒ¼ãƒ³</div>
                <div class="state-value" id="turns">20</div>
            </div>
            <div class="state-item">
                <div class="state-label">ç´å“ç”¨</div>
                <div class="state-value" id="delivery-item">ãªã—</div>
            </div>
        </div>

        <!-- ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ -->
        <div class="artifacts" id="artifacts-container">
            <span style="color: #aaa;">ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ: </span>
            <span id="artifacts-list">ãªã—</span>
        </div>
    </div>

    <div id="message"></div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="actions">
        <!-- æ¡å– -->
        <div class="action-group">
            <div class="action-title">æ¡å–</div>
            <div class="action-buttons">
                <button class="action-btn gather" onclick="doGather()">
                    æ¡å–ã™ã‚‹
                    <span class="action-cost">ç´ æ+2ã€œ3 / 1ã‚¿ãƒ¼ãƒ³æ¶ˆè²»</span>
                </button>
            </div>
        </div>

        <!-- èª¿åˆ -->
        <div class="action-group">
            <div class="action-title">èª¿åˆ</div>
            <div class="action-buttons">
                <button class="action-btn craft" onclick="doCraft('weapon')">
                    æ­¦å™¨ã‚’èª¿åˆ
                    <span class="action-cost">é–‹æ‹“åº¦+20% / ç´ æ2æš</span>
                </button>
                <button class="action-btn craft" onclick="doCraft('medicine')">
                    è–¬ã‚’èª¿åˆ
                    <span class="action-cost">æ¶ˆè€—åº¦-15% / ç´ æ2æš</span>
                </button>
                <button class="action-btn craft" onclick="doCraft('delivery')">
                    ç´å“ç”¨ã‚’èª¿åˆ
                    <span class="action-cost">ç´å“ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆ / ç´ æ2æš</span>
                </button>
            </div>
        </div>

        <!-- ä¾é ¼ -->
        <div class="action-group">
            <div class="action-title">ä¾é ¼</div>
            <div class="action-buttons">
                <button class="action-btn deliver" onclick="doDeliver()">
                    ä¾é ¼ã‚’ç´å“
                    <span class="action-cost">ãŠé‡‘+50G / ç´å“ç”¨ã‚¢ã‚¤ãƒ†ãƒ å¿…è¦</span>
                </button>
            </div>
        </div>

        <!-- è²·ã„ç‰© -->
        <div class="action-group">
            <div class="action-title">è²·ã„ç‰©</div>
            <div class="action-buttons">
                <button class="action-btn shop" onclick="doShop('materials')">
                    ç´ æã‚’è³¼å…¥
                    <span class="action-cost">ç´ æ+2 / 30G / 1ã‚¿ãƒ¼ãƒ³æ¶ˆè²»</span>
                </button>
                <button class="action-btn shop" onclick="doShop('artifact')">
                    ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆè³¼å…¥
                    <span class="action-cost">æ¶ˆè€—åº¦-2%/ã‚¿ãƒ¼ãƒ³ / 100G</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ãƒ­ã‚° -->
    <div class="log" id="log"></div>

    <!-- ãƒªã‚»ãƒƒãƒˆ -->
    <div class="reset">
        <button onclick="reset()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <script>
        // === GAME STATE ===
        let state = {
            pioneer: 0,        // é–‹æ‹“åº¦ (0-100)
            fatigue: 0,        // æ¶ˆè€—åº¦ (0-100)
            materials: 5,      // ç´ æ
            money: 50,         // ãŠé‡‘
            turns: 20,         // ã‚¿ãƒ¼ãƒ³
            deliveryItem: false, // ç´å“ç”¨ã‚¢ã‚¤ãƒ†ãƒ 
            artifacts: [],     // ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ
            gameOver: false
        };

        const INITIAL_STATE = {
            pioneer: 0,
            fatigue: 0,
            materials: 5,
            money: 50,
            turns: 20,
            deliveryItem: false,
            artifacts: [],
            gameOver: false
        };

        // === ACTIONS ===

        // æ¡å–
        function doGather() {
            if (state.gameOver || state.turns <= 0) return;

            const gathered = Math.floor(Math.random() * 2) + 2; // 2-3
            state.materials += gathered;

            log(`æ¡å–: ç´ æ +${gathered}æš ç²å¾—ï¼`, 'success');
            endTurn();
        }

        // èª¿åˆ
        function doCraft(type) {
            if (state.gameOver) return;
            if (state.materials < 2) {
                log('ç´ æãŒè¶³ã‚Šãªã„ï¼ï¼ˆå¿…è¦: 2æšï¼‰', 'danger');
                return;
            }

            state.materials -= 2;

            switch(type) {
                case 'weapon':
                    const pioneerGain = Math.floor(Math.random() * 6) + 18; // 18-23
                    state.pioneer = Math.min(100, state.pioneer + pioneerGain);
                    log(`æ­¦å™¨ã‚’èª¿åˆ: é–‹æ‹“åº¦ +${pioneerGain}%ï¼`, 'success');
                    break;
                case 'medicine':
                    const fatigueReduce = Math.floor(Math.random() * 6) + 13; // 13-18
                    state.fatigue = Math.max(0, state.fatigue - fatigueReduce);
                    log(`è–¬ã‚’èª¿åˆ: æ¶ˆè€—åº¦ -${fatigueReduce}%ï¼`, 'success');
                    break;
                case 'delivery':
                    state.deliveryItem = true;
                    log('ç´å“ç”¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’èª¿åˆï¼', 'info');
                    break;
            }

            // èª¿åˆã¯ã‚¿ãƒ¼ãƒ³æ¶ˆè²»ãªã—ï¼ˆç´ ææ¶ˆè²»ã®ã¿ï¼‰
            updateUI();
            checkEnd();
        }

        // ä¾é ¼ç´å“
        function doDeliver() {
            if (state.gameOver) return;
            if (!state.deliveryItem) {
                log('ç´å“ç”¨ã‚¢ã‚¤ãƒ†ãƒ ãŒãªã„ï¼', 'danger');
                return;
            }

            state.deliveryItem = false;
            state.money += 50;
            log('ä¾é ¼ã‚’ç´å“: ãŠé‡‘ +50Gï¼', 'gold');
            updateUI();
        }

        // è²·ã„ç‰©
        function doShop(type) {
            if (state.gameOver || state.turns <= 0) return;

            switch(type) {
                case 'materials':
                    if (state.money < 30) {
                        log('ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼ï¼ˆå¿…è¦: 30Gï¼‰', 'danger');
                        return;
                    }
                    state.money -= 30;
                    state.materials += 2;
                    log('ç´ æã‚’è³¼å…¥: ç´ æ +2æšï¼', 'info');
                    endTurn();
                    break;
                case 'artifact':
                    if (state.money < 100) {
                        log('ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼ï¼ˆå¿…è¦: 100Gï¼‰', 'danger');
                        return;
                    }
                    if (state.artifacts.includes('é ‘ä¸ˆãªé´')) {
                        log('æ—¢ã«ã€Œé ‘ä¸ˆãªé´ã€ã‚’æŒã£ã¦ã„ã‚‹ï¼', 'warning');
                        return;
                    }
                    state.money -= 100;
                    state.artifacts.push('é ‘ä¸ˆãªé´');
                    log('ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã€Œé ‘ä¸ˆãªé´ã€ã‚’è³¼å…¥ï¼æ¶ˆè€—åº¦ä¸Šæ˜‡ -2%/ã‚¿ãƒ¼ãƒ³', 'gold');
                    endTurn();
                    break;
            }
        }

        // ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†
        function endTurn() {
            state.turns--;

            // æ¶ˆè€—åº¦ä¸Šæ˜‡ï¼ˆã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆåŠ¹æœé©ç”¨ï¼‰
            let fatigueIncrease = 5;
            if (state.artifacts.includes('é ‘ä¸ˆãªé´')) {
                fatigueIncrease = 3;
            }
            state.fatigue = Math.min(100, state.fatigue + fatigueIncrease);

            if (fatigueIncrease < 5) {
                log(`ã‚¿ãƒ¼ãƒ³çµ‚äº†: æ¶ˆè€—åº¦ +${fatigueIncrease}%ï¼ˆé´ã®åŠ¹æœã§è»½æ¸›ï¼‰`, 'warning');
            } else {
                log(`ã‚¿ãƒ¼ãƒ³çµ‚äº†: æ¶ˆè€—åº¦ +${fatigueIncrease}%`, 'warning');
            }

            updateUI();
            checkEnd();
        }

        // === UI UPDATE ===
        function updateUI() {
            // æŒ‡æ¨™ãƒãƒ¼
            document.getElementById('pioneer-bar').style.width = state.pioneer + '%';
            document.getElementById('pioneer-text').textContent = state.pioneer + '%';
            document.getElementById('fatigue-bar').style.width = state.fatigue + '%';
            document.getElementById('fatigue-text').textContent = state.fatigue + '%';

            // æ¶ˆè€—åº¦ãŒé«˜ã„ã¨ãã®è­¦å‘Š
            const fatigueText = document.getElementById('fatigue-text');
            if (state.fatigue >= 70) {
                fatigueText.classList.add('danger-warning');
                fatigueText.style.color = '#f44336';
            } else {
                fatigueText.classList.remove('danger-warning');
                fatigueText.style.color = '';
            }

            // ãƒªã‚½ãƒ¼ã‚¹
            document.getElementById('materials').textContent = state.materials;
            document.getElementById('money').textContent = state.money + 'G';
            document.getElementById('turns').textContent = state.turns;
            document.getElementById('delivery-item').textContent = state.deliveryItem ? 'ã‚ã‚Š' : 'ãªã—';
            document.getElementById('delivery-item').style.color = state.deliveryItem ? '#4caf50' : '#aaa';

            // ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ
            const artifactsList = document.getElementById('artifacts-list');
            if (state.artifacts.length > 0) {
                artifactsList.innerHTML = state.artifacts.map(a =>
                    `<span class="artifact-item">${a}</span>`
                ).join('');
            } else {
                artifactsList.textContent = 'ãªã—';
            }

            // ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
            updateButtons();
        }

        function updateButtons() {
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(btn => {
                btn.disabled = state.gameOver;
            });

            // å€‹åˆ¥ã®æ¡ä»¶
            if (state.turns <= 0 || state.gameOver) {
                document.querySelectorAll('.action-btn.gather, .action-btn.shop').forEach(btn => {
                    btn.disabled = true;
                });
            }
        }

        // === LOG ===
        function log(msg, type = '') {
            const logEl = document.getElementById('log');
            const p = document.createElement('p');
            p.className = type;
            p.textContent = `> ${msg}`;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight;
        }

        // === END CHECK ===
        function checkEnd() {
            const msgEl = document.getElementById('message');

            if (state.pioneer >= 100) {
                msgEl.innerHTML = '<div class="victory">ğŸ‰ é–‹æ‹“å®Œäº†ï¼ VICTORY!</div>';
                state.gameOver = true;
                log('=== ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼ ===', 'success');
                updateButtons();
            } else if (state.fatigue >= 100) {
                msgEl.innerHTML = '<div class="game-over">ğŸ’€ æ¶ˆè€—ã—ãã£ãŸ... GAME OVER</div>';
                state.gameOver = true;
                log('=== ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ===', 'danger');
                updateButtons();
            } else if (state.turns <= 0 && state.pioneer < 100) {
                msgEl.innerHTML = '<div class="game-over">â° æ™‚é–“åˆ‡ã‚Œ... é–‹æ‹“åº¦ ' + state.pioneer + '%</div>';
                state.gameOver = true;
                log('=== æ™‚é–“åˆ‡ã‚Œ ===', 'warning');
                updateButtons();
            }
        }

        // === RESET ===
        function reset() {
            state = { ...INITIAL_STATE, artifacts: [] };
            document.getElementById('log').innerHTML = '';
            document.getElementById('message').innerHTML = '';
            updateUI();
            log('=== ã‚²ãƒ¼ãƒ é–‹å§‹ ===');
            log('ç›®æ¨™: é–‹æ‹“åº¦100%ã‚’ç›®æŒ‡ã›ï¼', 'info');
            log('æ³¨æ„: æ¶ˆè€—åº¦100%ã§ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼', 'warning');
        }

        // === INIT ===
        reset();
    </script>
</body>
</html>
