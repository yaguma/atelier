---
description: 性能問題の原因を調査する
allowed-tools: Read, Glob, Grep, Task, Bash, AskUserQuestion, TodoWrite
argument-hint: [調査対象（機能名/エンドポイント/画面/自然言語）]
---
性能問題の原因を特定するための包括的な調査を実施します。初期調査、詳細な原因分析、最終サマリーを段階的に作成し、性能問題の根本原因を明らかにします。

# context

出力ディレクトリ=".dcs"
カレントディレクトリ={{プロジェクトルート}}
分析ファイルリスト=[]
調査回数=0

# step

- $1 がない場合、「引数に調査対象を指定してください（例: エンドポイント名、画面名、機能名、または自然言語）」と言って終了する
- $1 の内容を簡潔に説明する
- TodoWrite ツールで以下のタスクリストを作成する：
  1. 性能問題の詳細情報を収集
  2. 初期調査の実施
  3. 原因候補の特定と詳細調査
  4. 最終サマリーの作成
- タスク1を in_progress にする
- AskUserQuestion ツールを使って以下の質問を順番に実施し、context を更新する：
  1. 性能劣化の症状を確認
  2. 発生タイミングを確認
  3. 影響範囲を確認
  4. 環境情報を確認
- 収集した context の内容をまとめてユーザに宣言する
- タスク1を completed にして、タスク2を in_progress にする
- step2 を実行する

## step2

- 既存の出力ファイルを確認して、重複しないナンバリングを決定する
  - {{出力ディレクトリ}}/{{timestamp}}_* を検索
  - 今回の内容を簡単に英語化したもの（例: "order_api", "cart_screen"）を作成
  - 同じ timestamp と内容で既存ディレクトリがある場合、末尾の連番を +1 する
  - ベースディレクトリを "{{出力ディレクトリ}}/{{timestamp}}_{{内容の英語化}}" とする
    - 例: ".dcs/20251025_123456_order_api"
    - 例: ".dcs/20251025_123456_cart_screen"
- 分析結果ファイルのリストを準備する
  - インデックスファイル: "{{ベースディレクトリ}}/index.md"
  - 初期調査ファイル: "{{ベースディレクトリ}}/initial.md"
  - 原因分析ファイル: "{{ベースディレクトリ}}/causes.md"
  - 推奨対応ファイル: "{{ベースディレクトリ}}/recommendations.md"
- すべてのファイル名を 分析ファイルリスト に追加する
- <performance_analysis_template> の内容を context の情報で埋めて、Task ツールで直接実行する
  - subagent_type: "general-purpose"
  - description: "性能劣化 初期調査の実行"
  - prompt: テンプレートの内容を context で埋めた完全なプロンプト
- Task の実行結果を受け取る
- 調査回数を 1 にする
- タスク2を completed にして、タスク3を in_progress にする
- step3 を実行する

## step3

- 出力されたファイルを Read で確認する
- causes ファイルから原因候補をリストアップする
- 各原因候補について詳細調査が必要かを判断する
- 詳細調査が必要な場合：
  - 調査する原因候補をリストとしてユーザに提示する
  - ユーザの承認を得る
  - 各原因候補に対して個別に Task ツールで詳細調査を実行する
    - 各調査ごとに新しい連番で追加ファイルとして保存する（例: "detail_2.md", "detail_3.md"）
    - 各ファイル名を 分析ファイルリスト に追加する
  - 調査回数を +1 する
  - 再度 step3 を実行する（詳細調査が不要になるまで繰り返す、最大5回）
- 詳細調査が不要な場合：
  - タスク3を completed にして、タスク4を in_progress にする
  - step4 を実行する

## step4

- <summary_template> の内容を使って、Task ツールで最終サマリーファイルを作成する
  - subagent_type: "general-purpose"
  - description: "性能劣化調査 最終サマリーの作成"
  - prompt: サマリーテンプレートの内容を context で埋めた完全なプロンプト
  - 最終サマリーファイル名: "{{ベースディレクトリ}}/final_summary.md"
- 全ての分析ファイルのパスを調査回数別に整理して表示する
  - 初期調査ファイル一覧
  - 詳細調査ファイル一覧（該当する場合）
  - 最終サマリー
- タスク4を completed にする
- 調査完了をユーザに報告する

# rules

## 確認ポイント

AskUserQuestion ツールを使って、以下の質問を順番に実施する：

### 質問1: 性能問題の症状
- **質問**: どのような性能問題が発生していますか？
- **header**: "症状"
- **multiSelect**: true
- **options**:
  - "レスポンスが遅い" - API応答やページ表示が遅い
  - "タイムアウトが発生する" - 処理が完了せずタイムアウトする
  - "メモリ使用量が多い" - メモリリークやメモリ圧迫
  - "CPU使用率が高い" - CPUリソースを過剰に消費
  - "データベースが遅い" - DBクエリの実行が遅い
  - "その他" - 上記以外の症状（追記で詳細を指定）

### 質問2: 発生タイミング
- **質問**: 性能問題はいつから発生していますか？
- **header**: "発生時期"
- **options**:
  - "最近のリリース後" - 特定のリリース後に発生
  - "データ量増加後" - データベースのデータが増えてから
  - "アクセス数増加後" - ユーザー数やトラフィックが増えてから
  - "特定の時間帯のみ" - ピーク時や特定時刻のみ
  - "常に発生" - システム起動時から常に遅い

### 質問3: 影響範囲
- **質問**: 性能問題の影響範囲はどの程度ですか？
- **header**: "影響範囲"
- **options**:
  - "特定の機能のみ" - 一部の機能やページのみ
  - "特定のユーザーのみ" - 特定の条件下のユーザーのみ
  - "システム全体" - システム全体に影響
  - "不明" - 影響範囲が明確でない

### 質問4: 環境情報
- **質問**: どの環境で発生していますか？
- **header**: "環境"
- **multiSelect**: true
- **options**:
  - "本番環境" - 本番環境で発生
  - "ステージング環境" - ステージング環境で発生
  - "開発環境" - 開発環境で発生
  - "ローカル環境" - ローカル開発環境で発生

contextとして以下を保持する：
- 調査対象（具体的な機能名やエンドポイント）
- 性能劣化の症状
- 発生タイミング
- 影響範囲
- 環境情報

## ファイル名のルール

### timestamp の形式
- yyyyMMddHHmmss 形式（例: 20251025123456）

### 内容の英語化のルール
- 調査対象を簡潔な英語に変換する
- スネークケース（snake_case）を使用
- 最大30文字程度に収める
- 例:
  - "注文API" → "order_api"
  - "カート画面" → "cart_screen"
  - "商品検索" → "goods_search"

### ファイル構成
- `index.md` - インデックス（全体概要とファイル一覧）
- `initial.md` - 初期調査結果
- `causes.md` - 原因候補の分析
- `recommendations.md` - 推奨対応
- `detail_N.md` - 詳細調査結果（Nは連番）
- `final_summary.md` - 最終サマリー

### 完全なファイル名の例
**初期調査**:
- `.dcs/20251025123456_order_api/index.md`
- `.dcs/20251025123456_order_api/initial.md`
- `.dcs/20251025123456_order_api/causes.md`
- `.dcs/20251025123456_order_api/recommendations.md`

**詳細調査**:
- `.dcs/20251025123456_order_api/detail_2.md`
- `.dcs/20251025123456_order_api/detail_3.md`

**最終サマリー**:
- `.dcs/20251025123456_order_api/final_summary.md`

## ファイルパスの記載ルール

- **カレントディレクトリを基準とした相対パスを使用する**
- フルパス（絶対パス）は記載しない
- 例:
  - ❌ `/Users/makotan/projects/ensemble-si/backend/src/main/kotlin/...`
  - ✅ `backend/src/main/kotlin/...`

## 原因候補の分類

性能問題の原因候補を以下のカテゴリで分類する：

### 1. データベース関連
- N+1クエリ問題
- インデックスの欠如
- 非効率なクエリ
- トランザクションの長時間ロック
- データ量の増加

### 2. アプリケーション層
- メモリリーク
- 不適切なキャッシュ戦略
- 同期処理のボトルネック
- 大量のオブジェクト生成
- 非効率なアルゴリズム
- 同一処理の重複実行

### 3. ネットワーク・通信
- 外部API呼び出しの遅延
- 不要な通信の繰り返し
- 大容量データの転送
- タイムアウト設定の不備

### 4. インフラ・環境
- リソース不足（CPU、メモリ、ディスク）
- ネットワーク帯域の問題
- 環境設定の不備
- ログ出力の過多

### 5. アーキテクチャ
- 責務の集中
- モジュール間の密結合
- スケーラビリティの欠如

## 詳細調査が必要な条件

以下の条件のいずれかに該当する場合、詳細調査を提案する：

- 原因候補が複数あり、特定に至っていない
- データベースクエリの詳細な分析が必要
- コードの実装詳細の確認が必要
- 外部サービスとの連携部分の調査が必要
- 環境設定やインフラの確認が必要
- パフォーマンステストの結果分析が必要

## step3 の繰り返しルール

- 詳細調査が必要な項目がある場合、step3 を繰り返す
- 最大5回まで繰り返す（無限ループ防止）
- 詳細調査項目が複数ある場合は、各項目ごとに個別に Task を実行する
- 各繰り返しで新しい連番のファイルを作成する
- ユーザーの承認を得てから次の調査を実行する
- 詳細調査が不要になったら step4 に進む

# info

<performance_analysis_template>
あなたは性能問題の調査エキスパートです。以下の情報に基づいて、性能問題の原因を調査し、ファイル出力してください。

# 調査対象の情報

調査対象: {{調査対象の具体的な情報}}
症状: {{性能劣化の症状}}
発生タイミング: {{発生タイミング}}
影響範囲: {{影響範囲}}
環境: {{環境情報}}
ベースディレクトリ: {{ベースディレクトリ}}（例: ".dcs/20251025123456_order_api"）
カレントディレクトリ: {{カレントディレクトリ}}

# 重要な注意事項

**すべてのファイルパスは、カレントディレクトリを基準とした相対パスで記載してください。**
**絶対パス（/Users/... や C:\\... など）は使用しないでください。**

例:
- ❌ `/Users/makotan/projects/ensemble-si/backend/src/main/kotlin/...`
- ✅ `backend/src/main/kotlin/...`

# 出力ファイル構成

調査結果は以下のファイルに分割して出力してください：

1. **インデックスファイル**: `{{ベースディレクトリ}}/index.md`
   - 全体概要と全ファイルへのリンク

2. **初期調査ファイル**: `{{ベースディレクトリ}}/initial.md`
   - プロジェクト概要と調査対象の詳細分析

3. **原因分析ファイル**: `{{ベースディレクトリ}}/causes.md`
   - 考えられる原因候補のリストと分析

4. **推奨対応ファイル**: `{{ベースディレクトリ}}/recommendations.md`
   - 具体的な改善提案と対応方針

# 調査手順

## 1. 調査対象の特定

- 調査対象が自然言語の場合、Grep/Globで具体的なファイル・関数・クラスを特定する
- 調査対象がエンドポイントの場合、対応するコントローラーやサービスを特定する
- 調査対象が画面の場合、対応するコンポーネントとAPI通信を特定する
- 特定結果を記録する（相対パス、行番号、コード要素の種類）

## 2. プロジェクト概要の把握

- アーキテクチャの理解（BFF、Prismatix Factory、データフローなど）
- 使用技術スタックの確認
- 関連するコンポーネントの特定
- データベーススキーマの確認（prismatix-factory/resources/*.yaml）

## 3. 調査対象の詳細分析

### コード実装の確認
- 主要な処理フローを追跡する
- データベースアクセス部分を特定する
- 外部API呼び出しを特定する
- ループや再帰処理を確認する

### データベースクエリの分析
- SQLクエリを抽出する
- クエリの実行回数を推定する
- インデックスの有無を確認する
- JOINの複雑さを評価する

### 依存関係の確認
- 関連するファイルとその役割
- サービス間の呼び出し関係
- データの流れ

## 4. 原因候補の特定

以下の観点から原因候補を分析する：

### データベース関連
- **N+1問題の有無**: ループ内でのクエリ実行
- **インデックス**: 必要なインデックスが存在するか
- **クエリ最適化**: JOIN、WHERE句、SELECT句の効率性
- **トランザクション**: 長時間ロックの可能性
- **データ量**: テーブルのレコード数とパフォーマンスの関係

調査方法：
```bash
# Prismatix Factoryのリソース定義を確認
# インデックス定義を確認
# クエリの複雑さを分析
```

### アプリケーション層
- **メモリ使用**: オブジェクト生成やキャッシュ戦略
- **同期処理**: ブロッキング処理の有無
- **アルゴリズム**: 計算量の評価（O(n), O(n²)など）
- **並列処理**: 非同期処理の活用度
- **重複処理**: フロー内での同一機能の重複処理

調査方法：
- コードレビュー
- ループのネスト構造確認
- メモリ使用パターンの分析

### ネットワーク・通信
- **API呼び出し**: 外部API呼び出しの回数と応答時間
- **BFF層**: BFFとバックエンド間の通信効率
- **データサイズ**: 転送データ量
- **タイムアウト**: 適切なタイムアウト設定

調査方法：
- API呼び出し箇所の特定
- データペイロードサイズの確認
- 通信回数の推定

### インフラ・環境
- **リソース**: CPU、メモリ、ディスク使用率
- **設定**: JVMオプション、接続プール設定
- **ログ**: 過剰なログ出力
- **環境差異**: 本番と開発環境の差異

調査方法：
- 設定ファイルの確認（application.yml、環境変数）
- リソース設定の確認
- ログレベルの確認

## 5. 各原因候補の評価

各原因候補について以下を評価する：

### 可能性レベル
- **高**: 明確な証拠がある、または非常に可能性が高い
- **中**: 可能性はあるが、さらなる調査が必要
- **低**: 可能性は低いが、念のため確認推奨

### 影響度
- **高**: 修正により大幅な性能改善が期待できる
- **中**: 一定の改善が期待できる
- **低**: 限定的な改善

### 調査難易度
- **低**: すぐに確認・検証可能
- **中**: 追加の調査やテストが必要
- **高**: 大規模な調査や環境構築が必要

## 6. 推奨対応の作成

### 即座に実施可能な対応
- コード修正が少なく、影響範囲が限定的
- リスクが低い
- 効果が見込める

### 検証が必要な対応
- 影響範囲が広い
- 追加のテストが必要
- パフォーマンステストで効果を確認すべき

### 長期的な対応
- アーキテクチャの変更を伴う
- 大規模なリファクタリングが必要
- インフラの増強が必要

## 7. ファイル出力

以下の順序で各ファイルを作成してください。**各ファイルは Write ツールを使って個別に保存してください。**

### 7.1 インデックスファイルの作成
`{{ベースディレクトリ}}/index.md` を作成

### 7.2 初期調査ファイルの作成
`{{ベースディレクトリ}}/initial.md` を作成

### 7.3 原因分析ファイルの作成
`{{ベースディレクトリ}}/causes.md` を作成

### 7.4 推奨対応ファイルの作成
`{{ベースディレクトリ}}/recommendations.md` を作成

# 各ファイルの出力形式

## インデックスファイル (`index.md`)

```markdown
# 性能劣化調査 - インデックス

**実施日時**: {{実施日時}}
**調査者**: Claude Code

---

## 調査概要

### 調査対象
- **対象**: {{調査対象の詳細}}
- **症状**: {{性能劣化の症状}}
- **発生タイミング**: {{発生タイミング}}
- **影響範囲**: {{影響範囲}}
- **環境**: {{環境情報}}

### サマリー

| 項目 | 内容 |
|------|------|
| 原因候補数 | XX件 |
| 高可能性の原因 | XX件 |
| 推奨対応数 | XX件 |

---

## 調査結果ファイル一覧

### 基本情報
- [初期調査](./initial.md) - プロジェクト概要と調査対象の分析
- [原因分析](./causes.md) - 原因候補のリストと評価
- [推奨対応](./recommendations.md) - 具体的な改善提案

---

## クイックナビゲーション

### 高可能性の原因
1. {{原因1}} - [詳細](./causes.md#原因1)
2. {{原因2}} - [詳細](./causes.md#原因2)

### 優先対応項目
1. {{対応1}} - [詳細](./recommendations.md#対応1)
2. {{対応2}} - [詳細](./recommendations.md#対応2)

---

*各ファイルの詳細は上記リンクから参照してください。*
```

## 初期調査ファイル (`initial.md`)

```markdown
# 性能劣化調査 - 初期調査

**実施日時**: {{実施日時}}
**調査者**: Claude Code

[← インデックスに戻る](./index.md)

---

## プロジェクト概要

### アーキテクチャ
{{システム構成の概要}}

### 技術スタック
- **Frontend**: {{フロントエンド技術}}
- **Backend**: {{バックエンド技術}}
- **Database**: {{データベース}}
- **その他**: {{その他の主要技術}}

---

## 調査対象の詳細

### 対象コンポーネント
- **ファイルパス**: [{{相対パス}}]({{相対パス}})
- **種類**: {{コンポーネントの種類（Controller, Service, Component等）}}
- **役割**: {{コンポーネントの役割}}

### 処理フロー
{{主要な処理フローの説明}}

### 関連ファイル
{{調査対象に関連する主要ファイルのリスト}}

---

## データベーススキーマ

### 関連テーブル
{{調査対象が使用するテーブルの情報}}

### インデックス定義
{{現在のインデックス定義の状況}}

---

## コード分析

### 主要な処理
{{コードの主要な処理内容}}

### データベースアクセス
{{SQLクエリやORM使用状況}}

### 外部API呼び出し
{{外部サービスとの連携状況}}

### ループ・再帰処理
{{ループや再帰処理の有無と内容}}

---

## 観測された問題点

{{初期調査で見つかった気になる点}}

---

*詳細な原因分析は [原因分析ファイル](./causes.md) を参照してください。*
```

## 原因分析ファイル (`causes.md`)

```markdown
# 性能劣化調査 - 原因分析

**実施日時**: {{実施日時}}
**調査者**: Claude Code

[← インデックスに戻る](./index.md) | [初期調査](./initial.md)

---

## 原因候補サマリー

| カテゴリ | 原因候補数 | 高可能性 | 中可能性 | 低可能性 |
|---------|----------|---------|---------|---------|
| データベース | XX件 | XX件 | XX件 | XX件 |
| アプリケーション | XX件 | XX件 | XX件 | XX件 |
| ネットワーク | XX件 | XX件 | XX件 | XX件 |
| インフラ | XX件 | XX件 | XX件 | XX件 |

---

## データベース関連の原因候補

### 原因1: {{原因名}}

- **可能性レベル**: 高/中/低
- **影響度**: 高/中/低
- **調査難易度**: 高/中/低

#### 詳細説明
{{原因の詳細な説明}}

#### 証拠・根拠
- [{{ファイルパス}}:{{行番号}}]({{相対パス}}#L{{行番号}})
  - {{該当コードの説明}}
- {{その他の証拠}}

#### 推定される影響
{{この原因による性能への影響}}

#### 検証方法
{{この原因を確認するための方法}}

---

## アプリケーション層の原因候補

（同様の形式で記述）

---

## ネットワーク・通信の原因候補

（同様の形式で記述）

---

## インフラ・環境の原因候補

（同様の形式で記述）

---

## 追加調査が必要な項目

以下の項目について、詳細調査が推奨されます：

1. {{追加調査項目1}}
   - 理由: {{なぜ追加調査が必要か}}
   - 調査内容: {{具体的に何を調査するか}}

2. {{追加調査項目2}}
   - 理由: {{なぜ追加調査が必要か}}
   - 調査内容: {{具体的に何を調査するか}}

（追加調査が不要な場合は「なし」と記載）

---

*推奨される対応は [推奨対応ファイル](./recommendations.md) を参照してください。*
```

## 推奨対応ファイル (`recommendations.md`)

```markdown
# 性能劣化調査 - 推奨対応

**実施日時**: {{実施日時}}
**調査者**: Claude Code

[← インデックスに戻る](./index.md) | [原因分析](./causes.md)

---

## 優先度: 高（即座に実施推奨）

### 1. {{対応項目1}}

- **対応する原因**: [{{原因名}}](./causes.md#原因名)
- **期待される効果**: {{改善効果の説明}}
- **実装難易度**: 低/中/高
- **リスク**: 低/中/高

#### 具体的な対応内容
{{対応の詳細}}

#### 実装例
```言語
// 修正前
{{修正前のコード例}}

// 修正後
{{修正後のコード例}}
```

#### 影響範囲
{{この対応による影響範囲}}

#### 検証方法
{{対応後の検証方法}}

---

## 優先度: 中（検証後に実施推奨）

### 1. {{対応項目2}}

（同様の形式で記述）

---

## 優先度: 低（長期的な改善）

### 1. {{対応項目3}}

（同様の形式で記述）

---

## パフォーマンステスト推奨項目

### 負荷テスト
- **対象**: {{テスト対象}}
- **シナリオ**: {{テストシナリオ}}
- **計測指標**: {{何を計測するか}}

### ベンチマークテスト
- **対象**: {{テスト対象}}
- **比較項目**: {{何と何を比較するか}}

---

## モニタリング推奨項目

### 追加すべきメトリクス
1. {{メトリクス1}} - {{理由}}
2. {{メトリクス2}} - {{理由}}

### ログ出力の追加
1. {{ログ箇所1}} - {{目的}}
2. {{ログ箇所2}} - {{目的}}

---

## その他の注意事項

- {{注意点1}}
- {{注意点2}}
- {{注意点3}}

---

*この推奨対応は調査結果に基づいています。実際の実装前に十分な検証を行ってください。*
```

# 調査の注意点

- 推測だけでなく、コードやデータに基づいた分析を行う
- 複数の原因が複合的に作用している可能性を考慮する
- パフォーマンスの計測方法も提案する
- すべてのファイルパスは相対パスで記載する
- 原因候補は必ず優先度と影響度を評価する

# 出力手順

**重要**: 必ず以下の順序でファイルを作成してください：

1. **インデックスファイルを最初に作成** (`{{ベースディレクトリ}}/index.md`)
   - Write ツールで保存

2. **初期調査ファイルを作成** (`{{ベースディレクトリ}}/initial.md`)
   - Write ツールで保存

3. **原因分析ファイルを作成** (`{{ベースディレクトリ}}/causes.md`)
   - Write ツールで保存

4. **推奨対応ファイルを作成** (`{{ベースディレクトリ}}/recommendations.md`)
   - Write ツールで保存

**各ファイルは Write ツールを使って個別に保存してください。一つのファイルにまとめないでください。**
</performance_analysis_template>

<summary_template>
あなたは性能劣化調査のサマリー作成エキスパートです。以下の情報に基づいて、最終サマリーを作成してください。

# サマリー作成対象の情報

調査対象: {{調査対象の具体的な情報}}
分析ファイルリスト: {{分析ファイルリスト}}
最終サマリーファイル名: {{サマリーファイル名}}
カレントディレクトリ: {{カレントディレクトリ}}

# 重要な注意事項

**すべてのファイルパスは、カレントディレクトリを基準とした相対パスで記載してください。**
**絶対パス（/Users/... や C:\\... など）は使用しないでください。**

例:
- ❌ `/Users/makotan/projects/ensemble-si/backend/src/main/kotlin/...`
- ✅ `backend/src/main/kotlin/...`

# サマリー作成手順

## 1. 全分析ファイルの読み込み

- {{分析ファイルリスト}} に含まれるすべてのファイルを Read で読み込む
- 各ファイルの内容を把握する

## 2. 情報の統合

- すべての調査結果から以下の情報を統合する
  - 特定された原因の総数
  - 最も可能性の高い原因
  - 推奨対応の優先順位
  - 詳細調査で判明した新事実

## 3. 結論の導出

- 最も可能性が高い原因を特定する
- 複数の原因が複合している場合はその関係性を説明する
- 最優先で対応すべき項目を明確にする

## 4. アクションプランの作成

- 短期的な対応（即座に実施可能）
- 中期的な対応（検証後に実施）
- 長期的な対応（アーキテクチャ改善）

## 5. サマリーファイルの出力

以下の出力形式で {{サマリーファイル名}} に結果を保存してください。

# 出力形式

```markdown
# 性能劣化調査 - 最終サマリー

**実施日時**: {{実施日時}}
**調査者**: Claude Code

---

## ナビゲーション

- [初期調査インデックス](./index.md)
- [初期調査](./initial.md)
- [原因分析](./causes.md)
- [推奨対応](./recommendations.md)

（詳細調査がある場合は追加）
- [詳細調査2](./detail_2.md)
- [詳細調査3](./detail_3.md)

---

## 調査概要

### 調査対象
- **対象**: {{調査対象の詳細}}
- **症状**: {{性能劣化の症状}}
- **発生タイミング**: {{発生タイミング}}
- **影響範囲**: {{影響範囲}}
- **環境**: {{環境情報}}

### 調査実施状況
- **調査回数**: {{調査回数}}回（初期調査 + 詳細調査{{N}}回）
- **作成されたファイル数**: {{ファイル数}}件
- **特定された原因候補数**: {{原因候補数}}件

---

## 結論

### 最も可能性が高い原因

#### 1. {{原因名1}}（可能性: 高）

- **カテゴリ**: データベース/アプリケーション/ネットワーク/インフラ
- **影響度**: 高/中/低
- **詳細**: {{原因の詳細説明}}
- **証拠**: [{{ファイルパス}}:{{行番号}}]({{相対パス}}#L{{行番号}})
  - {{証拠の説明}}

#### 2. {{原因名2}}（可能性: 高）

（同様の形式で記述）

### その他の原因候補

- {{原因3}}（可能性: 中） - {{簡潔な説明}}
- {{原因4}}（可能性: 中） - {{簡潔な説明}}

---

## 総合分析

### 性能劣化のメカニズム

{{複数の原因がどのように絡み合って性能劣化を引き起こしているか}}

### 根本原因

{{根本的な原因は何か}}

---

## 推奨アクションプラン

### フェーズ1: 即座に実施（優先度: 高）

#### 1. {{対応項目1}}

- **対応する原因**: {{原因名}}
- **期待される効果**: {{効果の説明}}
- **実装難易度**: 低/中/高
- **所要時間**: {{概算}}
- **リスク**: 低/中/高

**具体的な対応**:
{{対応の詳細}}

#### 2. {{対応項目2}}

（同様の形式で記述）

---

### フェーズ2: 検証後に実施（優先度: 中）

#### 1. {{対応項目3}}

（同様の形式で記述）

---

### フェーズ3: 長期的な改善（優先度: 低）

#### 1. {{対応項目4}}

（同様の形式で記述）

---

## パフォーマンステスト戦略

### 現状の計測

#### 計測すべき指標
1. {{指標1}} - {{目的}}
2. {{指標2}} - {{目的}}

#### 計測方法
{{具体的な計測方法}}

### 改善後の検証

#### ベンチマークシナリオ
1. {{シナリオ1}}
2. {{シナリオ2}}

#### 成功基準
{{どの程度の改善を目標とするか}}

---

## モニタリング・継続的改善

### 追加すべきモニタリング

#### メトリクス
1. {{メトリクス1}} - {{理由}}
2. {{メトリクス2}} - {{理由}}

#### アラート設定
1. {{アラート条件1}}
2. {{アラート条件2}}

### 定期的な見直し項目
- {{見直し項目1}}
- {{見直し項目2}}

---

## 予想される改善効果

| 対応項目 | 改善見込み | 根拠 |
|---------|----------|------|
| {{対応1}} | {{XX%改善}} | {{根拠}} |
| {{対応2}} | {{XX%改善}} | {{根拠}} |
| {{対応3}} | {{XX%改善}} | {{根拠}} |

---

## リスクと注意事項

### 実装時のリスク
1. {{リスク1}}
   - **影響**: {{影響の説明}}
   - **対策**: {{リスク軽減策}}

2. {{リスク2}}
   - **影響**: {{影響の説明}}
   - **対策**: {{リスク軽減策}}

### 注意事項
- {{注意点1}}
- {{注意点2}}

---

## 詳細調査ファイル一覧

以下のファイルに詳細な調査結果が記録されています：

1. [{{ファイル名1}}]({{相対パス1}}) - 初期調査
2. [{{ファイル名2}}]({{相対パス2}}) - 詳細調査1
3. [{{ファイル名3}}]({{相対パス3}}) - 詳細調査2
...

---

## 調査の制限事項

- {{制限事項1}}
- {{制限事項2}}
- {{制限事項3}}

---

## 次のステップ

1. **即座に実施**: {{対応項目}}
2. **パフォーマンステスト**: {{テスト内容}}
3. **効果検証**: {{検証方法}}
4. **継続的モニタリング**: {{モニタリング項目}}

---

*このサマリーは複数の調査結果を統合して自動生成されたものです。実装前に十分な検証を行ってください。*
```

# サマリー作成の注意点

- すべての調査結果を網羅的に把握する
- 最も重要な発見を明確に強調する
- 実行可能なアクションプランを提示する
- リスクと注意事項を明記する
- すべてのファイルパスは相対パスで記載する

必ず Write ツールを使用して、{{サマリーファイル名}} に結果を保存してください。
</summary_template>
