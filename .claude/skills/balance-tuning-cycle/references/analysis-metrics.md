# 分析メトリクス・目標値定義

## 概要

シミュレーション結果の分析に使用するメトリクスと、その目標値・許容範囲を定義する。

---

## 主要メトリクス

### 1. クリア率（Clear Rate）

**定義**: Sランクに到達したシミュレーション回数 / 総シミュレーション回数 × 100

| 項目 | 値 |
|------|-----|
| 目標値 | ユーザー指定（デフォルト: 30%） |
| 許容範囲 | ±5% |
| 下限警告 | 目標 - 10% |
| 上限警告 | 目標 + 10% |

### 2. ランク到達率（Rank Reach Rate）

**定義**: 各ランクに到達したシミュレーション回数 / 総回数 × 100

| ランク | 目標到達率 | 許容範囲 |
|--------|-----------|---------|
| F | 95%+ | ±3% |
| E | 85%+ | ±5% |
| D | 70%+ | ±5% |
| C | 55%+ | ±7% |
| B | 42%+ | ±7% |
| A | 35%+ | ±5% |
| S | 目標クリア率 | ±5% |

### 3. ランク到達日数（Days to Rank）

**定義**: 各ランクに到達するまでの平均日数

| ランク | 期待日数 | 許容範囲 |
|--------|---------|---------|
| F | 3-5日 | ±2日 |
| E | 6-10日 | ±3日 |
| D | 11-15日 | ±3日 |
| C | 16-20日 | ±3日 |
| B | 21-25日 | ±3日 |
| A | 26-28日 | ±2日 |
| S | 29-30日 | ±1日 |

### 4. ドロップオフ率（Drop-off Rate）

**定義**: ランクNに到達したがランクN+1に到達できなかった割合

| 判定 | 条件 |
|------|------|
| 正常 | 5-15% |
| Warning | 15-25% |
| Critical | 25%以上 |

---

## 経済メトリクス

### 5. ゴールド収支バランス

| メトリクス | 目標 | 許容範囲 |
|-----------|------|---------|
| 平均総獲得ゴールド | 800-1500 | ±300 |
| 平均総消費ゴールド | 500-1200 | ±300 |
| 最終残高平均 | 100-500 | ±200 |
| ゴールド破産率（0になる確率） | 10%以下 | +5% |

### 6. 依頼完了メトリクス

| メトリクス | 目標 | 許容範囲 |
|-----------|------|---------|
| 平均完了依頼数 | 18-30 | ±5 |
| 平均失敗依頼数 | 1-5 | ±2 |
| 依頼失敗率 | 5-15% | ±5% |

### 7. 調合メトリクス

| メトリクス | 目標 | 許容範囲 |
|-----------|------|---------|
| 平均調合回数 | 20-35 | ±5 |
| 品質S達成率 | 5-15% | ±5% |
| 品質A達成率 | 15-30% | ±5% |
| 素材不足率 | 10-25% | ±5% |

---

## 難易度曲線メトリクス

### 8. フェーズ別時間配分

各ランクで過ごす平均日数が適切か。

| 判定 | 条件 |
|------|------|
| 正常 | game-balance.json の expected_days 範囲内 |
| Warning | expected_days の±50%以内 |
| Critical | expected_days の±50%超過 |

### 9. 壁（Wall）検出

特定ランクで異常に多くのプレイヤーが停滞するパターン。

**検出条件**:
- ドロップオフ率が20%以上
- 平均滞在日数がexpected_daysの1.5倍以上
- かつ、その後のランクのドロップオフ率が低い

### 10. スノーボール検出

一度有利になると加速的に有利になるパターン。

**検出条件**:
- 後半ランクのクリア速度が期待値の50%未満
- ゴールド残高が増え続ける傾向

---

## 分析レポートフォーマット

```markdown
# Balance Analysis Report - Cycle {N}

## Summary
- クリア率: {clear_rate}% (目標: {target}%)
- 目標との乖離: {deviation}%
- 判定: 収束/未収束

## Key Metrics

### ランク到達率
| ランク | 到達率 | 目標 | 判定 |
|--------|--------|------|------|
| F | 97.2% | 95%+ | OK |
| E | 88.5% | 85%+ | OK |
| ... | | | |

### ランク到達日数
| ランク | 平均日数 | 期待値 | 判定 |
|--------|---------|--------|------|
| F | 4.2 | 3-5 | OK |
| ... | | | |

### ドロップオフ率
| ランク遷移 | 率 | 判定 |
|-----------|-----|------|
| F→E | 8.7% | OK |
| ... | | |

## Problem Identification

### ボトルネック
1. **ランクC→B遷移**: ドロップオフ率24.3%（Critical）
   - 原因推定: 素材不足（B品質素材の入手手段が限定的）
   - 影響: クリア率を10%押し下げている可能性

### 経済バランス
- ゴールド破産率: 12.5%（Warning）
- 原因: 序盤のショップ購入コストが高い

## Adjustment Recommendations

### 優先度: High
1. B品質素材の出現率を上げる（rareRate調整）
2. C→Bランクの必要貢献度を下げる

### 優先度: Medium
3. 序盤カードのコストを下げる
4. ショップ価格の調整

### 優先度: Low
5. 強化カードの効果値の微調整
```

---

## 注意事項

- メトリクスは定量的に計測し、主観的判断を避ける
- 複数メトリクスの相関を考慮する（1つだけ見て判断しない）
- 過去サイクルとの比較で改善傾向を確認する
- 外れ値（極端に良い/悪いシミュレーション結果）を除外して分析する
