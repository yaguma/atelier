# 調整ガイドライン・制約

## 概要

バランスパラメータ調整時に従うべきルールと制約を定義する。

---

## 基本原則

1. **1回の変更幅は控えめに**: 大きな変更は予測困難な副作用を生む
2. **1つずつ調整**: 複数パラメータを同時に変更すると原因特定が困難
3. **根拠を明記**: すべての変更に分析データに基づく理由を付ける
4. **可逆性を確保**: 変更前の値を必ず記録する

---

## 変更幅の制約

### game-balance.json

| パラメータ | 最大変更幅（1サイクル） | 備考 |
|-----------|----------------------|------|
| initial_gold | ±20% | 序盤体験に大きく影響 |
| initial_days | ±2日 | ゲーム全体の長さに影響 |
| action_points_per_day | ±1 | 非常に影響大、慎重に |
| hand_size | ±1 | プレイ感に影響 |
| daily_quest_count | ±1 | 選択肢の幅に影響 |
| material_pool_size | ±1 | 採取の選択肢に影響 |
| quality_variance | ±0.5 | 品質のばらつきに影響 |
| max_concurrent_quests | ±1 | 並行依頼数 |
| storage_capacity | ±5 | インベントリ管理に影響 |

### difficulty_curve

| パラメータ | 最大変更幅（1サイクル） | 備考 |
|-----------|----------------------|------|
| required_contribution | ±20% | ランク昇格の壁に直結 |
| expected_days | 参考値のため変更不要 | |

### quality_multipliers

| パラメータ | 最大変更幅（1サイクル） | 備考 |
|-----------|----------------------|------|
| 各品質の倍率 | ±20% | 報酬に直結 |

### quest_type_multipliers

| パラメータ | 最大変更幅（1サイクル） | 備考 |
|-----------|----------------------|------|
| 各タイプの倍率 | ±20% | 依頼選択に影響 |

### shop_prices

| パラメータ | 最大変更幅（1サイクル） | 備考 |
|-----------|----------------------|------|
| min/max 価格 | ±30% | 経済バランスに影響 |

### gathering_cost

| パラメータ | 最大変更幅（1サイクル） | 備考 |
|-----------|----------------------|------|
| 各段階のコスト | ±1 | APの使い方に大きく影響 |

---

## 変更禁止項目

以下のパラメータは**このスキルでは変更しない**:

| パラメータ | 理由 |
|-----------|------|
| initial_deck | デッキ構成はゲームデザイン側の決定事項 |
| ranks.json の specialRules | ゲームルールの変更は影響が大きすぎる |
| 型定義ファイル（.ts） | コードの変更はこのスキルの範囲外 |
| cards.json の type, unlockRank | カードの基本設計は変更しない |
| promotion_rewards の artifact_choices | 常に3選択肢 |

---

## 優先順位ガイド

### 問題の深刻度別の対応

| 深刻度 | 対応 |
|--------|------|
| クリア率が目標の半分以下 | difficulty_curve の大幅緩和を検討 |
| 特定ランクでドロップオフ率25%以上 | そのランクの required_contribution を緩和 |
| ゴールド破産率20%以上 | initial_gold 増加 or shop_prices 低下 |
| 素材不足が主因 | quality_multipliers 調整 or gathering パラメータ調整 |

### 調整の優先順序

1. **difficulty_curve.required_contribution** — 最も直接的にクリア率に影響
2. **initial_gold** — 序盤の自由度に影響
3. **quality_multipliers** — 報酬効率に影響
4. **quest_type_multipliers** — 依頼バランスに影響
5. **shop_prices** — 経済循環に影響
6. **gathering_cost** — AP効率に影響
7. **その他** — 微調整

---

## ドキュメント化ルール

### 変更記録フォーマット

各パラメータ変更は以下の形式で記録する:

```markdown
### 変更 {連番}: {パラメータ名}
- **変更前**: {old_value}
- **変更後**: {new_value}
- **変更率**: {change_percentage}%
- **根拠**: {analysis_data}（Analyst Agentのレポートから引用）
- **期待効果**: {expected_effect}
- **影響範囲**: {affected_areas}
```

### 累積変更追跡

複数サイクルにわたる変更は累積で追跡する:

```markdown
## 累積変更サマリー

| パラメータ | 初期値 | Cycle1後 | Cycle2後 | ... | 最終値 | 総変動率 |
|-----------|--------|---------|---------|-----|--------|---------|
| initial_gold | 100 | 110 | 120 | ... | 120 | +20% |
```

---

## 安全弁

### 総変動率の制限

1つのパラメータの初期値からの総変動率が**50%を超えた場合**:
- 警告を出力
- Cycle Lead に確認を求める
- ユーザーの承認なしには続行しない

### ゲーム破綻検出

以下の状態が検出された場合、即座にサイクルを停止:
- クリア率が0%（全シミュレーションが失敗）
- クリア率が100%（全シミュレーションが成功 = 難易度ゼロ）
- 平均ゲーム日数が5日未満（ゲームが短すぎる）
- ゴールドが無限に増え続ける（インフレ）

---

## 禁止事項

- 分析データなしでの「感覚的」調整
- 1サイクルで5つ以上のパラメータを同時変更
- 変更理由を記録せずに値を変更
- game-balance.json 以外のマスターデータファイルの変更（原則）
- TypeScriptコードの変更
