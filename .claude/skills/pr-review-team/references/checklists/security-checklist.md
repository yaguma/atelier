# Senior Security Engineer チェックリスト

## 観点: セキュリティ脆弱性・入力検証・データハンドリング

参照ルール: `security.md`

---

## チェック項目

### 1. 入力検証

- [ ] ユーザー入力（テキスト入力, 名前入力等）にサニタイズ処理があるか
- [ ] 数値入力に範囲チェック（min/max）があるか
- [ ] 文字列入力に長さ制限があるか
- [ ] 危険な文字（`<`, `>`, `'`, `"`, `&`）が適切に処理されているか
- [ ] URLパラメータが検証されているか

### 2. データハンドリング

- [ ] `JSON.parse()` が try-catch で囲まれているか
- [ ] セーブデータ読み込み時にスキーマ検証があるか
- [ ] 型ガードで未知データの型が検証されているか
- [ ] ローカルストレージから読み込んだデータが検証されているか
- [ ] 外部から受け取ったデータ（セーブデータ等）の整合性チェックがあるか

### 3. 機密情報管理

- [ ] APIキー、パスワードがハードコードされていないか
- [ ] `.env` ファイルの内容がコードに直接記述されていないか
- [ ] ログ出力に機密情報が含まれていないか
- [ ] エラーメッセージにシステム内部情報（スタックトレース等）が露出していないか
- [ ] `console.log` で機密データが出力されていないか

### 4. XSS対策

- [ ] `innerHTML` に未サニタイズのユーザー入力が設定されていないか
- [ ] DOM要素の動的生成時に適切なエスケープがされているか
- [ ] Phaser以外のHTML要素使用時にXSS対策がされているか

### 5. コードインジェクション防止

- [ ] `eval()` が使用されていないか
- [ ] `Function()` コンストラクタが使用されていないか
- [ ] 動的コード生成がないか
- [ ] 外部スクリプトの動的読み込みがないか
- [ ] 信頼できないURLへのリダイレクトがないか

### 6. ゲーム固有のセキュリティ

- [ ] ゲーム状態の整合性チェックがあるか（ゴールド負数, 所持品上限）
- [ ] セーブデータの改ざん検出機構が適切か
- [ ] ランク値が正しい範囲に制限されているか
- [ ] 数量操作で負の値や異常な値が入力できないか

### 7. 依存関係

- [ ] 新しい依存関係が追加された場合、ライセンスは適切か
- [ ] 既知の脆弱性を持つバージョンが使用されていないか
- [ ] 不要な依存関係が追加されていないか

---

## 重点チェックポイント

### セーブ/ロード機能の変更時
- データフォーマットの後方互換性
- 不正データに対するフォールバック処理
- チェックサム検証の維持

### ユーザー入力の追加時
- 入力値の検証ロジック
- サニタイズ処理の存在
- エラー時のユーザーフィードバック

### エラーハンドリングの変更時
- ユーザー向けメッセージと開発者向けログの分離
- スタックトレースの非露出
