# QA Leader チェックリスト

## 観点: テストカバレッジ・テスト品質・欠落テストケース

参照ルール: `testing.md`

---

## チェック項目

### 1. テスト配置

- [ ] テストファイルは `tests/` または `e2e/` に配置されているか（`src/` 内にないか）
- [ ] テストファイル名は `{対象ファイル名}.test.ts` の形式か
- [ ] ディレクトリ構成が `src/` の構造と対応しているか
- [ ] テストファイルで `@features/`, `@shared/` 等のエイリアスを使用しているか（相対パス禁止）

### 2. テスト存在チェック

- [ ] 新規追加された `services/` のコードにユニットテストがあるか
- [ ] 新規追加されたユーティリティ関数にテストがあるか
- [ ] 変更された既存ロジックのテストが更新されているか
- [ ] 削除されたコードに対応するテストも削除されているか

### 3. テスト品質 - 構造

- [ ] AAA（Arrange-Act-Assert）パターンに従っているか
- [ ] `describe` で対象名が適切に分類されているか
- [ ] `it` / `test` の記述が「〜する」形式で期待する振る舞いを説明しているか
- [ ] 正常系と異常系が `describe` で分離されているか

### 4. テスト品質 - カバレッジ

- [ ] 正常系のテストがあるか
- [ ] 異常系（エラーケース）のテストがあるか
- [ ] 境界値テストがあるか（最小値, 最大値, 境界の前後）
- [ ] エッジケースが考慮されているか（空配列, null/undefined, 0, 負数）

### 5. テスト品質 - 信頼性

- [ ] テスト間で状態を共有していないか（独立実行可能）
- [ ] テストが決定的か（毎回同じ結果を返す）
- [ ] 時間依存のテストで `vi.useFakeTimers()` が使われているか
- [ ] ランダム値に依存するテストがないか（シード固定 or モック）

### 6. モック

- [ ] 外部API呼び出しがモックされているか
- [ ] モックが過剰でないか（実装詳細への依存を避ける）
- [ ] `beforeEach` で `vi.clearAllMocks()` が呼ばれているか
- [ ] モックの戻り値が現実的な値か

### 7. テスト運用

- [ ] `it.skip` / `describe.skip` が放置されていないか
- [ ] `.only()` が残っていないか
- [ ] `console.log` がテスト内に残っていないか
- [ ] テストのタイムアウト設定が適切か

### 8. E2Eテスト（該当する場合）

- [ ] Page Objectパターンが使用されているか
- [ ] `data-testid` 属性でセレクタが安定化されているか
- [ ] 待機は明示的か（`waitFor`, `expect.poll`）
- [ ] テストデータがフィクスチャで管理されているか

---

## 欠落テストケースの特定方法

### 新規コードの分析

1. 新規 `services/` ファイルの全関数をリスト化
2. 各関数の引数の型から境界値を特定
3. 条件分岐（if/switch）から網羅すべきケースを特定
4. エラーが発生しうるケースを列挙

### 変更コードの分析

1. 変更された条件分岐が既存テストでカバーされているか確認
2. 新しいコードパスが追加された場合、対応テストがあるか確認
3. 既存テストが変更後の仕様と整合しているか確認

---

## 重点チェックポイント

### Functional Core（services/）の変更時
- カバレッジ90%以上が維持されているか
- 全パブリック関数にテストがあるか
- 異常系テストが網羅的か

### 状態管理の変更時
- StateManager連携のテストがあるか
- フェーズ遷移の正常系/異常系テストがあるか
