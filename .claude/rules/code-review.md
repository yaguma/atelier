# コードレビュー基準

## 概要

PRコードレビュー時に適用する共通基準。全レビュアーはこのルールに従う。

---

## 重要度定義

| レベル | 定義 | 対応 |
|--------|------|------|
| **Critical** | バグ・セキュリティ脆弱性・データ損失のリスク | マージ前に必ず修正 |
| **Warning** | 保守性・可読性・パフォーマンスの懸念 | 修正を強く推奨 |
| **Info** | 改善提案・ベストプラクティスの紹介 | 任意対応 |

### Critical の基準

以下のいずれかに該当する場合:
- 実行時エラーやクラッシュを引き起こす
- セキュリティ脆弱性（XSS, インジェクション, 機密情報漏洩）
- データ破損・データ損失のリスク
- ゲームロジックの明確な誤り（報酬計算、状態遷移の不整合）
- メモリリーク（EventBus購読解除忘れ、リソース未解放）

### Warning の基準

以下のいずれかに該当する場合:
- アーキテクチャルールへの違反（Feature-Based, Functional Core分離）
- 型安全性の欠如（any型使用, 不適切なキャスト）
- テスト不足（新機能にテストなし, エッジケース未カバー）
- パフォーマンス懸念（update()内の重い処理, 不要なオブジェクト生成）
- コーディング規約違反（命名規則, ファイル構成）

### Info の基準

以下のいずれかに該当する場合:
- より良い実装パターンの提案
- コメントの改善提案
- 軽微なリファクタリング提案
- ドキュメント更新の推奨

---

## レビュー時の行動規範

### 必須事項

- 指摘には必ず**根拠**を示す（ルールファイル名、コード箇所、再現手順）
- **ファイル編集は禁止** - レビュアーはRead/Glob/Grepのみ使用
- 具体的な修正案を提示する（「良くない」だけでなく「こうすべき」を示す）
- 既存コードと新規コードを区別し、**PR差分に含まれる変更のみ**をレビュー対象とする

### 禁止事項

- 好みや主観のみに基づく指摘
- 根拠なしでのCritical判定
- PR差分に含まれない既存コードへの指摘（別途Issueで対応）
- レビュアー間で重複する指摘の個別投稿（Team Leadが統合）

---

## 既存ツールとの使い分け

| | tdd-code-review | pr-review-team |
|---|---|---|
| **タイミング** | 開発中（コミット前） | PR作成後 |
| **エージェント** | 1（単一） | 6（5レビュアー + リード） |
| **並列性** | なし | 5並列 |
| **議論分析** | なし | クロスカッティング分析 |
| **出力先** | docs/code-reviews/ | PRコメント + docs/reviews/ |
| **推奨用途** | 日常的な品質チェック | マージ前の包括的レビュー |
