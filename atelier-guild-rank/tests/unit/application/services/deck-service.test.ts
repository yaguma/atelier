/**
 * DeckService ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
 * TASK-0009 ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»DeckServiceå®Ÿè£…
 *
 * @description
 * T-0009-01 ã€œ T-0009-06, T-DECK-01 ã€œ T-DECK-05 ã‚’å®Ÿè£…
 */

import { Card } from '@domain/entities/Card';
import type { IDeckService } from '@domain/interfaces/deck-service.interface';
import type { IMasterDataRepository } from '@domain/interfaces/master-data-repository.interface';
import { DeckService } from '@shared/services/deck-service';
import type { IEventBus } from '@shared/services/event-bus';
import type { CardMaster } from '@shared/types';
import { GuildRank, Rarity, toCardId } from '@shared/types';
import { beforeEach, describe, expect, it, vi } from 'vitest';

// ãƒ¢ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
const mockCardMasters: Record<string, CardMaster> = {
  'card-001': {
    id: toCardId('card-001'),
    name: 'ã‚«ãƒ¼ãƒ‰1',
    type: 'GATHERING',
    baseCost: 0,
    presentationCount: 2,
    rareRate: 0,
    materialPool: ['weed'],
    rarity: Rarity.COMMON,
    unlockRank: GuildRank.G,
    description: 'ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰1',
  },
  'card-002': {
    id: toCardId('card-002'),
    name: 'ã‚«ãƒ¼ãƒ‰2',
    type: 'GATHERING',
    baseCost: 0,
    presentationCount: 2,
    rareRate: 0,
    materialPool: ['water'],
    rarity: Rarity.COMMON,
    unlockRank: GuildRank.G,
    description: 'ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰2',
  },
  'card-003': {
    id: toCardId('card-003'),
    name: 'ã‚«ãƒ¼ãƒ‰3',
    type: 'RECIPE',
    cost: 1,
    requiredMaterials: [{ materialId: 'herb', quantity: 1 }],
    outputItemId: 'potion',
    category: 'MEDICINE',
    rarity: Rarity.COMMON,
    unlockRank: GuildRank.G,
    description: 'ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰3',
  },
};

// ãƒ¢ãƒƒã‚¯MasterDataRepository
class MockMasterDataRepository implements Partial<IMasterDataRepository> {
  getCardById(id: unknown): CardMaster | undefined {
    const idStr = String(id);
    return mockCardMasters[idStr];
  }

  isLoaded(): boolean {
    return true;
  }
}

// ãƒ¢ãƒƒã‚¯EventBus
class MockEventBus implements Partial<IEventBus> {
  emit = vi.fn();
  on = vi.fn();
  off = vi.fn();
  once = vi.fn();
}

describe('DeckService', () => {
  let deckService: IDeckService;
  let mockMasterDataRepo: IMasterDataRepository;
  let mockEventBus: IEventBus;

  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«DeckServiceã‚’åˆæœŸåŒ–
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: ãƒ¢ãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã¨EventBusã‚’ä½œæˆã—ã€DeckServiceã«æ³¨å…¥
    mockMasterDataRepo = new MockMasterDataRepository() as IMasterDataRepository;
    mockEventBus = new MockEventBus() as IEventBus;
    deckService = new DeckService(mockMasterDataRepo, mockEventBus);
  });

  // =============================================================================
  // T-0009-01: initialize()ã§åˆæœŸãƒ‡ãƒƒã‚­æ§‹ç¯‰
  // =============================================================================

  describe('initialize', () => {
    it('T-0009-01: initialize()ã§åˆæœŸãƒ‡ãƒƒã‚­æ§‹ç¯‰ã¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: åˆæœŸãƒ‡ãƒƒã‚­ãŒæ­£ã—ãæ§‹ç¯‰ã•ã‚Œã€è‡ªå‹•çš„ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã§Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã€ãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã§Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã€ãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: 3æšã®ã‚«ãƒ¼ãƒ‰ã§æœ€å°é™ã®ãƒ‡ãƒƒã‚­ã‚’æ§‹ç¯‰ã—ã€åŸºæœ¬å‹•ä½œã‚’ç¢ºèª
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: åˆæœŸãƒ‡ãƒƒã‚­IDã‚’æº–å‚™
      const initialDeckIds = [toCardId('card-001'), toCardId('card-002'), toCardId('card-003')];

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: initialize()ã‚’å‘¼ã³å‡ºã—ã€åˆæœŸãƒ‡ãƒƒã‚­ã‚’æ§‹ç¯‰
      // ã€å‡¦ç†å†…å®¹ã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã§ãƒ‡ãƒƒã‚­ã‚’åˆæœŸåŒ–ã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      deckService.initialize(initialDeckIds);

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒƒã‚­ãŒæ­£ã—ãæ§‹ç¯‰ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ‡ãƒƒã‚­ã®æšæ•°ãŒæŒ‡å®šã—ãŸæšæ•°ã¨ä¸€è‡´ã™ã‚‹
      const deck = deckService.getDeck();
      expect(deck.length).toBe(3); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ã«3æšã®ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ ğŸ”µ
    });
  });

  // =============================================================================
  // T-DECK-01: reset()ã§çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
  // =============================================================================

  describe('reset', () => {
    it('T-DECK-01: reset()ã§å±±æœ­ãƒ»æ‰‹æœ­ãƒ»æ¨ã¦æœ­ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒªã‚»ãƒƒãƒˆå¾Œã€å…¨ã¦ã®çŠ¶æ…‹ãŒç©ºã«ãªã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å±±æœ­ã€æ‰‹æœ­ã€æ¨ã¦æœ­ãŒå…¨ã¦ç©ºé…åˆ—ã«ãªã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å±±æœ­ã€æ‰‹æœ­ã€æ¨ã¦æœ­ãŒå…¨ã¦ç©ºé…åˆ—ã«ãªã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: äº‹å‰ã«ãƒ‡ãƒƒã‚­ã‚’åˆæœŸåŒ–ã—ã¦ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ­ãƒ¼ãƒ»ãƒ—ãƒ¬ã‚¤ã—ãŸçŠ¶æ…‹
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: çŠ¶æ…‹ãŒã‚ã‚‹çŠ¶æ…‹ã‹ã‚‰ãƒªã‚»ãƒƒãƒˆã‚’å®Ÿè¡Œ
      deckService.initialize([toCardId('card-001'), toCardId('card-002')]);
      deckService.draw(1);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: reset()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: å…¨ã¦ã®å†…éƒ¨çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
      deckService.reset();

      // ã€çµæœæ¤œè¨¼ã€‘: å…¨ã¦ã®å†…éƒ¨é…åˆ—ãŒç©ºã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒªã‚»ãƒƒãƒˆæ™‚ã«å…¨ã¦ã®å†…éƒ¨çŠ¶æ…‹ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹
      expect(deckService.getDeck().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒç©ºã«ãªã‚‹ ğŸ”µ
      expect(deckService.getHand().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒç©ºã«ãªã‚‹ ğŸ”µ
      expect(deckService.getDiscard().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: æ¨ã¦æœ­ãŒç©ºã«ãªã‚‹ ğŸ”µ
    });
  });

  // =============================================================================
  // T-0009-02: shuffle()ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  // =============================================================================

  describe('shuffle', () => {
    it('T-0009-02: shuffle()ã§Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚·ãƒ£ãƒƒãƒ•ãƒ«', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œã«ãƒ‡ãƒƒã‚­ã®é †åºãŒå¤‰ã‚ã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ã®è¦ç´ ã¯å¤‰ã‚ã‚‰ãªã„ãŒã€é †åºãŒãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ‡ãƒƒã‚­ã®è¦ç´ ã¯å¤‰ã‚ã‚‰ãªã„ãŒã€é †åºãŒãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: 10æšã®ã‚«ãƒ¼ãƒ‰ã‚’æŒã¤ãƒ‡ãƒƒã‚­
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ååˆ†ãªæ•°ã®ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Œã°ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œã«é †åºãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: shuffle()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å±±æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      deckService.shuffle();

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒƒã‚­ã®é•·ã•ã¯å¤‰ã‚ã‚‰ãšã€è¦ç´ ãŒä¿æŒã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯è¦ç´ ã‚’ä¿æŒã—ãŸã¾ã¾é †åºã®ã¿ã‚’å¤‰æ›´ã™ã‚‹
      const deck = deckService.getDeck();
      expect(deck.length).toBe(10); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ã®é•·ã•ã¯å¤‰ã‚ã‚‰ãªã„ ğŸ”µ
    });
  });

  // =============================================================================
  // T-0009-03: draw()ã§æ‰‹æœ­ã«ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹
  // =============================================================================

  describe('draw', () => {
    it('T-0009-03: draw()ã§å±±æœ­ã‹ã‚‰æ‰‹æœ­ã«ã‚«ãƒ¼ãƒ‰ãŒç§»å‹•', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ‰ãƒ­ãƒ¼å‡¦ç†ã«ã‚ˆã‚Šã€å±±æœ­ãŒæ¸›å°‘ã—ã€æ‰‹æœ­ãŒå¢—åŠ ã™ã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æŒ‡å®šæšæ•°ãŒå±±æœ­ã‹ã‚‰æ‰‹æœ­ã«ç§»å‹•ã—ã€CARD_DRAWNã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æŒ‡å®šæšæ•°ãŒå±±æœ­ã‹ã‚‰æ‰‹æœ­ã«ç§»å‹•ã—ã€CARD_DRAWNã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å±±æœ­10æšã®çŠ¶æ…‹ã§draw(3)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: é€šå¸¸ã®ãƒ‰ãƒ­ãƒ¼æ“ä½œã‚’æ¨¡æ“¬
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(3)ã‚’å‘¼ã³å‡ºã—ã€3æšã®ãƒ‰ãƒ­ãƒ¼ã‚’è©¦ã¿ã‚‹
      // ã€å‡¦ç†å†…å®¹ã€‘: å±±æœ­ã‹ã‚‰3æšå–å¾—ã—ã¦æ‰‹æœ­ã«è¿½åŠ 
      const drawnCards = deckService.draw(3);

      // ã€çµæœæ¤œè¨¼ã€‘: å±±æœ­ã¨æ‰‹æœ­ã®æšæ•°ãŒæ­£ã—ãå¤‰åŒ–ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ‰ãƒ­ãƒ¼ã¯å±±æœ­ã‹ã‚‰æ‰‹æœ­ã¸ã®ç§»å‹•æ“ä½œ
      expect(deckService.getDeck().length).toBe(7); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒ3æšæ¸›å°‘ï¼ˆ10 - 3ï¼‰ ğŸ”µ
      expect(deckService.getHand().length).toBe(3); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒ3æšå¢—åŠ  ğŸ”µ
      expect(drawnCards.length).toBe(3); // ã€ç¢ºèªå†…å®¹ã€‘: æˆ»ã‚Šå€¤ã®é…åˆ—é•·ãŒ3 ğŸ”µ
    });
  });

  // =============================================================================
  // T-0009-04: ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®ãƒ‰ãƒ­ãƒ¼ï¼ˆæ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰
  // =============================================================================

  describe('ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®ãƒ‰ãƒ­ãƒ¼', () => {
    it('T-0009-04: ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã«æ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å±±æœ­ã«æˆ»ã™', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å±±æœ­ãŒç©ºã«ãªã£ãŸéš›ã€è‡ªå‹•çš„ã«æ¨ã¦æœ­ãŒã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã¦å±±æœ­ã«æˆ»ã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ¨ã¦æœ­ãŒå±±æœ­ã«ç§»å‹•ã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã€ãƒ‰ãƒ­ãƒ¼ãŒç¶™ç¶šã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ¨ã¦æœ­ãŒå±±æœ­ã«ç§»å‹•ã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã€ãƒ‰ãƒ­ãƒ¼ãŒç¶™ç¶šã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å±±æœ­2æšã€æ¨ã¦æœ­10æšã®çŠ¶æ…‹ã§draw(5)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‰ãƒ­ãƒ¼é€”ä¸­ã§å±±æœ­ãŒæ¯æ¸‡ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚’æ¨¡æ“¬
      const cardIds = Array.from({ length: 12 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // å±±æœ­ã‚’2æšã ã‘æ®‹ã—ã¦ã€æ®‹ã‚Šã‚’æ‰‹æœ­ã«å¼•ã„ã¦ã‹ã‚‰æ¨ã¦æœ­ã«ç§»å‹•
      const cardsToPlay = deckService.draw(10);
      for (const card of cardsToPlay) {
        deckService.playCard(card);
      }

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(5)ã‚’å‘¼ã³å‡ºã—ã€5æšã®ãƒ‰ãƒ­ãƒ¼ã‚’è©¦ã¿ã‚‹
      // ã€å‡¦ç†å†…å®¹ã€‘: å±±æœ­ã‹ã‚‰2æšå–å¾—å¾Œã€æ¨ã¦æœ­10æšã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å±±æœ­ã«æˆ»ã—ã€æ®‹ã‚Š3æšã‚’å–å¾—
      const drawnCards = deckService.draw(5);

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‰ãƒ­ãƒ¼ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ãŒ5æšã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: å±±æœ­2æš + ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œã®å±±æœ­ã‹ã‚‰3æš = åˆè¨ˆ5æš
      expect(drawnCards.length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: 5æšå…¨ã¦ãŒãƒ‰ãƒ­ãƒ¼ã•ã‚Œã‚‹ ğŸ”µ
      expect(deckService.getDiscard().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: æ¨ã¦æœ­ãŒç©ºã«ãªã‚‹ï¼ˆå…¨ã¦å±±æœ­ã«æˆ»ã£ãŸï¼‰ ğŸ”µ
    });
  });

  // =============================================================================
  // T-0009-05: playCard()ã§æ‰‹æœ­ã‹ã‚‰æ¨ã¦æœ­ã«ç§»å‹•
  // =============================================================================

  describe('playCard', () => {
    it('T-0009-05: playCard()ã§ã‚«ãƒ¼ãƒ‰ãŒæ‰‹æœ­ã‹ã‚‰æ¨ã¦æœ­ã«ç§»å‹•', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤å‡¦ç†ã«ã‚ˆã‚Šã€æ‰‹æœ­ã‹ã‚‰æ¨ã¦æœ­ã«ã‚«ãƒ¼ãƒ‰ãŒç§»å‹•ã™ã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æŒ‡å®šã‚«ãƒ¼ãƒ‰ãŒæ‰‹æœ­ã‹ã‚‰å‰Šé™¤ã•ã‚Œã€æ¨ã¦æœ­ã«è¿½åŠ ã•ã‚Œã€CARD_PLAYEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æŒ‡å®šã‚«ãƒ¼ãƒ‰ãŒæ‰‹æœ­ã‹ã‚‰å‰Šé™¤ã•ã‚Œã€æ¨ã¦æœ­ã«è¿½åŠ ã•ã‚Œã€CARD_PLAYEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­5æšã®çŠ¶æ…‹ã§ã€ãã®ã†ã¡1æšã‚’ãƒ—ãƒ¬ã‚¤
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: é€šå¸¸ã®ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤æ“ä½œã‚’æ¨¡æ“¬
      const cardIds = Array.from({ length: 5 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      const hand = deckService.draw(5);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: playCard()ã‚’å‘¼ã³å‡ºã—ã€æ‰‹æœ­ã®1æšã‚’ãƒ—ãƒ¬ã‚¤
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã€æ¨ã¦æœ­ã«è¿½åŠ 
      const cardToPlay = hand[0];
      deckService.playCard(cardToPlay);

      // ã€çµæœæ¤œè¨¼ã€‘: æ‰‹æœ­ã¨æ¨ã¦æœ­ã®æšæ•°ãŒæ­£ã—ãå¤‰åŒ–ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ—ãƒ¬ã‚¤ã¯æ‰‹æœ­ã‹ã‚‰æ¨ã¦æœ­ã¸ã®ç§»å‹•æ“ä½œ
      expect(deckService.getHand().length).toBe(4); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒ1æšæ¸›å°‘ï¼ˆ5 - 1ï¼‰ ğŸ”µ
      expect(deckService.getDiscard().length).toBe(1); // ã€ç¢ºèªå†…å®¹ã€‘: æ¨ã¦æœ­ãŒ1æšå¢—åŠ  ğŸ”µ
    });
  });

  // =============================================================================
  // T-DECK-02: discardHand()ã§æ‰‹æœ­ã‚’å…¨ã¦æ¨ã¦æœ­ã«ç§»å‹•
  // =============================================================================

  describe('discardHand', () => {
    it('T-DECK-02: discardHand()ã§æ‰‹æœ­ãŒå…¨ã¦æ¨ã¦æœ­ã«ç§»å‹•', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ‰‹æœ­ç ´æ£„å‡¦ç†ã«ã‚ˆã‚Šã€å…¨ã¦ã®æ‰‹æœ­ãŒæ¨ã¦æœ­ã«ç§»å‹•ã™ã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­ãŒç©ºã«ãªã‚Šã€æ¨ã¦æœ­ãŒå¢—åŠ ã—ã€CARD_DISCARDEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ‰‹æœ­ãŒç©ºã«ãªã‚Šã€æ¨ã¦æœ­ãŒå¢—åŠ ã—ã€CARD_DISCARDEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­5æšã®çŠ¶æ…‹ã§discardHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã®æ‰‹æœ­ç ´æ£„ã‚’æ¨¡æ“¬
      const cardIds = Array.from({ length: 5 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(5);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: discardHand()ã‚’å‘¼ã³å‡ºã—ã€æ‰‹æœ­ã‚’å…¨ã¦ç ´æ£„
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã‚’å…¨ã¦æ¨ã¦æœ­ã«ç§»å‹•
      deckService.discardHand();

      // ã€çµæœæ¤œè¨¼ã€‘: æ‰‹æœ­ãŒç©ºã«ãªã‚Šã€æ¨ã¦æœ­ã«å…¨ã¦ç§»å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ‰‹æœ­ç ´æ£„ã¯å…¨ã¦ã®æ‰‹æœ­ã‚’æ¨ã¦æœ­ã«ç§»å‹•ã™ã‚‹æ“ä½œ
      expect(deckService.getHand().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒç©ºã«ãªã‚‹ ğŸ”µ
      expect(deckService.getDiscard().length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: æ¨ã¦æœ­ãŒ5æšã«ãªã‚‹ ğŸ”µ
    });
  });

  // =============================================================================
  // T-0009-06: refillHand()ã§æ‰‹æœ­ã‚’5æšã¾ã§è£œå……
  // =============================================================================

  describe('refillHand', () => {
    it('T-0009-06: refillHand()ã§æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ‰‹æœ­è£œå……å‡¦ç†ã«ã‚ˆã‚Šã€æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼ã•ã‚Œã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­ãŒ5æšæœªæº€ã®å ´åˆã€5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ‰‹æœ­ãŒ5æšæœªæº€ã®å ´åˆã€5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­2æšã€å±±æœ­10æšã®çŠ¶æ…‹ã§refillHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­ãŒæ¸›ã£ãŸçŠ¶æ…‹ã‹ã‚‰ã®è£œå……ã‚’æ¨¡æ“¬
      const cardIds = Array.from({ length: 12 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(2);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: refillHand()ã‚’å‘¼ã³å‡ºã—ã€æ‰‹æœ­ã‚’5æšã¾ã§è£œå……
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼
      deckService.refillHand();

      // ã€çµæœæ¤œè¨¼ã€‘: æ‰‹æœ­ãŒæ­£ç¢ºã«5æšã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ‰‹æœ­ä¸Šé™ï¼ˆ5æšï¼‰ã¾ã§è‡ªå‹•çš„ã«ãƒ‰ãƒ­ãƒ¼ã•ã‚Œã‚‹
      expect(deckService.getHand().length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒ5æšã«ãªã‚‹ ğŸ”µ
      expect(deckService.getDeck().length).toBe(7); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒ7æšã«ãªã‚‹ï¼ˆ12 - 5ï¼‰ ğŸ”µ
    });

    it('T-DECK-03: refillHand()ã§æ‰‹æœ­ãŒæ—¢ã«5æšã®å ´åˆã¯ãƒ‰ãƒ­ãƒ¼ã—ãªã„', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ‰‹æœ­ãŒä¸Šé™ã«é”ã—ã¦ã„ã‚‹å ´åˆã€ãƒ‰ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­æšæ•°ãŒå¤‰ã‚ã‚‰ãšã€å±±æœ­ã‚‚æ¸›ã‚‰ãªã„
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ‰‹æœ­æšæ•°ãŒå¤‰ã‚ã‚‰ãšã€å±±æœ­ã‚‚æ¸›ã‚‰ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰æ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­5æšã€å±±æœ­10æšã®çŠ¶æ…‹ã§refillHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­ä¸Šé™ã«é”ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã®è£œå……ã‚’è©¦ã¿ã‚‹
      const cardIds = Array.from({ length: 15 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(5);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: refillHand()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ãŒæ—¢ã«5æšãªã®ã§ä½•ã‚‚ã—ãªã„
      deckService.refillHand();

      // ã€çµæœæ¤œè¨¼ã€‘: æ‰‹æœ­ã¨å±±æœ­ã®æšæ•°ãŒå¤‰åŒ–ã—ãªã„ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ‰‹æœ­ãŒä¸Šé™ã«é”ã—ã¦ã„ã‚‹å ´åˆã¯è£œå……ä¸è¦
      expect(deckService.getHand().length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒ5æšã®ã¾ã¾ï¼ˆå¤‰åŒ–ãªã—ï¼‰ ğŸ”µ
      expect(deckService.getDeck().length).toBe(10); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒ10æšã®ã¾ã¾ï¼ˆå¤‰åŒ–ãªã—ï¼‰ ğŸ”µ
    });
  });

  // =============================================================================
  // T-DECK-04: addCard()ã§ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã«è¿½åŠ 
  // =============================================================================

  describe('addCard', () => {
    it('T-DECK-04: addCard()ã§ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã«è¿½åŠ ', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ‡ãƒƒã‚­æ§‹ç¯‰æ™‚ã«ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã§ãã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã§Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã€ãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã§Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã€ãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å­˜åœ¨ã™ã‚‹ã‚«ãƒ¼ãƒ‰IDã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒƒã‚­ã«è¿½åŠ 
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ç©ºã®ãƒ‡ãƒƒã‚­ã‹ã‚‰é–‹å§‹
      deckService.reset();

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCard()ã‚’å‘¼ã³å‡ºã—ã€ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ 
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã€ãƒ‡ãƒƒã‚­ã«è¿½åŠ 
      deckService.addCard(toCardId('card-001'));

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒƒã‚­ã®æšæ•°ãŒ1æšå¢—åŠ ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: addCard()ã¯ãƒ‡ãƒƒã‚­æ§‹ç¯‰ã®ãŸã‚ã®è¿½åŠ æ“ä½œ
      const deck = deckService.getDeck();
      expect(deck.length).toBe(1); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ã«1æšè¿½åŠ ã•ã‚Œã‚‹ ğŸ”µ
      expect(deck[0].id).toBe(toCardId('card-001')); // ã€ç¢ºèªå†…å®¹ã€‘: è¿½åŠ ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã®IDãŒæ­£ã—ã„ ğŸ”µ
    });
  });

  // =============================================================================
  // T-DECK-05: removeCard()ã§ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã‹ã‚‰å‰Šé™¤
  // =============================================================================

  describe('removeCard', () => {
    it('T-DECK-05: removeCard()ã§ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã‹ã‚‰å‰Šé™¤', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ‡ãƒƒã‚­æ§‹ç¯‰æ™‚ã«ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã§ãã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã«ä¸€è‡´ã™ã‚‹æœ€åˆã®ã‚«ãƒ¼ãƒ‰ãŒãƒ‡ãƒƒã‚­ã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã«ä¸€è‡´ã™ã‚‹æœ€åˆã®ã‚«ãƒ¼ãƒ‰ãŒãƒ‡ãƒƒã‚­ã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ‡ãƒƒã‚­ã«3æšï¼ˆcard-001, card-002, card-001ï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§removeCard(toCardId('card-001'))ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: é‡è¤‡ã™ã‚‹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã€æœ€åˆã®1æšã®ã¿ãŒå‰Šé™¤ã•ã‚Œã‚‹
      deckService.initialize([toCardId('card-001'), toCardId('card-002'), toCardId('card-001')]);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: removeCard()ã‚’å‘¼ã³å‡ºã—ã€ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤
      // ã€å‡¦ç†å†…å®¹ã€‘: æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã®æœ€åˆã®1æšã‚’å‰Šé™¤
      deckService.removeCard(toCardId('card-001'));

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒƒã‚­ã®æšæ•°ãŒ1æšæ¸›å°‘ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: removeCard()ã¯æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã®æœ€åˆã®1æšã‚’å‰Šé™¤
      const deck = deckService.getDeck();
      expect(deck.length).toBe(2); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ã‹ã‚‰1æšå‰Šé™¤ã•ã‚Œã‚‹ï¼ˆ3 â†’ 2ï¼‰ ğŸ”µ
    });
  });

  // =============================================================================
  // T-DECK-06ã€œ09: çŠ¶æ…‹å–å¾—
  // =============================================================================

  describe('çŠ¶æ…‹å–å¾—', () => {
    it('T-DECK-06: getDeck()ã§readonlyé…åˆ—ã¨ã—ã¦å±±æœ­ã‚’å–å¾—', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å±±æœ­ã®å†…å®¹ãŒå–å¾—ã§ãã€å¤–éƒ¨ã‹ã‚‰å¤‰æ›´ã§ããªã„ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å±±æœ­ã®å†…å®¹ãŒreadonlyé…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã€å¤–éƒ¨å¤‰æ›´ãŒå†…éƒ¨ã«å½±éŸ¿ã—ãªã„
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å±±æœ­ã®å†…å®¹ãŒreadonlyé…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã€å¤–éƒ¨å¤‰æ›´ãŒå†…éƒ¨ã«å½±éŸ¿ã—ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å±±æœ­10æšã®çŠ¶æ…‹ã§getDeck()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: å±±æœ­ã®å†…å®¹ã‚’å¤–éƒ¨ã‹ã‚‰å‚ç…§
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: getDeck()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: å±±æœ­ã‚’readonlyé…åˆ—ã¨ã—ã¦å–å¾—
      const deck = deckService.getDeck();

      // ã€çµæœæ¤œè¨¼ã€‘: æˆ»ã‚Šå€¤ã®é…åˆ—é•·ãŒ10ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸å¤‰æ€§ã‚’ä¿ã¤ãŸã‚ã€readonlyé…åˆ—ã‚’è¿”ã™
      expect(deck.length).toBe(10); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒ10æš ğŸ”µ
    });

    it('T-DECK-07: getHand()ã§readonlyé…åˆ—ã¨ã—ã¦æ‰‹æœ­ã‚’å–å¾—', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ‰‹æœ­ã®å†…å®¹ãŒå–å¾—ã§ãã€å¤–éƒ¨ã‹ã‚‰å¤‰æ›´ã§ããªã„ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­ã®å†…å®¹ãŒreadonlyé…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã€å¤–éƒ¨å¤‰æ›´ãŒå†…éƒ¨ã«å½±éŸ¿ã—ãªã„
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ‰‹æœ­ã®å†…å®¹ãŒreadonlyé…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã€å¤–éƒ¨å¤‰æ›´ãŒå†…éƒ¨ã«å½±éŸ¿ã—ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­5æšã®çŠ¶æ…‹ã§getHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­ã®å†…å®¹ã‚’å¤–éƒ¨ã‹ã‚‰å‚ç…§
      const cardIds = Array.from({ length: 5 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(5);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: getHand()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã‚’readonlyé…åˆ—ã¨ã—ã¦å–å¾—
      const hand = deckService.getHand();

      // ã€çµæœæ¤œè¨¼ã€‘: æˆ»ã‚Šå€¤ã®é…åˆ—é•·ãŒ5ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸å¤‰æ€§ã‚’ä¿ã¤ãŸã‚ã€readonlyé…åˆ—ã‚’è¿”ã™
      expect(hand.length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒ5æš ğŸ”µ
    });

    it('T-DECK-08: getDiscard()ã§readonlyé…åˆ—ã¨ã—ã¦æ¨ã¦æœ­ã‚’å–å¾—', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ¨ã¦æœ­ã®å†…å®¹ãŒå–å¾—ã§ãã€å¤–éƒ¨ã‹ã‚‰å¤‰æ›´ã§ããªã„ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ¨ã¦æœ­ã®å†…å®¹ãŒreadonlyé…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã€å¤–éƒ¨å¤‰æ›´ãŒå†…éƒ¨ã«å½±éŸ¿ã—ãªã„
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ¨ã¦æœ­ã®å†…å®¹ãŒreadonlyé…åˆ—ã¨ã—ã¦è¿”ã•ã‚Œã€å¤–éƒ¨å¤‰æ›´ãŒå†…éƒ¨ã«å½±éŸ¿ã—ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ¨ã¦æœ­8æšã®çŠ¶æ…‹ã§getDiscard()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ¨ã¦æœ­ã®å†…å®¹ã‚’å¤–éƒ¨ã‹ã‚‰å‚ç…§
      const cardIds = Array.from({ length: 8 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      const hand = deckService.draw(8);
      for (const card of hand) {
        deckService.playCard(card);
      }

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: getDiscard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ¨ã¦æœ­ã‚’readonlyé…åˆ—ã¨ã—ã¦å–å¾—
      const discard = deckService.getDiscard();

      // ã€çµæœæ¤œè¨¼ã€‘: æˆ»ã‚Šå€¤ã®é…åˆ—é•·ãŒ8ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸å¤‰æ€§ã‚’ä¿ã¤ãŸã‚ã€readonlyé…åˆ—ã‚’è¿”ã™
      expect(discard.length).toBe(8); // ã€ç¢ºèªå†…å®¹ã€‘: æ¨ã¦æœ­ãŒ8æš ğŸ”µ
    });

    it('T-DECK-09: getHandSize()ã§æ‰‹æœ­æšæ•°ã‚’å–å¾—', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ‰‹æœ­ã®æšæ•°ãŒæ­£ã—ãå–å¾—ã§ãã‚‹ã“ã¨
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­ã®æšæ•°ãŒæ•°å€¤ã¨ã—ã¦è¿”ã•ã‚Œã‚‹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: æ‰‹æœ­ã®æšæ•°ãŒæ•°å€¤ã¨ã—ã¦è¿”ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­3æšã®çŠ¶æ…‹ã§getHandSize()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­æšæ•°ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å–å¾—
      const cardIds = Array.from({ length: 3 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(3);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: getHandSize()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã®æšæ•°ã‚’æ•°å€¤ã¨ã—ã¦å–å¾—
      const handSize = deckService.getHandSize();

      // ã€çµæœæ¤œè¨¼ã€‘: æˆ»ã‚Šå€¤ãŒ3ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ‰‹æœ­é…åˆ—ã®é•·ã•ã‚’è¿”ã™
      expect(handSize).toBe(3); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­æšæ•°ãŒ3 ğŸ”µ
    });
  });

  // =============================================================================
  // ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ: T-DECK-10ã€œ13
  // =============================================================================

  describe('ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ', () => {
    it('T-DECK-10: å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã‚’è¿½åŠ æ™‚ã«INVALID_CARD_IDã‚¨ãƒ©ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã‚’æŒ‡å®šã—ã¦addCard()ã‚’å®Ÿè¡Œ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ID
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ID
      const nonExistentCardId = toCardId('non-existent-card');

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹
      // ã€çµæœæ¤œè¨¼ã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ç„¡åŠ¹ãªã‚«ãƒ¼ãƒ‰ãŒãƒ‡ãƒƒã‚­ã«è¿½åŠ ã•ã‚Œãšã€æ•´åˆæ€§ãŒä¿ãŸã‚Œã‚‹
      expect(() => {
        deckService.addCard(nonExistentCardId);
      }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãŒæŠ•ã’ã‚‰ã‚Œã‚‹ ğŸ”µ
    });

    it('T-DECK-11: ãƒ‡ãƒƒã‚­ãŒ30æšã‚’è¶…ãˆã‚‹å ´åˆã«DECK_FULLã‚¨ãƒ©ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ‡ãƒƒã‚­ä¸Šé™ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ãŒæ—¢ã«30æšã®çŠ¶æ…‹ã§addCard()ã‚’å®Ÿè¡Œ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ‡ãƒƒã‚­30æšã®çŠ¶æ…‹ã‚’ä½œæˆ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒƒã‚­ä¸Šé™ã‚’è¶…ãˆã‚‹ãŸã‚
      const cardIds = Array.from({ length: 30 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ãŒæ—¢ã«30æšã®çŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹
      // ã€çµæœæ¤œè¨¼ã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ‡ãƒƒã‚­æšæ•°ä¸Šé™ãŒå®ˆã‚‰ã‚Œã€ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã«æº–æ‹ 
      expect(() => {
        deckService.addCard(toCardId('card-001'));
      }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãŒæŠ•ã’ã‚‰ã‚Œã‚‹ ğŸ”µ
    });

    it('T-DECK-12: æ‰‹æœ­ã«ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤æ™‚ã«CARD_NOT_IN_HANDã‚¨ãƒ©ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æ‰‹æœ­ã«ãªã„ã‚«ãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦playCard()ã‚’å®Ÿè¡Œ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­ã«ãªã„Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æº–å‚™
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ã¯ãƒ—ãƒ¬ã‚¤ã§ããªã„
      deckService.initialize([toCardId('card-001')]);
      deckService.draw(1);

      // åˆ¥ã®ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆï¼ˆæ‰‹æœ­ã«ãªã„ï¼‰
      // ã€å‹å®‰å…¨æ€§å‘ä¸Šã€‘: CardMasterã‹ã‚‰Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦å‹å®‰å…¨ã«æ‰±ã† ğŸ”µ
      const cardMaster = mockMasterDataRepo.getCardById('card-002');
      if (!cardMaster) throw new Error('Card not found in test setup');
      const cardNotInHand = new Card(toCardId('card-002'), cardMaster);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: playCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã«ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤ã—ã‚ˆã†ã¨ã™ã‚‹
      // ã€çµæœæ¤œè¨¼ã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸æ­£ãªã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤ãŒé˜»æ­¢ã•ã‚Œã€ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®æ•´åˆæ€§ãŒä¿ãŸã‚Œã‚‹
      expect(() => {
        deckService.playCard(cardNotInHand);
      }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãŒæŠ•ã’ã‚‰ã‚Œã‚‹ ğŸ”µ
    });

    it('T-DECK-13: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æœªèª­ã¿è¾¼ã¿æ™‚ã«DATA_NOT_LOADEDã‚¨ãƒ©ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æœªèª­ã¿è¾¼ã¿ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§addCard()ã‚’å®Ÿè¡Œ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆã‹ã‚‰æ¨æ¸¬ã€å®Ÿè£…ã§ç¢ºèªãŒå¿…è¦

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æœªèª­ã¿è¾¼ã¿çŠ¶æ…‹ã®ãƒ¢ãƒƒã‚¯ã‚’ä½œæˆ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨ã§ããªã„çŠ¶æ…‹
      const unloadedRepo = {
        isLoaded: () => false,
        getCardById: () => undefined,
      } as IMasterDataRepository;
      const unloadedDeckService = new DeckService(unloadedRepo, mockEventBus);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æœªèª­ã¿è¾¼ã¿çŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹
      // ã€çµæœæ¤œè¨¼ã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸å®Œå…¨ãªçŠ¶æ…‹ã§ã®ã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨ãŒé˜»æ­¢ã•ã‚Œã‚‹
      expect(() => {
        unloadedDeckService.addCard(toCardId('card-001'));
      }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãŒæŠ•ã’ã‚‰ã‚Œã‚‹ ğŸŸ¡
    });
  });

  // =============================================================================
  // å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ: T-DECK-14ã€œ20
  // =============================================================================

  describe('å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ', () => {
    it('T-DECK-14: ãƒ‡ãƒƒã‚­0æšã®çŠ¶æ…‹ã§ãƒ‰ãƒ­ãƒ¼ã™ã‚‹ã¨ç©ºé…åˆ—ã‚’è¿”ã™', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¢ƒç•Œæ¡ä»¶ã§ã®å …ç‰¢æ€§ã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ãŒå®Œå…¨ã«ç©ºã®çŠ¶æ…‹ã¯æœ€å°ã®å¢ƒç•Œå€¤
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ç©ºã®çŠ¶æ…‹ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãšã€é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰æ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ‡ãƒƒã‚­0æšã€æ¨ã¦æœ­0æšã€æ‰‹æœ­0æšã®çŠ¶æ…‹ã§draw(5)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒƒã‚­ãŒå®Œå…¨ã«ç©ºã®ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèª
      deckService.reset();

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(5)ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: ç©ºã®ãƒ‡ãƒƒã‚­ã‹ã‚‰ãƒ‰ãƒ­ãƒ¼ã‚’è©¦ã¿ã‚‹
      const drawnCards = deckService.draw(5);

      // ã€çµæœæ¤œè¨¼ã€‘: ç©ºé…åˆ—ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ç©ºã®çŠ¶æ…‹ã§é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
      expect(drawnCards.length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: ç©ºé…åˆ—ãŒè¿”ã•ã‚Œã‚‹ ğŸ”µ
      expect(deckService.getHand().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ã‚‚0æšã®ã¾ã¾ ğŸ”µ
    });

    it('T-DECK-15: æ‰‹æœ­0æšã®çŠ¶æ…‹ã§è£œå……ã™ã‚‹ã¨5æšãƒ‰ãƒ­ãƒ¼ã•ã‚Œã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¢ƒç•Œæ¡ä»¶ã§ã®è£œå……å‡¦ç†ã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æ‰‹æœ­ãŒå®Œå…¨ã«ç©ºã®çŠ¶æ…‹ã¯æœ€å°ã®å¢ƒç•Œå€¤
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ç©ºã®çŠ¶æ…‹ã‹ã‚‰æ­£ç¢ºã«5æšã¾ã§è£œå……ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­0æšã€å±±æœ­10æšã®çŠ¶æ…‹ã§refillHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­ãŒå®Œå…¨ã«ç©ºã®ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèª
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: refillHand()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ãŒ0æšã‹ã‚‰5æšã¾ã§è£œå……ã•ã‚Œã‚‹
      deckService.refillHand();

      // ã€çµæœæ¤œè¨¼ã€‘: æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ­£ç¢ºã«5æšãŒãƒ‰ãƒ­ãƒ¼ã•ã‚Œã‚‹
      expect(deckService.getHand().length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒ5æšã«ãªã‚‹ ğŸ”µ
      expect(deckService.getDeck().length).toBe(5); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒ5æšã«ãªã‚‹ï¼ˆ10 - 5ï¼‰ ğŸ”µ
    });

    it('T-DECK-16: ãƒ‡ãƒƒã‚­ä¸Šé™30æšã®çŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰è¿½åŠ æ™‚ã«ã‚¨ãƒ©ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¢ƒç•Œæ¡ä»¶ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­ã®æœ€å¤§æšæ•°ã¯30æš
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ä¸Šé™ã«é”ã—ã¦ã„ã‚‹å ´åˆã€è¿½åŠ ãŒæ‹’å¦ã•ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ‡ãƒƒã‚­30æšã®çŠ¶æ…‹ã§addCard(toCardId('card-001'))ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒƒã‚­ã®æœ€å¤§æšæ•°ã‚’ç¢ºèª
      const cardIds = Array.from({ length: 30 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: ä¸Šé™ã«é”ã—ãŸçŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹
      // ã€çµæœæ¤œè¨¼ã€‘: ApplicationErrorãŒæŠ•ã’ã‚‰ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸Šé™ã‚’è¶…ãˆãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹
      expect(() => {
        deckService.addCard(toCardId('card-001'));
      }).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãŒæŠ•ã’ã‚‰ã‚Œã‚‹ ğŸ”µ
      expect(deckService.getDeck().length).toBe(30); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­æšæ•°ãŒ30æšã®ã¾ã¾ ğŸ”µ
    });

    it('T-DECK-17: ãƒ‡ãƒƒã‚­29æšã®çŠ¶æ…‹ã§1æšè¿½åŠ ã™ã‚‹ã¨30æšã«ãªã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¢ƒç•Œå€¤ã§ã®æ­£å¸¸å‹•ä½œã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ä¸Šé™ã®1ã¤æ‰‹å‰ã¯å¢ƒç•Œå€¤ã¨ã—ã¦é‡è¦
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ä¸Šé™ã«é”ã™ã‚‹ç›´å‰ã¾ã§è¿½åŠ å¯èƒ½
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰æ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ‡ãƒƒã‚­29æšã®çŠ¶æ…‹ã§addCard(toCardId('card-001'))ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ä¸Šé™ç›´å‰ã®ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèª
      const cardIds = Array.from({ length: 29 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: addCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: ä¸Šé™ç›´å‰ã®çŠ¶æ…‹ã§ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ 
      deckService.addCard(toCardId('card-001'));

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‡ãƒƒã‚­æšæ•°ãŒ30æšã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ä¸Šé™ã¡ã‚‡ã†ã©ã¾ã§è¿½åŠ å¯èƒ½
      expect(deckService.getDeck().length).toBe(30); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‡ãƒƒã‚­æšæ•°ãŒ30æšã«ãªã‚‹ ğŸ”µ
    });

    it('T-DECK-18: draw(0)ã‚’å®Ÿè¡Œã™ã‚‹ã¨ç©ºé…åˆ—ã‚’è¿”ã™', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¢ƒç•Œæ¡ä»¶ã§ã®å‹•ä½œç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ‰ãƒ­ãƒ¼æšæ•°0ã¯æœ€å°ã®å¢ƒç•Œå€¤
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: 0æšæŒ‡å®šã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãšã€é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜ã•ã‚Œã¦ã„ãªã„ãŒã€å¦¥å½“ãªæ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: draw(0)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æœ€å°ã®ãƒ‰ãƒ­ãƒ¼æšæ•°ã‚’ç¢ºèª
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(0)ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: 0æšãƒ‰ãƒ­ãƒ¼ã‚’è©¦ã¿ã‚‹
      const drawnCards = deckService.draw(0);

      // ã€çµæœæ¤œè¨¼ã€‘: ç©ºé…åˆ—ãŒè¿”ã•ã‚Œã€çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãªã„ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: 0æšæŒ‡å®šã§ä½•ã‚‚èµ·ããªã„
      expect(drawnCards.length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: ç©ºé…åˆ—ãŒè¿”ã•ã‚Œã‚‹ ğŸŸ¡
      expect(deckService.getDeck().length).toBe(10); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒå¤‰åŒ–ã—ãªã„ ğŸŸ¡
      expect(deckService.getHand().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: æ‰‹æœ­ãŒå¤‰åŒ–ã—ãªã„ ğŸŸ¡
    });

    it('T-DECK-19: draw(-1)ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ç©ºé…åˆ—ã‚’è¿”ã™', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ä¸æ­£ãªå…¥åŠ›ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: è² ã®å€¤ã¯ä¸æ­£ãªå…¥åŠ›
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ä¸æ­£ãªå€¤ã§ã‚‚å®‰å…¨ã«å‡¦ç†ã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜ã•ã‚Œã¦ã„ãªã„ãŒã€å¦¥å½“ãªæ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: draw(-1)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ä¸æ­£ãªå€¤ï¼ˆè² ã®å€¤ï¼‰ã‚’ç¢ºèª
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(-1)ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: è² ã®å€¤ã§ãƒ‰ãƒ­ãƒ¼ã‚’è©¦ã¿ã‚‹
      const drawnCards = deckService.draw(-1);

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚¨ãƒ©ãƒ¼ãŒæŠ•ã’ã‚‰ã‚Œã‚‹ã‹ã€ç©ºé…åˆ—ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: è² ã®å€¤ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
      expect(drawnCards.length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: ç©ºé…åˆ—ãŒè¿”ã•ã‚Œã‚‹ ğŸŸ¡
      expect(deckService.getDeck().length).toBe(10); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒå¤‰åŒ–ã—ãªã„ ğŸŸ¡
    });

    it('T-DECK-20: å±±æœ­ã‚ˆã‚Šå¤šã„æšæ•°ã‚’ãƒ‰ãƒ­ãƒ¼ã™ã‚‹ã¨ã€ãƒ‰ãƒ­ãƒ¼å¯èƒ½ãªæšæ•°ã¾ã§å–å¾—', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¢ƒç•Œæ¡ä»¶ã§ã®å‹•ä½œç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: è¦æ±‚æšæ•°ãŒåˆ©ç”¨å¯èƒ½æšæ•°ã‚’è¶…ãˆã‚‹ã‚±ãƒ¼ã‚¹
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: åˆ©ç”¨å¯èƒ½ãªæšæ•°ã¾ã§å–å¾—ã—ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å±±æœ­3æšã€æ¨ã¦æœ­0æšã®çŠ¶æ…‹ã§draw(10)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: è¦æ±‚æšæ•°ãŒå±±æœ­ã‚’è¶…ãˆã‚‹ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèª
      const cardIds = Array.from({ length: 3 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(10)ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: å±±æœ­ã‚ˆã‚Šå¤šã„æšæ•°ã‚’ãƒ‰ãƒ­ãƒ¼ã—ã‚ˆã†ã¨ã™ã‚‹
      const drawnCards = deckService.draw(10);

      // ã€çµæœæ¤œè¨¼ã€‘: ãƒ‰ãƒ­ãƒ¼å¯èƒ½ãªæšæ•°ï¼ˆ3æšï¼‰ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: åˆ©ç”¨å¯èƒ½ãªæšæ•°ã¾ã§æ­£ç¢ºã«å–å¾—
      expect(drawnCards.length).toBe(3); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ‰ãƒ­ãƒ¼å¯èƒ½ãªæšæ•°ã¾ã§å–å¾— ğŸ”µ
      expect(deckService.getDeck().length).toBe(0); // ã€ç¢ºèªå†…å®¹ã€‘: å±±æœ­ãŒ0æšã«ãªã‚‹ ğŸ”µ
    });
  });

  // =============================================================================
  // ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œãƒ†ã‚¹ãƒˆ: T-EVENT-01ã€œ04
  // =============================================================================

  describe('ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œãƒ†ã‚¹ãƒˆ', () => {
    it('T-EVENT-01: ãƒ‰ãƒ­ãƒ¼æ™‚ã«CARD_DRAWNã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: draw()å®Ÿè¡Œæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: EventBusã‚’ä»‹ã—ã¦CARD_DRAWNã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã«ãƒ‰ãƒ­ãƒ¼ã—ãŸã‚«ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å±±æœ­10æšã®çŠ¶æ…‹ã§draw(3)ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: é€šå¸¸ã®ãƒ‰ãƒ­ãƒ¼æ“ä½œ
      const cardIds = Array.from({ length: 10 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: draw(3)ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: å±±æœ­ã‹ã‚‰3æšå–å¾—ã—ã¦æ‰‹æœ­ã«è¿½åŠ 
      deckService.draw(3);

      // ã€çµæœæ¤œè¨¼ã€‘: CARD_DRAWNã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ‰ãƒ­ãƒ¼æ“ä½œã‚’ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„UIã«é€šçŸ¥
      expect(mockEventBus.emit).toHaveBeenCalled(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ ğŸ”µ
    });

    it('T-EVENT-02: ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤æ™‚ã«CARD_PLAYEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: playCard()å®Ÿè¡Œæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: EventBusã‚’ä»‹ã—ã¦CARD_PLAYEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã«ãƒ—ãƒ¬ã‚¤ã—ãŸã‚«ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­5æšã®çŠ¶æ…‹ã§1æšã‚’ãƒ—ãƒ¬ã‚¤
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: é€šå¸¸ã®ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤æ“ä½œ
      const cardIds = Array.from({ length: 5 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      const hand = deckService.draw(5);

      // ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆinitializeã¨drawã§ç™ºè¡Œã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢ï¼‰
      vi.clearAllMocks();

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: playCard()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã€æ¨ã¦æœ­ã«è¿½åŠ 
      deckService.playCard(hand[0]);

      // ã€çµæœæ¤œè¨¼ã€‘: CARD_PLAYEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤æ“ä½œã‚’ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„UIã«é€šçŸ¥
      expect(mockEventBus.emit).toHaveBeenCalled(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ ğŸ”µ
    });

    it('T-EVENT-03: æ‰‹æœ­ç ´æ£„æ™‚ã«CARD_DISCARDEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: discardHand()å®Ÿè¡Œæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: EventBusã‚’ä»‹ã—ã¦CARD_DISCARDEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã«ç ´æ£„ã—ãŸã‚«ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹
      // ğŸ”µ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­5æšã®çŠ¶æ…‹ã§discardHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã®æ‰‹æœ­ç ´æ£„
      const cardIds = Array.from({ length: 5 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(5);

      // ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆinitializeã¨drawã§ç™ºè¡Œã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢ï¼‰
      vi.clearAllMocks();

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: discardHand()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ã‚’å…¨ã¦æ¨ã¦æœ­ã«ç§»å‹•
      deckService.discardHand();

      // ã€çµæœæ¤œè¨¼ã€‘: CARD_DISCARDEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ‰‹æœ­ç ´æ£„æ“ä½œã‚’ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„UIã«é€šçŸ¥
      expect(mockEventBus.emit).toHaveBeenCalled(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ ğŸ”µ
    });

    it('T-EVENT-04: æ‰‹æœ­è£œå……æ™‚ã«HAND_REFILLEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆã®ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: refillHand()å®Ÿè¡Œæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: EventBusã‚’ä»‹ã—ã¦HAND_REFILLEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆã«è¨˜è¼‰ãŒã‚ã‚‹ãŒã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®è©³ç´°ã¯æœªç¢ºå®š

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æ‰‹æœ­2æšã®çŠ¶æ…‹ã§refillHand()ã‚’å®Ÿè¡Œ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æ‰‹æœ­è£œå……æ“ä½œ
      const cardIds = Array.from({ length: 12 }, (_, i) => toCardId(`card-00${(i % 3) + 1}`));
      deckService.initialize(cardIds);
      deckService.draw(2);

      // ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆinitializeã¨drawã§ç™ºè¡Œã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢ï¼‰
      vi.clearAllMocks();

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: refillHand()ã‚’å‘¼ã³å‡ºã—
      // ã€å‡¦ç†å†…å®¹ã€‘: æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼
      deckService.refillHand();

      // ã€çµæœæ¤œè¨¼ã€‘: HAND_REFILLEDã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æ‰‹æœ­è£œå……æ“ä½œã‚’ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„UIã«é€šçŸ¥
      expect(mockEventBus.emit).toHaveBeenCalled(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ ğŸŸ¡
    });
  });
});
