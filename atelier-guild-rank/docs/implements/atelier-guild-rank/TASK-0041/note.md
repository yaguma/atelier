# ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ 

**ã‚¿ã‚¹ã‚¯ID**: TASK-0041
**ä½œæˆæ—¥**: 2026-01-19
**è¦ä»¶å**: atelier-guild-rank
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“

## 1. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ä½¿ç”¨æŠ€è¡“
- **Framework**: Phaser 3.87+ / rexUI
- **Language**: TypeScript 5.x
- **Build Tool**: Vite 5.x
- **Package Manager**: pnpm 9.x
- **Linter/Formatter**: Biome 2.x
- **Unit Test**: Vitest
- **E2E Test**: Playwright
- **Git Hooks**: Lefthook
- **CSS**: Tailwind CSS 4.x

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **Clean Architectureï¼ˆ4å±¤æ§‹é€ ï¼‰**
  - **domain/**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆä¾å­˜ãªã—ï¼‰
  - **application/**: ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ãƒ»çŠ¶æ…‹ç®¡ç†ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆèª¿æ•´
  - **infrastructure/**: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ»å¤–éƒ¨é€£æº
  - **presentation/**: Phaser Scenesãƒ»UI Components
  - **shared/**: å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»å‹å®šç¾©

- **ä¾å­˜æ–¹å‘**: Presentation â†’ Application â†’ Domain â†’ Infrastructure(IF)

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
atelier-guild-rank/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/          # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”œâ”€â”€ application/     # ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ãƒ»çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ infrastructure/  # ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ»å¤–éƒ¨é€£æº
â”‚   â”œâ”€â”€ presentation/    # Phaser Scenesãƒ»UI Components
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ components/  # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆTooltipManagerã¯ã“ã“ã«é…ç½®ï¼‰
â”‚   â”‚       â””â”€â”€ theme.ts     # ãƒ†ãƒ¼ãƒå®šç¾©
â”‚   â””â”€â”€ shared/          # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/            # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ integration/     # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ mocks/           # ãƒ†ã‚¹ãƒˆç”¨ãƒ¢ãƒƒã‚¯
â””â”€â”€ e2e/                 # E2Eãƒ†ã‚¹ãƒˆ
```

## 2. é–‹ç™ºãƒ«ãƒ¼ãƒ«

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
- **Biome**ã§è‡ªå‹•é©ç”¨
  - ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ: 2ã‚¹ãƒšãƒ¼ã‚¹
  - ã‚¯ã‚©ãƒ¼ãƒˆ: ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ
  - ã‚»ãƒŸã‚³ãƒ­ãƒ³: å¿…é ˆ
  - æœ«å°¾ã‚«ãƒ³ãƒ: å…¨ã¦

### å‘½åè¦å‰‡
- **ãƒ•ã‚¡ã‚¤ãƒ«**: ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆä¾‹: `TooltipManager.ts`ï¼‰
- **ã‚¯ãƒ©ã‚¹**: ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆä¾‹: `TooltipManager`ï¼‰
- **å¤‰æ•°ãƒ»é–¢æ•°**: ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆä¾‹: `showTimeout`ï¼‰
- **å®šæ•°**: ã‚¢ãƒƒãƒ‘ãƒ¼ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ï¼ˆä¾‹: `DEFAULT_DELAY`ï¼‰
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ + `Config`/`Options`æ¥å°¾è¾ï¼ˆä¾‹: `TooltipConfig`ï¼‰

### Path Aliases
```typescript
import { THEME } from '@presentation/ui/theme';
import { BaseComponent } from '@presentation/ui/components/BaseComponent';
```

### ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´„
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ¨å¥¨ã•ã‚ŒãŸä¿®æ­£ã«ã¯ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚’ä»˜ä¸
  - ğŸ”µ é’ä¿¡å·: ã‚¿ã‚¹ã‚¯å®šç¾©ã«æ˜è¨˜
  - ğŸŸ¡ é»„ä¿¡å·: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
  - ğŸ”´ èµ¤ä¿¡å·: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

## 3. ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Vitest**: ãƒ¦ãƒ‹ãƒƒãƒˆ/çµ±åˆãƒ†ã‚¹ãƒˆ
- **Playwright**: E2Eãƒ†ã‚¹ãƒˆ

### ã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶
- **Global**: 80%ä»¥ä¸Šï¼ˆbranches, functions, lines, statementsï¼‰
- **Domainå±¤**: 90%ä»¥ä¸Š

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: `src/presentation/ui/components/TooltipManager.spec.ts`ï¼ˆå®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒä¸€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
- **ã¾ãŸã¯**: `tests/unit/presentation/ui/TooltipManager.test.ts`

### ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰
```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆ
pnpm test tests/unit/presentation/ui/TooltipManager.test.ts

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pnpm test:coverage
```

## 4. é–¢é€£å®Ÿè£…

### ä¾å­˜ã‚¿ã‚¹ã‚¯
- [x] **TASK-0018**: å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŸºç›¤ - âœ…å®Œäº†
  - BaseComponentã€Dialogã€Buttonã€ãƒ†ãƒ¼ãƒå®šç¾©ã‚’å®Ÿè£…
  - 48ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé

### å‚è€ƒå®Ÿè£…
| ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | èª¬æ˜ |
|------------|------|
| `src/presentation/ui/components/BaseComponent.ts` | å…¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŸºåº•ã‚¯ãƒ©ã‚¹ã€‚ç¶™æ‰¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‚è€ƒ |
| `src/presentation/ui/components/Dialog.ts` | ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å®Ÿè£…ã€‚show/hideã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å‚è€ƒ |
| `src/presentation/ui/components/Button.ts` | ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè£…ã®å‚è€ƒ |
| `src/presentation/ui/theme.ts` | ãƒ†ãƒ¼ãƒå®šç¾©ã€‚ã‚«ãƒ©ãƒ¼ã€ãƒ•ã‚©ãƒ³ãƒˆã€ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°ã®å‚ç…§ |

### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç‰¹å¾´
1. **BaseComponentç¶™æ‰¿**:
   - `scene`, `container`, `rexUI`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¶™æ‰¿
   - `create()`, `destroy()`æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…å¿…é ˆ
   - `setVisible()`, `setPosition()`ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³å¯¾å¿œ

2. **å…¥åŠ›å€¤æ¤œè¨¼**:
   - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§sceneã€åº§æ¨™ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼
   - ã‚¨ãƒ©ãƒ¼æ™‚ã¯è©³ç´°ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ãƒ­ãƒ¼

3. **ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**:
   - Phaserã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
   - `vi.fn().mockReturnValue()`ã§Phaserã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¢ãƒƒã‚¯
   - protectedãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯`component['property']`ã§ã‚¢ã‚¯ã‚»ã‚¹

## 5. è¨­è¨ˆæ–‡æ›¸å‚ç…§

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- **TooltipConfig**: ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆTASK-0041.mdï¼‰ã§å®šç¾©
  ```typescript
  interface TooltipConfig {
    content: string;    // è¡¨ç¤ºå†…å®¹
    x: number;          // Xåº§æ¨™
    y: number;          // Yåº§æ¨™
    delay?: number;     // è¡¨ç¤ºé…å»¶ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ500msï¼‰
    maxWidth?: number;  // æœ€å¤§å¹…
  }
  ```

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
- `src/presentation/ui/components/TooltipManager.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰

### UIè¨­è¨ˆå‚ç…§
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ‘ã‚¹ |
|------------|------|
| UIè¨­è¨ˆæ¦‚è¦ | `docs/design/atelier-guild-rank/ui-design/overview.md` |
| UIãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ | ã‚»ã‚¯ã‚·ãƒ§ãƒ³4.2å‚ç…§ï¼ˆToastå±¤: depth 500ï¼‰ |
| ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ | ã‚»ã‚¯ã‚·ãƒ§ãƒ³7.1å‚ç…§ï¼ˆèƒŒæ™¯: 0x333333, ãƒ†ã‚­ã‚¹ãƒˆ: #FFFFFFï¼‰ |

## 6. æ³¨æ„äº‹é …

### æŠ€è¡“çš„åˆ¶ç´„
- **ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³**: ã‚·ãƒ¼ãƒ³é–“ã§å†åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ãŸã‚ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§å®Ÿè£…
- **Zã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `depth: 500`ï¼ˆToastå±¤ï¼‰ã§æœ€å‰é¢è¡¨ç¤º
- **rexUI**: rexUIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒundefinedã®å ´åˆã¯è­¦å‘Šå‡ºåŠ›ã®ã¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
- ç‰¹ã«ãªã—ï¼ˆUIè¡¨ç¤ºã®ã¿ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
- **è¡¨ç¤ºé…å»¶**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ500msï¼ˆä¸è¦ãªDOMæ“ä½œã‚’é¿ã‘ã‚‹ï¼‰
- **è¡¨ç¤ºä½ç½®è‡ªå‹•èª¿æ•´**: ã‚«ãƒ¡ãƒ©åº§æ¨™ã‚’ä½¿ç”¨ã—ã¦ç”»é¢å†…ã«åã¾ã‚‹ã‚ˆã†èª¿æ•´
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç®¡ç†**: å‰å›ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ä¸è¦ãªå‡¦ç†ã‚’é˜²æ­¢

### å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹
1. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç®¡ç†**
   - `setTimeout`ã®IDã‚’ä¿æŒã—ã€`hide()`æ™‚ã«ã‚¯ãƒªã‚¢
   - æ–°ã—ã„`show()`å‘¼ã³å‡ºã—æ™‚ã«å‰å›ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢

2. **è¡¨ç¤ºä½ç½®è‡ªå‹•èª¿æ•´**
   - ç”»é¢å³ç«¯: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’å·¦å´ã«è¡¨ç¤º
   - ç”»é¢ä¸‹ç«¯: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’ä¸Šå´ã«è¡¨ç¤º
   - æœ€å°ãƒãƒ¼ã‚¸ãƒ³: 10px

3. **ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ**
   - èƒŒæ™¯: `Phaser.GameObjects.Rectangle`
   - ãƒ†ã‚­ã‚¹ãƒˆ: `Phaser.GameObjects.Text`ï¼ˆwordWrapå¯¾å¿œï¼‰

## 7. ãã®ä»–ãƒ¡ãƒ¢

### TDDå®Ÿè£…æ‰‹é †ï¼ˆæ¨å¥¨ãƒ•ãƒ­ãƒ¼ï¼‰
1. `/tsumiki:tdd-requirements TASK-0041` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚ˆã‚Šï¼‰
| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | ä¿¡é ¼æ€§ |
|---------|----------|--------|
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1 | ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆshow()ã§æŒ‡å®šä½ç½®ã«è¡¨ç¤ºï¼‰ | ğŸŸ¡ |
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2 | è¡¨ç¤ºä½ç½®è‡ªå‹•èª¿æ•´ï¼ˆç”»é¢ç«¯å¯¾å¿œï¼‰ | ğŸŸ¡ |
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3 | è¡¨ç¤ºé…å»¶ï¼ˆdelayè¨­å®šã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‹•ä½œï¼‰ | ğŸŸ¡ |

### å‚è€ƒ: Dialogã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// show()ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
public show(duration: number = 300): this {
  if (!this._visible) {
    this._visible = true;
    this.overlay.setVisible(true);
    this.dialog.setVisible(true);
    this.dialog.popUp(duration);
  }
  return this;
}

// hide()ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
public hide(duration: number = 300): this {
  this._visible = false;
  this.dialog.scaleDownDestroy(duration);
  this.overlay.setVisible(false);
  this.dialog.setVisible(false);
  return this;
}
```

### TooltipManagerå›ºæœ‰ã®å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ
1. **ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³**: `getInstance()`é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã§å”¯ä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
2. **åˆæœŸåŒ–**: `initialize(scene)`ã§ã‚·ãƒ¼ãƒ³ã‚’è¨­å®šã—ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
3. **è¡¨ç¤ºé…å»¶**: `setTimeout`ã‚’ä½¿ç”¨ã—ã¦delayå¾Œã«è¡¨ç¤º
4. **ä½ç½®èª¿æ•´**: `camera.width`, `camera.height`ã‚’ä½¿ç”¨ã—ã¦ç”»é¢å†…ã«åã‚ã‚‹
