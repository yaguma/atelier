# TASK-0058 TitleSceneリファクタリング - テストケース定義書

## 概要
819行のTitleScene.tsを責務ごとにコンポーネント分割するためのテストケース定義書。

## テストファイル一覧

| ファイル | 対象コンポーネント | テストケース数 |
|---------|-------------------|---------------|
| types.test.ts | 型定義・定数 | 7 |
| TitleLogo.test.ts | TitleLogoコンポーネント | 10 |
| TitleMenu.test.ts | TitleMenuコンポーネント | 13 |
| TitleDialog.test.ts | TitleDialogコンポーネント | 18 |
| TitleScene.integration.test.ts | 統合テスト | 10 |

## 1. 型定義テストケース (types.test.ts)

### TC-TY-001: TitleLogoConfig型チェック
- **目的**: 型定義の正確性確認
- **入力**: TitleLogoConfigオブジェクト
- **期待結果**: 必須プロパティ（title, subtitle）を持つ

### TC-TY-002: TitleMenuConfig型チェック
- **目的**: 型定義の正確性確認
- **入力**: TitleMenuConfigオブジェクト
- **期待結果**: 必須プロパティ（hasSaveData, onNewGame, onContinue, onSettings）を持つ

### TC-TY-003: コールバック型の型安全性
- **目的**: any型排除の確認
- **入力**: 各種コールバック関数
- **期待結果**: 正しい型シグネチャを持つ

### TC-TY-004: TitleDialogConfig型チェック
- **目的**: ダイアログ設定の型定義確認
- **入力**: TitleDialogConfigオブジェクト
- **期待結果**: 必須プロパティ（type, title, content, onClose）を持つ

### TC-TY-005: TITLE_LAYOUT定数チェック
- **目的**: レイアウト定数の存在確認
- **期待結果**: 必須定数（TITLE_Y, SUBTITLE_Y, BUTTON_START_Y, BUTTON_SPACING, VERSION_OFFSET）が存在

### TC-TY-006: TITLE_STYLES定数チェック
- **目的**: スタイル定数の存在確認
- **期待結果**: 必須定数（TITLE_FONT_SIZE, TITLE_COLOR, SUBTITLE_FONT_SIZE, SUBTITLE_COLOR）が存在

### TC-TY-007: TITLE_TEXT定数チェック
- **目的**: テキスト定数の存在確認
- **期待結果**: 必須定数（TITLE, SUBTITLE, NEW_GAME, CONTINUE, SETTINGS）が存在

## 2. TitleLogoテストケース (TitleLogo.test.ts)

### 正常系

#### TC-TL-001: 初期化テスト
- **目的**: コンポーネント初期化の確認
- **入力**: シーンインスタンス、座標
- **期待結果**: コンテナが作成される

#### TC-TL-002: タイトル表示テスト
- **目的**: タイトルテキスト表示の確認
- **入力**: create()呼び出し
- **期待結果**: 「ATELIER GUILD」が表示される

#### TC-TL-003: サブタイトル表示テスト
- **目的**: サブタイトル表示の確認
- **入力**: create()呼び出し
- **期待結果**: 「錬金術師ギルド」が表示される

#### TC-TL-004: バージョン表示テスト
- **目的**: バージョン情報表示の確認
- **入力**: create()呼び出し
- **期待結果**: 「Version X.X.X」が右下に表示される

#### TC-TL-005: タイトルスタイルテスト
- **目的**: スタイル設定の確認
- **入力**: create()呼び出し
- **期待結果**: タイトルが48px、#8B4513で表示される

#### TC-TL-006: 中央配置テスト
- **目的**: 配置位置の確認
- **入力**: create()呼び出し
- **期待結果**: テキストがorigin(0.5)で中央揃え

### 異常系

#### TC-TL-E01: nullシーンでエラー
- **目的**: 防御的プログラミングの確認
- **入力**: nullシーン
- **期待結果**: エラーがスローされる

#### TC-TL-E02: undefinedシーンでエラー
- **目的**: nullish値での動作確認
- **入力**: undefinedシーン
- **期待結果**: エラーがスローされる

### 境界値

#### TC-TL-B01: 座標(0, 0)での配置
- **目的**: 原点配置での動作確認
- **入力**: 座標(0, 0)
- **期待結果**: 正常に配置される

### 破棄処理

#### TC-TL-D01: destroy()でリソース解放
- **目的**: リソース管理の確認
- **入力**: destroy()呼び出し
- **期待結果**: コンテナと子要素が破棄される

## 3. TitleMenuテストケース (TitleMenu.test.ts)

### 正常系

#### TC-TM-001: 初期化テスト
- **目的**: コンポーネント初期化の確認
- **入力**: シーンインスタンス、設定
- **期待結果**: コンテナが作成される

#### TC-TM-002: 新規ゲームボタン表示テスト
- **目的**: ボタン表示の確認
- **入力**: create()呼び出し
- **期待結果**: 「新規ゲーム」ボタンが表示される

#### TC-TM-003: コンティニューボタン表示テスト（有効状態）
- **目的**: セーブデータ存在時のボタン状態確認
- **入力**: hasSaveData=true
- **期待結果**: コンティニューボタンが有効状態

#### TC-TM-004: コンティニューボタン表示テスト（無効状態）
- **目的**: セーブデータなし時のボタン状態確認
- **入力**: hasSaveData=false
- **期待結果**: コンティニューボタンが無効状態（alpha=0.5）

#### TC-TM-005: 設定ボタン表示テスト
- **目的**: 設定ボタン表示の確認
- **入力**: create()呼び出し
- **期待結果**: 「設定」ボタンが表示される

#### TC-TM-006: 新規ゲームボタンクリックイベントテスト
- **目的**: イベント発火の確認
- **入力**: 新規ゲームボタンクリック
- **期待結果**: onNewGameコールバックが呼び出される

#### TC-TM-007: コンティニューボタンクリックイベントテスト
- **目的**: コンティニューボタンのイベント発火確認
- **入力**: 有効なコンティニューボタンクリック
- **期待結果**: onContinueコールバックが呼び出される

#### TC-TM-008: 無効なコンティニューボタンクリック無視テスト
- **目的**: 無効ボタンのクリック無視確認
- **入力**: 無効なコンティニューボタンクリック
- **期待結果**: onContinueは呼び出されない

#### TC-TM-009: 設定ボタンクリックイベントテスト
- **目的**: 設定ボタンのイベント発火確認
- **入力**: 設定ボタンクリック
- **期待結果**: onSettingsコールバックが呼び出される

### 異常系

#### TC-TM-E01: nullシーンでエラー
- **目的**: 防御的プログラミングの確認
- **入力**: nullシーン
- **期待結果**: エラーがスローされる

#### TC-TM-E02: undefinedコールバックでエラー
- **目的**: 入力バリデーションの確認
- **入力**: undefinedコールバック
- **期待結果**: エラーがスローされる

### 境界値

#### TC-TM-B01: 座標(0, 0)での配置
- **目的**: 原点配置での動作確認
- **入力**: 座標(0, 0)
- **期待結果**: 正常に配置される

### 破棄処理

#### TC-TM-D01: destroy()でリソース解放
- **目的**: リソース管理の確認
- **入力**: destroy()呼び出し
- **期待結果**: コンテナとボタンが破棄される

## 4. TitleDialogテストケース (TitleDialog.test.ts)

### 正常系

#### TC-TD-001: 確認ダイアログ初期化テスト
- **目的**: 確認ダイアログの初期化確認
- **入力**: type="confirm"
- **期待結果**: ダイアログが作成される

#### TC-TD-002: 設定ダイアログ初期化テスト
- **目的**: 設定ダイアログの初期化確認
- **入力**: type="settings"
- **期待結果**: ダイアログが作成される

#### TC-TD-003: エラーダイアログ初期化テスト
- **目的**: エラーダイアログの初期化確認
- **入力**: type="error"
- **期待結果**: エラー背景色のダイアログが作成される

#### TC-TD-004: オーバーレイ表示テスト
- **目的**: オーバーレイ表示の確認
- **入力**: show()呼び出し
- **期待結果**: オーバーレイが表示される（alpha=0.7）

#### TC-TD-005: ダイアログタイトル表示テスト
- **目的**: タイトル表示の確認
- **入力**: show()呼び出し
- **期待結果**: ダイアログタイトルが表示される

#### TC-TD-006: ダイアログ内容表示テスト
- **目的**: 内容表示の確認
- **入力**: show()呼び出し
- **期待結果**: ダイアログ内容が表示される

#### TC-TD-007: 確認ダイアログボタン表示テスト
- **目的**: 確認ダイアログのボタン表示確認
- **入力**: type="confirm"
- **期待結果**: 「はい」「いいえ」ボタンが表示される

#### TC-TD-008: 単一ボタンダイアログ表示テスト
- **目的**: 設定/エラーダイアログのボタン表示確認
- **入力**: type="settings"
- **期待結果**: 「OK」ボタンのみが表示される

#### TC-TD-009: 確認ボタンクリックイベントテスト
- **目的**: 確認ボタンのイベント発火確認
- **入力**: 「はい」ボタンクリック
- **期待結果**: onConfirmコールバックが呼び出される

#### TC-TD-010: キャンセルボタンクリックイベントテスト
- **目的**: キャンセルボタンのイベント発火確認
- **入力**: 「いいえ」ボタンクリック
- **期待結果**: onCloseコールバックが呼び出される

#### TC-TD-011: ダイアログポップアップアニメーションテスト
- **目的**: ポップアップアニメーション確認
- **入力**: show()呼び出し
- **期待結果**: popUp(300)が実行される

#### TC-TD-012: ダイアログ深度設定テスト
- **目的**: Z-index設定確認
- **入力**: show()呼び出し
- **期待結果**: depth=400で表示される

### 異常系

#### TC-TD-E01: nullシーンでエラー
- **目的**: 防御的プログラミングの確認
- **入力**: nullシーン
- **期待結果**: エラーがスローされる

#### TC-TD-E02: 不正なダイアログタイプでエラー
- **目的**: 入力バリデーションの確認
- **入力**: 不正なtype
- **期待結果**: エラーがスローされる

### 境界値

#### TC-TD-B01: 空文字列タイトルでの表示
- **目的**: 空文字列での動作確認
- **入力**: title=""
- **期待結果**: ダイアログが正常に表示される

#### TC-TD-B02: 長い内容テキストでの表示
- **目的**: 長い文字列での動作確認
- **入力**: 200文字の内容
- **期待結果**: ダイアログが正常に表示される

### 破棄処理

#### TC-TD-D01: close()でリソース解放
- **目的**: リソース管理の確認
- **入力**: close()呼び出し
- **期待結果**: ダイアログとオーバーレイが破棄される

#### TC-TD-D02: 複数回close()呼び出しでエラーなし
- **目的**: 重複破棄の安全性確認
- **入力**: 複数回close()呼び出し
- **期待結果**: エラーが発生しない

## 5. 統合テストケース (TitleScene.integration.test.ts)

### TC-INT-001: TitleLogo→TitleScene連携
- **目的**: ロゴコンポーネントの正常統合
- **期待結果**: TitleLogoが正しく初期化される

### TC-INT-002: TitleMenu→TitleScene連携
- **目的**: メニューコンポーネントの正常統合
- **期待結果**: TitleMenuが正しく初期化される

### TC-INT-003: TitleMenu→TitleDialog連携（新規ゲーム確認）
- **目的**: 新規ゲーム時のダイアログ表示連携
- **期待結果**: セーブデータ存在時に確認ダイアログが表示される

### TC-INT-004: TitleDialog確認→シーン遷移連携
- **目的**: ダイアログ確認後のシーン遷移
- **期待結果**: 「はい」選択後にMainSceneへ遷移

### TC-INT-005: コンティニュー→シーン遷移連携
- **目的**: コンティニュー選択時のシーン遷移
- **期待結果**: セーブデータ付きでMainSceneへ遷移

### TC-INT-006: 設定ボタン→設定ダイアログ連携
- **目的**: 設定ダイアログ表示連携
- **期待結果**: 設定ダイアログが表示される

### TC-INT-007: フェードアウト→シーン遷移連携
- **目的**: フェードアニメーション後のシーン遷移
- **期待結果**: フェードアウト完了後にシーン遷移が実行される

### TC-INT-008: エラー発生→エラーダイアログ連携
- **目的**: エラー発生時のダイアログ表示
- **期待結果**: エラーダイアログが表示される

### TC-INT-009: コンポーネント間状態同期
- **目的**: hasSaveData状態の正しい伝播
- **期待結果**: SaveDataRepository.exists()の結果がTitleMenuに正しく伝播

### TC-INT-010: 全コンポーネント破棄処理
- **目的**: シーンシャットダウン時の全リソース解放
- **期待結果**: 全コンポーネントが正しく破棄される

## テスト実行コマンド

```bash
# タイトルコンポーネントの全テスト実行
pnpm test tests/unit/presentation/ui/scenes/components/title/

# 個別テスト実行
pnpm test tests/unit/presentation/ui/scenes/components/title/types.test.ts
pnpm test tests/unit/presentation/ui/scenes/components/title/TitleLogo.test.ts
pnpm test tests/unit/presentation/ui/scenes/components/title/TitleMenu.test.ts
pnpm test tests/unit/presentation/ui/scenes/components/title/TitleDialog.test.ts
pnpm test tests/unit/presentation/ui/scenes/components/title/TitleScene.integration.test.ts
```

## 補足

- 信頼性レベル
  - 🔵 設計文書準拠: 要件定義書・設計文書に基づくテスト
  - 🟡 妥当な推測: 既存パターンからの推測に基づくテスト
- テストは全てVitestで記述
- モックはPhaserとrexUIの最小限のモックを使用
