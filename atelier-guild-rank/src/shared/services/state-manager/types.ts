/**
 * state-manager types - StateManager型定義
 *
 * TASK-0066: shared/services移行
 * ゲーム状態を一元管理するためのインターフェース
 */

import type { GamePhase, IGameState, ISaveData } from '@shared/types';

/**
 * StateManagerインターフェース
 *
 * ゲーム状態の一元管理を行い、状態変更時にイベントを発行する
 */
export interface IStateManager {
  // =============================================================================
  // 状態取得・更新
  // =============================================================================

  /**
   * 現在のゲーム状態を取得する
   *
   * @returns 現在のゲーム状態（イミュータブルなコピー）
   */
  getState(): Readonly<IGameState>;

  /**
   * ゲーム状態を部分的に更新する
   *
   * @param partial 更新するプロパティ
   */
  updateState(partial: Partial<IGameState>): void;

  // =============================================================================
  // フェーズ管理
  // =============================================================================

  /**
   * ゲームフェーズを変更する
   *
   * @param phase 新しいフェーズ
   * @throws 無効なフェーズ遷移の場合
   */
  setPhase(phase: GamePhase): void;

  /**
   * 指定フェーズへの遷移が可能か確認する
   *
   * @param phase 確認するフェーズ
   * @returns 遷移可能な場合true
   */
  canTransitionTo(phase: GamePhase): boolean;

  // =============================================================================
  // 日進行
  // =============================================================================

  /**
   * 日を進める
   *
   * currentDay を +1 し、remainingDays を -1 し、AP を回復する
   */
  advanceDay(): void;

  // =============================================================================
  // リソース管理
  // =============================================================================

  /**
   * 行動ポイントを消費する
   *
   * @param amount 消費量
   * @returns 消費に成功した場合true、APが不足している場合false
   */
  spendActionPoints(amount: number): boolean;

  /**
   * ゴールドを追加する
   *
   * @param amount 追加量
   */
  addGold(amount: number): void;

  /**
   * ゴールドを消費する
   *
   * @param amount 消費量
   * @returns 消費に成功した場合true、ゴールドが不足している場合false
   */
  spendGold(amount: number): boolean;

  // =============================================================================
  // 昇格ゲージ
  // =============================================================================

  /**
   * 貢献度を追加する
   *
   * @param amount 追加量
   */
  addContribution(amount: number): void;

  // =============================================================================
  // 初期化・リセット
  // =============================================================================

  /**
   * ゲーム状態を初期化する
   *
   * @param initialState カスタム初期状態（部分的に指定可能）
   */
  initialize(initialState?: Partial<IGameState>): void;

  /**
   * ゲーム状態をデフォルト初期状態にリセットする
   */
  reset(): void;

  // =============================================================================
  // セーブ/ロード
  // =============================================================================

  /**
   * セーブデータからゲーム状態を復元する
   *
   * @param saveData セーブデータ
   */
  loadFromSaveData(saveData: ISaveData): void;

  /**
   * 現在のゲーム状態をセーブデータ形式でエクスポートする
   *
   * @returns セーブデータ
   */
  exportToSaveData(): ISaveData;
}
