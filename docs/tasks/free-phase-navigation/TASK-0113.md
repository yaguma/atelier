# TASK-0113: LocationSelectUI実装

**タスクID**: TASK-0113
**タスクタイプ**: TDD
**推定工数**: 8時間
**フェーズ**: Phase 3 - Presentation層 UI実装
**信頼性レベル**: 🔵 *REQ-002・architecture.md・design-interview.md D8より*

## 関連文書

- **概要**: [📋 overview.md](overview.md)
- **要件定義**: [📋 requirements.md](../../spec/free-phase-navigation/requirements.md) - REQ-002, REQ-002-01〜REQ-002-05
- **設計文書**: [📐 architecture.md](../../design/free-phase-navigation/architecture.md)
- **データフロー**: [🔄 dataflow.md](../../design/free-phase-navigation/dataflow.md) - セクション4

## タスク概要

採取場所選択UIを新規実装する。rexUI scrollablePanel + カード形式リストで採取地一覧を表示し、各カードにAPコスト・素材プレビューを含める。手札連動フィルタリングも実装。

## 依存タスク

- **前提タスク**: [TASK-0105: 採取場所データ定義とGatheringService拡張](TASK-0105.md)
- **後続タスク**: [TASK-0114: GatheringPhaseUI変更](TASK-0114.md)

## 完了条件

- [ ] rexUI scrollablePanelで採取地カードリストが表示される
- [ ] 各カードにAPコスト・素材プレビューが表示される
- [ ] 手札にある採取地カードのみ選択可能
- [ ] 手札に採取地カードが0枚の場合、メッセージが表示される
- [ ] 採取地選択時にコールバックが発火する
- [ ] テストが全て通る

---

## 実装詳細

### 1. LocationSelectUIコンポーネント 🔵

**信頼性**: 🔵 *architecture.md・design-interview.md D8「rexUI scrollablePanel + カード形式リスト」より*

**実装ファイル**: `src/features/gathering/components/LocationSelectUI.ts`

BaseComponent継承。rexUI.add.scrollablePanel()で場所カードリストを表示。

### 2. 場所カードの表示 🔵

**信頼性**: 🔵 *REQ-002-02・REQ-002-03より*

各カードに以下を表示:
- 採取地名
- 移動APコスト
- 採取可能素材プレビュー（素材名・レアリティ・出現率）
- 選択不可の場合はグレーアウト

### 3. 手札連動フィルタ 🔵

**信頼性**: 🔵 *REQ-002-04より*

手札にある採取地カードと連動し、選択可能な場所を判定。

### 4. 空手札時のメッセージ 🟡

**信頼性**: 🟡 *EDGE-103から妥当な推測*

手札に採取地カードが0枚の場合、「採取地カードがありません」メッセージを表示。

---

## 単体テスト要件

### テストケース1: 場所リストの表示 🔵

**Given**: 3つの採取地データ
**When**: LocationSelectUI.create()
**Then**: 3つの場所カードが表示される

### テストケース2: APコスト・素材プレビュー表示 🔵

**Given**: 場所データ（movementAPCost=1, 素材3種）
**When**: カード表示
**Then**: APコストと素材プレビューが正しく表示される

### テストケース3: 手札カードによる選択可否 🔵

**Given**: 手札に「近くの森」のみ
**When**: 表示
**Then**: 「近くの森」のみ選択可能、他はグレーアウト

### テストケース4: 場所選択コールバック 🔵

**Given**: LocationSelectUIが表示されている
**When**: 選択可能な場所をクリック
**Then**: onLocationSelect コールバックが呼ばれる

### テストケース5: 空手札メッセージ 🟡

**Given**: 手札に採取地カードなし
**When**: 表示
**Then**: 「採取地カードがありません」メッセージが表示される

---

## UI/UX要件

### デザイン 🟡

**信頼性**: 🟡 *design-interview.md D8から妥当な推測*

- カードリスト形式（rexUI scrollablePanel）
- 各カードは既存の依頼カードUIに類似したデザイン
- 選択不可カードはalpha=0.5でグレーアウト

---

## 実装手順

1. `/tsumiki:tdd-requirements TASK-0113` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- rexUIのscrollablePanelは既存の依頼一覧で使用パターンあり（参考にする）
- マップ表示は初期実装ではリスト形式、将来的にマップビジュアル追加可能な構造にする
- BaseComponent継承、THEMEの色定数を使用

---

## 信頼性レベルサマリー

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 3 | 1 | 0 | 4 |
| 単体テスト | 4 | 1 | 0 | 5 |
| UI/UX要件 | 0 | 1 | 0 | 1 |

### 全体評価

- **総項目数**: 10項目
- 🔵 **青信号**: 7項目 (70%)
- 🟡 **黄信号**: 3項目 (30%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: ✅ 高品質
