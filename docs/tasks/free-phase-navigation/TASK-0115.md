# TASK-0115: APOverflowPreview実装

**タスクID**: TASK-0115
**タスクタイプ**: TDD
**推定工数**: 8時間
**フェーズ**: Phase 3 - Presentation層 UI実装
**信頼性レベル**: 🟡 *NFR-102・design-interview.md D7から妥当な推測*

## 関連文書

- **概要**: [📋 overview.md](overview.md)
- **要件定義**: [📋 requirements.md](../../spec/free-phase-navigation/requirements.md) - NFR-102
- **設計文書**: [📐 architecture.md](../../design/free-phase-navigation/architecture.md)
- **型定義**: [📝 interfaces.ts](../../design/free-phase-navigation/interfaces.ts)

## タスク概要

AP超過時の確認ダイアログを新規実装する。消費AP・超過AP・翌日AP・消費日数を表示し、ユーザーに続行/キャンセルの選択を求める。

## 依存タスク

- **前提タスク**: [TASK-0107: GameFlowManager - processAPOverflow()](TASK-0107.md)
- **後続タスク**: [TASK-0119: 統合テスト - AP超過自動日進行](TASK-0119.md)

## 完了条件

- [ ] AP超過プレビューダイアログが表示される
- [ ] 消費AP・超過AP・翌日AP・消費日数が正しく表示される
- [ ] 「続行」ボタンでprocessAPOverflow()が実行される
- [ ] 「キャンセル」ボタンで行動がキャンセルされる
- [ ] テストが全て通る

---

## 実装詳細

### 1. APOverflowPreviewコンポーネント 🟡

**信頼性**: 🟡 *NFR-102・design-interview.md D7「行動確定後の確認ダイアログ」から妥当な推測*

**実装ファイル**: `src/shared/presentation/ui/phases/components/APOverflowPreview.ts`

rexUI.add.dialog()で確認ダイアログを表示。IAPOverflowPreviewDataを受け取り表示。

### 2. 表示内容 🟡

**信頼性**: 🟡 *NFR-102・interfaces.ts IAPOverflowPreviewDataから妥当な推測*

- 行動名
- 消費AP / 現在AP
- 超過AP
- 消費日数
- 翌日のAP
- 「続行」「キャンセル」ボタン

---

## 単体テスト要件

### テストケース1: プレビューダイアログの表示 🟡

**Given**: IAPOverflowPreviewData
**When**: show()
**Then**: ダイアログが表示される

### テストケース2: 続行ボタンでコールバック 🟡

**Given**: プレビューダイアログが表示
**When**: 続行ボタンクリック
**Then**: onConfirmコールバックが呼ばれる

### テストケース3: キャンセルボタンでコールバック 🟡

**Given**: プレビューダイアログが表示
**When**: キャンセルボタンクリック
**Then**: onCancelコールバックが呼ばれる

---

## 実装手順

1. `/tsumiki:tdd-requirements TASK-0115` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- ダイアログ表示時は背景をオーバーレイで半透明にする
- アニメーションを使用してダイアログのフェードイン/アウト
- BaseComponent継承パターンに従う

---

## 信頼性レベルサマリー

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 0 | 2 | 0 | 2 |
| 単体テスト | 0 | 3 | 0 | 3 |

### 全体評価

- **総項目数**: 5項目
- 🔵 **青信号**: 0項目 (0%)
- 🟡 **黄信号**: 5項目 (100%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: ⚠️ 要改善

**推測が多い項目**: ダイアログの具体的なレイアウト、表示内容の詳細
