# TASK-0111: PhaseTabUI実装

**タスクID**: TASK-0111
**タスクタイプ**: TDD
**推定工数**: 8時間
**フェーズ**: Phase 3 - Presentation層 UI実装
**信頼性レベル**: 🔵 *REQ-006・architecture.mdより*

## 関連文書

- **概要**: [📋 overview.md](overview.md)
- **要件定義**: [📋 requirements.md](../../spec/free-phase-navigation/requirements.md) - REQ-006, REQ-006-01〜REQ-006-03
- **設計文書**: [📐 architecture.md](../../design/free-phase-navigation/architecture.md)
- **型定義**: [📝 interfaces.ts](../../design/free-phase-navigation/interfaces.ts)

## タスク概要

フェーズ切り替え用のタブUIコンポーネントを新規作成する。依頼・採取・調合・納品の4タブ、アクティブタブ強調、クリックによるフェーズ切り替え、日終了ボタンを含む。

## 依存タスク

- **前提タスク**: [TASK-0106: GameFlowManager - switchPhase()](TASK-0106.md)
- **後続タスク**: [TASK-0112: FooterUI変更](TASK-0112.md), [TASK-0116: MainScene変更](TASK-0116.md)

## 完了条件

- [ ] 4つのタブ（依頼・採取・調合・納品）が表示される
- [ ] アクティブタブが視覚的に強調表示される
- [ ] タブクリックでGameFlowManager.switchPhase()が呼ばれる
- [ ] 「日終了」ボタンが配置されている
- [ ] PHASE_CHANGEDイベントでアクティブタブが更新される
- [ ] BaseComponent継承パターンに従っている
- [ ] テストが全て通る

---

## 実装詳細

### 1. PhaseTabUIコンポーネント 🔵

**信頼性**: 🔵 *REQ-006-01〜REQ-006-03・architecture.md「PhaseTabUI（FooterUIの置換）」より*

**実装ファイル**: `src/shared/components/PhaseTabUI.ts`

BaseComponentを継承。rexUIのlabel()で各タブを作成。既存のPHASE_COLORSを活用してアクティブタブを強調表示。

### 2. タブクリックイベント処理 🔵

**信頼性**: 🔵 *REQ-006-03「タブをクリックすることで即座にフェーズを切り替え」より*

各タブにpointerdownイベントを設定し、GameFlowManager.switchPhase()を呼び出す。

### 3. PHASE_CHANGEDイベント監視 🔵

**信頼性**: 🔵 *既存EventBusパターンより*

EventBus.on(PHASE_CHANGED)でアクティブタブを更新。

### 4. 「日終了」ボタン 🔵

**信頼性**: 🔵 *REQ-004・architecture.md「日終了ボタンの配置」より*

既存の「休憩」ボタンを「日終了」に名称変更。GameFlowManager.requestEndDay()を呼び出す。

---

## 単体テスト要件

### テストケース1: 4タブが表示される 🔵

**Given**: PhaseTabUIを作成
**When**: create()を呼び出す
**Then**: 4つのタブが表示される

### テストケース2: アクティブタブの強調 🔵

**Given**: currentPhase=GATHERING
**When**: PHASE_CHANGEDイベント発行
**Then**: GATHERINGタブがアクティブ色で表示

### テストケース3: タブクリックでswitchPhase呼び出し 🔵

**Given**: PhaseTabUIが表示されている
**When**: 調合タブをクリック
**Then**: switchPhase({targetPhase: ALCHEMY})が呼ばれる

### テストケース4: 日終了ボタンでrequestEndDay呼び出し 🔵

**Given**: PhaseTabUIが表示されている
**When**: 日終了ボタンをクリック
**Then**: requestEndDay()が呼ばれる

---

## UI/UX要件

### デザイン 🔵

**信頼性**: 🔵 *REQ-006-02・既存PHASE_COLORSより*

- タブ色: PHASE_COLORSを使用（依頼=青系、採取=緑系、調合=紫系、納品=橙系）
- アクティブタブ: 背景色を明るく、テキストを太字
- 非アクティブタブ: 背景色を暗く

### レスポンシブ 🟡

**信頼性**: 🟡 *既存FooterUIから妥当な推測*

- 画面幅に応じてタブサイズを調整
- タブテキストが収まらない場合はアイコンのみ表示

---

## 実装手順

1. `/tsumiki:tdd-requirements TASK-0111` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- BaseComponent継承パターンに従う
- THEMEの色定数を使用
- destroy()でEventBus購読を確実に解除
- rexUIの初期化確認を行う

---

## 信頼性レベルサマリー

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 4 | 0 | 0 | 4 |
| 単体テスト | 4 | 0 | 0 | 4 |
| UI/UX要件 | 1 | 1 | 0 | 2 |

### 全体評価

- **総項目数**: 10項目
- 🔵 **青信号**: 9項目 (90%)
- 🟡 **黄信号**: 1項目 (10%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: ✅ 高品質
