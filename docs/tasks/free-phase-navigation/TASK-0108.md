# TASK-0108: GameFlowManager - startDay()å¤‰æ›´ã¨requestEndDay()è¿½åŠ 

**ã‚¿ã‚¹ã‚¯ID**: TASK-0108
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 8æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - Applicationå±¤ ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *REQ-003-01ãƒ»REQ-004ãƒ»architecture.mdã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/free-phase-navigation/requirements.md) - REQ-003-01, REQ-004, REQ-004-01
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/free-phase-navigation/architecture.md)
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**: [ğŸ”„ dataflow.md](../../design/free-phase-navigation/dataflow.md) - ã‚»ã‚¯ã‚·ãƒ§ãƒ³5

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

startDay()ã®APå›å¾©ãƒ­ã‚¸ãƒƒã‚¯ã‚’APè¶…éåˆ†è€ƒæ…®ã«å¤‰æ›´ã—ã€æ˜ç¤ºçš„æ—¥çµ‚äº†ã®ãŸã‚ã®requestEndDay()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0102: ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»å®šç¾©ã®æ›´æ–°ã¨IGameStateæ‹¡å¼µ](TASK-0102.md), [TASK-0103: APOverflowServiceå®Ÿè£…](TASK-0103.md)
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0110: GameFlowManager - æ²ç¤ºæ¿é€£æºçµ±åˆ](TASK-0110.md)

## å®Œäº†æ¡ä»¶

- [ ] startDay()ãŒAPè¶…éåˆ†ã‚’å·®ã—å¼•ã„ã¦APå›å¾©ã™ã‚‹
- [ ] requestEndDay()ãŒæ®‹APç ´æ£„+endDay()ã‚’å®Ÿè¡Œã™ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. startDay() APå›å¾©ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-003-01ã€ŒAPè¶…éåˆ†ã¯ç¿Œæ—¥ã®APã‹ã‚‰å·®ã—å¼•ã‹ã‚Œã‚‹ã€ã‚ˆã‚Š*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/shared/services/game-flow/game-flow-manager.ts`

å¤‰æ›´å‰: `actionPoints = MAX_AP`
å¤‰æ›´å¾Œ: `actionPoints = MAX_AP - apOverflow` â†’ `apOverflow = 0`ã«ãƒªã‚»ãƒƒãƒˆ

### 2. requestEndDay()ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ  ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *REQ-004ãƒ»REQ-004-01ãƒ»dataflow.md ã‚»ã‚¯ã‚·ãƒ§ãƒ³5ã‚ˆã‚Š*

```typescript
async requestEndDay(): Promise<void> {
  // 1. æ®‹ã‚ŠAPã‚’ç ´æ£„
  // 2. apOverflowã‚’0ã«ãƒªã‚»ãƒƒãƒˆ
  // 3. endDay()å®Ÿè¡Œ
  // 4. startDay()å®Ÿè¡Œ
}
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: APè¶…éãªã—ã®é€šå¸¸startDay() ğŸ”µ

**Given**: apOverflow=0
**When**: startDay()
**Then**: actionPoints=MAX_AP(3)

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: APè¶…éã‚ã‚Šã®startDay() ğŸ”µ

**Given**: apOverflow=1
**When**: startDay()
**Then**: actionPoints=2, apOverflow=0ã«ãƒªã‚»ãƒƒãƒˆ

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: requestEndDay()ã§æ®‹APç ´æ£„ ğŸ”µ

**Given**: actionPoints=2
**When**: requestEndDay()
**Then**: endDay()ãŒå®Ÿè¡Œã•ã‚Œã€æ–°ã—ã„æ—¥ãŒé–‹å§‹ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹4: requestEndDay()ã§apOverflowãƒªã‚»ãƒƒãƒˆ ğŸ”µ

**Given**: apOverflow=1ï¼ˆå‰æ—¥ã®è¶…éåˆ†ï¼‰
**When**: requestEndDay()
**Then**: apOverflow=0ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã€æ¬¡æ—¥ã¯MAX_APã§é–‹å§‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0108` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- æ—¢å­˜ã®startDay()ã®ãƒ†ã‚¹ãƒˆãŒå£Šã‚Œãªã„ã‚ˆã†ã€apOverflow=0ã®å ´åˆã¯å¾“æ¥é€šã‚Šã®å‹•ä½œã‚’ç¶­æŒ
- requestEndDay()ã¯ã€Œæ—¥çµ‚äº†ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ç›´æ¥å‘¼ã°ã‚Œã‚‹ãŸã‚ã€UIã‚¤ãƒ™ãƒ³ãƒˆã¨ã®é€£æºã‚’è€ƒæ…®

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| å®Ÿè£…è©³ç´° | 2 | 0 | 0 | 2 |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | 4 | 0 | 0 | 4 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 6é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 6é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: âœ… é«˜å“è³ª
