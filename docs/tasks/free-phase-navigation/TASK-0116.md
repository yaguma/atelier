# TASK-0116: MainScene変更

**タスクID**: TASK-0116
**タスクタイプ**: TDD
**推定工数**: 8時間
**フェーズ**: Phase 3 - Presentation層 UI実装
**信頼性レベル**: 🔵 *REQ-001・architecture.md・既存MainScene実装より*

## 関連文書

- **概要**: [📋 overview.md](overview.md)
- **要件定義**: [📋 requirements.md](../../spec/free-phase-navigation/requirements.md) - REQ-001, REQ-006
- **設計文書**: [📐 architecture.md](../../design/free-phase-navigation/architecture.md)

## タスク概要

MainSceneをタブ切り替え連携に対応させる。_completedPhasesトラッキングを廃止し、PhaseTabUIとの連携を追加。showPhase()のフェーズ表示ロジックを自由遷移対応に更新する。

## 依存タスク

- **前提タスク**: [TASK-0106: GameFlowManager - switchPhase()](TASK-0106.md), [TASK-0111: PhaseTabUI実装](TASK-0111.md)
- **後続タスク**: [TASK-0118: 統合テスト - フェーズ自由遷移](TASK-0118.md)

## 完了条件

- [ ] _completedPhasesトラッキングが廃止されている
- [ ] showPhase()が自由遷移に対応している
- [ ] PhaseTabUIとの連携が正しく動作する
- [ ] 固定順序ロジック（nextPhaseMap等）が削除されている
- [ ] テストが全て通る

---

## 実装詳細

### 1. _completedPhases廃止 🔵

**信頼性**: 🔵 *REQ-001「自由遷移」・既存MainScene実装分析より*

**実装ファイル**: `src/scenes/MainScene.ts`

_completedPhasesの追跡は固定順序前提のため削除。

### 2. showPhase()の更新 🔵

**信頼性**: 🔵 *既存MainScene.showPhase()パターンより*

フェーズ切り替え時の処理を自由遷移対応に。固定順序の前提を排除。

### 3. 固定順序ロジックの削除 🔵

**信頼性**: 🔵 *architecture.md「次フェーズの自動決定ロジックを廃止」より*

nextPhaseMap、「次へ」ボタンのフェーズ遷移ロジック等を削除。

---

## 単体テスト要件

### テストケース1: 任意のフェーズへの表示切り替え 🔵

**Given**: currentPhase=QUEST_ACCEPT
**When**: showPhase(DELIVERY)
**Then**: DELIVERYフェーズUIが表示される

### テストケース2: PHASE_CHANGEDイベントで表示更新 🔵

**Given**: MainSceneが表示中
**When**: PHASE_CHANGEDイベント発行
**Then**: 対応フェーズUIに切り替わる

### テストケース3: _completedPhasesが存在しない 🔵

**Given**: MainScene
**When**: フェーズを複数回切り替え
**Then**: _completedPhasesの概念なし、エラーなし

---

## 実装手順

1. `/tsumiki:tdd-requirements TASK-0116` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- MainSceneの大規模変更のため、既存テストへの影響を慎重に確認
- 「次へ」ボタン関連のイベントハンドラも削除
- シーン間のデータ受け渡しは変更不要

---

## 信頼性レベルサマリー

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 3 | 0 | 0 | 3 |
| 単体テスト | 3 | 0 | 0 | 3 |

### 全体評価

- **総項目数**: 6項目
- 🔵 **青信号**: 6項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: ✅ 高品質
