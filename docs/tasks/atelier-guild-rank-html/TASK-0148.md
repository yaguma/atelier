# TASK-0148: DeckServiceåˆæœŸãƒ‡ãƒƒã‚­ç”Ÿæˆã®ä¿®æ­£

**ã‚¿ã‚¹ã‚¯ID**: TASK-0148
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 3æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 6 - ãƒã‚°ä¿®æ­£ãƒ»ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *è¨­è¨ˆå¤‰æ›´ã‚’å«ã‚€*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](../atelier-guild-rank-overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/atelier-guild-rank/requirements.md)
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/atelier-guild-rank/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

DeckServiceã®createInitialDeck()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£ã—ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰å®šç¾©ã®ä»£ã‚ã‚Šã«initial_deck.jsonãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0147
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0149

## å®Œäº†æ¡ä»¶

- [ ] createInitialDeck()ãŒinitial_deck.jsonã‚’ä½¿ç”¨
- [ ] ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆgathering.json, recipe.json, enhancement.jsonï¼‰ã¨é€£æº
- [ ] åˆæœŸãƒ‡ãƒƒã‚­ãŒæ­£ã—ã15æšã§æ§‹æˆã•ã‚Œã‚‹
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒé€šé

---

## å®Ÿè£…è©³ç´°

### 1. DeckServiceã®ä¾å­˜æ€§æ³¨å…¥ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´*

DeckServiceã«MasterDataLoaderã‚’æ³¨å…¥:
```typescript
export class DeckService {
  constructor(
    private readonly masterDataLoader?: IMasterDataLoader
  ) {}
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/domain/services/DeckService.ts`

### 2. createInitialDeck()ã®ä¿®æ­£ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´*

```typescript
async createInitialDeck(): Promise<Deck> {
  if (!this.masterDataLoader) {
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã®åˆæœŸãƒ‡ãƒƒã‚­
    return this.createDefaultInitialDeck();
  }

  const initialDeckData = await this.masterDataLoader.load<IInitialDeck>('initial_deck.json');
  const cardMaster = await this.masterDataLoader.loadAll();

  const cards = initialDeckData.cardIds.map(cardId => {
    // ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰è©²å½“ã‚«ãƒ¼ãƒ‰ã‚’æ¤œç´¢
    return this.findCardInMaster(cardId, cardMaster);
  });

  return createDeck(cards);
}
```

### 3. NewGameUseCaseã¨ã®çµ±åˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜ãƒ•ãƒ­ãƒ¼å‚ç…§*

NewGameUseCaseã§ã®DeckServiceä½¿ç”¨ç®‡æ‰€ã‚’ç¢ºèªã—ã€éåŒæœŸå¯¾å¿œ:
```typescript
// åˆæœŸãƒ‡ãƒƒã‚­ã‚’ç”Ÿæˆ
const initialDeck = await deckService.createInitialDeck();
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/application/NewGameUseCase.ts`

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®åˆæœŸãƒ‡ãƒƒã‚­ç”Ÿæˆ ğŸ”µ

**Given**: MasterDataLoaderãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
**When**: createInitialDeck()ã‚’å‘¼ã³å‡ºã™
**Then**: initial_deck.jsonã«åŸºã¥ã15æšã®ãƒ‡ãƒƒã‚­ãŒç”Ÿæˆã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ ğŸŸ¡

**Given**: MasterDataLoaderãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
**When**: createInitialDeck()ã‚’å‘¼ã³å‡ºã™
**Then**: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸåˆæœŸãƒ‡ãƒƒã‚­ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æ¤œè¨¼ ğŸ”µ

**Given**: åˆæœŸãƒ‡ãƒƒã‚­ãŒç”Ÿæˆã•ã‚Œã‚‹
**When**: ãƒ‡ãƒƒã‚­å†…å®¹ã‚’ç¢ºèª
**Then**: GATHERING 7æš, RECIPE 5æš, ENHANCEMENT 3æš

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0148` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- éåŒæœŸå‡¦ç†ã¸ã®å¤‰æ›´ã«ä¼´ã†å‘¼ã³å‡ºã—å…ƒã®ä¿®æ­£ãŒå¿…è¦
- å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ®‹ã™

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 5é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 3é …ç›® (60%)
- ğŸŸ¡ **é»„ä¿¡å·**: 2é …ç›® (40%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: è¦æ”¹å–„
