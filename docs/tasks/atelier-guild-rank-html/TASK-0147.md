# TASK-0147: MasterDataLoaderæ‹¡å¼µï¼ˆæ–°è¦ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰

**ã‚¿ã‚¹ã‚¯ID**: TASK-0147
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 3æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 6 - ãƒã‚°ä¿®æ­£ãƒ»ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *æ˜ç¢ºãªå®Ÿè£…è¦ä»¶*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](../atelier-guild-rank-overview.md)
- **è¦ä»¶å®šç¾©**: [ğŸ“‹ requirements.md](../../spec/atelier-guild-rank/requirements.md)
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture.md](../../design/atelier-guild-rank/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

MasterDataLoaderã«æ–°è¦è¿½åŠ ã•ã‚ŒãŸãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆclients.json, initial_deck.json, shop_items.jsonï¼‰ã®èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0146
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0148

## å®Œäº†æ¡ä»¶

- [ ] clients.jsonã®èª­ã¿è¾¼ã¿æ©Ÿèƒ½è¿½åŠ 
- [ ] initial_deck.jsonã®èª­ã¿è¾¼ã¿æ©Ÿèƒ½è¿½åŠ 
- [ ] shop_items.jsonã®èª­ã¿è¾¼ã¿æ©Ÿèƒ½è¿½åŠ 
- [ ] MasterDataSetã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ–°è¦ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¿½åŠ 
- [ ] loadAll()ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬èª­ã¿è¾¼ã¿å¯èƒ½

---

## å®Ÿè£…è©³ç´°

### 1. æ–°è¦ãƒ‡ãƒ¼ã‚¿å‹å®šç¾© ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ˜ç¢º*

**clients.jsonç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:
```typescript
export interface IClient {
  id: string;
  name: string;
  type: ClientType;
  contributionMultiplier: number;
  goldMultiplier: number;
  deadlineModifier: number;
  preferredQuestTypes: QuestConditionType[];
  unlockRank: GuildRank;
  dialoguePatterns: string[];
  description: string;
}
```

**initial_deck.jsonç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:
```typescript
export interface IInitialDeck {
  version: string;
  description: string;
  totalCards: number;
  deck: { cardId: string; quantity: number; type: CardType; name: string }[];
  cardIds: string[];
}
```

**shop_items.jsonç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:
```typescript
export interface IShopItem {
  id: string;
  type: 'card' | 'material' | 'artifact';
  itemId: string;
  price: number;
  stock: number; // -1 for unlimited
  unlockRank: GuildRank;
  description: string;
  quality?: Quality; // for materials
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/domain/`é…ä¸‹ã«æ–°è¦å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

### 2. IMasterDataLoaderæ‹¡å¼µ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‚ç…§*

MasterDataSetã«æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ :
```typescript
export interface MasterDataSet {
  // æ—¢å­˜
  cards: { gathering: IGatheringCard[]; recipe: IRecipeCard[]; enhancement: IEnhancementCard[] };
  materials: IMaterial[];
  items: IItem[];
  quests: IQuestTemplate[];
  ranks: IGuildRank[];
  artifacts: IArtifact[];
  // æ–°è¦è¿½åŠ 
  clients: IClient[];
  initialDeck: IInitialDeck;
  shopItems: IShopItem[];
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/infrastructure/loader/IMasterDataLoader.ts`

### 3. MasterDataLoaderå®Ÿè£… ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³å‚ç…§*

loadAll()ã‚’æ‹¡å¼µã—ã¦æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿:
```typescript
async loadAll(): Promise<MasterDataSet> {
  const [...existing, clients, initialDeck, shopItems] = await Promise.all([
    // æ—¢å­˜ã®ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    this.load<IClient[]>('clients.json'),
    this.load<IInitialDeck>('initial_deck.json'),
    this.load<IShopItem[]>('shop_items.json'),
  ]);
  // ...
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/infrastructure/loader/MasterDataLoader.ts`

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ğŸ”µ

**Given**: clients.jsonãŒå­˜åœ¨ã™ã‚‹
**When**: loadAll()ã‚’å‘¼ã³å‡ºã™
**Then**: clientsé…åˆ—ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: åˆæœŸãƒ‡ãƒƒã‚­ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ğŸ”µ

**Given**: initial_deck.jsonãŒå­˜åœ¨ã™ã‚‹
**When**: loadAll()ã‚’å‘¼ã³å‡ºã™
**Then**: initialDeckã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ã‚·ãƒ§ãƒƒãƒ—ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ğŸ”µ

**Given**: shop_items.jsonãŒå­˜åœ¨ã™ã‚‹
**When**: loadAll()ã‚’å‘¼ã³å‡ºã™
**Then**: shopItemsé…åˆ—ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã‚‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0147` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- æ—¢å­˜ã®loadAll()å‘¼ã³å‡ºã—ç®‡æ‰€ã¸ã®å½±éŸ¿ç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼‰

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 6é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 6é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
