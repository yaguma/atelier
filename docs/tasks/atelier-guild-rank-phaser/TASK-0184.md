# TASK-0184: BootSceneé€²æ—ãƒãƒ¼å®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0184
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - åŸºæœ¬ã‚·ãƒ¼ãƒ³ãƒ»å…±é€šUIå®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”´ *Phaserå›ºæœ‰ã®èª¿æŸ»ãŒå¿…è¦*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **è¨­è¨ˆæ–‡æ›¸**: [architecture.md](../../design/atelier-guild-rank-phaser/architecture.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

BootSceneã«è¦–è¦šçš„ãªãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é€²æ—ãƒãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0183, TASK-0176
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0185

## å®Œäº†æ¡ä»¶

- [ ] é€²æ—ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ã«é€£å‹•ã—ã¦é€²æ—ãŒæ›´æ–°ã•ã‚Œã‚‹
- [ ] ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. BootSceneé€²æ—ãƒãƒ¼è¿½åŠ  ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *UIFactoryã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ä½¿ç”¨*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/BootScene.ts` ã‚’æ›´æ–°

```typescript
import { BaseGameScene, SceneInitData } from './BaseGameScene';
import { SceneKeys } from '../config/SceneKeys';
import { AllAssets, getTotalAssetCount } from '../boot/AssetList';
import { SceneManager } from '../managers/SceneManager';
import { Colors } from '../config/ColorPalette';
import { TextStyles } from '../config/TextStyles';

export class BootScene extends BaseGameScene {
  private progressBar!: Phaser.GameObjects.Graphics;
  private progressBox!: Phaser.GameObjects.Graphics;
  private loadingText!: Phaser.GameObjects.Text;
  private percentText!: Phaser.GameObjects.Text;
  private titleText!: Phaser.GameObjects.Text;
  private assetText!: Phaser.GameObjects.Text;

  constructor() {
    super(SceneKeys.BOOT);
  }

  protected onInit(data?: SceneInitData): void {}

  protected onPreload(): void {
    const { width, height } = this.cameras.main;
    const centerX = width / 2;
    const centerY = height / 2;

    // èƒŒæ™¯
    this.cameras.main.setBackgroundColor(Colors.background);

    // ã‚¿ã‚¤ãƒˆãƒ«
    this.titleText = this.add.text(centerX, centerY - 100, 'Atelier Guild Rank', {
      ...TextStyles.titleLarge,
      fontSize: '42px',
    }).setOrigin(0.5);

    // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«
    this.add.text(centerX, centerY - 50, 'ã€œéŒ¬é‡‘è¡“å¸«ã‚®ãƒ«ãƒ‰ç‰©èªã€œ', {
      ...TextStyles.body,
      fontSize: '18px',
    }).setOrigin(0.5);

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒœãƒƒã‚¯ã‚¹ï¼ˆèƒŒæ™¯ï¼‰
    const barWidth = 400;
    const barHeight = 30;
    this.progressBox = this.add.graphics();
    this.progressBox.fillStyle(Colors.backgroundDark);
    this.progressBox.fillRoundedRect(
      centerX - barWidth / 2,
      centerY + 20,
      barWidth,
      barHeight,
      barHeight / 2
    );

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
    this.progressBar = this.add.graphics();

    // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆ
    this.percentText = this.add.text(centerX, centerY + 35, '0%', {
      ...TextStyles.body,
      fontSize: '16px',
    }).setOrigin(0.5);

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆ
    this.loadingText = this.add.text(centerX, centerY + 70, 'Loading...', {
      ...TextStyles.bodySmall,
    }).setOrigin(0.5);

    // ã‚¢ã‚»ãƒƒãƒˆåãƒ†ã‚­ã‚¹ãƒˆ
    this.assetText = this.add.text(centerX, centerY + 95, '', {
      ...TextStyles.bodySmall,
      fontSize: '12px',
    }).setOrigin(0.5);

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ‰ãƒƒãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    this.time.addEvent({
      delay: 500,
      callback: () => {
        const dots = this.loadingText.text.match(/\./g)?.length || 0;
        const newDots = (dots + 1) % 4;
        this.loadingText.setText('Loading' + '.'.repeat(newDots));
      },
      loop: true,
    });

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
    this.load.on('progress', (value: number) => {
      this.updateProgressBar(value);
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
    this.load.on('fileprogress', (file: Phaser.Loader.File) => {
      this.assetText.setText(file.key);
    });

    // å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
    this.load.on('complete', () => {
      this.assetText.setText('Complete!');
      this.loadingText.setText('Ready');
    });

    // ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿
    this.loadAllAssets();
  }

  protected onCreate(data?: SceneInitData): void {
    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¦TitleSceneã¸
    this.cameras.main.fadeOut(500, 0, 0, 0);
    this.cameras.main.once('camerafadeoutcomplete', () => {
      SceneManager.getInstance().goTo(SceneKeys.TITLE);
    });
  }

  protected setupEventListeners(): void {}

  private updateProgressBar(value: number): void {
    const { width, height } = this.cameras.main;
    const centerX = width / 2;
    const centerY = height / 2;
    const barWidth = 400;
    const barHeight = 30;
    const padding = 4;

    this.progressBar.clear();
    this.progressBar.fillStyle(Colors.primary);

    const fillWidth = (barWidth - padding * 2) * value;
    if (fillWidth > 0) {
      this.progressBar.fillRoundedRect(
        centerX - barWidth / 2 + padding,
        centerY + 20 + padding,
        fillWidth,
        barHeight - padding * 2,
        (barHeight - padding * 2) / 2
      );
    }

    this.percentText.setText(`${Math.round(value * 100)}%`);
  }

  private loadAllAssets(): void {
    AllAssets.forEach(asset => {
      switch (asset.type) {
        case 'image':
          this.load.image(asset.key, asset.path);
          break;
        case 'audio':
          this.load.audio(asset.key, asset.path);
          break;
        case 'json':
          this.load.json(asset.key, asset.path);
          break;
        case 'spritesheet':
          if (asset.frameConfig) {
            this.load.spritesheet(asset.key, asset.path, asset.frameConfig);
          }
          break;
      }
    });
  }
}
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: é€²æ—ãƒãƒ¼è¡¨ç¤º ğŸ”´

**Given**: BootSceneãŒé–‹å§‹ã•ã‚Œã‚‹
**When**: preload()ãŒå‘¼ã°ã‚Œã‚‹
**Then**: é€²æ—ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: é€²æ—æ›´æ–° ğŸ”´

**Given**: ã‚¢ã‚»ãƒƒãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹
**When**: 50%èª­ã¿è¾¼ã¿å®Œäº†
**Then**: é€²æ—ãƒãƒ¼ãŒ50%è¡¨ç¤ºã•ã‚Œã‚‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0184` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- ä½é€Ÿç’°å¢ƒã§ã®UXè€ƒæ…®
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ§ãˆã‚ã«
- ãƒ•ã‚©ãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹å‰ã®è¡¨ç¤ºã«æ³¨æ„

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 1é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 1é …ç›® (100%)

**å“è³ªè©•ä¾¡**: è¦èª¿æŸ»
