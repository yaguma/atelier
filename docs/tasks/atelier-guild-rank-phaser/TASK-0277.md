# TASK-0277: バグ修正・仕上げ

**タスクID**: TASK-0277
**タスクタイプ**: DIRECT
**推定工数**: 4時間
**フェーズ**: Phase 5 - 統合テスト・最適化・仕上げ
**信頼性レベル**: 🔴 *最終調整*

## 関連文書

- **概要**: [overview.md](./overview.md)
- **最終動作確認（後半機能）**: TASK-0276

## タスク概要

TASK-0275、TASK-0276で発見された不具合を修正し、リリース可能な状態に仕上げる。

## 依存タスク

- **前提タスク**: TASK-0276 (最終動作確認後半)
- **後続タスク**: なし（最終タスク）

## 完了条件

- [x] 優先度「高」の不具合が全て修正されている ※BUG-0001修正完了
- [x] 優先度「中」の不具合が全て修正されている ※BUG-0002, BUG-0003修正完了
- [x] 最終動作確認で不具合が再発しない ※Playwrightで確認済み
- [ ] パフォーマンス目標を達成している ※未確認
- [ ] リリースチェックリストが完了している ※一部未確認

**修正完了**: 2026-01-14

---

## 不具合管理

### 不具合一覧

| 不具合ID | 発生箇所 | 現象 | 優先度 | 状態 | 修正日 |
|---------|---------|------|--------|------|-------|
| BUG-0001 | 依頼受注フェーズ | 次のフェーズへボタンが動作しない | 高 | 完了 | 2026-01-14 |
| BUG-0002 | ナビゲーション | フェーズインジケータークリックが動作しない | 中 | 完了 | 2026-01-14 |
| BUG-0003 | ショップ画面 | 購入処理が動作しない | 中 | 完了 | 2026-01-14 |
| BUG-0004 | 画面遷移時 | DOM要素が重複する | 低 | 未着手 | - |

### 優先度基準

- **高**: ゲーム進行不可、データ損失、クラッシュ
- **中**: 機能不全、表示崩れ、操作性問題
- **低**: 軽微な表示問題、改善提案

---

## 修正作業フロー

### 1. 不具合分析 🔴

**信頼性**: 🔴 *デバッグ作業*

```markdown
### BUG-XXXX 分析

**再現手順**:
1.
2.
3.

**原因調査**:
- 関連ファイル:
- 問題箇所:
- 根本原因:

**修正方針**:
-
```

### 2. 修正実装 🔴

**信頼性**: 🔴 *コード修正*

```markdown
### BUG-XXXX 修正

**修正ファイル**:
- `path/to/file.ts`

**修正内容**:
- 変更点1
- 変更点2

**影響範囲**:
- 影響する機能
- 関連コンポーネント
```

### 3. 修正確認 🔴

**信頼性**: 🔴 *検証作業*

```markdown
### BUG-XXXX 確認

**再現テスト**:
- [ ] 元の手順で不具合が発生しない

**回帰テスト**:
- [ ] 関連機能が正常に動作する
- [ ] 他の機能に影響がない

**確認者**:
**確認日**:
```

---

## リリースチェックリスト

### 機能チェック

| No | 項目 | 確認 | 備考 |
|----|------|------|------|
| 1 | タイトル画面が表示される | [ ] | |
| 2 | 新規ゲームが開始できる | [ ] | |
| 3 | 全4フェーズを進行できる | [ ] | |
| 4 | 依頼を受注・納品できる | [ ] | |
| 5 | 採取で素材を獲得できる | [ ] | |
| 6 | 調合でアイテムを作成できる | [ ] | |
| 7 | ショップで購入できる | [ ] | |
| 8 | 昇格試験に挑戦できる | [ ] | |
| 9 | Sランク達成でゲームクリア | [ ] | |
| 10 | 30日経過でゲームオーバー | [ ] | |
| 11 | セーブ・ロードが動作する | [ ] | |
| 12 | タイトルに戻れる | [ ] | |

### パフォーマンスチェック

| No | 項目 | 目標値 | 測定値 | 合否 |
|----|------|--------|--------|------|
| 1 | 平均FPS | ≥55 | | |
| 2 | 最低FPS | ≥30 | | |
| 3 | 初期メモリ | ≤100MB | | |
| 4 | 長時間メモリ | ≤150MB | | |
| 5 | Boot時間 | ≤3000ms | | |
| 6 | シーン遷移 | ≤500ms | | |

### 品質チェック

| No | 項目 | 確認 | 備考 |
|----|------|------|------|
| 1 | コンソールエラーがない | [ ] | |
| 2 | メモリリークがない | [ ] | |
| 3 | UIが崩れていない | [ ] | |
| 4 | テキストが正しく表示される | [ ] | |
| 5 | 音声が正しく再生される | [ ] | |
| 6 | 全テストがパスする | [ ] | |

### ビルドチェック

| No | 項目 | 確認 | 備考 |
|----|------|------|------|
| 1 | npm run build が成功する | [ ] | |
| 2 | 型エラーがない | [ ] | |
| 3 | Lintエラーがない | [ ] | |
| 4 | ビルドサイズが適切 | [ ] | |
| 5 | 本番ビルドが動作する | [ ] | |

---

## 実装手順

1. `/direct-setup` - 不具合リスト整理・優先度付け
2. `/direct-verify` - 修正・確認・リリースチェック

---

## 最終成果物

### 出力ファイル

```
docs/tasks/atelier-guild-rank-phaser/
├── overview.md           # タスク概要（更新）
├── release-notes.md      # リリースノート
└── known-issues.md       # 既知の問題

src/presentation/phaser/  # Phaser実装
tests/                    # テストコード
```

### リリースノートテンプレート

```markdown
# atelier-guild-rank-phaser v1.0.0

## 概要

HTML版のPresentation層をPhaser 3に移行した最初のリリース。

## 主な機能

- Phaserベースのゲーム画面
- 全4フェーズのゲームサイクル
- ショップ・昇格試験システム
- セーブ・ロード機能

## 動作環境

- Chrome (推奨)
- Firefox
- Safari
- Edge

## 既知の問題

- 該当なし

## 次期バージョンの予定

- モバイル対応
- サウンド強化
- アニメーション追加
```

---

## 注意事項

- 修正は1件ずつ確実に
- 回帰テストを必ず実施
- 変更履歴を記録
- 緊急度の高いものから対応

---

## 信頼性レベルサマリー

- **総項目数**: 可変（発見不具合数による）
- 🔵 **青信号**: 0項目 (0%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 可変 (100%)

**品質評価**: 低品質（実装時に内容決定）

---

## プロジェクト完了条件

このタスクが完了すると、atelier-guild-rank-phaserプロジェクトの全120タスクが完了となる。

- Phase 1: TASK-0158〜0181 (24タスク) ✓
- Phase 2: TASK-0182〜0211 (30タスク) ✓
- Phase 3: TASK-0212〜0239 (28タスク) ✓
- Phase 4: TASK-0240〜0259 (20タスク) ✓
- Phase 5: TASK-0260〜0277 (18タスク) ✓

**合計: 120タスク**
