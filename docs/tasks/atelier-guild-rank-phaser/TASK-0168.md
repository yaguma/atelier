# TASK-0168: BaseGameSceneå®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0168
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - PhaseråŸºç›¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”´ *Phaserå›ºæœ‰ã®èª¿æŸ»ãŒå¿…è¦*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **è¨­è¨ˆæ–‡æ›¸**: [architecture.md](../../design/atelier-guild-rank-phaser/architecture.md)
- **ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ **: [core-systems.md](../../design/atelier-guild-rank-phaser/core-systems.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

TASK-0167ã§è¨­è¨ˆã—ãŸBaseGameSceneã‚’å®Ÿè£…ã—ã€å‹•ä½œç¢ºèªã‚’è¡Œã†ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0167
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0169, TASK-0182, TASK-0212

## å®Œäº†æ¡ä»¶

- [x] BaseGameSceneã‚¯ãƒ©ã‚¹ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [x] ãƒ†ã‚¹ãƒˆç”¨ã®ç¶™æ‰¿ã‚·ãƒ¼ãƒ³ãŒå‹•ä½œã™ã‚‹
- [x] EventBusé€£æºãŒå‹•ä½œã™ã‚‹
- [x] UIFactoryé€£æºãŒå‹•ä½œã™ã‚‹ï¼ˆrexUIå‚ç…§ã¨ã—ã¦å®Ÿè£…ï¼‰
- [x] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ãŒå‹•ä½œã™ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. BaseGameSceneå®Ÿè£… ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *è¨­è¨ˆã«åŸºã¥ããŒã€Phaserå›ºæœ‰ã®èª¿æ•´ãŒå¿…è¦*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/BaseGameScene.ts`

TASK-0167ã®è¨­è¨ˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 2. ãƒ†ã‚¹ãƒˆç”¨ã‚·ãƒ¼ãƒ³å®Ÿè£… ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *å‹•ä½œç¢ºèªç”¨*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/TestScene.ts`

```typescript
import { BaseGameScene, SceneInitData } from './BaseGameScene';
import { StateUpdateEvents } from '../events/EventTypes';

export class TestScene extends BaseGameScene {
  private testLabel!: Phaser.GameObjects.Text;

  constructor() {
    super('TestScene' as any);
  }

  protected onInit(data?: SceneInitData): void {
    console.log('TestScene: onInit', data);
  }

  protected onPreload(): void {
    console.log('TestScene: onPreload');
  }

  protected onCreate(data?: SceneInitData): void {
    console.log('TestScene: onCreate', data);

    // ãƒ†ã‚¹ãƒˆç”¨ãƒ©ãƒ™ãƒ«
    this.testLabel = this.add.text(640, 360, 'Test Scene', {
      fontSize: '32px',
      color: '#ffffff'
    }).setOrigin(0.5);

    // UIFactoryã‚’ä½¿ã£ãŸãƒœã‚¿ãƒ³
    const button = this.uiFactory.createButton({
      x: 640,
      y: 450,
      text: 'Click Me',
      onClick: () => {
        console.log('Button clicked!');
        this.eventBus.emitVoid('ui:newGame:clicked' as any);
      }
    });
  }

  protected setupEventListeners(): void {
    // çŠ¶æ…‹å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
    const unsub = this.eventBus.on('state:gold:changed', (payload) => {
      console.log('Gold changed:', payload);
      this.testLabel.setText(`Gold: ${payload.gold}`);
    });
    this.subscribe(unsub);
  }

  protected onUpdate(time: number, delta: number): void {
    // ãƒ•ãƒ¬ãƒ¼ãƒ æ›´æ–°å‡¦ç†
  }

  protected onShutdown(): void {
    console.log('TestScene: onShutdown');
  }
}
```

### 3. ã‚·ãƒ¼ãƒ³ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ¨™æº–çš„ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/index.ts`

```typescript
export { BaseGameScene, SceneInitData } from './BaseGameScene';
export { TestScene } from './TestScene';
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ã‚·ãƒ¼ãƒ³ä½œæˆ ğŸ”´

**Given**: TestSceneã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚‹
**When**: ã‚·ãƒ¼ãƒ³ã‚’ã‚²ãƒ¼ãƒ ã«è¿½åŠ ã™ã‚‹
**Then**: create()ãŒå‘¼ã°ã‚ŒUIãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ã‚¤ãƒ™ãƒ³ãƒˆé€£æº ğŸ”´

**Given**: TestSceneãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã‚ã‚‹
**When**: EventBusã§state:gold:changedã‚’ç™ºè¡Œã™ã‚‹
**Then**: ãƒ©ãƒ™ãƒ«ãŒæ›´æ–°ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ ğŸ”´

**Given**: TestSceneã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­ã—ã¦ã„ã‚‹
**When**: ã‚·ãƒ¼ãƒ³ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã™ã‚‹
**Then**: è³¼èª­ãŒè§£é™¤ã•ã‚Œãƒªã‚¹ãƒŠãƒ¼ã‚«ã‚¦ãƒ³ãƒˆãŒ0ã«ãªã‚‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0168` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- Phaserã®ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚‹
- headlessãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆã‚’æ¤œè¨
- å®Ÿéš›ã®ã‚²ãƒ¼ãƒ å‹•ä½œã§ã®ç¢ºèªã‚‚å¿…è¦

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 1é …ç›® (33%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 2é …ç›® (67%)

**å“è³ªè©•ä¾¡**: è¦èª¿æŸ»
