# TASK-0198: HandContainerãƒ†ã‚¹ãƒˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0198
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - åŸºæœ¬ã‚·ãƒ¼ãƒ³ãƒ»å…±é€šUIå®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *å¦¥å½“ãªæ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

HandContaineré–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0197
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0199

## å®Œäº†æ¡ä»¶

- [ ] HandLayoutUtilsã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] HandContainerã®åŸºæœ¬æ“ä½œãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] ã‚«ãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## å®Ÿè£…è©³ç´°

### 1. HandLayoutUtilsãƒ†ã‚¹ãƒˆ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/presentation/ui/hand/HandLayoutUtils.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { calculateCardPositions, CardPosition } from '../../../../../src/presentation/phaser/ui/hand/HandLayoutUtils';
import { HandLayout } from '../../../../../src/presentation/phaser/ui/hand/HandConstants';

describe('HandLayoutUtils', () => {
  describe('calculateCardPositions - horizontal', () => {
    it('ã‚«ãƒ¼ãƒ‰0æšã§ç©ºé…åˆ—ã‚’è¿”ã™', () => {
      const positions = calculateCardPositions(0, 'horizontal');
      expect(positions).toEqual([]);
    });

    it('ã‚«ãƒ¼ãƒ‰1æšã§ä¸­å¤®ã«é…ç½®', () => {
      const positions = calculateCardPositions(1, 'horizontal');
      expect(positions).toHaveLength(1);
      expect(positions[0].x).toBe(HandLayout.X);
      expect(positions[0].y).toBe(HandLayout.Y);
      expect(positions[0].rotation).toBe(0);
    });

    it('ã‚«ãƒ¼ãƒ‰3æšã§ç­‰é–“éš”ã«é…ç½®', () => {
      const positions = calculateCardPositions(3, 'horizontal');
      expect(positions).toHaveLength(3);

      // ç­‰é–“éš”ç¢ºèª
      const spacing1 = positions[1].x - positions[0].x;
      const spacing2 = positions[2].x - positions[1].x;
      expect(spacing1).toBe(HandLayout.CARD_SPACING);
      expect(spacing2).toBe(HandLayout.CARD_SPACING);

      // ä¸­å¤®æƒãˆç¢ºèª
      const centerX = (positions[0].x + positions[2].x) / 2;
      expect(centerX).toBe(HandLayout.X);
    });

    it('ã‚«ãƒ¼ãƒ‰5æšã§ç­‰é–“éš”ã«é…ç½®', () => {
      const positions = calculateCardPositions(5, 'horizontal');
      expect(positions).toHaveLength(5);

      // ã™ã¹ã¦å›è»¢ãªã—
      positions.forEach(pos => {
        expect(pos.rotation).toBe(0);
      });

      // æ·±åº¦ãŒé †ç•ªã«è¨­å®š
      positions.forEach((pos, index) => {
        expect(pos.depth).toBe(index);
      });
    });

    it('ã‚«ã‚¹ã‚¿ãƒ ä¸­å¿ƒåº§æ¨™ã§é…ç½®', () => {
      const customX = 400;
      const customY = 500;
      const positions = calculateCardPositions(3, 'horizontal', customX, customY);

      const centerX = (positions[0].x + positions[2].x) / 2;
      expect(centerX).toBe(customX);
      expect(positions[1].y).toBe(customY);
    });
  });

  describe('calculateCardPositions - fan', () => {
    it('ã‚«ãƒ¼ãƒ‰0æšã§ç©ºé…åˆ—ã‚’è¿”ã™', () => {
      const positions = calculateCardPositions(0, 'fan');
      expect(positions).toEqual([]);
    });

    it('ã‚«ãƒ¼ãƒ‰1æšã§ä¸­å¤®ã«å›è»¢ãªã—ã§é…ç½®', () => {
      const positions = calculateCardPositions(1, 'fan');
      expect(positions).toHaveLength(1);
      expect(positions[0].x).toBe(HandLayout.X);
      expect(positions[0].rotation).toBe(0);
    });

    it('ã‚«ãƒ¼ãƒ‰3æšã§æ‰‡å½¢ã«é…ç½®', () => {
      const positions = calculateCardPositions(3, 'fan');
      expect(positions).toHaveLength(3);

      // å·¦ç«¯ã¯è² ã®å›è»¢ã€ä¸­å¤®ã¯0ã€å³ç«¯ã¯æ­£ã®å›è»¢
      expect(positions[0].rotation).toBeLessThan(0);
      expect(positions[1].rotation).toBeCloseTo(0, 5);
      expect(positions[2].rotation).toBeGreaterThan(0);

      // å¯¾ç§°æ€§ç¢ºèª
      expect(positions[0].rotation).toBeCloseTo(-positions[2].rotation, 5);
    });

    it('ã‚«ãƒ¼ãƒ‰5æšã§æ‰‡å½¢ã«é…ç½®', () => {
      const positions = calculateCardPositions(5, 'fan');
      expect(positions).toHaveLength(5);

      // å›è»¢è§’åº¦ãŒå¾ã€…ã«å¢—åŠ 
      for (let i = 0; i < positions.length - 1; i++) {
        expect(positions[i].rotation).toBeLessThan(positions[i + 1].rotation);
      }
    });

    it('è§’åº¦ç¯„å›²ãŒè¨­å®šå€¤ä»¥å†…', () => {
      const positions = calculateCardPositions(7, 'fan');
      const maxAngleRad = HandLayout.FAN_ANGLE_RANGE * (Math.PI / 180) / 2;

      positions.forEach(pos => {
        expect(Math.abs(pos.rotation)).toBeLessThanOrEqual(maxAngleRad + 0.01);
      });
    });
  });
});
```

### 2. HandContainerãƒ†ã‚¹ãƒˆ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *Phaserãƒ¢ãƒƒã‚¯ä½¿ç”¨*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/presentation/ui/hand/HandContainer.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { HandLayout, HandLayoutType } from '../../../../../src/presentation/phaser/ui/hand/HandConstants';

// HandContainerã¯Phaserã«ä¾å­˜ã™ã‚‹ãŸã‚ã€å®šæ•°ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚’ä¸­å¿ƒã«

describe('HandConstants', () => {
  it('ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
    expect(HandLayout.X).toBeTypeOf('number');
    expect(HandLayout.Y).toBeTypeOf('number');
    expect(HandLayout.MAX_VISIBLE_CARDS).toBeGreaterThan(0);
    expect(HandLayout.CARD_SPACING).toBeGreaterThan(0);
  });

  it('æ‰‡å½¢é…ç½®ã®å®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
    expect(HandLayout.FAN_ANGLE_RANGE).toBeGreaterThan(0);
    expect(HandLayout.FAN_ANGLE_RANGE).toBeLessThanOrEqual(90);
    expect(HandLayout.FAN_RADIUS).toBeGreaterThan(0);
  });

  it('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
    expect(HandLayout.CARD_MOVE_DURATION).toBeGreaterThan(0);
    expect(HandLayout.CARD_HOVER_OFFSET).toBeLessThan(0); // ä¸Šæ–¹å‘ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆ
  });
});

describe('HandContaineræ©Ÿèƒ½', () => {
  // ä»¥ä¸‹ã¯Phaserã‚·ãƒ¼ãƒ³ãƒ¢ãƒƒã‚¯ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆ
  // å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã¯ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§å®Ÿè¡Œ

  describe('ã‚«ãƒ¼ãƒ‰ç®¡ç†', () => {
    it.skip('setCardsã§ã‚«ãƒ¼ãƒ‰ã‚’è¨­å®šã§ãã‚‹', () => {
      // Phaserã‚·ãƒ¼ãƒ³ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
    });

    it.skip('addCardã§ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã§ãã‚‹', () => {
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®è¿½åŠ ãƒ†ã‚¹ãƒˆ
    });

    it.skip('removeCardã§ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã§ãã‚‹', () => {
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®å‰Šé™¤ãƒ†ã‚¹ãƒˆ
    });

    it.skip('getCardsã§ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã‚’å–å¾—ã§ãã‚‹', () => {
      // é…åˆ—ã®å–å¾—ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('é¸æŠç®¡ç†', () => {
    it.skip('selectCardã§ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã§ãã‚‹', () => {
      // é¸æŠçŠ¶æ…‹ã®å¤‰æ›´ãƒ†ã‚¹ãƒˆ
    });

    it.skip('deselectCardã§é¸æŠã‚’è§£é™¤ã§ãã‚‹', () => {
      // é¸æŠè§£é™¤ãƒ†ã‚¹ãƒˆ
    });

    it.skip('setSelectableã§é¸æŠå¯å¦ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹', () => {
      // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ', () => {
    it.skip('setLayoutTypeã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹', () => {
      // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´ãƒ†ã‚¹ãƒˆ
    });

    it.skip('refreshã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å†é©ç”¨ã§ãã‚‹', () => {
      // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ
    });
  });
});
```

### 3. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆç”¨ã‚·ãƒ¼ãƒ³ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ‰‹å‹•ç¢ºèªç”¨*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/HandContainerTestScene.ts`

```typescript
import { BaseGameScene, SceneInitData } from './BaseGameScene';
import { HandContainer } from '../ui/hand/HandContainer';
import { GatheringCard } from '../../../domain/card/GatheringCard';
import { RecipeCard } from '../../../domain/card/RecipeCard';
// ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

export class HandContainerTestScene extends BaseGameScene {
  private handContainer!: HandContainer;

  constructor() {
    super('HandContainerTestScene' as any);
  }

  protected onInit(data?: SceneInitData): void {}
  protected onPreload(): void {}

  protected onCreate(data?: SceneInitData): void {
    // ãƒ†ã‚¹ãƒˆç”¨ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
    const testCards = this.createTestCards();

    // HandContainerç”Ÿæˆ
    this.handContainer = new HandContainer(this, {
      x: 640,
      y: 550,
      layoutType: 'horizontal',
      onCardSelect: (card, index) => {
        console.log(`Selected: ${card.name} at index ${index}`);
      },
      onCardDeselect: (card, index) => {
        console.log(`Deselected: ${card.name} at index ${index}`);
      },
    });

    this.handContainer.setCards(testCards);

    // ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³é…ç½®
    this.createTestButtons();
  }

  private createTestCards(): Card[] {
    // ãƒ¢ãƒƒã‚¯ã‚«ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå®Ÿéš›ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
    return [];
  }

  private createTestButtons(): void {
    // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡æ›¿ãƒœã‚¿ãƒ³
    // ã‚«ãƒ¼ãƒ‰è¿½åŠ ãƒœã‚¿ãƒ³
    // ã‚«ãƒ¼ãƒ‰å‰Šé™¤ãƒœã‚¿ãƒ³
    // é¸æŠå¯å¦åˆ‡æ›¿ãƒœã‚¿ãƒ³
  }

  protected setupEventListeners(): void {}
}
```

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0198` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- Phaserã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒƒã‚¯æ–¹æ³•
- ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆã®é‡è¦æ€§
- éåŒæœŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 3é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
