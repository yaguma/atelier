# パフォーマンス計測手順

## 計測環境

- **ブラウザ**: Chrome (DevToolsのMemory APIを使用)
- **デバイス**: 開発マシン + 低スペックテスト環境
- **計測時間**: 各シナリオ5分

## パフォーマンス目標値

| 項目 | 目標値 | 警告閾値 |
|------|--------|----------|
| 平均FPS | ≥55 | <55 |
| 最低FPS | ≥30 | <30 |
| メモリ（初期） | ≤100MB | >100MB |
| メモリ（長時間） | ≤150MB | >150MB |
| Boot時間 | ≤3000ms | >3000ms |
| シーン遷移 | ≤500ms | >500ms |
| オブジェクト数 | ≤500 | >500 |

## PerformanceMonitorの使用方法

### 1. 有効化

```typescript
// シーン内で
const monitor = new PerformanceMonitor(this);
monitor.enable();

// updateで呼び出す
update() {
  monitor.update();
}
```

### 2. シーン遷移計測

```typescript
// 遷移開始時
monitor.startSceneTransition('TitleScene', 'MainScene');

// 遷移完了時
const duration = monitor.endSceneTransition('TitleScene', 'MainScene');
```

### 3. イベント処理計測

```typescript
// イベント処理開始時
monitor.startEventMeasure('CARD_PLAYED');

// イベント処理完了時
monitor.endEventMeasure('CARD_PLAYED');
```

### 4. レポート出力

```typescript
// コンソールにレポート出力
monitor.logReport();

// JSON形式でエクスポート
const json = monitor.exportData();
```

---

## 計測シナリオ

### シナリオ1: 起動〜タイトル

**目的**: 初期ロード性能の確認

1. ゲームを起動
2. BootScene完了までの時間を計測
3. TitleSceneでのFPSを計測

**確認項目**:
- [ ] Boot時間が3秒以下
- [ ] TitleSceneで55FPS以上
- [ ] 初期メモリが100MB以下

### シナリオ2: 1ターンサイクル

**目的**: 通常プレイ時の性能確認

1. 新規ゲーム開始
2. 依頼受注フェーズでの操作
3. 採取フェーズでカード使用
4. 調合フェーズでアイテム作成
5. 納品フェーズで依頼完了
6. 各フェーズ遷移時間を記録

**確認項目**:
- [ ] 各フェーズで55FPS以上
- [ ] フェーズ遷移が500ms以下
- [ ] カード操作のレスポンスが良好

### シナリオ3: 長時間プレイ

**目的**: メモリリークの検出

1. 10日分のプレイをシミュレート
2. メモリ使用量の推移を記録
3. FPSの推移を記録

**確認項目**:
- [ ] メモリ使用量が150MB以下を維持
- [ ] FPSが時間経過で低下しない
- [ ] オブジェクト数が増加し続けない

### シナリオ4: UI負荷テスト

**目的**: 大量オブジェクト時の性能確認

1. ショップで大量購入
2. インベントリに100個以上のアイテム
3. スクロールパネルの動作確認

**確認項目**:
- [ ] スクロールが滑らか（30FPS以上）
- [ ] アイテム表示の遅延がない
- [ ] メモリ急増がない

---

## 計測結果テンプレート

### 計測日時: ____年__月__日 __:__

### 計測環境
- OS:
- ブラウザ: Chrome ___
- メモリ: ___GB
- CPU: ___

### シナリオ1: 起動〜タイトル

| 項目 | 目標値 | 計測値 | 合否 |
|------|--------|--------|------|
| Boot時間 | ≤3000ms | | |
| TitleScene FPS | ≥55 | | |
| 初期メモリ | ≤100MB | | |

### シナリオ2: 1ターンサイクル

| 項目 | 目標値 | 計測値 | 合否 |
|------|--------|--------|------|
| 依頼受注フェーズ FPS | ≥55 | | |
| 採取フェーズ FPS | ≥55 | | |
| 調合フェーズ FPS | ≥55 | | |
| 納品フェーズ FPS | ≥55 | | |
| フェーズ遷移時間 | ≤500ms | | |

### シナリオ3: 長時間プレイ

| 項目 | 目標値 | 計測値 | 合否 |
|------|--------|--------|------|
| 10日後 メモリ | ≤150MB | | |
| 10日後 FPS | ≥55 | | |
| メモリ増加率 | - | MB/日 | |

### シナリオ4: UI負荷テスト

| 項目 | 目標値 | 計測値 | 合否 |
|------|--------|--------|------|
| 100アイテム時 FPS | ≥30 | | |
| スクロール FPS | ≥30 | | |
| メモリ | ≤150MB | | |

---

## ボトルネック特定チェックリスト

### FPSが低い場合

- [ ] オブジェクト数を確認（500以上で要注意）
- [ ] update()で重い処理をしていないか
- [ ] 不要な描画更新がないか
- [ ] テクスチャサイズが大きすぎないか

### メモリが高い場合

- [ ] オブジェクトの破棄漏れがないか
- [ ] イベントリスナーの解除漏れがないか
- [ ] テクスチャのキャッシュが適切か
- [ ] 不要なシーンが残っていないか

### シーン遷移が遅い場合

- [ ] アセットのプリロードができているか
- [ ] シーン初期化で重い処理がないか
- [ ] 不要なオブジェクト生成がないか

---

## 最適化優先度リスト

計測結果に基づいて、以下の優先度で最適化を実施:

### 優先度: 高（FPSに直接影響）

1. オブジェクトプールの導入
2. テクスチャアトラスの使用
3. 不要なupdate処理の削減

### 優先度: 中（メモリに影響）

1. シーン破棄時のクリーンアップ
2. イベントリスナーの適切な管理
3. 未使用リソースの解放

### 優先度: 低（品質改善）

1. シーン遷移のプリロード
2. アニメーションの最適化
3. ネットワーク処理の非同期化
