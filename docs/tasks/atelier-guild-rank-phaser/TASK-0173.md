# TASK-0173: UIFactoryãƒœã‚¿ãƒ³ç”Ÿæˆå®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0173
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - PhaseråŸºç›¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *å¦¥å½“ãªæ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ **: [core-systems.md](../../design/atelier-guild-rank-phaser/core-systems.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

UIFactoryã®createButton()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã€ã‚²ãƒ¼ãƒ å†…ã§ä½¿ç”¨ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0172
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0174, TASK-0185, TASK-0201, TASK-0209, TASK-0210, TASK-0221, TASK-0247, TASK-0248

## å®Œäº†æ¡ä»¶

- [x] createButton()ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [x] ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒå‹•ä½œã™ã‚‹
- [x] ãƒ›ãƒãƒ¼çŠ¶æ…‹ãŒè¦–è¦šçš„ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [x] ç„¡åŠ¹çŠ¶æ…‹ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [x] ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã§ãã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. createButtonå®Ÿè£… ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUI.Buttonsã‚’ä½¿ç”¨*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/UIFactory.ts`ã«è¿½åŠ 

```typescript
import Buttons from 'phaser3-rex-plugins/templates/ui/buttons/Buttons';
import Label from 'phaser3-rex-plugins/templates/ui/label/Label';

createButton(options: ButtonOptions): Label {
  const {
    x, y, text, width, height,
    style, textStyle, onClick, disabled
  } = options;

  const bgColor = style?.backgroundColor ?? Colors.primary;
  const hoverColor = Colors.primaryHover;
  const disabledColor = Colors.secondary;

  // èƒŒæ™¯
  const background = this.rexUI.add.roundRectangle(
    0, 0,
    width ?? 150,
    height ?? 44,
    style?.cornerRadius ?? 8,
    disabled ? disabledColor : bgColor
  );

  // ãƒ©ãƒ™ãƒ«ï¼ˆãƒœã‚¿ãƒ³ã¨ã—ã¦ä½¿ç”¨ï¼‰
  const button = this.rexUI.add.label({
    x, y,
    width: width ?? 150,
    height: height ?? 44,
    background,
    text: this.scene.add.text(0, 0, text, textStyle ?? TextStyles.button),
    space: {
      left: style?.padding ?? 20,
      right: style?.padding ?? 20,
      top: 10,
      bottom: 10,
    },
    align: 'center',
  }).layout();

  // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
  if (!disabled) {
    button.setInteractive({ useHandCursor: true });

    button.on('pointerover', () => {
      (background as any).setFillStyle(hoverColor);
    });

    button.on('pointerout', () => {
      (background as any).setFillStyle(bgColor);
    });

    button.on('pointerdown', () => {
      (background as any).setFillStyle(Colors.primaryHover);
      this.scene.tweens.add({
        targets: button,
        scaleX: 0.95,
        scaleY: 0.95,
        duration: 50,
      });
    });

    button.on('pointerup', () => {
      (background as any).setFillStyle(hoverColor);
      this.scene.tweens.add({
        targets: button,
        scaleX: 1,
        scaleY: 1,
        duration: 50,
        onComplete: () => {
          if (onClick) onClick();
        }
      });
    });
  }

  return button;
}

// ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
setButtonEnabled(button: Label, enabled: boolean): void {
  const background = (button as any).getElement('background');
  if (enabled) {
    button.setInteractive({ useHandCursor: true });
    background.setFillStyle(Colors.primary);
  } else {
    button.disableInteractive();
    background.setFillStyle(Colors.secondary);
  }
}
```

### 2. ãƒ—ãƒ©ã‚¤ãƒãƒª/ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã«åŸºã¥ã*

```typescript
createPrimaryButton(options: Omit<ButtonOptions, 'style'>): Label {
  return this.createButton({
    ...options,
    style: {
      backgroundColor: Colors.primary,
      cornerRadius: 8,
    }
  });
}

createSecondaryButton(options: Omit<ButtonOptions, 'style'>): Label {
  return this.createButton({
    ...options,
    style: {
      backgroundColor: Colors.secondary,
      cornerRadius: 8,
    }
  });
}

createDangerButton(options: Omit<ButtonOptions, 'style'>): Label {
  return this.createButton({
    ...options,
    style: {
      backgroundColor: Colors.danger,
      cornerRadius: 8,
    }
  });
}
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ãƒœã‚¿ãƒ³ç”Ÿæˆ ğŸŸ¡

**Given**: UIFactoryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚‹
**When**: createButton()ã‚’å‘¼ã¶
**Then**: Labelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¿”ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ ğŸŸ¡

**Given**: ãƒœã‚¿ãƒ³ã«onClickãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
**When**: ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
**Then**: onClickã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ç„¡åŠ¹çŠ¶æ…‹ ğŸŸ¡

**Given**: disabled: trueã§ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆã™ã‚‹
**When**: ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
**Then**: onClickã¯å‘¼ã°ã‚Œãªã„

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0173` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- rexUIã®Labelã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆAPIã‚’ç¢ºèª
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ§ãˆã‚ã«
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹ï¼‰ã‚’æ¤œè¨

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 2é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 2é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
