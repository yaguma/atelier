# TASK-0230: AlchemyContainerãƒ†ã‚¹ãƒˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0230
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠãƒ»ãƒ¡ã‚¤ãƒ³ç”»é¢å®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¨­è¨ˆæ›¸ã«è¨˜è¼‰*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

AlchemyContaineré–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0229
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0231

## å®Œäº†æ¡ä»¶

- [ ] ãƒ¬ã‚·ãƒ”é¸æŠã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] ç´ æé¸æŠã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] å“è³ªäºˆæ¸¬ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] èª¿åˆå‡¦ç†ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## å®Ÿè£…è©³ç´°

### 1. AlchemyPreviewPanelãƒ†ã‚¹ãƒˆ ğŸ”µ

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/presentation/ui/alchemy/AlchemyPreviewPanel.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';

describe('AlchemyPreviewPanel', () => {
  describe('åˆæœŸåŒ–', () => {
    it.skip('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§åˆæœŸåŒ–ã§ãã‚‹', () => {
      // Phaserã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒƒã‚¯ãŒå¿…è¦
    });

    it.skip('ç©ºçŠ¶æ…‹ãŒåˆæœŸè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // åˆæœŸçŠ¶æ…‹ç¢ºèª
    });
  });

  describe('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š', () => {
    it.skip('setPreviewã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¨­å®šã•ã‚Œã‚‹', () => {
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºç¢ºèª
    });

    it.skip('nullã‚’è¨­å®šã™ã‚‹ã¨ç©ºçŠ¶æ…‹ã«ãªã‚‹', () => {
      // ç©ºçŠ¶æ…‹ã¸ã®æˆ»ã‚Šç¢ºèª
    });

    it.skip('getPreviewã§è¨­å®šã—ãŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå–å¾—ã§ãã‚‹', () => {
      // ã‚²ãƒƒã‚¿ãƒ¼ç¢ºèª
    });
  });

  describe('å“è³ªè¡¨ç¤º', () => {
    it.skip('å„å“è³ªãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // legendary, epic, rare, good, normal, poorã®è‰²ç¢ºèª
    });

    it.skip('å“è³ªã‚²ãƒ¼ã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ã‚²ãƒ¼ã‚¸ã®é•·ã•ç¢ºèª
    });
  });

  describe('ç´ æãƒªã‚¹ãƒˆ', () => {
    it.skip('ç´ æãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ç´ æè¡¨ç¤ºç¢ºèª
    });

    it.skip('addMaterialã§ç´ æãŒè¿½åŠ ã•ã‚Œã‚‹', () => {
      // è¿½åŠ å¾Œã®è¡¨ç¤ºç¢ºèª
    });

    it.skip('removeMaterialã§ç´ æãŒå‰Šé™¤ã•ã‚Œã‚‹', () => {
      // å‰Šé™¤å¾Œã®è¡¨ç¤ºç¢ºèª
    });

    it.skip('clearMaterialsã§å…¨ç´ æãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹', () => {
      // ã‚¯ãƒªã‚¢å¾Œã®è¡¨ç¤ºç¢ºèª
    });

    it.skip('4å€‹ã‚’è¶…ãˆã‚‹ç´ æã¯+N moreã¨è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // çœç•¥è¡¨ç¤ºç¢ºèª
    });
  });

  describe('ç‰¹æ€§ãƒªã‚¹ãƒˆ', () => {
    it.skip('ç¶™æ‰¿ç‰¹æ€§ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ç‰¹æ€§è¡¨ç¤ºç¢ºèª
    });

    it.skip('ç‰¹æ€§ãŒãªã„å ´åˆã¯ã€Œç¶™æ‰¿ç‰¹æ€§ãªã—ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ç©ºçŠ¶æ…‹ç¢ºèª
    });
  });

  describe('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼', () => {
    it.skip('èª¿åˆå¯èƒ½æ™‚ã¯ç·‘ã®ãƒã‚§ãƒƒã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // èª¿åˆå¯èƒ½çŠ¶æ…‹ç¢ºèª
    });

    it.skip('ç´ æä¸è¶³æ™‚ã¯èµ¤ã®ãƒãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ç´ æä¸è¶³çŠ¶æ…‹ç¢ºèª
    });

    it.skip('å¾…æ©Ÿä¸­ã¯ã‚°ãƒ¬ãƒ¼ã®ç ‚æ™‚è¨ˆãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // å¾…æ©ŸçŠ¶æ…‹ç¢ºèª
    });
  });
});
```

### 2. AlchemyContainerãƒ†ã‚¹ãƒˆ ğŸ”µ

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/presentation/ui/phase/AlchemyContainer.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';

describe('AlchemyContainer', () => {
  describe('åˆæœŸåŒ–', () => {
    it.skip('ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã§ãã‚‹', () => {
      // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆç¢ºèª
    });

    it.skip('èƒŒæ™¯ã¨ã‚¿ã‚¤ãƒˆãƒ«ãŒä½œæˆã•ã‚Œã‚‹', () => {
      // UIè¦ç´ ç¢ºèª
    });

    it.skip('æ‰‹æœ­ã‚¨ãƒªã‚¢ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ«ãŒä½œæˆã•ã‚Œã‚‹', () => {
      // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¢ºèª
    });
  });

  describe('ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰è¨­å®š', () => {
    it.skip('setRecipeCardsã§æ‰‹æœ­ãŒè¨­å®šã•ã‚Œã‚‹', () => {
      // æ‰‹æœ­è¡¨ç¤ºç¢ºèª
    });

    it.skip('ç©ºã®ãƒªã‚¹ãƒˆã‚’è¨­å®šã™ã‚‹ã¨æ‰‹æœ­ãŒç©ºã«ãªã‚‹', () => {
      // ç©ºçŠ¶æ…‹ç¢ºèª
    });
  });

  describe('ãƒ¬ã‚·ãƒ”é¸æŠ', () => {
    it.skip('selectRecipeã§ãƒ¬ã‚·ãƒ”ãŒé¸æŠã•ã‚Œã‚‹', () => {
      // é¸æŠçŠ¶æ…‹ç¢ºèª
    });

    it.skip('getSelectedRecipeã§é¸æŠä¸­ã®ãƒ¬ã‚·ãƒ”ãŒå–å¾—ã§ãã‚‹', () => {
      // ã‚²ãƒƒã‚¿ãƒ¼ç¢ºèª
    });

    it.skip('ãƒ¬ã‚·ãƒ”é¸æŠæ™‚ã«alchemy:recipe:selectedã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª
    });

    it.skip('ãƒ¬ã‚·ãƒ”å¤‰æ›´æ™‚ã«ç´ æãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹', () => {
      // ãƒªã‚»ãƒƒãƒˆç¢ºèª
    });
  });

  describe('ç´ æè¨­å®š', () => {
    it.skip('setAvailableMaterialsã§ç´ æãŒè¨­å®šã•ã‚Œã‚‹', () => {
      // ç´ æè¡¨ç¤ºç¢ºèª
    });

    it.skip('ãƒ¬ã‚·ãƒ”ã®è¦ä»¶ã«åˆã†ç´ æã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç¢ºèª
    });
  });

  describe('ç´ æé¸æŠ', () => {
    it.skip('selectMaterialã§ç´ æãŒé¸æŠã•ã‚Œã‚‹', () => {
      // é¸æŠçŠ¶æ…‹ç¢ºèª
    });

    it.skip('deselectMaterialã§é¸æŠãŒè§£é™¤ã•ã‚Œã‚‹', () => {
      // è§£é™¤ç¢ºèª
    });

    it.skip('getSelectedMaterialsã§é¸æŠä¸­ã®ç´ æãŒå–å¾—ã§ãã‚‹', () => {
      // ã‚²ãƒƒã‚¿ãƒ¼ç¢ºèª
    });

    it.skip('é¸æŠä¸Šé™ã«é”ã™ã‚‹ã¨è¿½åŠ é¸æŠã§ããªã„', () => {
      // ä¸Šé™ç¢ºèª
    });

    it.skip('clearMaterialsã§å…¨é¸æŠãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹', () => {
      // ã‚¯ãƒªã‚¢ç¢ºèª
    });
  });

  describe('å“è³ªäºˆæ¸¬', () => {
    it.skip('ç´ æã®å“è³ªã‹ã‚‰äºˆæ¸¬å“è³ªãŒè¨ˆç®—ã•ã‚Œã‚‹', () => {
      // äºˆæ¸¬è¨ˆç®—ç¢ºèª
    });

    it.skip('é«˜å“è³ªç´ æã§äºˆæ¸¬å“è³ªãŒä¸ŠãŒã‚‹', () => {
      // å“è³ªå‘ä¸Šç¢ºèª
    });

    it.skip('ç‰¹æ€§ãŒç¶™æ‰¿ã•ã‚Œã‚‹', () => {
      // ç‰¹æ€§ç¶™æ‰¿ç¢ºèª
    });
  });

  describe('èª¿åˆå¯å¦åˆ¤å®š', () => {
    it.skip('ãƒ¬ã‚·ãƒ”æœªé¸æŠæ™‚ã¯canCraftãŒfalse', () => {
      // æœªé¸æŠçŠ¶æ…‹ç¢ºèª
    });

    it.skip('ç´ æä¸è¶³æ™‚ã¯canCraftãŒfalse', () => {
      // ç´ æä¸è¶³ç¢ºèª
    });

    it.skip('æ¡ä»¶ã‚’æº€ãŸã™ã¨canCraftãŒtrue', () => {
      // èª¿åˆå¯èƒ½ç¢ºèª
    });
  });

  describe('èª¿åˆå®Ÿè¡Œ', () => {
    it.skip('craftã§èª¿åˆãŒå®Ÿè¡Œã•ã‚Œã‚‹', () => {
      // èª¿åˆå®Ÿè¡Œç¢ºèª
    });

    it.skip('canCraftãŒfalseã®æ™‚ã¯craftãŒå®Ÿè¡Œã•ã‚Œãªã„', () => {
      // æ¡ä»¶ãƒã‚§ãƒƒã‚¯ç¢ºèª
    });

    it.skip('èª¿åˆæˆåŠŸæ™‚ã«alchemy:craftã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª
    });

    it.skip('onAlchemyCompleteã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œã‚‹', () => {
      // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¢ºèª
    });

    it.skip('çµæœã«èª¿åˆã‚¢ã‚¤ãƒ†ãƒ ãŒå«ã¾ã‚Œã‚‹', () => {
      // çµæœç¢ºèª
    });
  });

  describe('ã‚¹ã‚­ãƒƒãƒ—', () => {
    it.skip('ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã§onSkipãŒå‘¼ã°ã‚Œã‚‹', () => {
      // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¢ºèª
    });

    it.skip('alchemy:skipã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª
    });
  });

  describe('ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«', () => {
    it.skip('enteræ™‚ã«çŠ¶æ…‹ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹', () => {
      // enterå‡¦ç†ç¢ºèª
    });

    it.skip('destroyã§å…¨ãƒªã‚½ãƒ¼ã‚¹ãŒè§£æ”¾ã•ã‚Œã‚‹', () => {
      // ç ´æ£„å‡¦ç†ç¢ºèª
    });
  });
});
```

### 3. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆç”¨ã‚·ãƒ¼ãƒ³ ğŸ”µ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/AlchemyTestScene.ts`

```typescript
import { BaseGameScene, SceneInitData } from './BaseGameScene';
import { AlchemyContainer } from '../ui/phase/AlchemyContainer';
import { EventBus } from '../core/EventBus';
import { RecipeCard } from '../../../domain/card/RecipeCard';
import { Material } from '../../../domain/material/Material';

export class AlchemyTestScene extends BaseGameScene {
  private alchemyContainer!: AlchemyContainer;
  private eventBus!: EventBus;

  constructor() {
    super('AlchemyTestScene' as any);
  }

  protected onInit(data?: SceneInitData): void {}
  protected onPreload(): void {}

  protected onCreate(data?: SceneInitData): void {
    this.eventBus = new EventBus();

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    this.eventBus.on('alchemy:craft', (result) => {
      console.log('Alchemy craft:', result);
    });
    this.eventBus.on('alchemy:skip', () => {
      console.log('Alchemy skipped');
    });
    this.eventBus.on('alchemy:recipe:selected', (data) => {
      console.log('Recipe selected:', data);
    });
    this.eventBus.on('alchemy:material:selected', (data) => {
      console.log('Material selected:', data);
    });

    // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ
    this.alchemyContainer = new AlchemyContainer({
      scene: this,
      eventBus: this.eventBus,
      x: 20,
      y: 20,
      onAlchemyComplete: (result) => {
        console.log('Alchemy complete:', result);
      },
      onSkip: () => {
        console.log('Skipped');
      },
    });

    // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š
    this.alchemyContainer.setRecipeCards(this.createTestRecipes());
    this.alchemyContainer.setAvailableMaterials(this.createTestMaterials());
    this.alchemyContainer.enter();

    // ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
    this.createTestControls();
  }

  private createTestRecipes(): RecipeCard[] {
    return [
      {
        id: 'recipe-1',
        name: 'å›å¾©è–¬',
        type: 'recipe',
        description: 'ä½“åŠ›ã‚’å›å¾©ã™ã‚‹è–¬',
        requiredCategories: ['plant', 'liquid'],
        requiredMaterialCount: 2,
      } as RecipeCard,
      {
        id: 'recipe-2',
        name: 'çˆ†å¼¾',
        type: 'recipe',
        description: 'çˆ†ç™ºã™ã‚‹å±é™ºãªè–¬',
        requiredCategories: ['mineral', 'powder'],
        requiredMaterialCount: 3,
      } as RecipeCard,
      {
        id: 'recipe-3',
        name: 'é­”æ³•ã®æ–',
        type: 'recipe',
        description: 'é­”åŠ›ã‚’è¾¼ã‚ãŸæ–',
        requiredCategories: ['monster', 'mineral'],
        requiredMaterialCount: 2,
      } as RecipeCard,
    ];
  }

  private createTestMaterials(): Material[] {
    return [
      { id: 'm1', name: 'è–¬è‰', category: 'plant', quality: 'normal' } as Material,
      { id: 'm2', name: 'èµ¤ã„èŠ±', category: 'plant', quality: 'good' } as Material,
      { id: 'm3', name: 'è–æ°´', category: 'liquid', quality: 'rare' } as Material,
      { id: 'm4', name: 'é‰„é‰±çŸ³', category: 'mineral', quality: 'normal' } as Material,
      { id: 'm5', name: 'éŠ€é‰±çŸ³', category: 'mineral', quality: 'good' } as Material,
      { id: 'm6', name: 'ç«è–¬', category: 'powder', quality: 'normal' } as Material,
      { id: 'm7', name: 'é­”ç‰©ã®éª¨', category: 'monster', quality: 'rare', traits: ['å‘ªã„è€æ€§'] } as Material,
      { id: 'm8', name: 'æ¸…æ°´', category: 'liquid', quality: 'normal' } as Material,
    ];
  }

  private createTestControls(): void {
    const buttonY = 600;

    // ç´ æè¿½åŠ 
    this.createTestButton(50, buttonY, 'ç´ æè¿½åŠ ', () => {
      const newMaterial = {
        id: `m-${Date.now()}`,
        name: `æ–°ç´ æ${Math.floor(Math.random() * 100)}`,
        category: ['plant', 'mineral', 'liquid'][Math.floor(Math.random() * 3)],
        quality: ['normal', 'good', 'rare'][Math.floor(Math.random() * 3)],
      } as Material;
      const current = this.alchemyContainer.getAvailableMaterials?.() ?? [];
      this.alchemyContainer.setAvailableMaterials([...current, newMaterial]);
    });

    // ãƒªã‚»ãƒƒãƒˆ
    this.createTestButton(150, buttonY, 'ãƒªã‚»ãƒƒãƒˆ', () => {
      this.alchemyContainer.clearMaterials();
    });
  }

  private createTestButton(x: number, y: number, label: string, onClick: () => void): void {
    const btn = this.add.text(x, y, label, {
      fontSize: '12px',
      backgroundColor: '#333333',
      padding: { x: 10, y: 5 },
    }).setInteractive();

    btn.on('pointerdown', onClick);
  }

  protected setupEventListeners(): void {}
}
```

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0230` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- Phaserã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒƒã‚¯æ–¹æ³•
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã‚€ãƒ†ã‚¹ãƒˆ
- å“è³ªäºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 3é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
