# TASK-0205: SidebarUIè¨­è¨ˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0205
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - åŸºæœ¬ã‚·ãƒ¼ãƒ³ãƒ»å…±é€šUIå®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *å¦¥å½“ãªæ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

ãƒ¡ã‚¤ãƒ³ç”»é¢å³å´ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼UIã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨åŸºæœ¬æ§‹é€ ã‚’è¨­è¨ˆã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0177
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0206

## å®Œäº†æ¡ä»¶

- [ ] ISidebarUIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ãŒè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹
- [ ] ä¾é ¼ãƒªã‚¹ãƒˆãƒ»ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªè¡¨ç¤ºé ˜åŸŸãŒè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šæ•° ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ui-design/overview.mdã‚’å‚è€ƒ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/sidebar/SidebarConstants.ts`

```typescript
export const SidebarLayout = {
  // ä½ç½®ãƒ»ã‚µã‚¤ã‚º
  X: 1000,
  Y: 80,
  WIDTH: 280,
  HEIGHT: 640,

  // ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
  PADDING: 10,

  // ã‚¿ãƒ–
  TAB_HEIGHT: 40,
  TAB_WIDTH: 130,

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
  CONTENT_Y: 50,
  CONTENT_HEIGHT: 580,

  // ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ 
  ITEM_HEIGHT: 60,
  ITEM_SPACING: 5,
} as const;

export type SidebarTab = 'quests' | 'inventory';

export const SidebarColors = {
  BACKGROUND: 0x1a1a2e,
  BACKGROUND_ALPHA: 0.95,
  TAB_ACTIVE: 0x4a4a8a,
  TAB_INACTIVE: 0x2a2a4a,
  BORDER: 0x4a4a6a,
} as const;
```

### 2. ISidebarUIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/sidebar/ISidebarUI.ts`

```typescript
import Phaser from 'phaser';
import { Quest } from '../../../../domain/quest/Quest';
import { InventoryItem } from '../../../../domain/item/InventoryItem';
import { SidebarTab } from './SidebarConstants';

export interface SidebarUIOptions {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  onQuestSelect?: (quest: Quest) => void;
  onItemSelect?: (item: InventoryItem) => void;
}

export interface ISidebarUI {
  // ã‚³ãƒ³ãƒ†ãƒŠå‚ç…§
  readonly container: Phaser.GameObjects.Container;

  // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
  setActiveTab(tab: SidebarTab): void;
  getActiveTab(): SidebarTab;

  // ä¾é ¼ãƒªã‚¹ãƒˆæ›´æ–°
  setQuests(quests: Quest[]): void;
  highlightQuest(questId: string): void;
  clearQuestHighlight(): void;

  // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ›´æ–°
  setInventory(items: InventoryItem[]): void;
  highlightItem(itemId: string): void;
  clearItemHighlight(): void;

  // è¡¨ç¤ºåˆ¶å¾¡
  setVisible(visible: boolean): void;
  setEnabled(enabled: boolean): void;

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  scrollToTop(): void;
  scrollToItem(index: number): void;

  // ç ´æ£„
  destroy(): void;
}
```

### 3. SidebarUIåŸºæœ¬å®Ÿè£… ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ã‚³ãƒ³ãƒ†ãƒŠæ§‹é€ *

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/sidebar/SidebarUI.ts`

```typescript
import Phaser from 'phaser';
import { Quest } from '../../../../domain/quest/Quest';
import { InventoryItem } from '../../../../domain/item/InventoryItem';
import { ISidebarUI, SidebarUIOptions } from './ISidebarUI';
import { SidebarLayout, SidebarTab, SidebarColors } from './SidebarConstants';
import { Colors } from '../../config/ColorPalette';
import { TextStyles } from '../../config/TextStyles';
import { UIFactory } from '../common/UIFactory';

export class SidebarUI implements ISidebarUI {
  public readonly container: Phaser.GameObjects.Container;

  private scene: Phaser.Scene;
  private uiFactory: UIFactory;
  private activeTab: SidebarTab = 'quests';

  // èƒŒæ™¯
  private background!: Phaser.GameObjects.Graphics;

  // ã‚¿ãƒ–
  private questsTab!: Phaser.GameObjects.Container;
  private inventoryTab!: Phaser.GameObjects.Container;

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  private questsContainer!: Phaser.GameObjects.Container;
  private inventoryContainer!: Phaser.GameObjects.Container;
  private scrollablePanel?: any; // rexUI.ScrollablePanel

  // ãƒ‡ãƒ¼ã‚¿
  private quests: Quest[] = [];
  private inventory: InventoryItem[] = [];

  // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  private onQuestSelect?: (quest: Quest) => void;
  private onItemSelect?: (item: InventoryItem) => void;

  constructor(scene: Phaser.Scene, uiFactory: UIFactory, options: SidebarUIOptions = {}) {
    this.scene = scene;
    this.uiFactory = uiFactory;
    this.onQuestSelect = options.onQuestSelect;
    this.onItemSelect = options.onItemSelect;

    const x = options.x ?? SidebarLayout.X;
    const y = options.y ?? SidebarLayout.Y;

    this.container = scene.add.container(x, y);
    this.container.setDepth(400);

    this.createBackground(options);
    this.createTabs();
    this.createContentAreas();

    // åˆæœŸã‚¿ãƒ–ã‚’è¡¨ç¤º
    this.setActiveTab('quests');
  }

  private createBackground(options: SidebarUIOptions): void {
    const width = options.width ?? SidebarLayout.WIDTH;
    const height = options.height ?? SidebarLayout.HEIGHT;

    this.background = this.scene.add.graphics();
    this.background.fillStyle(SidebarColors.BACKGROUND, SidebarColors.BACKGROUND_ALPHA);
    this.background.fillRoundedRect(0, 0, width, height, 8);
    this.background.lineStyle(1, SidebarColors.BORDER);
    this.background.strokeRoundedRect(0, 0, width, height, 8);
    this.container.add(this.background);
  }

  private createTabs(): void {
    // ä¾é ¼ã‚¿ãƒ–
    this.questsTab = this.createTab('ä¾é ¼', 0, () => this.setActiveTab('quests'));
    this.container.add(this.questsTab);

    // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚¿ãƒ–
    this.inventoryTab = this.createTab('æ‰€æŒå“', SidebarLayout.TAB_WIDTH, () => this.setActiveTab('inventory'));
    this.container.add(this.inventoryTab);
  }

  private createTab(label: string, offsetX: number, onClick: () => void): Phaser.GameObjects.Container {
    const tab = this.scene.add.container(
      SidebarLayout.PADDING + offsetX,
      SidebarLayout.PADDING
    );

    const bg = this.scene.add.graphics();
    bg.fillStyle(SidebarColors.TAB_INACTIVE, 1);
    bg.fillRoundedRect(0, 0, SidebarLayout.TAB_WIDTH, SidebarLayout.TAB_HEIGHT, { tl: 8, tr: 8, bl: 0, br: 0 });
    tab.add(bg);

    const text = this.scene.add.text(
      SidebarLayout.TAB_WIDTH / 2,
      SidebarLayout.TAB_HEIGHT / 2,
      label,
      TextStyles.body
    ).setOrigin(0.5);
    tab.add(text);

    tab.setInteractive(
      new Phaser.Geom.Rectangle(0, 0, SidebarLayout.TAB_WIDTH, SidebarLayout.TAB_HEIGHT),
      Phaser.Geom.Rectangle.Contains
    );
    tab.on('pointerdown', onClick);

    // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
    tab.setData('bg', bg);
    tab.setData('text', text);

    return tab;
  }

  private createContentAreas(): void {
    // ä¾é ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    this.questsContainer = this.scene.add.container(
      SidebarLayout.PADDING,
      SidebarLayout.CONTENT_Y
    );
    this.container.add(this.questsContainer);

    // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    this.inventoryContainer = this.scene.add.container(
      SidebarLayout.PADDING,
      SidebarLayout.CONTENT_Y
    );
    this.inventoryContainer.setVisible(false);
    this.container.add(this.inventoryContainer);
  }

  setActiveTab(tab: SidebarTab): void {
    this.activeTab = tab;

    // ã‚¿ãƒ–ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ›´æ–°
    this.updateTabVisual(this.questsTab, tab === 'quests');
    this.updateTabVisual(this.inventoryTab, tab === 'inventory');

    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    this.questsContainer.setVisible(tab === 'quests');
    this.inventoryContainer.setVisible(tab === 'inventory');
  }

  private updateTabVisual(tab: Phaser.GameObjects.Container, active: boolean): void {
    const bg = tab.getData('bg') as Phaser.GameObjects.Graphics;
    bg.clear();
    bg.fillStyle(active ? SidebarColors.TAB_ACTIVE : SidebarColors.TAB_INACTIVE, 1);
    bg.fillRoundedRect(0, 0, SidebarLayout.TAB_WIDTH, SidebarLayout.TAB_HEIGHT, { tl: 8, tr: 8, bl: 0, br: 0 });
  }

  getActiveTab(): SidebarTab {
    return this.activeTab;
  }

  // ä¾é ¼ãƒ»ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã®è©³ç´°å®Ÿè£…ã¯å¾Œç¶šã‚¿ã‚¹ã‚¯ã§
  setQuests(quests: Quest[]): void {
    this.quests = quests;
  }

  highlightQuest(questId: string): void {}
  clearQuestHighlight(): void {}

  setInventory(items: InventoryItem[]): void {
    this.inventory = items;
  }

  highlightItem(itemId: string): void {}
  clearItemHighlight(): void {}

  setVisible(visible: boolean): void {
    this.container.setVisible(visible);
  }

  setEnabled(enabled: boolean): void {
    this.container.setAlpha(enabled ? 1 : 0.5);
  }

  scrollToTop(): void {}
  scrollToItem(index: number): void {}

  destroy(): void {
    this.container.destroy();
  }
}
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ğŸŸ¡

**Given**: SidebarUIãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹
**When**: setActiveTab('inventory')ã‚’å‘¼ã¶
**Then**: ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: åˆæœŸã‚¿ãƒ– ğŸŸ¡

**Given**: SidebarUIã‚’ç”Ÿæˆã™ã‚‹
**When**: ä½•ã‚‚ã—ãªã„
**Then**: ä¾é ¼ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ã¦ã„ã‚‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0205` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- rexUIã®ScrollablePanelã®æ´»ç”¨
- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã®ä¿æŒ

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 3é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
