# TASK-0169: SceneManagerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

**ã‚¿ã‚¹ã‚¯ID**: TASK-0169
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - PhaseråŸºç›¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *å¦¥å½“ãªæ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ **: [core-systems.md](../../design/atelier-guild-rank-phaser/core-systems.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

ã‚·ãƒ¼ãƒ³é·ç§»ã‚’ç®¡ç†ã™ã‚‹SceneManagerã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã™ã‚‹ã€‚é€šå¸¸é·ç§»ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é·ç§»ã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0168
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0170

## å®Œäº†æ¡ä»¶

- [x] ISceneManagerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [x] ã‚·ãƒ¼ãƒ³é·ç§»ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [x] ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [x] é·ç§»å±¥æ­´ç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. ã‚·ãƒ¼ãƒ³é·ç§»ã‚¿ã‚¤ãƒ—å®šç¾© ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ui-design/overview.mdã‚’å‚è€ƒ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/managers/SceneTransition.ts`

```typescript
import { SceneKey } from '../config/SceneKeys';

export type TransitionType = 'fade' | 'slide' | 'none';

export interface TransitionConfig {
  type: TransitionType;
  duration: number;
  direction?: 'left' | 'right' | 'up' | 'down';
}

export const DefaultTransitions: Record<string, TransitionConfig> = {
  standard: {
    type: 'fade',
    duration: 300,
  },
  quick: {
    type: 'none',
    duration: 0,
  },
  overlay: {
    type: 'fade',
    duration: 200,
  },
};

export interface SceneTransitionData {
  from: SceneKey;
  to: SceneKey;
  transition: TransitionConfig;
  data?: Record<string, unknown>;
}
```

### 2. ISceneManagerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªã‚·ãƒ¼ãƒ³ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/managers/ISceneManager.ts`

```typescript
import { SceneKey } from '../config/SceneKeys';
import { TransitionConfig, SceneTransitionData } from './SceneTransition';

export interface ISceneManager {
  /**
   * ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³ã‚­ãƒ¼ã‚’å–å¾—
   */
  getCurrentScene(): SceneKey;

  /**
   * ã‚·ãƒ¼ãƒ³ã«é·ç§»ï¼ˆæ—¢å­˜ã‚·ãƒ¼ãƒ³ã¯åœæ­¢ï¼‰
   */
  goTo(
    sceneKey: SceneKey,
    data?: Record<string, unknown>,
    transition?: TransitionConfig
  ): Promise<void>;

  /**
   * ã‚·ãƒ¼ãƒ³ã‚’ç½®ãæ›ãˆï¼ˆå±¥æ­´ã«æ®‹ã•ãªã„ï¼‰
   */
  replace(
    sceneKey: SceneKey,
    data?: Record<string, unknown>,
    transition?: TransitionConfig
  ): Promise<void>;

  /**
   * å‰ã®ã‚·ãƒ¼ãƒ³ã«æˆ»ã‚‹
   */
  goBack(transition?: TransitionConfig): Promise<boolean>;

  /**
   * ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚·ãƒ¼ãƒ³ã‚’é–‹ã
   */
  openOverlay(
    sceneKey: SceneKey,
    data?: Record<string, unknown>,
    transition?: TransitionConfig
  ): Promise<void>;

  /**
   * ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚·ãƒ¼ãƒ³ã‚’é–‰ã˜ã‚‹
   */
  closeOverlay(
    sceneKey: SceneKey,
    transition?: TransitionConfig
  ): Promise<void>;

  /**
   * ã™ã¹ã¦ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’é–‰ã˜ã‚‹
   */
  closeAllOverlays(): Promise<void>;

  /**
   * ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒé–‹ã„ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
   */
  isOverlayOpen(sceneKey: SceneKey): boolean;

  /**
   * é–‹ã„ã¦ã„ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ä¸€è¦§ã‚’å–å¾—
   */
  getOpenOverlays(): SceneKey[];

  /**
   * ã‚·ãƒ¼ãƒ³é·ç§»å±¥æ­´ã‚’å–å¾—
   */
  getHistory(): SceneTransitionData[];

  /**
   * å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
   */
  clearHistory(): void;

  /**
   * é·ç§»ä¸­ã‹ã©ã†ã‹
   */
  isTransitioning(): boolean;
}
```

### 3. ã‚·ãƒ¼ãƒ³é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *EventBusã¨é€£æº*

**è¿½åŠ ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©**:
```typescript
// EventTypes.tsã«è¿½åŠ 
export const SceneEvents = {
  SCENE_TRANSITION_START: 'scene:transition:start',
  SCENE_TRANSITION_COMPLETE: 'scene:transition:complete',
  OVERLAY_OPENED: 'scene:overlay:opened',
  OVERLAY_CLOSED: 'scene:overlay:closed',
} as const;
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ãƒã‚§ãƒƒã‚¯ ğŸŸ¡

**Given**: ISceneManagerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
**When**: å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹
**Then**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: TransitionConfigå‹ãƒã‚§ãƒƒã‚¯ ğŸŸ¡

**Given**: TransitionConfigãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
**When**: å„é·ç§»ã‚¿ã‚¤ãƒ—ã‚’ç”Ÿæˆã™ã‚‹
**Then**: å‹ã‚¨ãƒ©ãƒ¼ãŒãªã„

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0169` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- é·ç§»ä¸­ã®é€£ç¶šé·ç§»è¦æ±‚ã¸ã®å¯¾å¿œã‚’è€ƒæ…®
- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®é‡ã­é †ç®¡ç†
- å±¥æ­´ã®æœ€å¤§ä¿æŒæ•°ã‚’æ¤œè¨

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 3é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
