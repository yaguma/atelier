# TASK-0195: HandContainerè¨­è¨ˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0195
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æŽ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - åŸºæœ¬ã‚·ãƒ¼ãƒ³ãƒ»å…±é€šUIå®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ðŸŸ¡ *å¦¥å½“ãªæŽ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

æ‰‹æœ­è¡¨ç¤ºã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨åŸºæœ¬æ§‹é€ ã‚’è¨­è¨ˆã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0178, TASK-0194
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0196

## å®Œäº†æ¡ä»¶

- [ ] IHandContainerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] æ‰‹æœ­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚«ãƒ¼ãƒ‰ã®ä¸¦ã¹æ–¹ï¼ˆæ‰‡å½¢/æ°´å¹³ï¼‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] é¸æŠžçŠ¶æ…‹ã®ç®¡ç†æ–¹æ³•ãŒè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. æ‰‹æœ­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šæ•° ðŸŸ¡

**ä¿¡é ¼æ€§**: ðŸŸ¡ *ui-design/overview.mdã‚’å‚è€ƒ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/hand/HandConstants.ts`

```typescript
export const HandLayout = {
  // ä½ç½®ï¼ˆç”»é¢ä¸‹éƒ¨ä¸­å¤®ï¼‰
  X: 640,
  Y: 650,

  // è¡¨ç¤ºè¨­å®š
  MAX_VISIBLE_CARDS: 7,
  CARD_SPACING: 100,  // ã‚«ãƒ¼ãƒ‰é–“éš”ï¼ˆæ°´å¹³é…ç½®æ™‚ï¼‰
  CARD_OVERLAP: 30,   // ã‚«ãƒ¼ãƒ‰é‡ãªã‚Šï¼ˆæ‰‡å½¢é…ç½®æ™‚ï¼‰

  // æ‰‡å½¢é…ç½®
  FAN_ANGLE_RANGE: 30, // æ‰‡å½¢ã®è§’åº¦ç¯„å›²ï¼ˆåº¦ï¼‰
  FAN_RADIUS: 400,     // æ‰‡å½¢ã®åŠå¾„

  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  CARD_MOVE_DURATION: 200,
  CARD_HOVER_OFFSET: -30,
} as const;

export type HandLayoutType = 'horizontal' | 'fan';
```

### 2. IHandContainerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ðŸŸ¡

**ä¿¡é ¼æ€§**: ðŸŸ¡ *ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/hand/IHandContainer.ts`

```typescript
import Phaser from 'phaser';
import { Card } from '../../../../domain/card/Card';
import { ICardView } from '../card/ICardView';
import { HandLayoutType } from './HandConstants';

export interface HandContainerOptions {
  x?: number;
  y?: number;
  layoutType?: HandLayoutType;
  maxVisibleCards?: number;
  onCardSelect?: (card: Card, index: number) => void;
  onCardDeselect?: (card: Card, index: number) => void;
}

export interface IHandContainer {
  // ã‚³ãƒ³ãƒ†ãƒŠå‚ç…§
  readonly container: Phaser.GameObjects.Container;

  // æ‰‹æœ­ç®¡ç†
  setCards(cards: Card[]): void;
  addCard(card: Card, animate?: boolean): void;
  removeCard(cardOrIndex: Card | number, animate?: boolean): void;
  getCards(): Card[];
  getCardCount(): number;

  // é¸æŠžç®¡ç†
  getSelectedCard(): Card | null;
  getSelectedIndex(): number;
  selectCard(cardOrIndex: Card | number): void;
  deselectCard(): void;
  setSelectable(selectable: boolean): void;

  // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
  setLayoutType(type: HandLayoutType): void;
  getLayoutType(): HandLayoutType;
  refresh(): void;

  // è¡¨ç¤º
  setVisible(visible: boolean): void;
  setPosition(x: number, y: number): void;

  // ç ´æ£„
  destroy(): void;
}
```

### 3. ã‚«ãƒ¼ãƒ‰é…ç½®è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ðŸŸ¡

**ä¿¡é ¼æ€§**: ðŸŸ¡ *ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/hand/HandLayoutUtils.ts`

```typescript
import { HandLayout, HandLayoutType } from './HandConstants';

export interface CardPosition {
  x: number;
  y: number;
  rotation: number;
  scale: number;
  depth: number;
}

export const calculateCardPositions = (
  cardCount: number,
  layoutType: HandLayoutType,
  centerX: number = HandLayout.X,
  centerY: number = HandLayout.Y
): CardPosition[] => {
  if (layoutType === 'horizontal') {
    return calculateHorizontalLayout(cardCount, centerX, centerY);
  } else {
    return calculateFanLayout(cardCount, centerX, centerY);
  }
};

const calculateHorizontalLayout = (
  cardCount: number,
  centerX: number,
  centerY: number
): CardPosition[] => {
  const positions: CardPosition[] = [];
  const totalWidth = (cardCount - 1) * HandLayout.CARD_SPACING;
  const startX = centerX - totalWidth / 2;

  for (let i = 0; i < cardCount; i++) {
    positions.push({
      x: startX + i * HandLayout.CARD_SPACING,
      y: centerY,
      rotation: 0,
      scale: 1,
      depth: i,
    });
  }

  return positions;
};

const calculateFanLayout = (
  cardCount: number,
  centerX: number,
  centerY: number
): CardPosition[] => {
  const positions: CardPosition[] = [];

  if (cardCount === 0) return positions;
  if (cardCount === 1) {
    return [{ x: centerX, y: centerY, rotation: 0, scale: 1, depth: 0 }];
  }

  const angleRange = HandLayout.FAN_ANGLE_RANGE * (Math.PI / 180);
  const startAngle = -angleRange / 2;
  const angleStep = angleRange / (cardCount - 1);
  const radius = HandLayout.FAN_RADIUS;

  for (let i = 0; i < cardCount; i++) {
    const angle = startAngle + i * angleStep;
    positions.push({
      x: centerX + Math.sin(angle) * radius,
      y: centerY - Math.cos(angle) * radius + radius,
      rotation: angle,
      scale: 1,
      depth: i,
    });
  }

  return positions;
};
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: æ°´å¹³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®— ðŸŸ¡

**Given**: ã‚«ãƒ¼ãƒ‰5æžš
**When**: calculateHorizontalLayoutã‚’å‘¼ã¶
**Then**: 5ã¤ã®ä½ç½®ãŒç­‰é–“éš”ã§è¿”ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: æ‰‡å½¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®— ðŸŸ¡

**Given**: ã‚«ãƒ¼ãƒ‰5æžš
**When**: calculateFanLayoutã‚’å‘¼ã¶
**Then**: 5ã¤ã®ä½ç½®ãŒæ‰‡å½¢ã«é…ç½®ã•ã‚Œã‚‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0195` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- ã‚«ãƒ¼ãƒ‰æžšæ•°ãŒå¤šã„å ´åˆã®é‡ãªã‚Šå‡¦ç†
- æ‰‡å½¢é…ç½®ã®è§’åº¦è¨ˆç®—
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã¯å°†æ¥èª²é¡Œ

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒžãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ðŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ðŸŸ¡ **é»„ä¿¡å·**: 3é …ç›® (100%)
- ðŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
