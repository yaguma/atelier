# TASK-0204: HeaderUIãƒ†ã‚¹ãƒˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0204
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 - åŸºæœ¬ã‚·ãƒ¼ãƒ³ãƒ»å…±é€šUIå®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¨­è¨ˆæ›¸ã«è¨˜è¼‰*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

HeaderUIé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0203
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0205

## å®Œäº†æ¡ä»¶

- [ ] HeaderConstantsã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] HeaderUtilsã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] HeaderUIã®åŸºæœ¬æ“ä½œãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## å®Ÿè£…è©³ç´°

### 1. HeaderConstantsãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *å®šæ•°ã®æ¤œè¨¼*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/presentation/ui/header/HeaderUI.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { HeaderLayout, HeaderColors } from '../../../../../src/presentation/phaser/ui/header/HeaderConstants';
import { getRankColor, formatGold, formatDay } from '../../../../../src/presentation/phaser/ui/header/HeaderUtils';

describe('HeaderConstants', () => {
  describe('HeaderLayout', () => {
    it('ãƒ˜ãƒƒãƒ€ãƒ¼ã®åŸºæœ¬ã‚µã‚¤ã‚ºãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
      expect(HeaderLayout.WIDTH).toBeGreaterThan(0);
      expect(HeaderLayout.HEIGHT).toBeGreaterThan(0);
    });

    it('å„è¦ç´ ã®Xåº§æ¨™ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
      expect(HeaderLayout.RANK_X).toBeDefined();
      expect(HeaderLayout.EXP_GAUGE_X).toBeDefined();
      expect(HeaderLayout.DAY_X).toBeDefined();
      expect(HeaderLayout.GOLD_X).toBeDefined();
      expect(HeaderLayout.AP_X).toBeDefined();
      expect(HeaderLayout.MENU_X).toBeDefined();
    });

    it('Xåº§æ¨™ãŒå·¦ã‹ã‚‰å³ã¸é †ã«å¤§ãããªã‚‹', () => {
      expect(HeaderLayout.RANK_X).toBeLessThan(HeaderLayout.EXP_GAUGE_X);
      expect(HeaderLayout.EXP_GAUGE_X).toBeLessThan(HeaderLayout.DAY_X);
      expect(HeaderLayout.DAY_X).toBeLessThan(HeaderLayout.GOLD_X);
      expect(HeaderLayout.GOLD_X).toBeLessThan(HeaderLayout.AP_X);
      expect(HeaderLayout.AP_X).toBeLessThan(HeaderLayout.MENU_X);
    });

    it('ã‚²ãƒ¼ã‚¸ã‚µã‚¤ã‚ºãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
      expect(HeaderLayout.EXP_GAUGE_WIDTH).toBeGreaterThan(0);
      expect(HeaderLayout.EXP_GAUGE_HEIGHT).toBeGreaterThan(0);
      expect(HeaderLayout.AP_GAUGE_WIDTH).toBeGreaterThan(0);
      expect(HeaderLayout.AP_GAUGE_HEIGHT).toBeGreaterThan(0);
    });
  });

  describe('HeaderColors', () => {
    it('èƒŒæ™¯è‰²ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
      expect(HeaderColors.BACKGROUND).toBeTypeOf('number');
      expect(HeaderColors.BACKGROUND_ALPHA).toBeGreaterThan(0);
      expect(HeaderColors.BACKGROUND_ALPHA).toBeLessThanOrEqual(1);
    });

    it('å…¨ãƒ©ãƒ³ã‚¯ã®è‰²ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹', () => {
      const ranks = ['F', 'E', 'D', 'C', 'B', 'A', 'S'];
      ranks.forEach(rank => {
        const colorKey = `RANK_${rank}` as keyof typeof HeaderColors;
        expect(HeaderColors[colorKey]).toBeTypeOf('number');
      });
    });

    it('é«˜ãƒ©ãƒ³ã‚¯ã»ã©ç›®ç«‹ã¤è‰²ï¼ˆä¸»è¦³çš„ã ãŒé‡‘è‰²ã¯æœ€é«˜ãƒ©ãƒ³ã‚¯ï¼‰', () => {
      expect(HeaderColors.RANK_S).toBe(0xffd700); // é‡‘è‰²
    });
  });
});

describe('HeaderUtils', () => {
  describe('getRankColor', () => {
    it('Fãƒ©ãƒ³ã‚¯ã¯ç°è‰²ã‚’è¿”ã™', () => {
      const mockRank = { name: 'F' } as any;
      expect(getRankColor(mockRank)).toBe(HeaderColors.RANK_F);
    });

    it('Sãƒ©ãƒ³ã‚¯ã¯é‡‘è‰²ã‚’è¿”ã™', () => {
      const mockRank = { name: 'S' } as any;
      expect(getRankColor(mockRank)).toBe(HeaderColors.RANK_S);
    });

    it('å…¨ãƒ©ãƒ³ã‚¯ã§è‰²ãŒå–å¾—ã§ãã‚‹', () => {
      const ranks = ['F', 'E', 'D', 'C', 'B', 'A', 'S'];
      ranks.forEach(rankName => {
        const mockRank = { name: rankName } as any;
        const color = getRankColor(mockRank);
        expect(color).toBeTypeOf('number');
      });
    });

    it('æœªçŸ¥ã®ãƒ©ãƒ³ã‚¯ã¯Fãƒ©ãƒ³ã‚¯ã®è‰²ã‚’è¿”ã™', () => {
      const mockRank = { name: 'X' } as any;
      expect(getRankColor(mockRank)).toBe(HeaderColors.RANK_F);
    });
  });

  describe('formatGold', () => {
    it('1000æœªæº€ã¯ãã®ã¾ã¾è¡¨ç¤º', () => {
      expect(formatGold(500)).toBe('500');
      expect(formatGold(999)).toBe('999');
    });

    it('1000ä»¥ä¸Š10000æœªæº€ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š', () => {
      expect(formatGold(1000)).toBe('1,000');
      expect(formatGold(5000)).toBe('5,000');
      expect(formatGold(9999)).toBe('9,999');
    });

    it('10000ä»¥ä¸Šã¯Kè¡¨è¨˜', () => {
      expect(formatGold(10000)).toBe('10.0K');
      expect(formatGold(12345)).toBe('12.3K');
      expect(formatGold(100000)).toBe('100.0K');
    });

    it('0ã¯ãã®ã¾ã¾è¡¨ç¤º', () => {
      expect(formatGold(0)).toBe('0');
    });
  });

  describe('formatDay', () => {
    it('æ—¥æ•°ãŒæ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹', () => {
      expect(formatDay(1, 30)).toBe('Day 1/30');
      expect(formatDay(15, 30)).toBe('Day 15/30');
      expect(formatDay(30, 30)).toBe('Day 30/30');
    });
  });
});

describe('HeaderUI', () => {
  // Phaserã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒƒã‚¯ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆ

  describe('è¡¨ç¤ºé …ç›®', () => {
    it.skip('ãƒ©ãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // Phaserã‚·ãƒ¼ãƒ³ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
    });

    it.skip('çµŒé¨“å€¤ã‚²ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ã‚²ãƒ¼ã‚¸è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('æ—¥æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // æ—¥æ•°è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('ã‚´ãƒ¼ãƒ«ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ã‚´ãƒ¼ãƒ«ãƒ‰è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('APã‚²ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // APã‚²ãƒ¼ã‚¸è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('æ›´æ–°æ©Ÿèƒ½', () => {
    it.skip('updateAllã§å…¨é …ç›®ãŒæ›´æ–°ã•ã‚Œã‚‹', () => {
      // ä¸€æ‹¬æ›´æ–°ã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('updateRankã§ãƒ©ãƒ³ã‚¯è‰²ãŒå¤‰ã‚ã‚‹', () => {
      // ãƒ©ãƒ³ã‚¯æ›´æ–°ã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('updateExpã§ã‚²ãƒ¼ã‚¸å¹…ãŒå¤‰ã‚ã‚‹', () => {
      // çµŒé¨“å€¤æ›´æ–°ã®ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³', () => {
    it.skip('animateExpGainã§ãƒ•ãƒ­ãƒ¼ãƒˆãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // çµŒé¨“å€¤ç²å¾—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('animateGoldChangeã§ãƒ•ãƒ­ãƒ¼ãƒˆãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ã‚´ãƒ¼ãƒ«ãƒ‰å¤‰åŒ–ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('animateAPChangeã§ãƒ•ãƒ­ãƒ¼ãƒˆãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // APå¤‰åŒ–ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('è­¦å‘Šè¡¨ç¤º', () => {
    it.skip('æ®‹ã‚Šæ—¥æ•°ãŒå°‘ãªã„ã¨è­¦å‘Šè‰²ã«ãªã‚‹', () => {
      // æ—¥æ•°è­¦å‘Šã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('APãŒå°‘ãªã„ã¨ã‚²ãƒ¼ã‚¸è‰²ãŒå¤‰ã‚ã‚‹', () => {
      // APè­¦å‘Šã®ãƒ†ã‚¹ãƒˆ
    });

    it.skip('APãŒå°‘ãªã„ã¨ãƒ†ã‚­ã‚¹ãƒˆãŒç‚¹æ»…ã™ã‚‹', () => {
      // APç‚¹æ»…ã®ãƒ†ã‚¹ãƒˆ
    });
  });
});
```

### 2. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆç”¨ã‚·ãƒ¼ãƒ³ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ‰‹å‹•ç¢ºèªç”¨*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/HeaderUITestScene.ts`

```typescript
import { BaseGameScene, SceneInitData } from './BaseGameScene';
import { HeaderUI } from '../ui/header/HeaderUI';
import { HeaderUIData } from '../ui/header/IHeaderUI';
// ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ãƒ©ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

export class HeaderUITestScene extends BaseGameScene {
  private headerUI!: HeaderUI;

  constructor() {
    super('HeaderUITestScene' as any);
  }

  protected onInit(data?: SceneInitData): void {}
  protected onPreload(): void {}

  protected onCreate(data?: SceneInitData): void {
    // HeaderUIç”Ÿæˆ
    this.headerUI = new HeaderUI(this, {
      onMenuClick: () => console.log('Menu clicked'),
    });

    // åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š
    const initialData: HeaderUIData = {
      rank: { name: 'E' } as any, // ãƒ¢ãƒƒã‚¯ãƒ©ãƒ³ã‚¯
      currentExp: 50,
      requiredExp: 100,
      currentDay: 10,
      maxDay: 30,
      gold: 1500,
      currentAP: 7,
      maxAP: 10,
    };
    this.headerUI.updateAll(initialData);

    // ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³é…ç½®
    this.createTestButtons();
  }

  private createTestButtons(): void {
    let y = 150;

    // ãƒ©ãƒ³ã‚¯å¤‰æ›´ãƒœã‚¿ãƒ³
    // çµŒé¨“å€¤è¿½åŠ ãƒœã‚¿ãƒ³
    // ã‚´ãƒ¼ãƒ«ãƒ‰è¿½åŠ ãƒœã‚¿ãƒ³
    // APæ¶ˆè²»ãƒœã‚¿ãƒ³
    // æ—¥é€ã‚Šãƒœã‚¿ãƒ³
  }

  protected setupEventListeners(): void {}
}
```

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0204` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¦–è¦šç¢ºèª
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®ãƒ†ã‚¹ãƒˆ

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 2é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 2é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
