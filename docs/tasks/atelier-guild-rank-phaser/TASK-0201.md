# TASK-0201: HeaderUI設計

**タスクID**: TASK-0201
**タスクタイプ**: TDD
**推定工数**: 4時間
**フェーズ**: Phase 2 - 基本シーン・共通UI実装
**信頼性レベル**: 🔵 *設計書に記載*

## 関連文書

- **概要**: [overview.md](./overview.md)
- **UI設計**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## タスク概要

メイン画面上部のヘッダーUIのインターフェースと基本構造を設計する。

## 依存タスク

- **前提タスク**: TASK-0173, TASK-0176
- **後続タスク**: TASK-0202

## 完了条件

- [x] IHeaderUIインターフェースが定義されている
- [x] ヘッダーレイアウト定数が定義されている
- [x] 表示項目（ランク、経験値、日数、ゴールド、AP）の配置が決定している
- [x] 更新メソッドのシグネチャが設計されている

---

## 実装詳細

### 1. ヘッダーレイアウト定数 🔵

**信頼性**: 🔵 *ui-design/overview.mdを参考*

**実装ファイル**: `src/presentation/phaser/ui/header/HeaderConstants.ts`

```typescript
export const HeaderLayout = {
  // 位置・サイズ
  X: 0,
  Y: 0,
  WIDTH: 1280,
  HEIGHT: 80,

  // パディング
  PADDING_X: 20,
  PADDING_Y: 10,

  // ランク表示エリア
  RANK_X: 20,
  RANK_WIDTH: 200,

  // 経験値ゲージ
  EXP_GAUGE_X: 230,
  EXP_GAUGE_WIDTH: 300,
  EXP_GAUGE_HEIGHT: 20,

  // 日数表示
  DAY_X: 600,

  // ゴールド表示
  GOLD_X: 800,

  // AP表示
  AP_X: 1000,
  AP_GAUGE_WIDTH: 200,
  AP_GAUGE_HEIGHT: 20,

  // メニューボタン
  MENU_X: 1220,
} as const;

export const HeaderColors = {
  BACKGROUND: 0x1a1a2e,
  BACKGROUND_ALPHA: 0.95,
  BORDER: 0x4a4a6a,

  // ランク別色
  RANK_F: 0x808080,
  RANK_E: 0x00aa00,
  RANK_D: 0x0088ff,
  RANK_C: 0xaa00ff,
  RANK_B: 0xff8800,
  RANK_A: 0xff0000,
  RANK_S: 0xffd700,
} as const;
```

### 2. IHeaderUIインターフェース 🔵

**信頼性**: 🔵 *コンポーネント設計*

**実装ファイル**: `src/presentation/phaser/ui/header/IHeaderUI.ts`

```typescript
import Phaser from 'phaser';
import { Rank } from '../../../../domain/rank/Rank';

export interface HeaderUIData {
  rank: Rank;
  currentExp: number;
  requiredExp: number;
  currentDay: number;
  maxDay: number;
  gold: number;
  currentAP: number;
  maxAP: number;
}

export interface HeaderUIOptions {
  x?: number;
  y?: number;
  width?: number;
  onMenuClick?: () => void;
}

export interface IHeaderUI {
  // コンテナ参照
  readonly container: Phaser.GameObjects.Container;

  // 一括更新
  updateAll(data: HeaderUIData): void;

  // 個別更新
  updateRank(rank: Rank): void;
  updateExp(current: number, required: number): void;
  updateDay(current: number, max: number): void;
  updateGold(gold: number): void;
  updateAP(current: number, max: number): void;

  // アニメーション付き更新
  animateExpGain(amount: number): void;
  animateGoldChange(amount: number): void;
  animateAPChange(amount: number): void;

  // 表示制御
  setVisible(visible: boolean): void;

  // 破棄
  destroy(): void;
}
```

### 3. ランク色取得ユーティリティ 🔵

**信頼性**: 🔵 *ランク別色分け*

**実装ファイル**: `src/presentation/phaser/ui/header/HeaderUtils.ts`

```typescript
import { Rank } from '../../../../domain/rank/Rank';
import { HeaderColors } from './HeaderConstants';

export const getRankColor = (rank: Rank): number => {
  switch (rank.name) {
    case 'F': return HeaderColors.RANK_F;
    case 'E': return HeaderColors.RANK_E;
    case 'D': return HeaderColors.RANK_D;
    case 'C': return HeaderColors.RANK_C;
    case 'B': return HeaderColors.RANK_B;
    case 'A': return HeaderColors.RANK_A;
    case 'S': return HeaderColors.RANK_S;
    default: return HeaderColors.RANK_F;
  }
};

export const formatGold = (gold: number): string => {
  if (gold >= 10000) {
    return `${(gold / 1000).toFixed(1)}K`;
  }
  return gold.toLocaleString();
};

export const formatDay = (current: number, max: number): string => {
  return `Day ${current}/${max}`;
};
```

---

## 単体テスト要件

### テストケース1: ランク色取得 🔵

**Given**: 各ランク
**When**: getRankColorを呼ぶ
**Then**: 対応する色が返される

### テストケース2: ゴールドフォーマット 🔵

**Given**: 12345ゴールド
**When**: formatGoldを呼ぶ
**Then**: "12.3K"が返される

### テストケース3: 日数フォーマット 🔵

**Given**: 現在5日目、最大30日
**When**: formatDayを呼ぶ
**Then**: "Day 5/30"が返される

---

## 実装手順

1. `/tsumiki:tdd-requirements TASK-0201` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- 画面幅に対するレスポンシブ対応
- ランク色のアクセシビリティ
- 数値変化時のアニメーション

---

## 信頼性レベルサマリー

- **総項目数**: 3項目
- 🔵 **青信号**: 3項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: 高品質
