# TASK-0274: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–ãƒ†ã‚¹ãƒˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0274
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 5 - çµ±åˆãƒ†ã‚¹ãƒˆãƒ»æœ€é©åŒ–ãƒ»ä»•ä¸Šã’
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”´ *Phaserå›ºæœ‰*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–å®Ÿè£…**: TASK-0273

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

TASK-0273ã§å®Ÿè£…ã—ãŸãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0273 (ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–å®Ÿè£…), TASK-0271 (ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«æœ€é©åŒ–)
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0275

## å®Œäº†æ¡ä»¶

- [x] DisposableManagerã®å˜ä½“ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [x] EventListenerManagerã®å˜ä½“ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [x] WeakCacheã®å˜ä½“ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [x] ã‚·ãƒ¼ãƒ³é·ç§»ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [x] é•·æ™‚é–“ç¨¼åƒãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹

---

## ãƒ†ã‚¹ãƒˆå®Ÿè£…è©³ç´°

### 1. DisposableManagerãƒ†ã‚¹ãƒˆ ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/phaser/utils/DisposableManager.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { DisposableManager, IDisposable } from '@/presentation/phaser/utils/DisposableManager';

describe('DisposableManager', () => {
  let manager: DisposableManager;

  beforeEach(() => {
    manager = new DisposableManager();
  });

  describe('register', () => {
    it('ç ´æ£„å¯¾è±¡ã‚’ç™»éŒ²ã§ãã‚‹', () => {
      const disposable: IDisposable = { dispose: vi.fn() };

      manager.register(disposable);

      expect(manager.count).toBe(1);
    });

    it('è¤‡æ•°ã®ç ´æ£„å¯¾è±¡ã‚’ç™»éŒ²ã§ãã‚‹', () => {
      const disposable1: IDisposable = { dispose: vi.fn() };
      const disposable2: IDisposable = { dispose: vi.fn() };

      manager.register(disposable1);
      manager.register(disposable2);

      expect(manager.count).toBe(2);
    });

    it('ç ´æ£„æ¸ˆã¿ã®å ´åˆã¯å³åº§ã«ç ´æ£„ã•ã‚Œã‚‹', () => {
      const disposable: IDisposable = { dispose: vi.fn() };

      manager.dispose();
      manager.register(disposable);

      expect(disposable.dispose).toHaveBeenCalled();
      expect(manager.count).toBe(0);
    });
  });

  describe('dispose', () => {
    it('ç™»éŒ²ã•ã‚ŒãŸå…¨ã¦ã®ç ´æ£„å¯¾è±¡ã‚’ç ´æ£„ã™ã‚‹', () => {
      const disposable1: IDisposable = { dispose: vi.fn() };
      const disposable2: IDisposable = { dispose: vi.fn() };

      manager.register(disposable1);
      manager.register(disposable2);

      manager.dispose();

      expect(disposable1.dispose).toHaveBeenCalled();
      expect(disposable2.dispose).toHaveBeenCalled();
    });

    it('é€†é †ã§ç ´æ£„ã•ã‚Œã‚‹ï¼ˆå¾Œã«ç™»éŒ²ã•ã‚ŒãŸã‚‚ã®ãŒå…ˆï¼‰', () => {
      const order: number[] = [];
      const disposable1: IDisposable = { dispose: () => order.push(1) };
      const disposable2: IDisposable = { dispose: () => order.push(2) };
      const disposable3: IDisposable = { dispose: () => order.push(3) };

      manager.register(disposable1);
      manager.register(disposable2);
      manager.register(disposable3);

      manager.dispose();

      expect(order).toEqual([3, 2, 1]);
    });

    it('2å›ç›®ã®disposeã¯ä½•ã‚‚ã—ãªã„', () => {
      const disposable: IDisposable = { dispose: vi.fn() };

      manager.register(disposable);

      manager.dispose();
      manager.dispose();

      expect(disposable.dispose).toHaveBeenCalledTimes(1);
    });

    it('ç ´æ£„ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ä»–ã®ç ´æ£„ã¯ç¶™ç¶šã™ã‚‹', () => {
      const disposable1: IDisposable = {
        dispose: vi.fn().mockImplementation(() => {
          throw new Error('Test error');
        }),
      };
      const disposable2: IDisposable = { dispose: vi.fn() };

      manager.register(disposable1);
      manager.register(disposable2);

      // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ä¾‹å¤–ã¯æŠ•ã’ãªã„
      expect(() => manager.dispose()).not.toThrow();

      // ä¸¡æ–¹ã¨ã‚‚å‘¼ã³å‡ºã•ã‚Œã‚‹
      expect(disposable1.dispose).toHaveBeenCalled();
      expect(disposable2.dispose).toHaveBeenCalled();
    });
  });

  describe('onCleanup', () => {
    it('ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç™»éŒ²ã§ãã‚‹', () => {
      const callback = vi.fn();

      manager.onCleanup(callback);
      manager.dispose();

      expect(callback).toHaveBeenCalled();
    });

    it('ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ç ´æ£„å¯¾è±¡ã‚ˆã‚Šå…ˆã«å®Ÿè¡Œã•ã‚Œã‚‹', () => {
      const order: string[] = [];

      manager.onCleanup(() => order.push('callback'));
      manager.register({ dispose: () => order.push('disposable') });

      manager.dispose();

      expect(order).toEqual(['callback', 'disposable']);
    });
  });

  describe('unregister', () => {
    it('ç ´æ£„å¯¾è±¡ã‚’ç™»éŒ²è§£é™¤ã§ãã‚‹', () => {
      const disposable: IDisposable = { dispose: vi.fn() };

      manager.register(disposable);
      manager.unregister(disposable);

      expect(manager.count).toBe(0);

      manager.dispose();
      expect(disposable.dispose).not.toHaveBeenCalled();
    });
  });
});
```

### 2. EventListenerManagerãƒ†ã‚¹ãƒˆ ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/phaser/utils/EventListenerManager.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { EventListenerManager } from '@/presentation/phaser/utils/EventListenerManager';
import { EventEmitter } from 'events';

describe('EventListenerManager', () => {
  let manager: EventListenerManager;

  beforeEach(() => {
    manager = new EventListenerManager();
  });

  describe('addEventBusListener', () => {
    it('EventBusã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ãƒ»è§£é™¤ã§ãã‚‹', () => {
      const callback = vi.fn();
      const unsubscribe = vi.fn();
      const eventBus = {
        on: vi.fn().mockReturnValue(unsubscribe),
      };

      manager.addEventBusListener(eventBus, 'test:event', callback);

      expect(eventBus.on).toHaveBeenCalledWith('test:event', callback);

      manager.dispose();

      expect(unsubscribe).toHaveBeenCalled();
    });
  });

  describe('addPhaserListener', () => {
    it('Phaser EventEmitterã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ãƒ»è§£é™¤ã§ãã‚‹', () => {
      // ãƒ¢ãƒƒã‚¯ã‚¨ãƒŸãƒƒã‚¿ãƒ¼
      const emitter = {
        on: vi.fn(),
        off: vi.fn(),
      };
      const callback = vi.fn();

      manager.addPhaserListener(emitter as any, 'test', callback);

      expect(emitter.on).toHaveBeenCalledWith('test', callback, undefined);

      manager.dispose();

      expect(emitter.off).toHaveBeenCalledWith('test', callback, undefined);
    });
  });

  describe('addDOMListener', () => {
    it('DOM EventListenerã‚’ç™»éŒ²ãƒ»è§£é™¤ã§ãã‚‹', () => {
      const element = {
        addEventListener: vi.fn(),
        removeEventListener: vi.fn(),
      };
      const callback = vi.fn();

      manager.addDOMListener(element as any, 'click', callback);

      expect(element.addEventListener).toHaveBeenCalledWith('click', callback, undefined);

      manager.dispose();

      expect(element.removeEventListener).toHaveBeenCalledWith('click', callback, undefined);
    });
  });

  describe('addTween', () => {
    it('Tweenã‚’ç™»éŒ²ã—ã€disposeæ™‚ã«åœæ­¢ãƒ»ç ´æ£„ã•ã‚Œã‚‹', () => {
      const tween = {
        isPlaying: vi.fn().mockReturnValue(true),
        stop: vi.fn(),
        destroy: vi.fn(),
      };

      manager.addTween(tween as any);
      manager.dispose();

      expect(tween.stop).toHaveBeenCalled();
      expect(tween.destroy).toHaveBeenCalled();
    });

    it('å†ç”Ÿã—ã¦ã„ãªã„Tweenã¯stopã‚’å‘¼ã°ãªã„', () => {
      const tween = {
        isPlaying: vi.fn().mockReturnValue(false),
        stop: vi.fn(),
        destroy: vi.fn(),
      };

      manager.addTween(tween as any);
      manager.dispose();

      expect(tween.stop).not.toHaveBeenCalled();
      expect(tween.destroy).toHaveBeenCalled();
    });
  });

  describe('addTimer', () => {
    it('Timerã‚’ç™»éŒ²ã—ã€disposeæ™‚ã«ç ´æ£„ã•ã‚Œã‚‹', () => {
      const timer = {
        destroy: vi.fn(),
      };

      manager.addTimer(timer as any);
      manager.dispose();

      expect(timer.destroy).toHaveBeenCalled();
    });
  });

  describe('dispose', () => {
    it('2å›ç›®ã®disposeã¯ä½•ã‚‚ã—ãªã„', () => {
      const unsubscribe = vi.fn();
      const eventBus = {
        on: vi.fn().mockReturnValue(unsubscribe),
      };

      manager.addEventBusListener(eventBus, 'test', vi.fn());

      manager.dispose();
      manager.dispose();

      expect(unsubscribe).toHaveBeenCalledTimes(1);
    });
  });

  describe('count', () => {
    it('ç™»éŒ²ã•ã‚ŒãŸãƒªã‚¹ãƒŠãƒ¼æ•°ã‚’è¿”ã™', () => {
      const eventBus = { on: vi.fn().mockReturnValue(vi.fn()) };

      expect(manager.count).toBe(0);

      manager.addEventBusListener(eventBus, 'event1', vi.fn());
      expect(manager.count).toBe(1);

      manager.addEventBusListener(eventBus, 'event2', vi.fn());
      expect(manager.count).toBe(2);
    });
  });
});
```

### 3. WeakCacheãƒ†ã‚¹ãƒˆ ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/phaser/utils/WeakCache.test.ts`

```typescript
import { describe, it, expect, beforeEach } from 'vitest';
import { WeakCache } from '@/presentation/phaser/utils/WeakCache';

describe('WeakCache', () => {
  let cache: WeakCache<string, object>;

  beforeEach(() => {
    cache = new WeakCache<string, object>();
  });

  describe('set/get', () => {
    it('ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ãã‚‹', () => {
      const obj = { value: 'test' };

      cache.set('key1', obj);

      expect(cache.get('key1')).toBe(obj);
    });

    it('å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ã¯undefinedã‚’è¿”ã™', () => {
      expect(cache.get('nonexistent')).toBeUndefined();
    });

    it('åŒã˜ã‚­ãƒ¼ã§ä¸Šæ›¸ãã§ãã‚‹', () => {
      const obj1 = { value: 'first' };
      const obj2 = { value: 'second' };

      cache.set('key1', obj1);
      cache.set('key1', obj2);

      expect(cache.get('key1')).toBe(obj2);
    });
  });

  describe('has', () => {
    it('ã‚­ãƒ¼ã®å­˜åœ¨ã‚’ç¢ºèªã§ãã‚‹', () => {
      const obj = { value: 'test' };

      cache.set('key1', obj);

      expect(cache.has('key1')).toBe(true);
      expect(cache.has('nonexistent')).toBe(false);
    });
  });

  describe('delete', () => {
    it('ã‚­ãƒ¼ã‚’å‰Šé™¤ã§ãã‚‹', () => {
      const obj = { value: 'test' };

      cache.set('key1', obj);
      const result = cache.delete('key1');

      expect(result).toBe(true);
      expect(cache.get('key1')).toBeUndefined();
    });

    it('å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ã®å‰Šé™¤ã¯falseã‚’è¿”ã™', () => {
      expect(cache.delete('nonexistent')).toBe(false);
    });
  });

  describe('clear', () => {
    it('å…¨ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤ã§ãã‚‹', () => {
      cache.set('key1', { value: 1 });
      cache.set('key2', { value: 2 });

      cache.clear();

      expect(cache.get('key1')).toBeUndefined();
      expect(cache.get('key2')).toBeUndefined();
    });
  });

  describe('size', () => {
    it('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºã‚’è¿”ã™', () => {
      expect(cache.size).toBe(0);

      cache.set('key1', { value: 1 });
      expect(cache.size).toBe(1);

      cache.set('key2', { value: 2 });
      expect(cache.size).toBe(2);

      cache.delete('key1');
      expect(cache.size).toBe(1);
    });
  });
});
```

### 4. ã‚·ãƒ¼ãƒ³é·ç§»ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆ ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *çµ±åˆãƒ†ã‚¹ãƒˆ*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/integration/phaser/phase5/SceneTransitionMemory.test.ts`

```typescript
import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';
import { createTestGame } from '../../../utils/phaserTestUtils';

describe('Scene Transition Memory Test', () => {
  let game: any;

  beforeEach(async () => {
    const testSetup = await createTestGame();
    game = testSetup.game;
  });

  afterEach(() => {
    game?.destroy(true);
  });

  describe('ã‚·ãƒ¼ãƒ³é·ç§»æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—', () => {
    it('ã‚·ãƒ¼ãƒ³é·ç§»å¾Œã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°ãŒå¢—åŠ ã—ç¶šã‘ãªã„', async () => {
      // Arrange
      const initialObjectCount = game.scene.getScenes(true)[0]?.children?.length || 0;

      // Act - è¤‡æ•°å›ã‚·ãƒ¼ãƒ³é·ç§»
      for (let i = 0; i < 5; i++) {
        game.scene.start('MainScene');
        await new Promise(resolve => setTimeout(resolve, 100));
        game.scene.start('TitleScene');
        await new Promise(resolve => setTimeout(resolve, 100));
      }

      // Assert
      const finalObjectCount = game.scene.getScenes(true)[0]?.children?.length || 0;

      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°ãŒå¤§å¹…ã«å¢—åŠ ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
      // è¨±å®¹ç¯„å›²: åˆæœŸå€¤ã®2å€ä»¥å†…
      expect(finalObjectCount).toBeLessThan(initialObjectCount * 2 + 50);
    });

    it('ã‚·ãƒ¼ãƒ³ç ´æ£„æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒè§£é™¤ã•ã‚Œã‚‹', async () => {
      // Arrange
      const scene = game.scene.getScene('MainScene');
      const mockCallback = vi.fn();

      // ã‚·ãƒ¼ãƒ³ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
      scene?.events.on('test-event', mockCallback);

      // Act
      game.scene.stop('MainScene');
      await new Promise(resolve => setTimeout(resolve, 50));

      // ã‚·ãƒ¼ãƒ³ç ´æ£„å¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
      scene?.events.emit('test-event');

      // Assert - ãƒªã‚¹ãƒŠãƒ¼ãŒè§£é™¤ã•ã‚Œã¦ã„ã‚Œã°ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯å‘¼ã°ã‚Œãªã„
      // æ³¨: å®Ÿéš›ã®å‹•ä½œã¯Phaserã®å®Ÿè£…ä¾å­˜
    });
  });

  describe('DisposableManagerçµ±åˆ', () => {
    it('ã‚·ãƒ¼ãƒ³çµ‚äº†æ™‚ã«DisposableManagerãŒç ´æ£„ã•ã‚Œã‚‹', async () => {
      // Arrange
      const scene = game.scene.getScene('MainScene');
      const disposable = { dispose: vi.fn() };

      // ã‚·ãƒ¼ãƒ³ã«Disposableã‚’ç™»éŒ²ï¼ˆå®Ÿè£…ä¾å­˜ï¼‰
      if (scene && (scene as any).registerDisposable) {
        (scene as any).registerDisposable(disposable);
      }

      // Act
      game.scene.stop('MainScene');
      await new Promise(resolve => setTimeout(resolve, 50));

      // Assert
      // æ³¨: å®Ÿè£…ã«å¿œã˜ã¦ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’èª¿æ•´
    });
  });
});
```

### 5. é•·æ™‚é–“ç¨¼åƒãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆ ğŸ”´

**ä¿¡é ¼æ€§**: ğŸ”´ *çµ±åˆãƒ†ã‚¹ãƒˆ*

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/integration/phaser/phase5/LongRunningMemory.test.ts`

```typescript
import { describe, it, expect, beforeEach, afterEach } from 'vitest';
import { createTestGame } from '../../../utils/phaserTestUtils';

describe('Long Running Memory Test', () => {
  let game: any;

  beforeEach(async () => {
    const testSetup = await createTestGame();
    game = testSetup.game;
  });

  afterEach(() => {
    game?.destroy(true);
  });

  describe('ç¹°ã‚Šè¿”ã—æ“ä½œã§ã®ãƒ¡ãƒ¢ãƒªå¢—åŠ ', () => {
    it('ã‚«ãƒ¼ãƒ‰å–å¾—ãƒ»è¿”å´ã‚’ç¹°ã‚Šè¿”ã—ã¦ã‚‚ãƒ¡ãƒ¢ãƒªãŒå¢—åŠ ã—ç¶šã‘ãªã„', async () => {
      // Arrange
      const iterations = 100;

      // Chrome DevTools APIï¼ˆåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰
      const getMemory = () => {
        const perf = window.performance as any;
        return perf.memory?.usedJSHeapSize || 0;
      };

      const initialMemory = getMemory();

      // Act - ã‚«ãƒ¼ãƒ‰æ“ä½œã‚’ç¹°ã‚Šè¿”ã—
      for (let i = 0; i < iterations; i++) {
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã‹ã‚‰å–å¾—ãƒ»è¿”å´
        // å®Ÿéš›ã®å®Ÿè£…ã«åˆã‚ã›ã¦èª¿æ•´
      }

      // å¼·åˆ¶GCï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ã¿ï¼‰
      if (typeof global.gc === 'function') {
        global.gc();
      }

      await new Promise(resolve => setTimeout(resolve, 100));

      const finalMemory = getMemory();

      // Assert
      // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒ50%ä»¥ä¸Šå¢—åŠ ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
      if (initialMemory > 0) {
        expect(finalMemory).toBeLessThan(initialMemory * 1.5);
      }
    });

    it('ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã‚’ç¹°ã‚Šè¿”ã—ã¦ã‚‚ãƒ¡ãƒ¢ãƒªãŒå¢—åŠ ã—ç¶šã‘ãªã„', async () => {
      // Arrange
      const iterations = 1000;
      const eventBus = game.registry.get('eventBus');

      // Act
      for (let i = 0; i < iterations; i++) {
        eventBus?.emit('test:event', { data: i });
      }

      await new Promise(resolve => setTimeout(resolve, 100));

      // Assert
      // ã‚¨ãƒ©ãƒ¼ãªãå®Œäº†ã™ã‚Œã°OK
      expect(true).toBe(true);
    });
  });

  describe('ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ«ã®ãƒ¡ãƒ¢ãƒªåŠ¹ç‡', () => {
    it('ãƒ—ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸå ´åˆã¨ä½¿ç”¨ã—ãªã„å ´åˆã®æ¯”è¼ƒ', async () => {
      // Arrange
      const iterations = 50;

      // ãƒ—ãƒ¼ãƒ«ä½¿ç”¨ãªã—ï¼ˆå‚è€ƒå€¤ï¼‰
      const withoutPool: object[] = [];
      for (let i = 0; i < iterations; i++) {
        withoutPool.push({ id: i, data: new Array(100).fill(0) });
      }
      withoutPool.length = 0; // ã‚¯ãƒªã‚¢

      // ãƒ—ãƒ¼ãƒ«ä½¿ç”¨ã‚ã‚Š
      // å®Ÿéš›ã®ãƒ—ãƒ¼ãƒ«å®Ÿè£…ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆ

      // Assert
      // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬çµæœã‚’ç¢ºèª
      expect(true).toBe(true);
    });
  });
});
```

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0274` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

| ãƒ†ã‚¹ãƒˆå¯¾è±¡ | ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸ |
|-----------|---------------|
| DisposableManager | 95% |
| EventListenerManager | 95% |
| WeakCache | 90% |
| ã‚·ãƒ¼ãƒ³é·ç§»ãƒ¡ãƒ¢ãƒª | 80% |

---

## æ³¨æ„äº‹é …

- ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®GCåˆ¶å¾¡ã®é™ç•Œ
- Chrome DevTools APIã®åˆ©ç”¨å¯èƒ½æ€§
- éåŒæœŸå‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 5é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 5é …ç›® (100%)

**å“è³ªè©•ä¾¡**: ä½å“è³ªï¼ˆå®Ÿè£…æ™‚ã«èª¿æ•´è¦ãƒ»Phaserå›ºæœ‰ï¼‰
