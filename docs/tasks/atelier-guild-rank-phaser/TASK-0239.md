# TASK-0239: Phase3çµ±åˆãƒ†ã‚¹ãƒˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0239
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 3 - ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠãƒ»ãƒ¡ã‚¤ãƒ³ç”»é¢å®Ÿè£…
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *è¨­è¨ˆæ›¸ã«è¨˜è¼‰*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

Phase 3ã§å®Ÿè£…ã—ãŸã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã€‚ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠã®é€£æºã€MainSceneã®å‹•ä½œã€EventBusã®é€šä¿¡ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0219, TASK-0225, TASK-0230, TASK-0234, TASK-0238
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0240

## å®Œäº†æ¡ä»¶

- [ ] å…¨ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠã®åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] MainSceneã®å„æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] EventBusé€£æºãƒ†ã‚¹ãƒˆãŒé€šã‚‹
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒ¼ãƒ³ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## å®Ÿè£…è©³ç´°

### 1. ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠçµ±åˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/integration/presentation/PhaseContainers.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';

describe('Phase Containers Integration', () => {
  describe('ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»', () => {
    it.skip('quest-accept â†’ gathering ã¸ã®é·ç§»ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', () => {
      // ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»ãƒ†ã‚¹ãƒˆ
    });

    it.skip('gathering â†’ alchemy ã¸ã®é·ç§»ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', () => {
      // ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»ãƒ†ã‚¹ãƒˆ
    });

    it.skip('alchemy â†’ delivery ã¸ã®é·ç§»ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', () => {
      // ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»ãƒ†ã‚¹ãƒˆ
    });

    it.skip('delivery â†’ quest-accept ã¸ã®ã‚µã‚¤ã‚¯ãƒ«ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', () => {
      // 1ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('ãƒ•ã‚§ãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—', () => {
    it.skip('æ¡å–ãƒ•ã‚§ãƒ¼ã‚ºã§é¸æŠã—ãŸç´ æãŒèª¿åˆãƒ•ã‚§ãƒ¼ã‚ºã§åˆ©ç”¨å¯èƒ½', () => {
      // ãƒ‡ãƒ¼ã‚¿é€£æºãƒ†ã‚¹ãƒˆ
    });

    it.skip('èª¿åˆãƒ•ã‚§ãƒ¼ã‚ºã§ä½œæˆã—ãŸã‚¢ã‚¤ãƒ†ãƒ ãŒç´å“ãƒ•ã‚§ãƒ¼ã‚ºã§è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ãƒ‡ãƒ¼ã‚¿é€£æºãƒ†ã‚¹ãƒˆ
    });
  });

  describe('ã‚³ãƒ³ãƒ†ãƒŠãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«', () => {
    it.skip('ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»æ™‚ã«å‰ã®ã‚³ãƒ³ãƒ†ãƒŠãŒé©åˆ‡ã«ç ´æ£„ã•ã‚Œã‚‹', () => {
      // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ
    });

    it.skip('enter/exitãŒæ­£ã—ã„é †åºã§å‘¼ã°ã‚Œã‚‹', () => {
      // ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆ
    });
  });
});
```

### 2. MainSceneçµ±åˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/integration/presentation/MainScene.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';

describe('MainScene Integration', () => {
  describe('ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ', () => {
    it.skip('ãƒ˜ãƒƒãƒ€ãƒ¼ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ã€ãƒ•ãƒƒã‚¿ãƒ¼ãŒæ­£ã—ãé…ç½®ã•ã‚Œã‚‹', () => {
      // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¤œè¨¼
    });

    it.skip('å„ã‚¨ãƒªã‚¢ã®ã‚µã‚¤ã‚ºãŒæœŸå¾…é€šã‚Š', () => {
      // ã‚µã‚¤ã‚ºæ¤œè¨¼
    });
  });

  describe('UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€£æº', () => {
    it.skip('HeaderUIãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹', () => {
      // ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
    });

    it.skip('SidebarUIãŒä¾é ¼ãƒ»ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹', () => {
      // ã‚µã‚¤ãƒ‰ãƒãƒ¼è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
    });

    it.skip('PhaseIndicatorãŒç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’ç¤ºã™', () => {
      // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('æ‰‹æœ­ãƒ»ãƒ‡ãƒƒã‚­é€£æº', () => {
    it.skip('æ‰‹æœ­ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // æ‰‹æœ­è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
    });

    it.skip('ã‚«ãƒ¼ãƒ‰é¸æŠãŒãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ³ãƒ†ãƒŠã«åæ˜ ã•ã‚Œã‚‹', () => {
      // é¸æŠé€£æºãƒ†ã‚¹ãƒˆ
    });

    it.skip('ãƒ‰ãƒ­ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', () => {
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('ãƒ•ã‚§ãƒ¼ã‚ºåˆ‡æ›¿', () => {
    it.skip('switchToPhaseã§ãƒ•ã‚§ãƒ¼ã‚ºãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹', () => {
      // åˆ‡æ›¿ãƒ†ã‚¹ãƒˆ
    });

    it.skip('é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œã‚‹', () => {
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
    });
  });
});
```

### 3. EventBusçµ±åˆãƒ†ã‚¹ãƒˆ ğŸ”µ

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/integration/presentation/EventBusIntegration.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';

describe('EventBus Integration', () => {
  describe('UI â†’ Application ã‚¤ãƒ™ãƒ³ãƒˆ', () => {
    it.skip('ä¾é ¼å—æ³¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£ã—ãç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ†ã‚¹ãƒˆ
    });

    it.skip('æ¡å–ç¢ºå®šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£ã—ãç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ†ã‚¹ãƒˆ
    });

    it.skip('èª¿åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£ã—ãç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ†ã‚¹ãƒˆ
    });

    it.skip('ç´å“ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£ã—ãç™ºç«ã™ã‚‹', () => {
      // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('Application â†’ UI ã‚¤ãƒ™ãƒ³ãƒˆ', () => {
    it.skip('ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°ãŒUIã«åæ˜ ã•ã‚Œã‚‹', () => {
      // çŠ¶æ…‹åæ˜ ãƒ†ã‚¹ãƒˆ
    });

    it.skip('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã«åæ˜ ã•ã‚Œã‚‹', () => {
      // ãƒ‡ãƒ¼ã‚¿åæ˜ ãƒ†ã‚¹ãƒˆ
    });

    it.skip('ãƒ•ã‚§ãƒ¼ã‚ºå¤‰æ›´ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹', () => {
      // ãƒ•ã‚§ãƒ¼ã‚ºå¤‰æ›´ãƒ†ã‚¹ãƒˆ
    });
  });

  describe('ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—', () => {
    it.skip('ã‚·ãƒ¼ãƒ³çµ‚äº†æ™‚ã«ãƒªã‚¹ãƒŠãƒ¼ãŒè§£é™¤ã•ã‚Œã‚‹', () => {
      // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ
    });

    it.skip('é‡è¤‡ãƒªã‚¹ãƒŠãƒ¼ãŒç™»éŒ²ã•ã‚Œãªã„', () => {
      // é‡è¤‡é˜²æ­¢ãƒ†ã‚¹ãƒˆ
    });
  });
});
```

### 4. çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒ¼ãƒ³ ğŸ”µ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/scenes/Phase3TestScene.ts`

```typescript
import Phaser from 'phaser';
import { BaseGameScene, SceneInitData } from './BaseGameScene';
import { MainSceneLayout } from './MainSceneConstants';
import { QuestAcceptContainer } from '../ui/phase/QuestAcceptContainer';
import { GatheringContainer } from '../ui/phase/GatheringContainer';
import { AlchemyContainer } from '../ui/phase/AlchemyContainer';
import { DeliveryContainer } from '../ui/phase/DeliveryContainer';
import { HeaderUI } from '../ui/common/HeaderUI';
import { SidebarUI } from '../ui/common/SidebarUI';
import { PhaseIndicator } from '../ui/common/PhaseIndicator';
import { HandContainer } from '../ui/hand/HandContainer';
import { DeckView } from '../ui/common/DeckView';
import { EventBus } from '../core/EventBus';
import { TextStyles } from '../config/TextStyles';

export class Phase3TestScene extends BaseGameScene {
  private eventBus!: EventBus;

  // UI Components
  private headerUI!: HeaderUI;
  private sidebarUI!: SidebarUI;
  private phaseIndicator!: PhaseIndicator;
  private handContainer!: HandContainer;
  private deckView!: DeckView;

  // Phase Containers
  private currentPhaseContainer: any = null;
  private currentPhase: string = 'quest-accept';

  // Test Controls
  private testPanel!: Phaser.GameObjects.Container;

  constructor() {
    super('Phase3TestScene' as any);
  }

  protected onInit(data?: SceneInitData): void {
    this.eventBus = new EventBus();
    this.setupEventListeners();
  }

  protected onPreload(): void {}

  protected onCreate(data?: SceneInitData): void {
    this.createBackground();
    this.createHeaderUI();
    this.createSidebarUI();
    this.createPhaseIndicator();
    this.createHandAndDeck();
    this.createTestControls();

    // åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š
    this.setTestData();

    // åˆæœŸãƒ•ã‚§ãƒ¼ã‚ºè¡¨ç¤º
    this.showPhase('quest-accept');
  }

  private createBackground(): void {
    const bg = this.add.graphics();
    bg.fillStyle(0x1a1a2e, 1);
    bg.fillRect(0, 0, 1024, 768);
  }

  private createHeaderUI(): void {
    this.headerUI = new HeaderUI(this, {
      x: 0,
      y: 0,
      width: 1024,
      height: 60,
    });
  }

  private createSidebarUI(): void {
    this.sidebarUI = new SidebarUI(this, {
      x: 824,
      y: 60,
      width: 200,
      height: 658,
    });
  }

  private createPhaseIndicator(): void {
    this.phaseIndicator = new PhaseIndicator(this, {
      x: 412,
      y: 743,
      phases: ['quest-accept', 'gathering', 'alchemy', 'delivery'],
      currentPhase: this.currentPhase,
    });
  }

  private createHandAndDeck(): void {
    this.handContainer = new HandContainer(this, {
      x: 50,
      y: 580,
      maxCards: 5,
      cardWidth: 100,
      cardHeight: 150,
      layout: 'horizontal',
    });

    this.deckView = new DeckView(this, {
      x: 850,
      y: 550,
      width: 150,
      height: 100,
    });
  }

  private createTestControls(): void {
    this.testPanel = this.add.container(10, 600);

    const title = this.add.text(0, 0, 'ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«', {
      fontSize: '12px',
      color: '#ffffff',
    });
    this.testPanel.add(title);

    // ãƒ•ã‚§ãƒ¼ã‚ºåˆ‡æ›¿ãƒœã‚¿ãƒ³
    const phases = ['quest-accept', 'gathering', 'alchemy', 'delivery'];
    phases.forEach((phase, index) => {
      const btn = this.createTestButton(
        index * 100,
        25,
        phase.substring(0, 8),
        () => this.showPhase(phase)
      );
      this.testPanel.add(btn);
    });

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
    const actions = [
      { label: 'ãƒ‰ãƒ­ãƒ¼', action: () => this.testDraw() },
      { label: 'AP+', action: () => this.testAddAP() },
      { label: 'Gold+', action: () => this.testAddGold() },
      { label: 'Notify', action: () => this.testNotification() },
    ];

    actions.forEach((item, index) => {
      const btn = this.createTestButton(index * 80, 55, item.label, item.action);
      this.testPanel.add(btn);
    });
  }

  private createTestButton(
    x: number,
    y: number,
    label: string,
    onClick: () => void
  ): Phaser.GameObjects.Container {
    const btn = this.add.container(x, y);

    const bg = this.add.graphics();
    bg.fillStyle(0x333366, 1);
    bg.fillRoundedRect(0, 0, 75, 25, 4);
    btn.add(bg);

    const text = this.add.text(37, 12, label, {
      fontSize: '10px',
      color: '#ffffff',
    }).setOrigin(0.5);
    btn.add(text);

    btn.setInteractive(
      new Phaser.Geom.Rectangle(0, 0, 75, 25),
      Phaser.Geom.Rectangle.Contains
    );
    btn.on('pointerdown', onClick);

    return btn;
  }

  private setTestData(): void {
    // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿
    this.headerUI.setRank('Silver');
    this.headerUI.setExp(150, 200);
    this.headerUI.setDay(5, 30);
    this.headerUI.setGold(500);
    this.headerUI.setAP(8, 10);

    // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿
    this.sidebarUI.setQuests(this.createTestQuests());
    this.sidebarUI.setInventory(this.createTestItems());

    // ãƒ‡ãƒƒã‚­ãƒ»æ‰‹æœ­
    this.deckView.setDeckCount(20);
    this.deckView.setDiscardCount(5);
    this.handContainer.setCards(this.createTestCards());
  }

  private showPhase(phase: string): void {
    // å‰ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç ´æ£„
    if (this.currentPhaseContainer) {
      this.currentPhaseContainer.destroy();
    }

    this.currentPhase = phase;
    this.phaseIndicator.setCurrentPhase(phase);

    // æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
    const bounds = { x: 12, y: 70, width: 800, height: 500 };

    switch (phase) {
      case 'quest-accept':
        this.currentPhaseContainer = new QuestAcceptContainer({
          scene: this,
          eventBus: this.eventBus,
          x: bounds.x,
          y: bounds.y,
        });
        (this.currentPhaseContainer as QuestAcceptContainer).setAvailableQuests(
          this.createTestQuests()
        );
        break;

      case 'gathering':
        this.currentPhaseContainer = new GatheringContainer({
          scene: this,
          eventBus: this.eventBus,
          x: bounds.x,
          y: bounds.y,
        });
        (this.currentPhaseContainer as GatheringContainer).setCurrentAP(8, 10);
        (this.currentPhaseContainer as GatheringContainer).setMaterialOptions(
          this.createTestMaterialOptions()
        );
        break;

      case 'alchemy':
        this.currentPhaseContainer = new AlchemyContainer({
          scene: this,
          eventBus: this.eventBus,
          x: bounds.x,
          y: bounds.y,
        });
        (this.currentPhaseContainer as AlchemyContainer).setRecipeCards(
          this.createTestRecipes() as any
        );
        (this.currentPhaseContainer as AlchemyContainer).setAvailableMaterials(
          this.createTestMaterials()
        );
        break;

      case 'delivery':
        this.currentPhaseContainer = new DeliveryContainer({
          scene: this,
          eventBus: this.eventBus,
          x: bounds.x,
          y: bounds.y,
        });
        (this.currentPhaseContainer as DeliveryContainer).setAcceptedQuests(
          this.createTestQuests()
        );
        (this.currentPhaseContainer as DeliveryContainer).setInventory(
          this.createTestItems()
        );
        break;
    }

    this.currentPhaseContainer?.enter();
  }

  // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰
  private createTestQuests(): any[] {
    return [
      { id: 'q1', name: 'è–¬è‰ã®ä¾é ¼', remainingDays: 5, difficulty: 'easy', reward: { gold: 100, exp: 20 }, requiredItems: [{ name: 'å›å¾©è–¬', quantity: 2 }] },
      { id: 'q2', name: 'çˆ†å¼¾ã®ä¾é ¼', remainingDays: 3, difficulty: 'normal', reward: { gold: 200, exp: 40 } },
      { id: 'q3', name: 'é­”æ³•è–¬ã®ä¾é ¼', remainingDays: 7, difficulty: 'hard', reward: { gold: 500, exp: 100 } },
    ];
  }

  private createTestItems(): any[] {
    return [
      { id: 'i1', name: 'å›å¾©è–¬', quality: 'normal' },
      { id: 'i2', name: 'å›å¾©è–¬', quality: 'good' },
      { id: 'i3', name: 'çˆ†å¼¾', quality: 'normal' },
    ];
  }

  private createTestCards(): any[] {
    return [
      { id: 'c1', name: 'æ£®ã®æ¡å–åœ°', type: 'gathering' },
      { id: 'c2', name: 'å›å¾©è–¬ã®ãƒ¬ã‚·ãƒ”', type: 'recipe' },
      { id: 'c3', name: 'å±±ã®æ¡å–åœ°', type: 'gathering' },
    ];
  }

  private createTestMaterialOptions(): any[] {
    return [
      { material: { id: 'm1', name: 'è–¬è‰', category: 'plant', quality: 'normal' }, quantity: 3, probability: 0.8 },
      { material: { id: 'm2', name: 'é‰„é‰±çŸ³', category: 'mineral', quality: 'normal' }, quantity: 2, probability: 0.5 },
      { material: { id: 'm3', name: 'å¸Œå°‘é‰±çŸ³', category: 'mineral', quality: 'rare' }, quantity: 1, probability: 0.1 },
    ];
  }

  private createTestRecipes(): any[] {
    return [
      { id: 'r1', name: 'å›å¾©è–¬', type: 'recipe', requiredCategories: ['plant'], requiredMaterialCount: 2 },
      { id: 'r2', name: 'çˆ†å¼¾', type: 'recipe', requiredCategories: ['mineral', 'powder'], requiredMaterialCount: 3 },
    ];
  }

  private createTestMaterials(): any[] {
    return [
      { id: 'm1', name: 'è–¬è‰', category: 'plant', quality: 'normal' },
      { id: 'm2', name: 'èµ¤ã„èŠ±', category: 'plant', quality: 'good' },
      { id: 'm3', name: 'é‰„é‰±çŸ³', category: 'mineral', quality: 'normal' },
      { id: 'm4', name: 'ç«è–¬', category: 'powder', quality: 'normal' },
    ];
  }

  // ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  private testDraw(): void {
    console.log('Draw test');
    this.eventBus.emit('ui:card:draw:requested', { count: 1 });
  }

  private testAddAP(): void {
    console.log('Add AP test');
    this.headerUI.setAP(10, 10);
  }

  private testAddGold(): void {
    console.log('Add Gold test');
    this.headerUI.setGold(1000);
  }

  private testNotification(): void {
    console.log('Notification test');
    // é€šçŸ¥ãƒ†ã‚¹ãƒˆ
  }

  protected setupEventListeners(): void {
    // ãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    this.eventBus.on('quest:accept', (data) => console.log('Quest accept:', data));
    this.eventBus.on('gathering:confirm', (data) => console.log('Gathering confirm:', data));
    this.eventBus.on('alchemy:craft', (data) => console.log('Alchemy craft:', data));
    this.eventBus.on('delivery:complete', (data) => console.log('Delivery complete:', data));
  }
}
```

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0239` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- çµ±åˆãƒ†ã‚¹ãƒˆã®ç¯„å›²è¨­å®š
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç¶²ç¾…æ€§
- Phaserã‚·ãƒ¼ãƒ³ã®ãƒ¢ãƒƒã‚¯æ–¹æ³•

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 4é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 4é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
