# TASK-0177: UIFactoryã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ç”Ÿæˆå®Ÿè£…

**ã‚¿ã‚¹ã‚¯ID**: TASK-0177
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - PhaseråŸºç›¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *å¦¥å½“ãªæ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ **: [core-systems.md](../../design/atelier-guild-rank-phaser/core-systems.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

UIFactoryã®createScrollPanel()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒªã‚¹ãƒˆè¡¨ç¤ºã‚’ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0174
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0205, TASK-0214, TASK-0240

## å®Œäº†æ¡ä»¶

- [x] createScrollPanel()ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [x] å‚ç›´ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå‹•ä½œã™ã‚‹
- [x] ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [x] ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ãã‚‹
- [x] ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å‹•çš„è¿½åŠ ãŒã§ãã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. createScrollPanelå®Ÿè£… ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUI.ScrollablePanelã‚’ä½¿ç”¨*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/UIFactory.ts`ã«è¿½åŠ 

```typescript
import ScrollablePanel from 'phaser3-rex-plugins/templates/ui/scrollablepanel/ScrollablePanel';

export interface ScrollPanelObject {
  panel: ScrollablePanel;
  addItem: (item: Phaser.GameObjects.GameObject) => void;
  removeItem: (item: Phaser.GameObjects.GameObject) => void;
  clear: () => void;
  scrollTo: (percentage: number) => void;
  refresh: () => void;
}

createScrollPanel(options: ScrollPanelOptions): ScrollPanelObject {
  const {
    x, y, width, height,
    content, scrollMode, style
  } = options;

  // èƒŒæ™¯
  const background = this.rexUI.add.roundRectangle(
    0, 0, 0, 0,
    style?.cornerRadius ?? 8,
    style?.backgroundColor ?? Colors.panelBackground
  );

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ³ãƒ†ãƒŠ
  const contentSizer = this.rexUI.add.sizer({
    orientation: scrollMode === 'horizontal' ? 'x' : 'y',
    space: { item: 8 },
  });

  // åˆæœŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ 
  if (content) {
    const items = Array.isArray(content) ? content : [content];
    items.forEach(item => contentSizer.add(item));
  }

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«
  const panel = this.rexUI.add.scrollablePanel({
    x, y,
    width, height,

    scrollMode: scrollMode === 'horizontal' ? 1 : 0,

    background,

    panel: {
      child: contentSizer,
      mask: {
        padding: 1,
      },
    },

    slider: {
      track: this.rexUI.add.roundRectangle(
        0, 0, 8, 0, 4, Colors.backgroundDark
      ),
      thumb: this.rexUI.add.roundRectangle(
        0, 0, 8, 40, 4, Colors.primary
      ),
    },

    space: {
      left: style?.padding ?? 10,
      right: style?.padding ?? 10,
      top: style?.padding ?? 10,
      bottom: style?.padding ?? 10,
      panel: 10,
    },

    mouseWheelScroller: {
      focus: false,
      speed: 0.1,
    },
  }).layout();

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  const addItem = (item: Phaser.GameObjects.GameObject) => {
    contentSizer.add(item);
    panel.layout();
  };

  const removeItem = (item: Phaser.GameObjects.GameObject) => {
    contentSizer.remove(item, true);
    panel.layout();
  };

  const clear = () => {
    contentSizer.removeAll(true);
    panel.layout();
  };

  const scrollTo = (percentage: number) => {
    panel.setT(percentage);
  };

  const refresh = () => {
    panel.layout();
  };

  return {
    panel,
    addItem,
    removeItem,
    clear,
    scrollTo,
    refresh,
  };
}

// ãƒªã‚¹ãƒˆãƒ‘ãƒãƒ«ï¼ˆä¾¿åˆ©ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
createListPanel(options: {
  x: number;
  y: number;
  width: number;
  height: number;
  items: Phaser.GameObjects.GameObject[];
  itemSpacing?: number;
}): ScrollPanelObject {
  return this.createScrollPanel({
    x: options.x,
    y: options.y,
    width: options.width,
    height: options.height,
    content: options.items,
    scrollMode: 'vertical',
    style: {
      backgroundColor: Colors.panelBackground,
      cornerRadius: 8,
      padding: 10,
    },
  });
}
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ç”Ÿæˆ ğŸŸ¡

**Given**: UIFactoryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚‹
**When**: createScrollPanel()ã‚’å‘¼ã¶
**Then**: ScrollPanelObjectãŒè¿”ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ  ğŸŸ¡

**Given**: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ãŒã‚ã‚‹
**When**: addItem()ã§ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã™ã‚‹
**Then**: ãƒ‘ãƒãƒ«å†…ã«ã‚¢ã‚¤ãƒ†ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‹•ä½œ ğŸŸ¡

**Given**: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒãƒ‘ãƒãƒ«ã‚ˆã‚Šå¤§ãã„
**When**: ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹
**Then**: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã‚Œã‚‹

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0177` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå°‘ãªã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤ºã«
- ãƒã‚¹ã‚¯å‡¦ç†ã§ãƒ‘ãƒãƒ«å¤–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éš ã™
- ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ã§ã®ã‚¹ãƒ¯ã‚¤ãƒ—å¯¾å¿œã‚’æ¤œè¨

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 1é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 1é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
