# TASK-0172: UIFactoryåŸºç›¤è¨­è¨ˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0172
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - PhaseråŸºç›¤ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *å¦¥å½“ãªæ¨æ¸¬ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [overview.md](./overview.md)
- **ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ **: [core-systems.md](../../design/atelier-guild-rank-phaser/core-systems.md)
- **UIè¨­è¨ˆ**: [ui-design/overview.md](../../design/atelier-guild-rank-phaser/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

rexUIã‚’ä½¿ç”¨ã—ãŸUIè¦ç´ ã®ç”Ÿæˆã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹UIFactoryã®åŸºç›¤ã‚’è¨­è¨ˆã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: TASK-0160
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: TASK-0173

## å®Œäº†æ¡ä»¶

- [ ] UIFactoryã‚¯ãƒ©ã‚¹ã®åŸºç›¤ãŒè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹
- [ ] å…±é€šã®UIã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] rexUIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‚ç…§æ–¹æ³•ãŒç¢ºç«‹ã•ã‚Œã¦ã„ã‚‹
- [ ] UIè¦ç´ ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. å…±é€šUIã‚ªãƒ—ã‚·ãƒ§ãƒ³å®šç¾© ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªUIãƒ‘ã‚¿ãƒ¼ãƒ³*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/UITypes.ts`

```typescript
import Phaser from 'phaser';

// åŸºæœ¬ä½ç½®ãƒ»ã‚µã‚¤ã‚º
export interface UIPosition {
  x: number;
  y: number;
}

export interface UISize {
  width: number;
  height: number;
}

export interface UIBounds extends UIPosition, UISize {}

// åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«
export interface UIBaseStyle {
  backgroundColor?: number;
  borderColor?: number;
  borderWidth?: number;
  cornerRadius?: number;
  padding?: number | { top?: number; bottom?: number; left?: number; right?: number };
}

// ãƒœã‚¿ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface ButtonOptions extends UIPosition {
  text: string;
  width?: number;
  height?: number;
  style?: UIBaseStyle;
  textStyle?: Phaser.Types.GameObjects.Text.TextStyle;
  onClick?: () => void;
  disabled?: boolean;
}

// ãƒ©ãƒ™ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface LabelOptions extends UIPosition {
  text: string;
  icon?: string;
  iconSize?: number;
  textStyle?: Phaser.Types.GameObjects.Text.TextStyle;
  orientation?: 'horizontal' | 'vertical';
  space?: number;
}

// ãƒ‘ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface PanelOptions extends UIBounds {
  style?: UIBaseStyle;
  title?: string;
  titleStyle?: Phaser.Types.GameObjects.Text.TextStyle;
}

// ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface DialogOptions {
  title: string;
  content: string | Phaser.GameObjects.GameObject;
  buttons?: Array<{
    text: string;
    onClick: () => void;
    primary?: boolean;
  }>;
  width?: number;
  modal?: boolean;
}

// ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface ProgressBarOptions extends UIPosition {
  width: number;
  height: number;
  value: number;
  maxValue: number;
  barColor?: number;
  backgroundColor?: number;
  showText?: boolean;
}

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface ScrollPanelOptions extends UIBounds {
  content: Phaser.GameObjects.GameObject | Phaser.GameObjects.GameObject[];
  scrollMode?: 'vertical' | 'horizontal' | 'both';
  style?: UIBaseStyle;
}

// ã‚°ãƒªãƒƒãƒ‰ãƒœã‚¿ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³
export interface GridButtonsOptions extends UIPosition {
  items: Array<{
    id: string;
    content: Phaser.GameObjects.GameObject | string;
    data?: unknown;
  }>;
  columns: number;
  cellWidth: number;
  cellHeight: number;
  space?: { column?: number; row?: number };
  onItemClick?: (id: string, data?: unknown) => void;
}
```

### 2. UIFactoryåŸºç›¤ã‚¯ãƒ©ã‚¹ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUIã®APIã‚’å‚è€ƒ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/UIFactory.ts`

```typescript
import Phaser from 'phaser';
import RexUIPlugin from 'phaser3-rex-plugins/templates/ui/ui-plugin';
import { Colors } from '../config/ColorPalette';
import { TextStyles } from '../config/TextStyles';
import {
  ButtonOptions,
  LabelOptions,
  PanelOptions,
  DialogOptions,
  ProgressBarOptions,
  ScrollPanelOptions,
  GridButtonsOptions,
} from './UITypes';

export class UIFactory {
  constructor(
    private scene: Phaser.Scene,
    private rexUI: RexUIPlugin
  ) {}

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«
  private getDefaultButtonStyle(): object {
    return {
      background: this.scene.add.rectangle(0, 0, 1, 1, Colors.primary),
      text: this.scene.add.text(0, 0, '', TextStyles.button),
      space: { left: 20, right: 20, top: 10, bottom: 10 },
    };
  }

  // å„createãƒ¡ã‚½ãƒƒãƒ‰ã¯å¾Œç¶šã‚¿ã‚¹ã‚¯ã§å®Ÿè£…
  createButton(options: ButtonOptions): any {
    throw new Error('Not implemented - see TASK-0173');
  }

  createLabel(options: LabelOptions): any {
    throw new Error('Not implemented - see TASK-0174');
  }

  createDialog(options: DialogOptions): any {
    throw new Error('Not implemented - see TASK-0175');
  }

  createProgressBar(options: ProgressBarOptions): any {
    throw new Error('Not implemented - see TASK-0176');
  }

  createScrollPanel(options: ScrollPanelOptions): any {
    throw new Error('Not implemented - see TASK-0177');
  }

  createGridButtons(options: GridButtonsOptions): any {
    throw new Error('Not implemented - see TASK-0178');
  }

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰
  protected createRoundedRect(
    x: number,
    y: number,
    width: number,
    height: number,
    color: number,
    radius: number = 8
  ): Phaser.GameObjects.Graphics {
    const graphics = this.scene.add.graphics();
    graphics.fillStyle(color);
    graphics.fillRoundedRect(x - width/2, y - height/2, width, height, radius);
    return graphics;
  }
}
```

### 3. UIFactoryã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/phaser/ui/index.ts`

```typescript
export { UIFactory } from './UIFactory';
export * from './UITypes';
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: UIFactoryç”Ÿæˆ ğŸŸ¡

**Given**: ã‚·ãƒ¼ãƒ³ã¨rexUIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‹
**When**: UIFactoryã‚’ç”Ÿæˆã™ã‚‹
**Then**: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ­£å¸¸ã«ç”Ÿæˆã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: å‹å®šç¾©ãƒã‚§ãƒƒã‚¯ ğŸŸ¡

**Given**: UITypesãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
**When**: å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹
**Then**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„

---

## å®Ÿè£…æ‰‹é †

1. `/tsumiki:tdd-requirements TASK-0172` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- rexUIã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆAPIã‚’ç¢ºèª
- å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ã¯ä¸€ç®‡æ‰€ã§ç®¡ç†
- æ‹¡å¼µæ€§ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆ

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

- **ç·é …ç›®æ•°**: 3é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 3é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: ä¸­å“è³ª
