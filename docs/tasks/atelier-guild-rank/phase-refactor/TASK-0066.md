# TASK-0066: shared/servicesä½œæˆï¼ˆEventBus, StateManagerç§»è¡Œï¼‰

## åŸºæœ¬æƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0066 |
| **ã‚¿ã‚¹ã‚¯å** | shared/servicesä½œæˆï¼ˆEventBus, StateManagerç§»è¡Œï¼‰ |
| **è¦‹ç©æ™‚é–“** | 4æ™‚é–“ |
| **ä¾å­˜ã‚¿ã‚¹ã‚¯** | TASK-0064 |
| **é–‹ç™ºã‚¿ã‚¤ãƒ—** | TDD |
| **ãƒ•ã‚§ãƒ¼ã‚º** | Phase 2 - sharedç§»è¡Œ |
| **çŠ¶æ…‹** | âœ… å®Œäº† |

---

## æ¦‚è¦

### èƒŒæ™¯

EventBusã¨StateManagerã¯è¤‡æ•°ã®æ©Ÿèƒ½ã‹ã‚‰ä½¿ç”¨ã•ã‚Œã‚‹ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚Šã€shared/servicesã«é…ç½®ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹ã€‚.claude/rules/architecture.mdã®è¨­è¨ˆæ–¹é‡ã«åŸºã¥ãã€ã“ã‚Œã‚‰ã‚’sharedå±¤ã«ç§»å‹•ã™ã‚‹ã€‚

### ç›®çš„

EventBusã¨StateManagerã‚’src/shared/services/ã«ç§»å‹•ã—ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’æ›´æ–°ã™ã‚‹ã€‚

### ç¾çŠ¶

- EventBus: `src/application/events/`
- StateManager: `src/application/services/state-manager.ts`

---

## è¦ä»¶

### æ©Ÿèƒ½è¦ä»¶

| è¦ä»¶ID | è¦ä»¶ | ä¿¡é ¼æ€§ |
|--------|------|--------|
| REQ-066-01 | EventBusã‚’src/shared/services/event-bus/ã«ç§»å‹•ã™ã‚‹ | ğŸ”µ |
| REQ-066-02 | StateManagerã‚’src/shared/services/state-manager/ã«ç§»å‹•ã™ã‚‹ | ğŸ”µ |
| REQ-066-03 | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚‚ä¸€ç·’ã«ç§»å‹•ã™ã‚‹ | ğŸ”µ |
| REQ-066-04 | ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’@shared/servicesã«æ›´æ–°ã™ã‚‹ | ğŸ”µ |
| REQ-066-05 | æ—§ãƒ‘ã‚¹ã‹ã‚‰ã®å‚ç…§ã‚’å…¨ã¦æ›´æ–°ã™ã‚‹ | ğŸ”µ |

### éæ©Ÿèƒ½è¦ä»¶

| è¦ä»¶ID | è¦ä»¶ |
|--------|------|
| NFR-066-01 | æ—¢å­˜ã®EventBus, StateManagerãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ |
| NFR-066-02 | å¾ªç’°å‚ç…§ãŒç™ºç”Ÿã—ãªã„ã“ã¨ |
| NFR-066-03 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ãŒãªã„ã“ã¨ |

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### EventBusç§»è¡Œãƒ†ã‚¹ãƒˆ

```typescript
describe('shared/services/event-bus', () => {
  describe('ç§»è¡Œç¢ºèª', () => {
    it('@shared/services/event-busã‹ã‚‰EventBusãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã“ã¨', () => {});
    it('æ—¢å­˜ã®å…¨EventBusãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨', () => {});
  });

  describe('æ©Ÿèƒ½ç¢ºèª', () => {
    it('ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ãƒ»ç™ºç«ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨', () => {});
    it('ã‚¤ãƒ™ãƒ³ãƒˆè§£é™¤ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨', () => {});
  });
});
```

### StateManagerç§»è¡Œãƒ†ã‚¹ãƒˆ

```typescript
describe('shared/services/state-manager', () => {
  describe('ç§»è¡Œç¢ºèª', () => {
    it('@shared/services/state-managerã‹ã‚‰StateManagerãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã“ã¨', () => {});
    it('æ—¢å­˜ã®å…¨StateManagerãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨', () => {});
  });

  describe('æ©Ÿèƒ½ç¢ºèª', () => {
    it('çŠ¶æ…‹å–å¾—ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨', () => {});
    it('çŠ¶æ…‹æ›´æ–°ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨', () => {});
  });
});
```

---

## å®Ÿè£…è¨ˆç”»

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆï¼ˆ30åˆ†ï¼‰

1. src/shared/services/event-bus/ä½œæˆ
2. src/shared/services/state-manager/ä½œæˆ
3. index.tsãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—2: EventBusç§»è¡Œï¼ˆ1.5æ™‚é–“ï¼‰

1. EventBusãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
2. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã®ç§»å‹•
3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹æ›´æ–°
4. æ—§ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—3: StateManagerç§»è¡Œï¼ˆ1.5æ™‚é–“ï¼‰

1. StateManagerãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
2. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã®ç§»å‹•
3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹æ›´æ–°
4. æ—§ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ç¢ºèªï¼ˆ30åˆ†ï¼‰

1. æ—¢å­˜ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
2. ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ã®ç¢ºèªãƒ»ä¿®æ­£
3. å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹ã®ç¢ºèª

---

## ç§»è¡Œå¾Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/shared/services/
â”œâ”€â”€ event-bus/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ EventBus.ts
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ state-manager/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ StateManager.ts
â”‚   â””â”€â”€ types.ts
â””â”€â”€ index.ts
```

---

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

### ç§»è¡Œå…ƒ

- `src/application/events/` â†’ `src/shared/services/event-bus/`
- `src/application/services/state-manager.ts` â†’ `src/shared/services/state-manager/`

### æ›´æ–°å¯¾è±¡

- EventBus, StateManagerã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å…¨ãƒ•ã‚¡ã‚¤ãƒ«
- tsconfig.jsonã®ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®š

---

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [x] EventBusãŒsrc/shared/services/event-bus/ã«ç§»å‹•ã•ã‚Œã¦ã„ã‚‹
- [x] StateManagerãŒsrc/shared/services/state-manager/ã«ç§»å‹•ã•ã‚Œã¦ã„ã‚‹
- [x] @shared/servicesãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹
- [x] æ—¢å­˜ã®EventBus, StateManagerãƒ†ã‚¹ãƒˆãŒå…¨ã¦ãƒ‘ã‚¹ã™ã‚‹
- [x] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ï¼ˆ1632ä»¶ãƒ‘ã‚¹ã€4ä»¶ã‚¹ã‚­ãƒƒãƒ—ï¼‰
- [x] `pnpm lint`ãŒã‚¨ãƒ©ãƒ¼ãªã—ã§å®Œäº†ã™ã‚‹ï¼ˆæ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **TASK-0064**: shared/typesç§»è¡Œã¨æ•´ç†
- **è¨­è¨ˆæ–‡æ›¸**: `.claude/rules/architecture.md`

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| æ©Ÿèƒ½è¦ä»¶ | 5 | 0 | 0 | 5 |
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | 0 | 0 | 0 | 0 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 5é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 5é …ç›® (100%) - .claude/rules/architecture.mdã«åŸºã¥ã
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: è‰¯å¥½ï¼ˆè¨­è¨ˆæ–‡æ›¸ã«åŸºã¥ãæ˜ç¢ºãªç§»è¡Œæ–¹é‡ï¼‰

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2026-02-09 | åˆç‰ˆä½œæˆ |
| 2026-02-11 | å®Ÿè£…å®Œäº†ï¼ˆTASK-0066ï¼‰ |
