# TASK-0076: features/alchemy/typesä½œæˆ

**ã‚¿ã‚¹ã‚¯ID**: TASK-0076
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 5 - features/alchemyæ©Ÿèƒ½
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *æ—¢å­˜å®Ÿè£…ã«åŸºã¥ã*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](../overview.md)
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

èª¿åˆæ©Ÿèƒ½ã®å‹å®šç¾©ã‚’ä½œæˆã™ã‚‹ã€‚æ—¢å­˜ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«æ•£åœ¨ã™ã‚‹èª¿åˆé–¢é€£ã®å‹ã‚’ features/alchemy/types ã«é›†ç´„ã—ã€ä¸€å…ƒç®¡ç†ã‚’å®Ÿç¾ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0064](../phase-refactor/TASK-0064.md)
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0077](TASK-0077.md)

## å®Œäº†æ¡ä»¶

- [ ] IAlchemyService ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒ features/alchemy/types ã«ç§»å‹•ã•ã‚Œã¦ã„ã‚‹
- [ ] Recipe, CraftedItem é–¢é€£ã®å‹ãŒç§»å‹•ã•ã‚Œã¦ã„ã‚‹
- [ ] Quality, Grade å‹ãŒç§»å‹•ã•ã‚Œã¦ã„ã‚‹
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šéã™ã‚‹
- [ ] å‹ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. IAlchemyService ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç§»å‹• ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜å®Ÿè£…ã«åŸºã¥ã*

æ—¢å­˜ã® `src/domain/services/interfaces/IAlchemyService.ts` ã‚’ç§»å‹•ã™ã‚‹ã€‚

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/alchemy/types/IAlchemyService.ts`

```typescript
import type { Material, CraftedItem, Recipe, Quality, Grade } from './index';

export interface IAlchemyService {
  craft(recipe: Recipe, materials: Material[]): CraftedItem;
  calculateQuality(materials: Material[]): Quality;
  calculateAttributes(materials: Material[]): Record<string, number>;
  getAvailableRecipes(): Recipe[];
}
```

### 2. Recipe, CraftedItem å‹å®šç¾© ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜å®Ÿè£…ã«åŸºã¥ã*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/alchemy/types/recipe.ts`

```typescript
import type { Material } from '@features/materials/types';
import type { Quality, Grade } from './quality';

export interface Recipe {
  id: string;
  name: string;
  description: string;
  requiredMaterials: MaterialRequirement[];
  resultItemId: string;
  unlockRank: number;
}

export interface MaterialRequirement {
  materialType: string;
  quantity: number;
  minQuality?: Quality;
}

export interface CraftedItem {
  id: string;
  recipeId: string;
  name: string;
  quality: Quality;
  grade: Grade;
  attributes: Record<string, number>;
  createdAt: number;
}
```

### 3. Quality, Grade å‹å®šç¾© ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜å®Ÿè£…ã«åŸºã¥ã*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/alchemy/types/quality.ts`

```typescript
export type Quality = 'E' | 'D' | 'C' | 'B' | 'A' | 'S';

export type Grade = 1 | 2 | 3 | 4 | 5;

export interface QualityConfig {
  quality: Quality;
  minScore: number;
  maxScore: number;
  multiplier: number;
}

export const QUALITY_THRESHOLDS: Record<Quality, number> = {
  E: 0,
  D: 20,
  C: 40,
  B: 60,
  A: 80,
  S: 95,
};
```

### 4. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ¨™æº–çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/alchemy/types/index.ts`

```typescript
export type { IAlchemyService } from './IAlchemyService';
export type { Recipe, MaterialRequirement, CraftedItem } from './recipe';
export type { Quality, Grade, QualityConfig } from './quality';
export { QUALITY_THRESHOLDS } from './quality';
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: å‹ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç¢ºèª ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: features/alchemy/types/index.ts
**When**: å„å‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
**Then**: å‹ã‚¨ãƒ©ãƒ¼ãªãã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/unit/features/alchemy/types/index.test.ts`

```typescript
describe('features/alchemy/types', () => {
  it('should export IAlchemyService interface', () => {
    // å‹ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
  });

  it('should export Recipe and CraftedItem types', () => {
    // å‹ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
  });

  it('should export Quality and Grade types', () => {
    // å‹ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
  });
});
```

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: QUALITY_THRESHOLDS å®šæ•°ãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ—¢å­˜å®Ÿè£…ã«åŸºã¥ã*

**Given**: QUALITY_THRESHOLDS å®šæ•°
**When**: å„å“è³ªãƒ¬ãƒ™ãƒ«ã®é–¾å€¤ã‚’å‚ç…§
**Then**: æœŸå¾…ã™ã‚‹é–¾å€¤ãŒè¿”ã•ã‚Œã‚‹

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0076` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- æ—¢å­˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’æ®µéšçš„ã«æ›´æ–°ã™ã‚‹ã“ã¨
- å¾ªç’°å‚ç…§ã‚’é¿ã‘ã‚‹ãŸã‚ã€ä¾å­˜é–¢ä¿‚ã«æ³¨æ„ã™ã‚‹ã“ã¨
- å‹ã®ã¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯ `export type` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| å®Ÿè£…è©³ç´° | 4 | 0 | 0 | 4 |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | 2 | 0 | 0 | 2 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 6é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 6é …ç›® (100%)
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜ä¿¡é ¼æ€§ï¼ˆæ—¢å­˜å®Ÿè£…ã«åŸºã¥ãç§»è¡Œã‚¿ã‚¹ã‚¯ï¼‰
