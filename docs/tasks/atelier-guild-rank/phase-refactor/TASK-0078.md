# TASK-0078: features/alchemy/components作成

**タスクID**: TASK-0078
**タスクタイプ**: TDD
**推定工数**: 4時間
**フェーズ**: Phase 5 - features/alchemy機能
**信頼性レベル**: 🔵 *既存実装に基づく*

## 関連文書

- **概要**: [📋 overview.md](../overview.md)
- **設計文書**: [📐 architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

## タスク概要

調合関連UIコンポーネントを features/alchemy/components に移動する。既存の調合フェーズUIを整理し、再利用可能なコンポーネントとして構成する。

## 依存タスク

- **前提タスク**: [TASK-0067](../phase-refactor/TASK-0067.md), [TASK-0077](TASK-0077.md)
- **後続タスク**: [TASK-0079](TASK-0079.md)

## 完了条件

- [ ] RecipeListUI コンポーネントが移動されている
- [ ] 調合フェーズUI関連が整理されている
- [ ] 共通UIユーティリティを使用している
- [ ] 既存テストが全て通過する
- [ ] 新規コンポーネントのテストカバレッジが80%以上

---

## 実装詳細

### 1. RecipeListUI コンポーネント移動 🔵

**信頼性**: 🔵 *既存実装に基づく*

既存のレシピ一覧表示コンポーネントを移動する。

**実装ファイル**: `src/features/alchemy/components/RecipeListUI.ts`

```typescript
import type { Recipe } from '../types';
import { UIBackgroundBuilder } from '@presentation/ui/utils';
import { Colors } from '@presentation/theme';

export interface RecipeListUIConfig {
  x: number;
  y: number;
  width: number;
  height: number;
  onRecipeSelect?: (recipe: Recipe) => void;
}

export class RecipeListUI {
  private scene: Phaser.Scene;
  private container: Phaser.GameObjects.Container;
  private recipes: Recipe[] = [];
  private config: RecipeListUIConfig;

  constructor(scene: Phaser.Scene, config: RecipeListUIConfig) {
    this.scene = scene;
    this.config = config;
    this.create();
  }

  private create(): void {
    this.container = this.scene.add.container(this.config.x, this.config.y);
    this.createBackground();
  }

  private createBackground(): void {
    const bg = new UIBackgroundBuilder(this.scene)
      .setSize(this.config.width, this.config.height)
      .setFill(Colors.background.panel)
      .build();
    this.container.add(bg);
  }

  setRecipes(recipes: Recipe[]): void {
    this.recipes = recipes;
    this.renderRecipes();
  }

  private renderRecipes(): void {
    // レシピ一覧の描画
  }

  destroy(): void {
    this.container.destroy();
  }
}
```

### 2. RecipeCardUI コンポーネント作成 🔵

**信頼性**: 🔵 *既存実装に基づく*

個別のレシピカード表示コンポーネントを作成する。

**実装ファイル**: `src/features/alchemy/components/RecipeCardUI.ts`

```typescript
import type { Recipe } from '../types';
import { UIBackgroundBuilder, applyHoverAnimation } from '@presentation/ui/utils';
import { Colors, AnimationPresets } from '@presentation/theme';

export interface RecipeCardUIConfig {
  x: number;
  y: number;
  width: number;
  height: number;
  onClick?: () => void;
}

export class RecipeCardUI {
  private scene: Phaser.Scene;
  private container: Phaser.GameObjects.Container;
  private recipe: Recipe;

  constructor(scene: Phaser.Scene, recipe: Recipe, config: RecipeCardUIConfig) {
    this.scene = scene;
    this.recipe = recipe;
    this.create(config);
  }

  private create(config: RecipeCardUIConfig): void {
    this.container = this.scene.add.container(config.x, config.y);

    const bg = new UIBackgroundBuilder(this.scene)
      .setSize(config.width, config.height)
      .setFill(Colors.background.card)
      .setBorder(Colors.border.primary)
      .build();

    this.container.add(bg);
    this.createContent();
    this.setupInteraction(config);
  }

  private createContent(): void {
    // レシピ名、説明、必要素材の表示
  }

  private setupInteraction(config: RecipeCardUIConfig): void {
    this.container.setInteractive();
    applyHoverAnimation(this.container, this.scene, AnimationPresets.card.select);

    if (config.onClick) {
      this.container.on('pointerdown', config.onClick);
    }
  }

  destroy(): void {
    this.container.destroy();
  }
}
```

### 3. CraftingUI コンポーネント作成 🔵

**信頼性**: 🔵 *既存実装に基づく*

調合実行画面のメインコンポーネントを作成する。

**実装ファイル**: `src/features/alchemy/components/CraftingUI.ts`

```typescript
import type { Recipe, Material, CraftedItem } from '../types';
import { craft } from '../services';

export interface CraftingUIConfig {
  x: number;
  y: number;
  width: number;
  height: number;
  onCraftComplete?: (item: CraftedItem) => void;
}

export class CraftingUI {
  private scene: Phaser.Scene;
  private container: Phaser.GameObjects.Container;
  private selectedRecipe: Recipe | null = null;
  private selectedMaterials: Material[] = [];

  constructor(scene: Phaser.Scene, config: CraftingUIConfig) {
    this.scene = scene;
    this.create(config);
  }

  setRecipe(recipe: Recipe): void {
    this.selectedRecipe = recipe;
    this.updateDisplay();
  }

  addMaterial(material: Material): void {
    this.selectedMaterials.push(material);
    this.updateDisplay();
  }

  removeMaterial(index: number): void {
    this.selectedMaterials.splice(index, 1);
    this.updateDisplay();
  }

  private updateDisplay(): void {
    // 表示更新
  }

  destroy(): void {
    this.container.destroy();
  }
}
```

### 4. インデックスファイル作成 🔵

**信頼性**: 🔵 *標準的な実装パターン*

**実装ファイル**: `src/features/alchemy/components/index.ts`

```typescript
export { RecipeListUI } from './RecipeListUI';
export type { RecipeListUIConfig } from './RecipeListUI';
export { RecipeCardUI } from './RecipeCardUI';
export type { RecipeCardUIConfig } from './RecipeCardUI';
export { CraftingUI } from './CraftingUI';
export type { CraftingUIConfig } from './CraftingUI';
```

---

## 単体テスト要件

### テストケース1: RecipeListUI テスト 🔵

**信頼性**: 🔵 *既存実装に基づく*

**テストファイル**: `tests/unit/features/alchemy/components/RecipeListUI.test.ts`

```typescript
describe('RecipeListUI', () => {
  it('should create container at specified position', () => {
    // テスト実装
  });

  it('should render recipes when setRecipes is called', () => {
    // テスト実装
  });

  it('should call onRecipeSelect when recipe is clicked', () => {
    // テスト実装
  });
});
```

### テストケース2: RecipeCardUI テスト 🔵

**信頼性**: 🔵 *既存実装に基づく*

**Given**: RecipeCardUI インスタンス
**When**: ホバー時
**Then**: ホバーアニメーションが再生される

### テストケース3: CraftingUI テスト 🔵

**信頼性**: 🔵 *既存実装に基づく*

**Given**: CraftingUI インスタンス
**When**: 素材を追加
**Then**: 表示が更新される

---

## 実装手順

### TDDタスクの場合

1. `/tsumiki:tdd-requirements TASK-0078` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- 共通UIユーティリティ（TASK-0067）を積極的に使用すること
- Phaser.Scene への依存を最小限にすること
- コンポーネントのライフサイクル（destroy）を正しく実装すること

---

## 信頼性レベルサマリー

### 項目別信頼性

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 4 | 0 | 0 | 4 |
| 単体テスト | 3 | 0 | 0 | 3 |

### 全体評価

- **総項目数**: 7項目
- 🔵 **青信号**: 7項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: 高信頼性（既存実装に基づく移行タスク）
