# TASK-0095: scenes/MainScene移行

## 基本情報

| 項目 | 値 |
|------|-----|
| **タスクID** | TASK-0095 |
| **タスク名** | scenes/MainScene移行 |
| **見積時間** | 4時間 |
| **依存タスク** | TASK-0094, TASK-0071, TASK-0075, TASK-0079, TASK-0083 |
| **開発タイプ** | TDD |
| **フェーズ** | Phase 10 - scenes移行 |
| **状態** | 🔲 未着手 |

---

## 概要

### 背景

MainSceneはゲームの中核となるシーンであり、依頼受注→採取→調合→納品の4フェーズを管理している。Feature-Based Architectureへの移行に伴い、各機能を@features経由でインポートする構造に変更する。

### 目的

MainSceneを新しいfeatures構造に対応させ、Imperative Shellとして副作用処理を集約する。

### 現状

- src/presentation/scenes/MainScene.ts にMainSceneが存在
- 各フェーズの処理が直接記述されている

---

## 要件

### 機能要件

| 要件ID | 要件 | 信頼性 |
|--------|------|--------|
| REQ-095-01 | MainScene.tsをsrc/scenes/に移行する | 🔵 |
| REQ-095-02 | 各フェーズUIを@features経由でインポートする | 🔵 |
| REQ-095-03 | Imperative Shellとして副作用処理を集約する | 🔵 |
| REQ-095-04 | 4フェーズ（依頼受注→採取→調合→納品）が正常に動作する | 🔵 |

### 非機能要件

| 要件ID | 要件 |
|--------|------|
| NFR-095-01 | 既存のテストがすべてパスすること |
| NFR-095-02 | ゲームプレイが正常に動作すること |
| NFR-095-03 | FCIS原則（Functional Core, Imperative Shell）に準拠すること |

---

## テストケース

### MainScene統合テスト

```typescript
describe('MainScene', () => {
  describe('フェーズ管理', () => {
    it('依頼受注フェーズが正常に動作すること', () => {});
    it('採取フェーズが正常に動作すること', () => {});
    it('調合フェーズが正常に動作すること', () => {});
    it('納品フェーズが正常に動作すること', () => {});
  });

  describe('フェーズ遷移', () => {
    it('依頼受注→採取に遷移すること', () => {});
    it('採取→調合に遷移すること', () => {});
    it('調合→納品に遷移すること', () => {});
    it('納品後に次のターンが開始すること', () => {});
  });

  describe('features連携', () => {
    it('@features/questの機能が利用できること', () => {});
    it('@features/gatheringの機能が利用できること', () => {});
    it('@features/alchemyの機能が利用できること', () => {});
    it('@features/inventoryの機能が利用できること', () => {});
  });
});
```

---

## 実装計画

### ステップ1: MainScene移行準備（1時間）

1. 現在のMainSceneの構造を分析
2. @features経由のインポートパスを設計
3. 副作用処理の特定

### ステップ2: MainScene移行（2時間）

1. src/presentation/scenes/MainScene.ts → src/scenes/MainScene.ts
2. 各フェーズUIを@features経由でインポート
3. Imperative Shellパターンに従って副作用処理を集約

### ステップ3: 統合テスト（1時間）

1. MainSceneの統合テスト作成/更新
2. 全フェーズの動作確認
3. features連携テスト

---

## 対象ファイル

- `src/presentation/scenes/MainScene.ts` → `src/scenes/MainScene.ts`
- `src/scenes/index.ts` - エクスポート更新

---

## 受け入れ条件

- [ ] src/scenes/MainScene.tsが作成されている
- [ ] 各フェーズUIが@features経由でインポートされている
- [ ] Imperative Shellとして副作用処理が集約されている
- [ ] 4フェーズすべてが正常に動作する
- [ ] MainSceneの統合テストがパスする
- [ ] `pnpm lint`がエラーなしで完了する

---

## 関連ドキュメント

- **TASK-0094**: BootScene移行（依存）
- **TASK-0071**: features/gathering移行（依存）
- **TASK-0075**: features/alchemy移行（依存）
- **TASK-0079**: features/deck移行（依存）
- **TASK-0083**: features/inventory移行（依存）
- **設計文書**: `.claude/rules/architecture.md`

---

## 信頼性レベルサマリー

### 項目別信頼性

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 機能要件 | 4 | 0 | 0 | 4 |
| テストケース | 0 | 0 | 0 | 0 |

### 全体評価

- **総項目数**: 4項目
- 🔵 **青信号**: 4項目 (100%) - FCIS原則に基づく
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: 良好（FCIS原則に準拠した設計）

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-02-09 | 初版作成 |
