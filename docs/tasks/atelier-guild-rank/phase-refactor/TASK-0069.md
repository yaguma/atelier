# TASK-0069: features/deck/servicesä½œæˆï¼ˆDeckServiceç´”ç²‹é–¢æ•°åŒ–ï¼‰

## åŸºæœ¬æƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0069 |
| **ã‚¿ã‚¹ã‚¯å** | features/deck/servicesä½œæˆï¼ˆDeckServiceç´”ç²‹é–¢æ•°åŒ–ï¼‰ |
| **è¦‹ç©æ™‚é–“** | 4æ™‚é–“ |
| **ä¾å­˜ã‚¿ã‚¹ã‚¯** | TASK-0068 |
| **é–‹ç™ºã‚¿ã‚¤ãƒ—** | TDD |
| **ãƒ•ã‚§ãƒ¼ã‚º** | Phase 3 - features/deckæ©Ÿèƒ½ |
| **çŠ¶æ…‹** | âœ… å®Œäº† |

---

## æ¦‚è¦

### èƒŒæ™¯

Functional Core, Imperative Shellï¼ˆFCISï¼‰åŸå‰‡ã«å¾“ã„ã€DeckServiceã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å†å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚å‰¯ä½œç”¨ã‚’æŒã¤å‡¦ç†ã‚’ã‚·ãƒ¼ãƒ³å´ã«ç§»å‹•ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

### ç›®çš„

DeckServiceã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦`src/features/deck/services/`ã«å†å®Ÿè£…ã—ã€å‰¯ä½œç”¨ã‚’åˆ†é›¢ã™ã‚‹ã€‚

### ç¾çŠ¶

- DeckService: `src/domain/services/DeckService.ts`
- çŠ¶æ…‹å¤‰æ›´ã‚’å«ã‚€ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨

---

## è¦ä»¶

### æ©Ÿèƒ½è¦ä»¶

| è¦ä»¶ID | è¦ä»¶ | ä¿¡é ¼æ€§ |
|--------|------|--------|
| REQ-069-01 | shuffleé–¢æ•°ã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ | ğŸ”µ |
| REQ-069-02 | drawé–¢æ•°ã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ | ğŸ”µ |
| REQ-069-03 | playCardé–¢æ•°ã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ | ğŸ”µ |
| REQ-069-04 | å‰¯ä½œç”¨ã‚’æŒã¤å‡¦ç†ã¯ã‚·ãƒ¼ãƒ³å´ã«ç§»å‹•ã™ã‚‹ | ğŸ”µ |

### éæ©Ÿèƒ½è¦ä»¶

| è¦ä»¶ID | è¦ä»¶ |
|--------|------|
| NFR-069-01 | ç´”ç²‹é–¢æ•°ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒ80%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æŒã¤ã“ã¨ |
| NFR-069-02 | åŒã˜å…¥åŠ›ã«å¯¾ã—ã¦å¸¸ã«åŒã˜å‡ºåŠ›ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ |
| NFR-069-03 | å¤–éƒ¨çŠ¶æ…‹ã«ä¾å­˜ã—ãªã„ã“ã¨ |

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### ç´”ç²‹é–¢æ•°ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
describe('features/deck/services', () => {
  describe('shuffle', () => {
    it('åŒã˜ã‚·ãƒ¼ãƒ‰å€¤ã§åŒã˜çµæœãŒè¿”ã•ã‚Œã‚‹ã“ã¨', () => {});
    it('å…¥åŠ›é…åˆ—ã‚’å¤‰æ›´ã—ãªã„ã“ã¨ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰', () => {});
    it('å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰ãŒçµæœã«å«ã¾ã‚Œã‚‹ã“ã¨', () => {});
  });

  describe('draw', () => {
    it('æŒ‡å®šæšæ•°ã®ã‚«ãƒ¼ãƒ‰ã‚’å–å¾—ã§ãã‚‹ã“ã¨', () => {});
    it('å…ƒã®ãƒ‡ãƒƒã‚­ã¨æ®‹ã‚Šãƒ‡ãƒƒã‚­ã‚’è¿”ã™ã“ã¨', () => {});
    it('ãƒ‡ãƒƒã‚­ãŒç©ºã®å ´åˆç©ºé…åˆ—ã‚’è¿”ã™ã“ã¨', () => {});
  });

  describe('playCard', () => {
    it('æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ãŸæ–°ã—ã„çŠ¶æ…‹ã‚’è¿”ã™ã“ã¨', () => {});
    it('å…¥åŠ›çŠ¶æ…‹ã‚’å¤‰æ›´ã—ãªã„ã“ã¨ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰', () => {});
    it('å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ã®å ´åˆã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã“ã¨', () => {});
  });
});
```

---

## å®Ÿè£…è¨ˆç”»

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ1æ™‚é–“ï¼‰

1. shuffleé–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
2. drawé–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. playCardé–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—2: ç´”ç²‹é–¢æ•°å®Ÿè£…ï¼ˆ2æ™‚é–“ï¼‰

1. shuffleé–¢æ•°ã®å®Ÿè£…ï¼ˆã‚·ãƒ¼ãƒ‰å€¤å¯¾å¿œï¼‰
2. drawé–¢æ•°ã®å®Ÿè£…ï¼ˆã‚¿ãƒ—ãƒ«è¿”å´ï¼‰
3. playCardé–¢æ•°ã®å®Ÿè£…

### ã‚¹ãƒ†ãƒƒãƒ—3: å‰¯ä½œç”¨åˆ†é›¢ï¼ˆ1æ™‚é–“ï¼‰

1. æ—¢å­˜DeckServiceã®å‰¯ä½œç”¨ã‚’ç‰¹å®š
2. ã‚·ãƒ¼ãƒ³å´ã¸ã®ç§»å‹•è¨ˆç”»ä½œæˆ
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

---

## å®Ÿè£…è©³ç´°

### shuffleé–¢æ•°

```typescript
/**
 * ãƒ‡ãƒƒã‚­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ç´”ç²‹é–¢æ•°
 * @param deck ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¯¾è±¡ã®ãƒ‡ãƒƒã‚­
 * @param seed ä¹±æ•°ã‚·ãƒ¼ãƒ‰ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
 * @returns ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚ŒãŸæ–°ã—ã„ãƒ‡ãƒƒã‚­
 */
export function shuffle<T>(deck: readonly T[], seed?: number): T[] {
  // Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
}
```

### drawé–¢æ•°

```typescript
/**
 * ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãç´”ç²‹é–¢æ•°
 * @param deck ç¾åœ¨ã®ãƒ‡ãƒƒã‚­
 * @param count å¼•ãæšæ•°
 * @returns [å¼•ã„ãŸã‚«ãƒ¼ãƒ‰, æ®‹ã‚Šã®ãƒ‡ãƒƒã‚­]
 */
export function draw<T>(
  deck: readonly T[],
  count: number
): [drawnCards: T[], remainingDeck: T[]] {
  // å®Ÿè£…
}
```

### playCardé–¢æ•°

```typescript
/**
 * ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤ã™ã‚‹ç´”ç²‹é–¢æ•°
 * @param state ç¾åœ¨ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 * @param cardId ãƒ—ãƒ¬ã‚¤ã™ã‚‹ã‚«ãƒ¼ãƒ‰ID
 * @returns æ–°ã—ã„ã‚²ãƒ¼ãƒ çŠ¶æ…‹ï¼ˆResultå‹ï¼‰
 */
export function playCard(
  state: DeckState,
  cardId: string
): Result<DeckState, PlayCardError> {
  // å®Ÿè£…
}
```

---

## ç§»è¡Œå¾Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/features/deck/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ shuffle.ts
â”‚   â”œâ”€â”€ draw.ts
â”‚   â””â”€â”€ play-card.ts
â””â”€â”€ index.ts
```

---

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

### ä½œæˆ

- `src/features/deck/services/shuffle.ts`
- `src/features/deck/services/draw.ts`
- `src/features/deck/services/play-card.ts`
- `src/features/deck/services/index.ts`

### æ›´æ–°å¯¾è±¡

- DeckServiceã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚·ãƒ¼ãƒ³ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [x] shuffle, draw, playCardãŒç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [x] ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ80%ä»¥ä¸Šã§ã‚ã‚‹
- [x] å‰¯ä½œç”¨ã‚’æŒã¤å‡¦ç†ãŒç‰¹å®šãƒ»åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹
- [x] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [x] `pnpm lint`ãŒã‚¨ãƒ©ãƒ¼ãªã—ã§å®Œäº†ã™ã‚‹

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **TASK-0068**: features/deck/typesä½œæˆ
- **è¨­è¨ˆæ–‡æ›¸**: `.claude/rules/architecture.md` FCISåŸå‰‡

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| æ©Ÿèƒ½è¦ä»¶ | 4 | 0 | 0 | 4 |
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | 0 | 0 | 0 | 0 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 4é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 4é …ç›® (100%) - .claude/rules/architecture.md FCISã«åŸºã¥ã
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: è‰¯å¥½ï¼ˆè¨­è¨ˆæ–‡æ›¸ã«åŸºã¥ãæ˜ç¢ºãªå®Ÿè£…æ–¹é‡ï¼‰

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2026-02-09 | åˆç‰ˆä½œæˆ |
| 2026-02-11 | ã‚¿ã‚¹ã‚¯å®Œäº†ï¼ˆPR #150 ãƒãƒ¼ã‚¸ï¼‰ |
