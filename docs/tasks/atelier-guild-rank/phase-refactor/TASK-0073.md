# TASK-0073: features/gathering/servicesä½œæˆ

## åŸºæœ¬æƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0073 |
| **ã‚¿ã‚¹ã‚¯å** | features/gathering/servicesä½œæˆ |
| **è¦‹ç©æ™‚é–“** | 4æ™‚é–“ |
| **ä¾å­˜ã‚¿ã‚¹ã‚¯** | TASK-0072 |
| **é–‹ç™ºã‚¿ã‚¤ãƒ—** | TDD |
| **ãƒ•ã‚§ãƒ¼ã‚º** | Phase 4 - features/gatheringæ©Ÿèƒ½ |
| **çŠ¶æ…‹** | ğŸ”² æœªç€æ‰‹ |

---

## æ¦‚è¦

### èƒŒæ™¯

Functional Core, Imperative Shellï¼ˆFCISï¼‰åŸå‰‡ã«å¾“ã„ã€GatheringServiceã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å†å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ä¹±æ•°ç”Ÿæˆã¯å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’ç¢ºä¿ã™ã‚‹ã€‚

### ç›®çš„

GatheringServiceã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦`src/features/gathering/services/`ã«å†å®Ÿè£…ã—ã€å‰¯ä½œç”¨ã‚’åˆ†é›¢ã™ã‚‹ã€‚

### ç¾çŠ¶

- GatheringService: `src/domain/services/GatheringService.ts`
- å†…éƒ¨ã§ä¹±æ•°ç”Ÿæˆã‚’è¡Œã£ã¦ã„ã‚‹

---

## è¦ä»¶

### æ©Ÿèƒ½è¦ä»¶

| è¦ä»¶ID | è¦ä»¶ | ä¿¡é ¼æ€§ |
|--------|------|--------|
| REQ-073-01 | gatheré–¢æ•°ã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ | ğŸ”µ |
| REQ-073-02 | calculateMaterialsé–¢æ•°ã‚’ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ | ğŸ”µ |
| REQ-073-03 | ä¹±æ•°ç”Ÿæˆã¯å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã™ã‚‹è¨­è¨ˆã«ã™ã‚‹ | ğŸ”µ |
| REQ-073-04 | å‰¯ä½œç”¨ã‚’æŒã¤å‡¦ç†ã¯ã‚·ãƒ¼ãƒ³å´ã«ç§»å‹•ã™ã‚‹ | ğŸ”µ |

### éæ©Ÿèƒ½è¦ä»¶

| è¦ä»¶ID | è¦ä»¶ |
|--------|------|
| NFR-073-01 | ç´”ç²‹é–¢æ•°ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒ80%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æŒã¤ã“ã¨ |
| NFR-073-02 | åŒã˜å…¥åŠ›ï¼ˆä¹±æ•°ã‚·ãƒ¼ãƒ‰å«ã‚€ï¼‰ã«å¯¾ã—ã¦å¸¸ã«åŒã˜å‡ºåŠ›ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ |
| NFR-073-03 | å¤–éƒ¨çŠ¶æ…‹ã«ä¾å­˜ã—ãªã„ã“ã¨ |

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### ç´”ç²‹é–¢æ•°ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
describe('features/gathering/services', () => {
  describe('gather', () => {
    it('åŒã˜ã‚·ãƒ¼ãƒ‰å€¤ã§åŒã˜çµæœãŒè¿”ã•ã‚Œã‚‹ã“ã¨', () => {});
    it('å…¥åŠ›çŠ¶æ…‹ã‚’å¤‰æ›´ã—ãªã„ã“ã¨ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰', () => {});
    it('æ¡å–ã‚«ãƒ¼ãƒ‰ã«å¿œã˜ãŸç´ æãŒç²å¾—ã•ã‚Œã‚‹ã“ã¨', () => {});
  });

  describe('calculateMaterials', () => {
    it('ã‚«ãƒ¼ãƒ‰åŠ¹æœã«åŸºã¥ã„ã¦ç´ æé‡ãŒè¨ˆç®—ã•ã‚Œã‚‹ã“ã¨', () => {});
    it('å“è³ªä¿®æ­£ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹ã“ã¨', () => {});
    it('ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒœãƒ¼ãƒŠã‚¹ãŒè¨ˆç®—ã•ã‚Œã‚‹ã“ã¨', () => {});
  });

  describe('selectGatheringOption', () => {
    it('ãƒ‰ãƒ©ãƒ•ãƒˆé¸æŠè‚¢ã‹ã‚‰é¸æŠã—ãŸçµæœã‚’è¿”ã™ã“ã¨', () => {});
    it('é¸æŠä¸å¯ã®å ´åˆã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã“ã¨', () => {});
  });
});
```

---

## å®Ÿè£…è¨ˆç”»

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ1æ™‚é–“ï¼‰

1. gatheré–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
2. calculateMaterialsé–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. selectGatheringOptioné–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—2: ç´”ç²‹é–¢æ•°å®Ÿè£…ï¼ˆ2æ™‚é–“ï¼‰

1. gatheré–¢æ•°ã®å®Ÿè£…ï¼ˆä¹±æ•°æ³¨å…¥å¯¾å¿œï¼‰
2. calculateMaterialsé–¢æ•°ã®å®Ÿè£…
3. selectGatheringOptioné–¢æ•°ã®å®Ÿè£…

### ã‚¹ãƒ†ãƒƒãƒ—3: å‰¯ä½œç”¨åˆ†é›¢ï¼ˆ1æ™‚é–“ï¼‰

1. æ—¢å­˜GatheringServiceã®å‰¯ä½œç”¨ã‚’ç‰¹å®š
2. ã‚·ãƒ¼ãƒ³å´ã¸ã®ç§»å‹•è¨ˆç”»ä½œæˆ
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

---

## å®Ÿè£…è©³ç´°

### gatheré–¢æ•°

```typescript
/**
 * æ¡å–ã‚’å®Ÿè¡Œã™ã‚‹ç´”ç²‹é–¢æ•°
 * @param state ç¾åœ¨ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 * @param card ä½¿ç”¨ã™ã‚‹æ¡å–ã‚«ãƒ¼ãƒ‰
 * @param randomValue ä¹±æ•°å€¤ï¼ˆ0-1ã€å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ï¼‰
 * @returns æ¡å–çµæœ
 */
export function gather(
  state: GatheringState,
  card: GatheringCard,
  randomValue: number
): GatheringResult {
  // å®Ÿè£…
}
```

### calculateMaterialsé–¢æ•°

```typescript
/**
 * ç´ æç²å¾—é‡ã‚’è¨ˆç®—ã™ã‚‹ç´”ç²‹é–¢æ•°
 * @param card æ¡å–ã‚«ãƒ¼ãƒ‰
 * @param bonuses å„ç¨®ãƒœãƒ¼ãƒŠã‚¹
 * @param randomValues ä¹±æ•°é…åˆ—ï¼ˆå¤–éƒ¨ã‹ã‚‰æ³¨å…¥ï¼‰
 * @returns ç²å¾—ç´ æãƒªã‚¹ãƒˆ
 */
export function calculateMaterials(
  card: GatheringCard,
  bonuses: GatheringBonuses,
  randomValues: readonly number[]
): Material[] {
  // å®Ÿè£…
}
```

### selectGatheringOptioné–¢æ•°

```typescript
/**
 * ãƒ‰ãƒ©ãƒ•ãƒˆé¸æŠè‚¢ã‹ã‚‰é¸æŠã™ã‚‹ç´”ç²‹é–¢æ•°
 * @param options é¸æŠå¯èƒ½ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³
 * @param selectedIndex é¸æŠã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
 * @returns é¸æŠçµæœï¼ˆResultå‹ï¼‰
 */
export function selectGatheringOption(
  options: readonly GatheringOption[],
  selectedIndex: number
): Result<GatheringOption, SelectionError> {
  // å®Ÿè£…
}
```

---

## ç§»è¡Œå¾Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/features/gathering/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ gather.ts
â”‚   â”œâ”€â”€ calculate-materials.ts
â”‚   â””â”€â”€ select-option.ts
â””â”€â”€ index.ts
```

---

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

### ä½œæˆ

- `src/features/gathering/services/gather.ts`
- `src/features/gathering/services/calculate-materials.ts`
- `src/features/gathering/services/select-option.ts`
- `src/features/gathering/services/index.ts`

### æ›´æ–°å¯¾è±¡

- GatheringServiceã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚·ãƒ¼ãƒ³ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] gather, calculateMaterials, selectGatheringOptionãŒç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ä¹±æ•°ãŒå¤–éƒ¨æ³¨å…¥å¯èƒ½ãªè¨­è¨ˆã«ãªã£ã¦ã„ã‚‹
- [ ] ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ80%ä»¥ä¸Šã§ã‚ã‚‹
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [ ] `pnpm lint`ãŒã‚¨ãƒ©ãƒ¼ãªã—ã§å®Œäº†ã™ã‚‹

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **TASK-0072**: features/gathering/typesä½œæˆ
- **è¨­è¨ˆæ–‡æ›¸**: `.claude/rules/architecture.md` FCISåŸå‰‡

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| æ©Ÿèƒ½è¦ä»¶ | 4 | 0 | 0 | 4 |
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | 0 | 0 | 0 | 0 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 4é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 4é …ç›® (100%) - FCISåŸå‰‡ã«åŸºã¥ã
- ğŸŸ¡ **é»„ä¿¡å·**: 0é …ç›® (0%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: è‰¯å¥½ï¼ˆè¨­è¨ˆæ–‡æ›¸ã«åŸºã¥ãæ˜ç¢ºãªå®Ÿè£…æ–¹é‡ï¼‰

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2026-02-09 | åˆç‰ˆä½œæˆ |
