# TASK-0083: features/quest/index.ts公開API作成

**タスクID**: TASK-0083
**タスクタイプ**: DIRECT
**推定工数**: 4時間
**フェーズ**: Phase 6 - features/quest機能
**信頼性レベル**: 🔵 *標準的な実装パターン*

## 関連文書

- **概要**: [📋 overview.md](../overview.md)
- **設計文書**: [📐 architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

## タスク概要

依頼機能の公開APIを定義する。features/quest モジュールの外部向けインターフェースを整理し、適切なエクスポートを設定する。

## 依存タスク

- **前提タスク**: [TASK-0082](TASK-0082.md)
- **後続タスク**: なし

## 完了条件

- [ ] features/quest/index.ts が作成されている
- [ ] 公開APIが適切にエクスポートされている
- [ ] 内部実装が隠蔽されている
- [ ] ドキュメントコメントが追加されている
- [ ] 既存テストが全て通過する

---

## 実装詳細

### 1. 公開API定義 🔵

**信頼性**: 🔵 *標準的な実装パターン*

依頼機能の公開インターフェースを定義する。

**実装ファイル**: `src/features/quest/index.ts`

```typescript
/**
 * @module features/quest
 * @description 依頼機能モジュール
 *
 * ギルド依頼の生成、受注、納品、報酬計算を提供する。
 *
 * @example
 * ```typescript
 * import {
 *   generateQuests,
 *   validateQuest,
 *   calculateReward,
 *   QuestDetailModal,
 * } from '@features/quest';
 *
 * // 依頼生成
 * const quests = generateQuests({ rank: 2, count: 5, clients });
 *
 * // 納品バリデーション
 * const result = validateQuest(quest, items);
 *
 * // 報酬計算
 * const reward = calculateReward(quest, deliveredItems);
 *
 * // UIコンポーネント
 * const modal = new QuestDetailModal(scene, { onAccept: handleAccept });
 * ```
 */

// Types
export type {
  Quest,
  QuestStatus,
  QuestCondition,
  QuestReward,
  IQuestService,
  DeliveryResult,
  Client,
  ClientPersonality,
  ClientDialogue,
} from './types';

// Services (Pure Functions)
export {
  generateQuests,
  validateQuest,
  calculateReward,
} from './services';

export type {
  GenerateQuestsConfig,
  ValidationResult,
  ValidationError,
  RewardCalculationResult,
} from './services';

// UI Components
export {
  QuestDetailModal,
  DeliveryQuestPanel,
  QuestCardUI,
} from './components';

export type {
  QuestDetailModalConfig,
  DeliveryQuestPanelConfig,
  QuestCardUIConfig,
} from './components';
```

### 2. 内部モジュール構成 🔵

**信頼性**: 🔵 *標準的な実装パターン*

内部ディレクトリ構造を整理する。

```
src/features/quest/
├── index.ts           # 公開API
├── types/
│   ├── index.ts
│   ├── Quest.ts
│   ├── IQuestService.ts
│   └── Client.ts
├── services/
│   ├── index.ts
│   ├── generateQuests.ts
│   ├── validateQuest.ts
│   └── calculateReward.ts
└── components/
    ├── index.ts
    ├── QuestDetailModal.ts
    ├── DeliveryQuestPanel.ts
    └── QuestCardUI.ts
```

### 3. パスエイリアス設定 🔵

**信頼性**: 🔵 *標準的な実装パターン*

tsconfig.json にパスエイリアスを追加する。

```json
{
  "compilerOptions": {
    "paths": {
      "@features/quest": ["./src/features/quest"],
      "@features/quest/*": ["./src/features/quest/*"]
    }
  }
}
```

### 4. 使用例ドキュメント 🔵

**信頼性**: 🔵 *標準的な実装パターン*

主要な使用パターンをドキュメント化する。

```typescript
// 依頼フローの例
import {
  generateQuests,
  validateQuest,
  calculateReward,
  QuestDetailModal,
  DeliveryQuestPanel,
  QuestCardUI,
  type Quest,
  type Client,
} from '@features/quest';
import type { CraftedItem } from '@features/alchemy';

// 1. 依頼生成
const clients: Client[] = [/* クライアントデータ */];
const quests = generateQuests({
  rank: playerRank,
  count: 5,
  clients,
});

// 2. 依頼詳細モーダル
const modal = new QuestDetailModal(scene, {
  onAccept: (quest) => acceptQuest(quest),
  onClose: () => closeModal(),
});

// 3. 依頼カード表示
quests.forEach((quest, index) => {
  const client = clients.find(c => c.id === quest.clientId)!;
  new QuestCardUI(scene, quest, client, {
    x: 100,
    y: 100 + index * 120,
    width: 300,
    height: 100,
    onClick: () => modal.show(quest, client),
  });
});

// 4. 納品パネル
const deliveryPanel = new DeliveryQuestPanel(scene, {
  x: 500,
  y: 100,
  width: 400,
  height: 500,
  onDeliver: (quest, items) => {
    const validation = validateQuest(quest, items);
    if (validation.valid) {
      const reward = calculateReward(quest, items);
      completeDelivery(quest, reward);
    }
  },
});
```

---

## 実装手順

### DIRECTタスクの場合

1. index.ts ファイルを作成
2. 公開APIを定義
3. ドキュメントコメントを追加
4. パスエイリアスを設定
5. 既存テストの通過を確認

---

## 注意事項

- 内部実装詳細はエクスポートしないこと
- 型は `export type` を使用すること
- @features/alchemy への依存を明示すること
- 循環参照を避けること

---

## 信頼性レベルサマリー

### 項目別信頼性

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 4 | 0 | 0 | 4 |

### 全体評価

- **総項目数**: 4項目
- 🔵 **青信号**: 4項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: 高信頼性（標準的な実装パターン）
