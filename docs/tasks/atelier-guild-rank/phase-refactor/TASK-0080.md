# TASK-0080: features/quest/types作成

**タスクID**: TASK-0080
**タスクタイプ**: TDD
**推定工数**: 4時間
**フェーズ**: Phase 6 - features/quest機能
**信頼性レベル**: 🔵 *既存実装に基づく*

## 関連文書

- **概要**: [📋 overview.md](../overview.md)
- **設計文書**: [📐 architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

## タスク概要

依頼機能の型定義を作成する。既存の `src/domain/entities/Quest.ts` を移動し、IQuestService インターフェースや Client, QuestCondition 関連の型を features/quest/types に集約する。

## 依存タスク

- **前提タスク**: [TASK-0064](../phase-refactor/TASK-0064.md)
- **後続タスク**: [TASK-0081](TASK-0081.md)

## 完了条件

- [ ] src/domain/entities/Quest.ts が features/quest/types に移動されている
- [ ] IQuestService インターフェースが移動されている
- [ ] Client, QuestCondition 関連の型が移動されている
- [ ] 既存テストが全て通過する
- [ ] 型のエクスポートが正しく設定されている

---

## 実装詳細

### 1. Quest エンティティ移動 🔵

**信頼性**: 🔵 *既存実装に基づく*

既存の `src/domain/entities/Quest.ts` を移動する。

**実装ファイル**: `src/features/quest/types/Quest.ts`

```typescript
import type { Quality } from '@features/alchemy/types';

export interface Quest {
  id: string;
  clientId: string;
  title: string;
  description: string;
  conditions: QuestCondition[];
  reward: QuestReward;
  deadline: number;
  rank: number;
  status: QuestStatus;
}

export type QuestStatus = 'available' | 'accepted' | 'completed' | 'failed' | 'expired';

export interface QuestCondition {
  type: 'item' | 'quality' | 'quantity';
  itemId?: string;
  minQuality?: Quality;
  quantity?: number;
}

export interface QuestReward {
  gold: number;
  contribution: number;
  items?: string[];
}
```

### 2. IQuestService インターフェース移動 🔵

**信頼性**: 🔵 *既存実装に基づく*

既存の `src/domain/services/interfaces/IQuestService.ts` を移動する。

**実装ファイル**: `src/features/quest/types/IQuestService.ts`

```typescript
import type { Quest, QuestStatus } from './Quest';
import type { CraftedItem } from '@features/alchemy/types';

export interface IQuestService {
  generateQuests(rank: number, count: number): Quest[];
  acceptQuest(questId: string): boolean;
  deliverQuest(questId: string, items: CraftedItem[]): DeliveryResult;
  getActiveQuests(): Quest[];
  getAvailableQuests(): Quest[];
  updateQuestStatus(questId: string, status: QuestStatus): void;
}

export interface DeliveryResult {
  success: boolean;
  quest: Quest;
  reward?: {
    gold: number;
    contribution: number;
  };
  feedback?: string;
}
```

### 3. Client 型定義 🔵

**信頼性**: 🔵 *既存実装に基づく*

依頼主の型定義を作成する。

**実装ファイル**: `src/features/quest/types/Client.ts`

```typescript
export interface Client {
  id: string;
  name: string;
  title: string;
  portrait: string;
  personality: ClientPersonality;
  preferredQualities: string[];
}

export type ClientPersonality = 'demanding' | 'generous' | 'picky' | 'easygoing';

export interface ClientDialogue {
  greeting: string;
  accept: string;
  reject: string;
  deliverySuccess: string;
  deliveryFail: string;
}
```

### 4. インデックスファイル作成 🔵

**信頼性**: 🔵 *標準的な実装パターン*

**実装ファイル**: `src/features/quest/types/index.ts`

```typescript
export type {
  Quest,
  QuestStatus,
  QuestCondition,
  QuestReward,
} from './Quest';

export type {
  IQuestService,
  DeliveryResult,
} from './IQuestService';

export type {
  Client,
  ClientPersonality,
  ClientDialogue,
} from './Client';
```

---

## 単体テスト要件

### テストケース1: 型のエクスポート確認 🔵

**信頼性**: 🔵 *標準的なテストパターン*

**Given**: features/quest/types/index.ts
**When**: 各型をインポート
**Then**: 型エラーなくインポートできる

**テストファイル**: `tests/unit/features/quest/types/index.test.ts`

```typescript
describe('features/quest/types', () => {
  it('should export Quest type', () => {
    // 型チェックテスト
  });

  it('should export IQuestService interface', () => {
    // 型チェックテスト
  });

  it('should export Client type', () => {
    // 型チェックテスト
  });
});
```

### テストケース2: QuestStatus 型テスト 🔵

**信頼性**: 🔵 *既存実装に基づく*

**Given**: QuestStatus 型
**When**: 有効なステータス値を設定
**Then**: 型エラーが発生しない

---

## 実装手順

### TDDタスクの場合

1. `/tsumiki:tdd-requirements TASK-0080` - 詳細要件定義
2. `/tsumiki:tdd-testcases` - テストケース作成
3. `/tsumiki:tdd-red` - テスト実装（失敗）
4. `/tsumiki:tdd-green` - 最小実装
5. `/tsumiki:tdd-refactor` - リファクタリング
6. `/tsumiki:tdd-verify-complete` - 品質確認

---

## 注意事項

- 既存のインポートパスを段階的に更新すること
- @features/alchemy/types への依存を明示すること
- 循環参照を避けるため、依存関係に注意すること

---

## 信頼性レベルサマリー

### 項目別信頼性

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 4 | 0 | 0 | 4 |
| 単体テスト | 2 | 0 | 0 | 2 |

### 全体評価

- **総項目数**: 6項目
- 🔵 **青信号**: 6項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: 高信頼性（既存実装に基づく移行タスク）
