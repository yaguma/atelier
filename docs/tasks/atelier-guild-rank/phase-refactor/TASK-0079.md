# TASK-0079: features/alchemy/index.ts公開API作成

**タスクID**: TASK-0079
**タスクタイプ**: DIRECT
**推定工数**: 4時間
**フェーズ**: Phase 5 - features/alchemy機能
**信頼性レベル**: 🔵 *標準的な実装パターン*

## 関連文書

- **概要**: [📋 overview.md](../overview.md)
- **設計文書**: [📐 architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

## タスク概要

調合機能の公開APIを定義する。features/alchemy モジュールの外部向けインターフェースを整理し、適切なエクスポートを設定する。

## 依存タスク

- **前提タスク**: [TASK-0078](TASK-0078.md)
- **後続タスク**: なし

## 完了条件

- [ ] features/alchemy/index.ts が作成されている
- [ ] 公開APIが適切にエクスポートされている
- [ ] 内部実装が隠蔽されている
- [ ] ドキュメントコメントが追加されている
- [ ] 既存テストが全て通過する

---

## 実装詳細

### 1. 公開API定義 🔵

**信頼性**: 🔵 *標準的な実装パターン*

調合機能の公開インターフェースを定義する。

**実装ファイル**: `src/features/alchemy/index.ts`

```typescript
/**
 * @module features/alchemy
 * @description 調合機能モジュール
 *
 * 錬金術による調合処理、レシピ管理、品質計算を提供する。
 *
 * @example
 * ```typescript
 * import { calculateQuality, craft, RecipeListUI } from '@features/alchemy';
 *
 * // 品質計算
 * const quality = calculateQuality(materials);
 *
 * // 調合実行
 * const result = craft(recipe, materials, generateId);
 *
 * // UIコンポーネント
 * const recipeList = new RecipeListUI(scene, config);
 * ```
 */

// Types
export type {
  IAlchemyService,
  Recipe,
  MaterialRequirement,
  CraftedItem,
  Quality,
  Grade,
  QualityConfig,
} from './types';

export { QUALITY_THRESHOLDS } from './types';

// Services (Pure Functions)
export {
  calculateQuality,
  calculateAttributes,
  craft,
  determineGrade,
} from './services';

export type { CraftResult } from './services';

// UI Components
export {
  RecipeListUI,
  RecipeCardUI,
  CraftingUI,
} from './components';

export type {
  RecipeListUIConfig,
  RecipeCardUIConfig,
  CraftingUIConfig,
} from './components';
```

### 2. 内部モジュール構成 🔵

**信頼性**: 🔵 *標準的な実装パターン*

内部ディレクトリ構造を整理する。

```
src/features/alchemy/
├── index.ts           # 公開API
├── types/
│   ├── index.ts
│   ├── IAlchemyService.ts
│   ├── recipe.ts
│   └── quality.ts
├── services/
│   ├── index.ts
│   ├── calculateQuality.ts
│   ├── calculateAttributes.ts
│   ├── craft.ts
│   └── determineGrade.ts
└── components/
    ├── index.ts
    ├── RecipeListUI.ts
    ├── RecipeCardUI.ts
    └── CraftingUI.ts
```

### 3. パスエイリアス設定 🔵

**信頼性**: 🔵 *標準的な実装パターン*

tsconfig.json にパスエイリアスを追加する。

```json
{
  "compilerOptions": {
    "paths": {
      "@features/alchemy": ["./src/features/alchemy"],
      "@features/alchemy/*": ["./src/features/alchemy/*"]
    }
  }
}
```

### 4. 使用例ドキュメント 🔵

**信頼性**: 🔵 *標準的な実装パターン*

主要な使用パターンをドキュメント化する。

```typescript
// 調合フローの例
import {
  calculateQuality,
  calculateAttributes,
  craft,
  RecipeListUI,
  CraftingUI,
  type Recipe,
  type Material,
} from '@features/alchemy';

// 1. レシピ選択UI
const recipeList = new RecipeListUI(scene, {
  x: 100,
  y: 100,
  width: 300,
  height: 400,
  onRecipeSelect: (recipe) => handleRecipeSelect(recipe),
});

// 2. 調合UI
const craftingUI = new CraftingUI(scene, {
  x: 500,
  y: 100,
  width: 400,
  height: 400,
  onCraftComplete: (item) => handleCraftComplete(item),
});

// 3. 純粋関数による計算
const quality = calculateQuality(materials);
const attributes = calculateAttributes(materials);
const result = craft(recipe, materials, () => crypto.randomUUID());
```

---

## 実装手順

### DIRECTタスクの場合

1. index.ts ファイルを作成
2. 公開APIを定義
3. ドキュメントコメントを追加
4. パスエイリアスを設定
5. 既存テストの通過を確認

---

## 注意事項

- 内部実装詳細はエクスポートしないこと
- 型は `export type` を使用すること
- 循環参照を避けること
- バレルファイルのパフォーマンスに注意すること

---

## 信頼性レベルサマリー

### 項目別信頼性

| カテゴリ | 🔵 青 | 🟡 黄 | 🔴 赤 | 合計 |
|---------|-------|-------|-------|------|
| 実装詳細 | 4 | 0 | 0 | 4 |

### 全体評価

- **総項目数**: 4項目
- 🔵 **青信号**: 4項目 (100%)
- 🟡 **黄信号**: 0項目 (0%)
- 🔴 **赤信号**: 0項目 (0%)

**品質評価**: 高信頼性（標準的な実装パターン）
