# TASK-0018: 共通UIコンポーネント基盤 - テストケース仕様書

**バージョン**: 1.0.0
**作成日**: 2026-01-17
**タスクID**: TASK-0018
**フェーズ**: 3 - UI層

---

## 1. テスト戦略

### 1.1 テストレベル

| レベル | 目的 | ツール |
|--------|------|--------|
| **単体テスト** | 個別コンポーネントの動作検証 | Vitest |
| **統合テスト** | コンポーネント間の連携検証 | Vitest + Phaser Test Utils |
| **E2Eテスト** | ブラウザ上での実際の表示・動作検証 | Playwright |

### 1.2 テスト対象コンポーネント

1. **テーマ定義** (`src/presentation/ui/theme.ts`)
2. **基底コンポーネント** (`src/presentation/ui/components/BaseComponent.ts`)
3. **ボタンコンポーネント** (`src/presentation/ui/components/Button.ts`)
4. **ダイアログコンポーネント** (`src/presentation/ui/components/Dialog.ts`)

### 1.3 信頼性レベル凡例

- 🔵 **青信号**: 設計文書に記載
- 🟡 **黄信号**: 設計文書から妥当な推測
- 🔴 **赤信号**: 設計文書にない推測

---

## 2. テーマ定義のテストケース

### 2.1 単体テスト

#### T-0018-THEME-01: カラーパレット定義の検証 🔵

**テスト目的**: テーマカラーが設計書通りに定義されていることを確認
**信頼性レベル**: 🔵 設計書（ui-design/overview.md）に明記
**テスト内容**:
- THEME.colors.primaryが0x8B4513であることを確認
- THEME.colors.secondaryが0xD2691Eであることを確認
- THEME.colors.backgroundが0xF5F5DCであることを確認
- THEME.colors.textが0x333333であることを確認
- THEME.colors.successが0x228B22であることを確認
- THEME.colors.warningが0xDAA520であることを確認
- THEME.colors.errorが0x8B0000であることを確認
- THEME.colors.disabledが0xCCCCCCであることを確認

**期待結果**: すべてのカラー値が設計書通りに定義されている

#### T-0018-THEME-02: フォント設定の検証 🔵

**テスト目的**: フォント設定が設計書通りに定義されていることを確認
**信頼性レベル**: 🔵 設計書（ui-design/overview.md）に明記
**テスト内容**:
- THEME.fonts.primaryが'Noto Sans JP'であることを確認
- THEME.fonts.secondaryが'sans-serif'であることを確認

**期待結果**: すべてのフォント設定が設計書通りに定義されている

#### T-0018-THEME-03: サイズ定義の検証 🔵

**テスト目的**: フォントサイズが設計書通りに定義されていることを確認
**信頼性レベル**: 🔵 設計書（ui-design/overview.md）に明記
**テスト内容**:
- THEME.sizes.smallが14であることを確認
- THEME.sizes.mediumが16であることを確認
- THEME.sizes.largeが20であることを確認
- THEME.sizes.xlargeが24であることを確認

**期待結果**: すべてのサイズ設定が設計書通りに定義されている

#### T-0018-THEME-04: スペーシング定義の検証 🔵

**テスト目的**: スペーシング値が設計書通りに定義されていることを確認
**信頼性レベル**: 🔵 設計書（ui-design/overview.md）に明記
**テスト内容**:
- THEME.spacing.xsが4であることを確認
- THEME.spacing.smが8であることを確認
- THEME.spacing.mdが16であることを確認
- THEME.spacing.lgが24であることを確認
- THEME.spacing.xlが32であることを確認

**期待結果**: すべてのスペーシング値が設計書通りに定義されている

#### T-0018-THEME-05: 定数としての不変性確認 🟡

**テスト目的**: THEMEオブジェクトが変更不可能であることを確認
**信頼性レベル**: 🟡 TypeScriptの`as const`から推測
**テスト内容**:
- THEMEオブジェクトがreadonlyであることを確認（型レベル）
- 実行時にプロパティの変更が防止されていることを確認

**期待結果**: THEMEオブジェクトが定数として定義されている

---

## 3. BaseComponentのテストケース

### 3.1 単体テスト

#### T-0018-BASE-01: コンストラクタの初期化検証 🔵

**テスト目的**: BaseComponentが正しく初期化されることを確認
**信頼性レベル**: 🔵 タスク定義（TASK-0018.md）に明記
**テスト内容**:
- sceneプロパティが正しく設定されることを確認
- containerが作成されることを確認
- rexUIプラグインへの参照が設定されることを確認
- containerの座標が指定した値に設定されることを確認

**期待結果**: すべてのプロパティが正しく初期化される

#### T-0018-BASE-02: setVisibleメソッドの検証 🔵

**テスト目的**: 可視性の制御が正しく動作することを確認
**信頼性レベル**: 🔵 タスク定義（TASK-0018.md）に明記
**テスト内容**:
- setVisible(true)でcontainerが表示されることを確認
- setVisible(false)でcontainerが非表示になることを確認
- メソッドチェーンが可能であることを確認（thisを返す）

**期待結果**: 可視性が正しく制御され、メソッドチェーンが可能

#### T-0018-BASE-03: setPositionメソッドの検証 🔵

**テスト目的**: 位置の変更が正しく動作することを確認
**信頼性レベル**: 🔵 タスク定義（TASK-0018.md）に明記
**テスト内容**:
- setPosition(x, y)でcontainerの座標が変更されることを確認
- メソッドチェーンが可能であることを確認（thisを返す）

**期待結果**: 位置が正しく変更され、メソッドチェーンが可能

#### T-0018-BASE-04: 抽象メソッドの存在確認 🔵

**テスト目的**: 抽象メソッドが定義されていることを確認
**信頼性レベル**: 🔵 タスク定義（TASK-0018.md）に明記
**テスト内容**:
- createメソッドが抽象メソッドとして定義されていることを確認（型レベル）
- destroyメソッドが抽象メソッドとして定義されていることを確認（型レベル）

**期待結果**: サブクラスで実装が必須となる

#### T-0018-BASE-05: メソッドチェーンの検証 🟡

**テスト目的**: 複数のメソッドを連続して呼び出せることを確認
**信頼性レベル**: 🟡 Fluent Interfaceパターンから推測
**テスト内容**:
- setVisible().setPosition()のようなメソッドチェーンが動作することを確認

**期待結果**: メソッドチェーンが正しく動作する

---

## 4. Buttonコンポーネントのテストケース

### 4.1 単体テスト

#### T-0018-BTN-01: プライマリボタンの生成検証 🔵

**テスト目的**: プライマリボタンが正しいスタイルで生成されることを確認
**信頼性レベル**: 🔵 タスク定義（TASK-0018.md）と設計書に明記
**テスト内容**:
- ボタンが生成されることを確認
- 背景色がprimaryカラー（0x8B4513）であることを確認
- テキストが白色であることを確認
- パディングが正しく設定されることを確認
- 角丸が4pxであることを確認

**期待結果**: プライマリボタンが設計書通りのスタイルで生成される

#### T-0018-BTN-02: セカンダリボタンの生成検証 🔵

**テスト目的**: セカンダリボタンが正しいスタイルで生成されることを確認
**信頼性レベル**: 🔵 タスク定義（TASK-0018.md）と設計書に明記
**テスト内容**:
- ボタンが生成されることを確認
- 背景が透明であることを確認
- 枠線がグレーであることを確認
- テキスト色が通常色であることを確認

**期待結果**: セカンダリボタンが設計書通りのスタイルで生成される

#### T-0018-BTN-03: テキストボタンの生成検証 🟡

**テスト目的**: テキストボタンが正しいスタイルで生成されることを確認
**信頼性レベル**: 🟡 タスク定義から推測（詳細スタイルは設計書未記載）
**テスト内容**:
- ボタンが生成されることを確認
- 背景が透明であることを確認
- 枠線がないことを確認
- テキストのみ表示されることを確認

**期待結果**: テキストボタンが生成される

#### T-0018-BTN-04: アイコンボタンの生成検証 🟡

**テスト目的**: アイコンボタンが正しいスタイルで生成されることを確認
**信頼性レベル**: 🟡 タスク定義から推測（詳細スタイルは設計書未記載）
**テスト内容**:
- ボタンが生成されることを確認
- アイコンが表示されることを確認
- テキストが省略可能であることを確認

**期待結果**: アイコンボタンが生成される

#### T-0018-BTN-05: ボタンクリックイベントの検証 🔵

**テスト目的**: ボタンがクリック可能でコールバックが実行されることを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-02）に明記
**テスト内容**:
- ボタンにクリックイベントが設定できることを確認
- ボタンをクリックしたときにコールバック関数が実行されることを確認
- コールバック関数が正しい引数で呼ばれることを確認

**期待結果**: クリックイベントが正しく動作する

#### T-0018-BTN-06: 無効状態のボタン検証 🔵

**テスト目的**: 無効状態のボタンが正しく表示されることを確認
**信頼性レベル**: 🔵 設計書に明記
**テスト内容**:
- setEnabled(false)でボタンが無効化されることを確認
- 背景色がdisabledカラー（0xCCCCCC）になることを確認
- テキスト色がグレーになることを確認
- クリックイベントが発火しないことを確認

**期待結果**: 無効状態のボタンが正しく動作する

#### T-0018-BTN-07: ホバーアニメーションの検証 🟡

**テスト目的**: ホバー時のアニメーションが動作することを確認
**信頼性レベル**: 🟡 タスク定義（推奨条件）から推測
**テスト内容**:
- マウスホバー時にボタンの見た目が変化することを確認
- ホバー解除時に元の状態に戻ることを確認

**期待結果**: ホバーアニメーションが動作する（推奨条件）

#### T-0018-BTN-08: 押下アニメーションの検証 🟡

**テスト目的**: 押下時のアニメーションが動作することを確認
**信頼性レベル**: 🟡 タスク定義（推奨条件）から推測
**テスト内容**:
- ボタン押下時にスケールダウンアニメーションが発生することを確認
- ボタン解放時に元のサイズに戻ることを確認

**期待結果**: 押下アニメーションが動作する（推奨条件）

### 4.2 E2Eテスト

#### T-0018-BTN-E2E-01: プライマリボタンの表示検証 🔵

**テスト目的**: ブラウザ上でプライマリボタンが正しく表示されることを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-01）に明記
**テスト内容**:
- プライマリボタンが画面に表示されることを確認
- ボタンのスタイルが設計書通りであることを確認（目視またはスクリーンショット比較）

**期待結果**: プライマリボタンが正しいスタイルで表示される

#### T-0018-BTN-E2E-02: ボタンクリックの検証 🔵

**テスト目的**: ブラウザ上でボタンクリックが動作することを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-02）に明記
**テスト内容**:
- ボタンをクリックできることを確認
- クリック後にコールバックが実行されることを確認（画面の変化やログ出力で検証）

**期待結果**: ボタンクリックが正しく動作する

---

## 5. Dialogコンポーネントのテストケース

### 5.1 単体テスト

#### T-0018-DLG-01: 確認ダイアログの生成検証 🔵

**テスト目的**: 確認ダイアログが正しく生成されることを確認
**信頼性レベル**: 🔵 タスク定義と設計書に明記
**テスト内容**:
- ダイアログが生成されることを確認
- タイトル、メッセージ、「はい」「いいえ」ボタンが含まれることを確認
- 背景色がbackgroundカラー（0xF5F5DC）であることを確認
- 角丸が12pxであることを確認

**期待結果**: 確認ダイアログが設計書通りに生成される

#### T-0018-DLG-02: 情報ダイアログの生成検証 🔵

**テスト目的**: 情報ダイアログが正しく生成されることを確認
**信頼性レベル**: 🔵 タスク定義と設計書に明記
**テスト内容**:
- ダイアログが生成されることを確認
- タイトル、メッセージ、「閉じる」ボタンが含まれることを確認

**期待結果**: 情報ダイアログが設計書通りに生成される

#### T-0018-DLG-03: 選択ダイアログの生成検証 🔵

**テスト目的**: 選択ダイアログが正しく生成されることを確認
**信頼性レベル**: 🔵 タスク定義と設計書に明記
**テスト内容**:
- ダイアログが生成されることを確認
- タイトル、メッセージ、複数の選択肢ボタンが含まれることを確認

**期待結果**: 選択ダイアログが設計書通りに生成される

#### T-0018-DLG-04: ダイアログ表示の検証 🔵

**テスト目的**: ダイアログが正しく表示されることを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-03）に明記
**テスト内容**:
- show()メソッドでダイアログが表示されることを確認
- モーダル背景（オーバーレイ）が表示されることを確認
- ダイアログがpopUpアニメーション（スライドイン）することを確認

**期待結果**: ダイアログがモーダル表示される

#### T-0018-DLG-05: ダイアログ非表示の検証 🔵

**テスト目的**: ダイアログが正しく非表示になることを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-04）に明記
**テスト内容**:
- hide()メソッドでダイアログが非表示になることを確認
- モーダル背景が非表示になることを確認
- ダイアログがscaleDownアニメーション（フェードアウト）することを確認

**期待結果**: ダイアログが非表示になる

#### T-0018-DLG-06: ダイアログボタンクリックの検証 🔵

**テスト目的**: ダイアログのボタンクリックが正しく動作することを確認
**信頼性レベル**: 🔵 設計書に明記
**テスト内容**:
- 「はい」ボタンをクリックしたときに正しいコールバックが実行されることを確認
- 「いいえ」ボタンをクリックしたときに正しいコールバックが実行されることを確認
- ボタンクリック後にダイアログが自動で閉じることを確認

**期待結果**: ボタンクリックが正しく動作し、ダイアログが閉じる

#### T-0018-DLG-07: オーバーレイクリックの検証 🟡

**テスト目的**: オーバーレイをクリックしたときの動作を確認
**信頼性レベル**: 🟡 一般的なUIパターンから推測
**テスト内容**:
- オーバーレイをクリックしたときにダイアログが閉じることを確認（または閉じないことを確認）

**期待結果**: オーバーレイクリック時の動作が定義通り

#### T-0018-DLG-08: 深度（depth）の検証 🔵

**テスト目的**: ダイアログが他のUI要素の上に表示されることを確認
**信頼性レベル**: 🔵 設計書（UIレイヤー構成）に明記
**テスト内容**:
- オーバーレイのdepthが300であることを確認
- ダイアログのdepthが400であることを確認
- 他のUI要素（Content: 100, Header: 200）の上に表示されることを確認

**期待結果**: ダイアログが最前面に表示される

### 5.2 E2Eテスト

#### T-0018-DLG-E2E-01: ダイアログ表示の検証 🔵

**テスト目的**: ブラウザ上でダイアログが正しく表示されることを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-03）に明記
**テスト内容**:
- ダイアログが画面に表示されることを確認
- モーダル背景が表示されることを確認
- ダイアログが中央に配置されることを確認

**期待結果**: ダイアログが正しく表示される

#### T-0018-DLG-E2E-02: ダイアログ閉じるの検証 🔵

**テスト目的**: ブラウザ上でダイアログが正しく閉じることを確認
**信頼性レベル**: 🔵 タスク定義（T-0018-04）に明記
**テスト内容**:
- 「閉じる」ボタンをクリックしてダイアログが非表示になることを確認
- モーダル背景が非表示になることを確認

**期待結果**: ダイアログが正しく閉じる

---

## 6. 統合テスト

### T-0018-INT-01: テーマとボタンの統合検証 🔵

**テスト目的**: ボタンがテーマ定義を正しく使用することを確認
**信頼性レベル**: 🔵 タスク定義から推測
**テスト内容**:
- ボタン生成時にTHEME.colorsを使用していることを確認
- ボタンテキストがTHEME.fontsを使用していることを確認
- ボタンのパディングがTHEME.spacingを使用していることを確認

**期待結果**: ボタンがテーマ定義を正しく使用している

### T-0018-INT-02: テーマとダイアログの統合検証 🔵

**テスト目的**: ダイアログがテーマ定義を正しく使用することを確認
**信頼性レベル**: 🔵 タスク定義から推測
**テスト内容**:
- ダイアログ生成時にTHEME.colorsを使用していることを確認
- ダイアログのスペーシングがTHEME.spacingを使用していることを確認

**期待結果**: ダイアログがテーマ定義を正しく使用している

### T-0018-INT-03: BaseComponentの継承検証 🔵

**テスト目的**: ボタンとダイアログがBaseComponentを正しく継承していることを確認
**信頼性レベル**: 🔵 タスク定義から推測
**テスト内容**:
- ボタンがBaseComponentを継承していることを確認
- ダイアログがBaseComponentを継承していることを確認
- setVisible(), setPosition()メソッドが使用可能であることを確認

**期待結果**: 継承が正しく動作している

---

## 7. アクセシビリティテスト（推奨条件）

### T-0018-A11Y-01: キーボード操作の検証 🟡

**テスト目的**: キーボードでボタンとダイアログを操作できることを確認
**信頼性レベル**: 🟡 タスク定義（推奨条件）から推測
**テスト内容**:
- Tabキーでボタンにフォーカスできることを確認
- Enterキーでボタンをアクティブ化できることを確認
- Escapeキーでダイアログを閉じられることを確認

**期待結果**: キーボード操作が可能（推奨条件）

### T-0018-A11Y-02: フォーカス表示の検証 🟡

**テスト目的**: フォーカス時に視覚的なフィードバックがあることを確認
**信頼性レベル**: 🟡 タスク定義（推奨条件）から推測
**テスト内容**:
- ボタンにフォーカスがあたったときに視覚的な変化があることを確認
- フォーカスインジケーターが明確に表示されることを確認

**期待結果**: フォーカス表示が明確（推奨条件）

---

## 8. パフォーマンステスト

### T-0018-PERF-01: ボタン大量生成のパフォーマンス 🟡

**テスト目的**: 大量のボタンを生成してもパフォーマンスが劣化しないことを確認
**信頼性レベル**: 🟡 実用性から推測
**テスト内容**:
- 100個のボタンを生成する
- 生成時間が許容範囲内（例: 1秒以内）であることを確認
- フレームレートが60FPSを維持していることを確認

**期待結果**: 大量生成でもパフォーマンスが維持される

### T-0018-PERF-02: ダイアログのアニメーション性能 🟡

**テスト目的**: ダイアログのアニメーションがスムーズであることを確認
**信頼性レベル**: 🟡 実用性から推測
**テスト内容**:
- ダイアログの表示・非表示アニメーションを実行
- アニメーション中のフレームレートが60FPSを維持していることを確認

**期待結果**: アニメーションがスムーズに動作する

---

## 9. エッジケーステスト

### T-0018-EDGE-01: 空文字列のボタンテキスト 🟡

**テスト目的**: 空のテキストでボタンを生成したときの動作を確認
**信頼性レベル**: 🟡 エッジケースとして推測
**テスト内容**:
- 空文字列でボタンを生成する
- エラーが発生しないことを確認
- ボタンが表示されることを確認（空の状態でも）

**期待結果**: エラーが発生せず、ボタンが生成される

### T-0018-EDGE-02: 非常に長いテキストのボタン 🟡

**テスト目的**: 長いテキストでボタンを生成したときの動作を確認
**信頼性レベル**: 🟡 エッジケースとして推測
**テスト内容**:
- 100文字以上の長いテキストでボタンを生成する
- テキストが適切に折り返されるか、省略されることを確認
- ボタンのレイアウトが崩れないことを確認

**期待結果**: 長いテキストでもレイアウトが崩れない

### T-0018-EDGE-03: ダイアログの多重表示 🟡

**テスト目的**: 複数のダイアログを同時に表示したときの動作を確認
**信頼性レベル**: 🟡 エッジケースとして推測
**テスト内容**:
- 複数のダイアログを連続して表示する
- 最前面のダイアログが操作可能であることを確認
- depth順序が正しく保たれることを確認

**期待結果**: 複数ダイアログが正しく管理される

---

## 10. テストカバレッジ目標

| 項目 | 目標 |
|------|------|
| **コードカバレッジ** | 80%以上 |
| **ブランチカバレッジ** | 70%以上 |
| **E2Eテスト** | 主要機能100% |

---

## 11. テスト実行順序

1. **単体テスト**: テーマ定義 → BaseComponent → Button → Dialog
2. **統合テスト**: テーマとコンポーネントの統合検証
3. **E2Eテスト**: ブラウザ上での動作検証
4. **パフォーマンステスト**: 負荷試験
5. **アクセシビリティテスト**: キーボード操作等（推奨条件）

---

## 12. テストデータ

### 12.1 ボタンテストデータ

```typescript
export const BUTTON_TEST_DATA = {
  primary: {
    text: 'プライマリボタン',
    type: 'primary',
  },
  secondary: {
    text: 'セカンダリボタン',
    type: 'secondary',
  },
  text: {
    text: 'テキストボタン',
    type: 'text',
  },
  icon: {
    icon: 'check',
    type: 'icon',
  },
  disabled: {
    text: '無効ボタン',
    type: 'primary',
    enabled: false,
  },
};
```

### 12.2 ダイアログテストデータ

```typescript
export const DIALOG_TEST_DATA = {
  confirm: {
    title: '確認',
    message: 'この操作を実行してもよろしいですか?',
    type: 'confirm',
  },
  info: {
    title: '情報',
    message: '操作が完了しました。',
    type: 'info',
  },
  choice: {
    title: '選択',
    message: '以下から選択してください。',
    type: 'choice',
    options: ['オプション1', 'オプション2', 'オプション3'],
  },
};
```

---

## 13. テスト環境

| 項目 | 内容 |
|------|------|
| **テストフレームワーク** | Vitest (単体・統合), Playwright (E2E) |
| **ブラウザ** | Chromium, Firefox, WebKit |
| **解像度** | 1280x720（基準）, 960x540（最小）, 3840x2160（4K） |
| **CI/CD** | GitHub Actions（自動実行） |

---

## 14. 成果物

| 成果物 | パス |
|--------|------|
| テーマ定義テスト | `src/presentation/ui/theme.spec.ts` |
| BaseComponentテスト | `src/presentation/ui/components/BaseComponent.spec.ts` |
| Buttonテスト | `src/presentation/ui/components/Button.spec.ts` |
| Dialogテスト | `src/presentation/ui/components/Dialog.spec.ts` |
| 統合テスト | `src/presentation/ui/components/integration.spec.ts` |
| E2Eテスト | `e2e/specs/ui-components.spec.ts` |

---

## 15. 受け入れ基準

### 15.1 必須条件 🔵

- [ ] すべての単体テストが成功する
- [ ] すべての統合テストが成功する
- [ ] すべてのE2Eテストが成功する
- [ ] コードカバレッジが80%以上
- [ ] T-0018-01からT-0018-04のテストが成功する

### 15.2 推奨条件 🟡

- [ ] アクセシビリティテストが成功する
- [ ] パフォーマンステストが成功する
- [ ] エッジケーステストが成功する

---

## 関連文書

- **タスク定義書**: [TASK-0018.md](./TASK-0018.md)
- **UI設計書**: [../../design/atelier-guild-rank/ui-design/overview.md](../../design/atelier-guild-rank/ui-design/overview.md)
- **要件定義書**: [../../spec/atelier-guild-rank-requirements.md](../../spec/atelier-guild-rank-requirements.md)

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2026-01-17 | 1.0.0 | 初版作成 |
