# TASK-0047: 共通UIコンポーネント視覚実装

## 基本情報

| 項目 | 値 |
|------|-----|
| **タスクID** | TASK-0047 |
| **タスク名** | 共通UIコンポーネント視覚実装 |
| **見積時間** | 4時間 |
| **依存タスク** | TASK-0018, TASK-0046 |
| **開発タイプ** | TDD |
| **状態** | ✅ 完了 |

---

## 概要

### 背景

TASK-0046で実装されたHeaderUI、SidebarUI、FooterUIコンポーネントは、テストを通すための最小限の実装（ロジック・状態管理）のみで、実際のPhaserのGameObject（テキスト、図形、ボタンなど）を作成していない。そのため、MainSceneに遷移しても画面が真っ白（背景色のみ）となっている。

### 目的

各共通UIコンポーネントの`create()`メソッドに実際のPhaserのGameObject生成処理を追加し、デザイン仕様に基づいた視覚的なUI表示を実現する。

### 対象コンポーネント

1. **HeaderUI** - ランク、昇格ゲージ、残り日数、所持金、行動ポイント表示
2. **SidebarUI** - 受注依頼、素材、完成品のアコーディオン、保管容量、ショップボタン
3. **FooterUI** - フェーズインジケーター、手札表示エリア、次へボタン

---

## 要件

### 機能要件

#### HeaderUI視覚実装

| 要件ID | 要件 | 信頼性 |
|--------|------|--------|
| REQ-047-01 | ランク表示テキストを画面に描画すること | 🔵 |
| REQ-047-02 | 昇格ゲージをプログレスバーとして表示すること | 🔵 |
| REQ-047-03 | 昇格ゲージの色が値に応じて変化すること（赤/黄/緑/水色） | 🔵 |
| REQ-047-04 | 残り日数テキストを表示し、色が日数に応じて変化すること | 🔵 |
| REQ-047-05 | 残り3日以下で点滅アニメーションを実行すること | 🟡 |
| REQ-047-06 | 所持金テキストを表示すること | 🔵 |
| REQ-047-07 | 行動ポイントを「現在/最大 AP」形式で表示すること | 🔵 |

#### SidebarUI視覚実装

| 要件ID | 要件 | 信頼性 |
|--------|------|--------|
| REQ-047-08 | 「受注依頼」セクションヘッダーを表示すること | 🔵 |
| REQ-047-09 | 「素材」セクションヘッダーを表示すること | 🔵 |
| REQ-047-10 | 「完成品」セクションヘッダーを表示すること | 🔵 |
| REQ-047-11 | 各セクションの折りたたみ/展開アイコンを表示すること | 🟡 |
| REQ-047-12 | 保管容量テキストを表示すること（例: 「保管: 0/20」） | 🔵 |
| REQ-047-13 | ショップボタンを表示すること | 🔵 |

#### FooterUI視覚実装

| 要件ID | 要件 | 信頼性 |
|--------|------|--------|
| REQ-047-14 | フェーズインジケーターを4つのドットで表示すること | 🔵 |
| REQ-047-15 | 現在フェーズがハイライト表示されること | 🔵 |
| REQ-047-16 | 完了フェーズにチェックマークが表示されること | 🟡 |
| REQ-047-17 | 手札表示エリアのプレースホルダーを5つ表示すること | 🔵 |
| REQ-047-18 | 「次へ」ボタンを表示すること | 🔵 |
| REQ-047-19 | 「次へ」ボタンのラベルがフェーズに応じて変化すること | 🔵 |

### 非機能要件

| 要件ID | 要件 |
|--------|------|
| NFR-047-01 | テスト容易性: すべての視覚要素がテストで検証可能であること |
| NFR-047-02 | 既存テストが引き続きパスすること |
| NFR-047-03 | update()メソッド呼び出し時に表示が更新されること |

---

## テストケース

### HeaderUI視覚テスト

```typescript
describe('HeaderUI 視覚実装', () => {
  describe('create()', () => {
    it('ランク表示テキストが生成されること', () => {});
    it('昇格ゲージの背景バーが生成されること', () => {});
    it('昇格ゲージのフィルバーが生成されること', () => {});
    it('残り日数テキストが生成されること', () => {});
    it('所持金テキストが生成されること', () => {});
    it('行動ポイントテキストが生成されること', () => {});
  });

  describe('update() 視覚更新', () => {
    it('ランク更新時にテキストが変更されること', () => {});
    it('昇格ゲージ更新時にバー幅が変更されること', () => {});
    it('昇格ゲージ30%未満で赤色になること', () => {});
    it('昇格ゲージ30-59%で黄色になること', () => {});
    it('昇格ゲージ60-99%で緑色になること', () => {});
    it('昇格ゲージ100%で水色になること', () => {});
    it('残り日数4-5日で赤色になること', () => {});
    it('残り日数6-10日で黄色になること', () => {});
    it('残り日数11日以上で白色になること', () => {});
    it('残り日数3日以下で点滅フラグがtrueになること', () => {});
  });
});
```

### SidebarUI視覚テスト

```typescript
describe('SidebarUI 視覚実装', () => {
  describe('create()', () => {
    it('受注依頼セクションヘッダーが生成されること', () => {});
    it('素材セクションヘッダーが生成されること', () => {});
    it('完成品セクションヘッダーが生成されること', () => {});
    it('保管容量テキストが生成されること', () => {});
    it('ショップボタンが生成されること', () => {});
  });

  describe('update() 視覚更新', () => {
    it('保管容量更新時にテキストが変更されること', () => {});
  });

  describe('toggleSection() 視覚更新', () => {
    it('セクション折りたたみ時にアイコンが変化すること', () => {});
  });
});
```

### FooterUI視覚テスト

```typescript
describe('FooterUI 視覚実装', () => {
  describe('create()', () => {
    it('フェーズインジケーターが4つ生成されること', () => {});
    it('手札表示エリアのプレースホルダーが5つ生成されること', () => {});
    it('次へボタンが生成されること', () => {});
  });

  describe('updatePhaseIndicator() 視覚更新', () => {
    it('現在フェーズのインジケーターがハイライトされること', () => {});
    it('完了フェーズのインジケーターが完了スタイルになること', () => {});
    it('未到達フェーズのインジケーターがグレーアウトされること', () => {});
  });

  describe('updateNextButton() 視覚更新', () => {
    it('ボタンラベルが更新されること', () => {});
    it('無効時にボタンがグレーアウトされること', () => {});
  });
});
```

---

## 実装計画

### ステップ1: HeaderUI視覚実装（1.5時間）

1. Phaserテキストオブジェクトの作成（ランク、残り日数、所持金、AP）
2. 昇格ゲージのプログレスバー実装（背景＋フィル）
3. update()メソッドで視覚要素を更新する処理を追加
4. 色の動的変更ロジック実装

### ステップ2: SidebarUI視覚実装（1時間）

1. セクションヘッダーテキストの作成
2. 折りたたみアイコンの実装（▼/▶）
3. 保管容量テキストの作成
4. ショップボタンの作成（Phaser.GameObjects.Rectangle + Text）

### ステップ3: FooterUI視覚実装（1.5時間）

1. フェーズインジケーターの作成（4つのドット + ライン）
2. 手札表示エリアのプレースホルダー作成（5つの矩形）
3. 次へボタンの作成
4. 状態に応じたスタイル変更ロジック実装

---

## 設計仕様

### 色定数（設計書 common-components.md より）

```typescript
const COLORS = {
  // ステータス色
  RED: 0xFF6B6B,       // 昇格ゲージ0-29%、残り日数4-5日
  YELLOW: 0xFFD93D,    // 昇格ゲージ30-59%、残り日数6-10日
  GREEN: 0x6BCB77,     // 昇格ゲージ60-99%
  CYAN: 0x4ECDC4,      // 昇格ゲージ100%
  WHITE: 0xFFFFFF,     // 残り日数11日以上
  BRIGHT_RED: 0xFF0000, // 残り日数1-3日（点滅用）

  // 背景色
  BACKGROUND: 0x1F2937,
  BACKGROUND_LIGHT: 0x374151,

  // テキスト色
  TEXT_PRIMARY: 0xFFFFFF,
  TEXT_SECONDARY: 0x9CA3AF,
  TEXT_MUTED: 0x6B7280,

  // フェーズインジケーター
  PHASE_PENDING: 0x6B7280,   // 未到達（グレー）
  PHASE_CURRENT: 0x6366F1,   // 現在（プライマリ）
  PHASE_COMPLETED: 0x10B981, // 完了（緑）
};
```

### レイアウト定数（MainScene.ts より）

```typescript
const LAYOUT = {
  SIDEBAR_WIDTH: 200,
  HEADER_HEIGHT: 60,
  FOOTER_HEIGHT: 120,
};
```

---

## 受け入れ条件

- [x] HeaderUIのすべての表示要素が画面に描画される
- [x] SidebarUIのすべての表示要素が画面に描画される
- [x] FooterUIのすべての表示要素が画面に描画される
- [x] 各コンポーネントのupdate()呼び出しで表示が正しく更新される
- [ ] 既存のテストがすべてパスする ※DIコンテナ関連のテスト失敗は別タスクで対応
- [x] 新規テストがすべてパスする（58テスト全てパス）
- [ ] 「新規ゲーム」クリック後にMainSceneの4分割レイアウトが表示される ※実機確認は別途必要

---

## 関連ドキュメント

- **UI設計書**: `docs/design/atelier-guild-rank/ui-design/screens/common-components.md`
- **メイン画面設計**: `docs/design/atelier-guild-rank/ui-design/screens/main.md`
- **既存実装**: `src/presentation/ui/components/HeaderUI.ts`
- **既存実装**: `src/presentation/ui/components/SidebarUI.ts`
- **既存実装**: `src/presentation/ui/components/FooterUI.ts`

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-22 | 初版作成 |
| 2026-01-22 | TDD実装完了 - HeaderUI(33テスト), SidebarUI(10テスト), FooterUI(15テスト) 全58テストパス |
