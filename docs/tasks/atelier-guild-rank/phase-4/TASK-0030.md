# TASK-0030: E2Eテスト・デバッグ

**バージョン**: 1.0.0
**作成日**: 2026-01-16
**フェーズ**: 4 - 統合・テスト
**見積時間**: 4時間（半日）
**依存タスク**: TASK-0028, TASK-0029

---

## 1. タスク概要

| 項目 | 値 |
|------|-----|
| **タスクID** | TASK-0030 |
| **タスク名** | E2Eテスト・デバッグ |
| **カテゴリ** | テスト |
| **優先度** | 高 |
| **担当レイヤー** | 全レイヤー |

### 信頼性レベル

- 🔵 **青信号**: 設計文書に記載
- 🟡 **黄信号**: 設計文書から妥当な推測
- 🔴 **赤信号**: 設計文書にない推測

---

## 2. 実装内容

### 2.1 E2Eテストシナリオ 🟡

`tests/e2e/game-flow.test.ts`:

```typescript
describe('ゲームフロー E2E', () => {
  describe('新規ゲーム開始', () => {
    it('タイトル画面から新規ゲームを開始できる', async () => {
      // 1. タイトル画面表示
      // 2. 新規ゲームボタンクリック
      // 3. MainScene遷移確認
      // 4. 初期状態確認（G rank, 30日, 100G）
    });
  });

  describe('1日のサイクル', () => {
    it('依頼受注→採取→調合→納品が完了できる', async () => {
      // 1. 依頼受注フェーズ
      // 2. 採取フェーズ（カードプレイ、素材選択）
      // 3. 調合フェーズ（レシピ選択、調合実行）
      // 4. 納品フェーズ（アイテム納品）
      // 5. 日終了、翌日開始確認
    });
  });

  describe('ゲームクリア', () => {
    it('Sランク到達でゲームクリアになる', async () => {
      // Sランク状態をセットアップ
      // ゲームクリア画面遷移確認
    });
  });

  describe('ゲームオーバー', () => {
    it('残り日数0でゲームオーバーになる', async () => {
      // 残り日数1、非Sランク状態をセットアップ
      // 日終了処理
      // ゲームオーバー画面遷移確認
    });
  });
});
```

### 2.2 デバッグツール 🔴

`src/shared/utils/debug.ts`:

```typescript
export class DebugTools {
  static setRank(rank: GuildRank): void {
    // ランク即時変更
  }

  static addGold(amount: number): void {
    // ゴールド追加
  }

  static skipToDay(day: number): void {
    // 指定日にスキップ
  }

  static unlockAllCards(): void {
    // 全カード解放
  }

  static logState(): void {
    // 現在状態をコンソール出力
  }
}
```

### 2.3 テストヘルパー 🟡

- ゲーム状態のセットアップヘルパー
- モックサービスの提供
- スナップショットテスト

### 2.4 パフォーマンステスト 🔴

- フレームレート監視
- メモリ使用量チェック
- ロード時間計測

---

## 3. 受け入れ基準

### 3.1 必須条件 🔵

- [ ] 主要ゲームフローのE2Eテストが通る
- [ ] クリティカルパスに問題がない
- [ ] コンソールエラーがない

### 3.2 推奨条件 🟡

- [ ] デバッグツールが動作する
- [ ] パフォーマンスが許容範囲内

---

## 4. テストケース

### 4.1 E2Eテスト

| テストID | テスト内容 | 期待結果 |
|---------|----------|----------|
| T-0030-01 | 新規ゲーム開始 | MainScene表示 |
| T-0030-02 | 1日サイクル完了 | 翌日開始 |
| T-0030-03 | セーブ→ロード | 状態復元 |
| T-0030-04 | ゲームクリア | クリア画面表示 |
| T-0030-05 | ゲームオーバー | オーバー画面表示 |

---

## 5. 成果物

| 成果物 | パス |
|--------|------|
| E2Eテスト | `/tests/e2e/game-flow.test.ts` |
| デバッグツール | `/src/shared/utils/debug.ts` |
| テストヘルパー | `/tests/helpers/` |

---

## 関連文書

- **データフロー設計書**: [../../design/atelier-guild-rank/dataflow.md](../../design/atelier-guild-rank/dataflow.md)

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | 初版作成 |
