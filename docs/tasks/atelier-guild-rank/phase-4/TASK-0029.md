# TASK-0029: ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½çµ±åˆ

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2026-01-16
**ãƒ•ã‚§ãƒ¼ã‚º**: 4 - çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ
**è¦‹ç©æ™‚é–“**: 4æ™‚é–“ï¼ˆåŠæ—¥ï¼‰
**ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0007, TASK-0028

---

## 1. ã‚¿ã‚¹ã‚¯æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0029 |
| **ã‚¿ã‚¹ã‚¯å** | ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½çµ±åˆ |
| **ã‚«ãƒ†ã‚´ãƒª** | çµ±åˆ |
| **å„ªå…ˆåº¦** | é«˜ |
| **æ‹…å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼** | Application |

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«

- ğŸ”µ **é’ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

---

## 2. å®Ÿè£…å†…å®¹

### 2.1 ã‚»ãƒ¼ãƒ–æ©Ÿèƒ½å®Ÿè£… ğŸ”µ

`src/application/services/save-load-service.ts`:

```typescript
export class SaveLoadService {
  constructor(
    private saveRepo: ISaveDataRepository,
    private stateManager: IStateManager,
    private deckService: IDeckService,
    private inventoryService: IInventoryService,
    private questService: IQuestService,
  ) {}

  async save(): Promise<void> {
    const saveData: SaveData = {
      version: '1.0.0',
      lastSaved: new Date().toISOString(),
      gameState: this.stateManager.getState(),
      deckState: {
        deck: this.deckService.getDeck().map(c => c.id),
        hand: this.deckService.getHand().map(c => c.id),
        discard: this.deckService.getDiscard().map(c => c.id),
      },
      inventoryState: {
        materials: this.inventoryService.getMaterials(),
        items: this.inventoryService.getItems(),
        artifacts: this.inventoryService.getArtifacts(),
      },
      questState: {
        acceptedQuests: this.questService.getAcceptedQuests(),
        dailyQuests: this.questService.getAvailableQuests(),
      },
    };

    await this.saveRepo.save(saveData);
  }

  async load(): Promise<boolean> {
    const saveData = await this.saveRepo.load();
    if (!saveData) return false;

    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
    if (!this.isCompatibleVersion(saveData.version)) {
      throw new Error('Incompatible save data version');
    }

    // çŠ¶æ…‹å¾©å…ƒ
    this.stateManager.loadFromSaveData(saveData);
    this.deckService.loadFromSaveData(saveData.deckState);
    this.inventoryService.loadFromSaveData(saveData.inventoryState);
    this.questService.loadFromSaveData(saveData.questState);

    return true;
  }

  hasSaveData(): boolean {
    return this.saveRepo.exists();
  }

  async deleteSaveData(): Promise<void> {
    await this.saveRepo.delete();
  }
}
```

### 2.2 ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–æ©Ÿèƒ½ ğŸŸ¡

- æ—¥çµ‚äº†æ™‚ã«è‡ªå‹•ã‚»ãƒ¼ãƒ–
- ãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†æ™‚ã«è‡ªå‹•ã‚»ãƒ¼ãƒ–
- ã‚»ãƒ¼ãƒ–ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º

### 2.3 ã‚»ãƒ¼ãƒ–ã‚¹ãƒ­ãƒƒãƒˆç®¡ç† ğŸ”´

- è¤‡æ•°ã‚»ãƒ¼ãƒ–ã‚¹ãƒ­ãƒƒãƒˆï¼ˆå°†æ¥æ‹¡å¼µï¼‰
- ã‚¹ãƒ­ãƒƒãƒˆé¸æŠUI

---

## 3. å—ã‘å…¥ã‚ŒåŸºæº–

### 3.1 å¿…é ˆæ¡ä»¶ ğŸ”µ

- [ ] æ‰‹å‹•ã‚»ãƒ¼ãƒ–ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ­ãƒ¼ãƒ‰ã§ã‚²ãƒ¼ãƒ ãŒå†é–‹ã§ãã‚‹
- [ ] ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãŒå‹•ä½œã™ã‚‹

### 3.2 æ¨å¥¨æ¡ä»¶ ğŸŸ¡

- [ ] ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–æ©Ÿèƒ½
- [ ] ã‚»ãƒ¼ãƒ–ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º

---

## 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 4.1 çµ±åˆãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0029-01 | ã‚»ãƒ¼ãƒ–å®Ÿè¡Œ | ãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸ |
| T-0029-02 | ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ | çŠ¶æ…‹å¾©å…ƒæˆåŠŸ |
| T-0029-03 | å­˜åœ¨ãƒã‚§ãƒƒã‚¯ | æ­£ã—ã„çµæœ |
| T-0029-04 | å‰Šé™¤å®Ÿè¡Œ | ãƒ‡ãƒ¼ã‚¿å‰Šé™¤æˆåŠŸ |
| T-0029-05 | éäº’æ›ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ |

---

## 5. æˆæœç‰©

| æˆæœç‰© | ãƒ‘ã‚¹ |
|--------|------|
| SaveLoadService | `/src/application/services/save-load-service.ts` |
| ãƒ†ã‚¹ãƒˆ | `/tests/integration/save-load.test.ts` |

---

## é–¢é€£æ–‡æ›¸

- **ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ**: [../../design/atelier-guild-rank/data-schema-save.md](../../design/atelier-guild-rank/data-schema-save.md)
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆæ›¸**: [../../design/atelier-guild-rank/dataflow.md](../../design/atelier-guild-rank/dataflow.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |
