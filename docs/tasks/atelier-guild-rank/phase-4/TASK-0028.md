# TASK-0028: ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆãƒ»DIè¨­å®š

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2026-01-16
**ãƒ•ã‚§ãƒ¼ã‚º**: 4 - çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ
**è¦‹ç©æ™‚é–“**: 4æ™‚é–“ï¼ˆåŠæ—¥ï¼‰
**ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0009ã€œTASK-0017

---

## 1. ã‚¿ã‚¹ã‚¯æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0028 |
| **ã‚¿ã‚¹ã‚¯å** | ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆãƒ»DIè¨­å®š |
| **ã‚«ãƒ†ã‚´ãƒª** | çµ±åˆ |
| **å„ªå…ˆåº¦** | é«˜ |
| **æ‹…å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼** | Infrastructure |

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«

- ğŸ”µ **é’ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

---

## 2. å®Ÿè£…å†…å®¹

### 2.1 DIã‚³ãƒ³ãƒ†ãƒŠå®Ÿè£… ğŸŸ¡

`src/infrastructure/di/container.ts`:

```typescript
export class Container {
  private static instance: Container;
  private services: Map<string, any> = new Map();

  static getInstance(): Container {
    if (!Container.instance) {
      Container.instance = new Container();
    }
    return Container.instance;
  }

  register<T>(key: string, service: T): void {
    this.services.set(key, service);
  }

  resolve<T>(key: string): T {
    const service = this.services.get(key);
    if (!service) {
      throw new Error(`Service not found: ${key}`);
    }
    return service;
  }
}

export const ServiceKeys = {
  EventBus: 'EventBus',
  StateManager: 'StateManager',
  MasterDataRepository: 'MasterDataRepository',
  SaveDataRepository: 'SaveDataRepository',
  DeckService: 'DeckService',
  MaterialService: 'MaterialService',
  GatheringService: 'GatheringService',
  AlchemyService: 'AlchemyService',
  QuestService: 'QuestService',
  InventoryService: 'InventoryService',
  ShopService: 'ShopService',
  ArtifactService: 'ArtifactService',
  RankService: 'RankService',
  GameFlowManager: 'GameFlowManager',
} as const;
```

### 2.2 ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ– ğŸ”µ

`src/infrastructure/di/setup.ts`:

```typescript
export async function initializeServices(): Promise<Container> {
  const container = Container.getInstance();

  // ã‚¤ãƒ³ãƒ•ãƒ©å±¤
  const eventBus = new EventBus();
  container.register(ServiceKeys.EventBus, eventBus);

  const masterDataRepo = new MasterDataRepository();
  await masterDataRepo.load();
  container.register(ServiceKeys.MasterDataRepository, masterDataRepo);

  const saveDataRepo = new LocalStorageSaveRepository();
  container.register(ServiceKeys.SaveDataRepository, saveDataRepo);

  // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
  const stateManager = new StateManager(eventBus);
  container.register(ServiceKeys.StateManager, stateManager);

  const materialService = new MaterialService(masterDataRepo);
  container.register(ServiceKeys.MaterialService, materialService);

  const deckService = new DeckService(masterDataRepo, eventBus);
  container.register(ServiceKeys.DeckService, deckService);

  // ... ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–

  return container;
}
```

### 2.3 ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–é †åº ğŸ”µ

1. EventBus
2. MasterDataRepositoryï¼ˆéåŒæœŸãƒ­ãƒ¼ãƒ‰ï¼‰
3. SaveDataRepository
4. StateManager
5. DeckService, MaterialService
6. GatheringService, AlchemyService, QuestService
7. InventoryService
8. ShopService, ArtifactService, RankService
9. GameFlowManager

### 2.4 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ğŸ”µ

- ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤
- ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

---

## 3. å—ã‘å…¥ã‚ŒåŸºæº–

### 3.1 å¿…é ˆæ¡ä»¶ ğŸ”µ

- [x] å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã‚‹
- [x] ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè§£æ±ºã•ã‚Œã‚‹
- [x] ã‚·ãƒ¼ãƒ³ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹

### 3.2 æ¨å¥¨æ¡ä»¶ ğŸŸ¡

- [x] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ã®é©åˆ‡ãªãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] åˆæœŸåŒ–é€²æ—ã®é€šçŸ¥

---

## 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 4.1 çµ±åˆãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0028-01 | ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ– | å…¨ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨å¯èƒ½ |
| T-0028-02 | ä¾å­˜é–¢ä¿‚è§£æ±º | æ­£ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾— |
| T-0028-03 | ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼ | ãƒªãƒˆãƒ©ã‚¤å‹•ä½œ |
| T-0028-04 | ã‚·ãƒ¼ãƒ³ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ | ã‚µãƒ¼ãƒ“ã‚¹å–å¾—å¯èƒ½ |

---

## 5. æˆæœç‰©

| æˆæœç‰© | ãƒ‘ã‚¹ |
|--------|------|
| DIã‚³ãƒ³ãƒ†ãƒŠ | `/src/infrastructure/di/container.ts` |
| ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | `/src/infrastructure/di/setup.ts` |
| ãƒ†ã‚¹ãƒˆ | `/tests/integration/di/setup.test.ts` |

---

## é–¢é€£æ–‡æ›¸

- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸**: [../../design/atelier-guild-rank/architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |
