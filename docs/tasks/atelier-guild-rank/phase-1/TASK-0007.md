# TASK-0007: ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2026-01-16
**ãƒ•ã‚§ãƒ¼ã‚º**: 1 - åŸºç›¤æ§‹ç¯‰
**è¦‹ç©æ™‚é–“**: 4æ™‚é–“ï¼ˆåŠæ—¥ï¼‰
**ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0003

---

## 1. ã‚¿ã‚¹ã‚¯æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0007 |
| **ã‚¿ã‚¹ã‚¯å** | ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£… |
| **ã‚«ãƒ†ã‚´ãƒª** | åŸºç›¤æ§‹ç¯‰ |
| **å„ªå…ˆåº¦** | é«˜ |
| **æ‹…å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼** | Infrastructure |

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«

- ğŸ”µ **é’ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

---

## 2. å®Ÿè£…å†…å®¹

### 2.1 ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿å‹å®šç¾© ğŸ”µ

`src/shared/types/save-data.ts`:

```typescript
export interface SaveData {
  version: string;
  lastSaved: string; // ISO 8601
  gameState: GameState;
  deckState: DeckState;
  inventoryState: InventoryState;
  questState: QuestState;
}

export interface DeckState {
  deck: CardId[];
  hand: CardId[];
  discard: CardId[];
}

export interface InventoryState {
  materials: MaterialInstance[];
  items: ItemInstance[];
  artifacts: ArtifactId[];
}

export interface QuestState {
  acceptedQuests: Quest[];
  dailyQuests: Quest[];
}
```

### 2.2 ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸ”µ

`src/domain/interfaces/save-data-repository.interface.ts`:

```typescript
export interface ISaveDataRepository {
  save(data: SaveData): Promise<void>;
  load(): Promise<SaveData | null>;
  exists(): boolean;
  delete(): Promise<void>;
  getLastSavedTime(): Date | null;
}
```

### 2.3 LocalStorageå®Ÿè£… ğŸ”µ

`src/infrastructure/repositories/local-storage-save-repository.ts`:

```typescript
export class LocalStorageSaveRepository implements ISaveDataRepository {
  private readonly STORAGE_KEY = 'atelier-guild-rank-save';

  async save(data: SaveData): Promise<void> {
    const json = JSON.stringify(data);
    localStorage.setItem(this.STORAGE_KEY, json);
  }

  async load(): Promise<SaveData | null> {
    const json = localStorage.getItem(this.STORAGE_KEY);
    if (!json) return null;

    try {
      return JSON.parse(json) as SaveData;
    } catch {
      console.error('Failed to parse save data');
      return null;
    }
  }

  exists(): boolean {
    return localStorage.getItem(this.STORAGE_KEY) !== null;
  }

  async delete(): Promise<void> {
    localStorage.removeItem(this.STORAGE_KEY);
  }

  getLastSavedTime(): Date | null {
    const data = localStorage.getItem(this.STORAGE_KEY);
    if (!data) return null;
    try {
      const parsed = JSON.parse(data) as SaveData;
      return new Date(parsed.lastSaved);
    } catch {
      return null;
    }
  }
}
```

### 2.4 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ğŸŸ¡

- ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
- äº’æ›æ€§ãŒãªã„å ´åˆã®å‡¦ç†

---

## 3. å—ã‘å…¥ã‚ŒåŸºæº–

### 3.1 å¿…é ˆæ¡ä»¶ ğŸ”µ

- [ ] ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãŒã§ãã‚‹
- [ ] å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãŒå‹•ä½œã™ã‚‹
- [ ] å‰Šé™¤ãŒå‹•ä½œã™ã‚‹
- [ ] ç ´æãƒ‡ãƒ¼ã‚¿ã®å ´åˆnullã‚’è¿”ã™

### 3.2 æ¨å¥¨æ¡ä»¶ ğŸŸ¡

- [ ] ãƒ‡ãƒ¼ã‚¿åœ§ç¸®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 4.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0007-01 | ã‚»ãƒ¼ãƒ–â†’ãƒ­ãƒ¼ãƒ‰ | åŒä¸€ãƒ‡ãƒ¼ã‚¿å–å¾— |
| T-0007-02 | å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆå­˜åœ¨æ™‚ï¼‰ | true |
| T-0007-03 | å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆæœªå­˜åœ¨æ™‚ï¼‰ | false |
| T-0007-04 | å‰Šé™¤ | exists()ãŒfalse |
| T-0007-05 | ç ´æãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰ | nullè¿”å´ |

---

## 5. æˆæœç‰©

| æˆæœç‰© | ãƒ‘ã‚¹ |
|--------|------|
| ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿å‹ | `/src/shared/types/save-data.ts` |
| ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `/src/domain/interfaces/save-data-repository.interface.ts` |
| å®Ÿè£… | `/src/infrastructure/repositories/local-storage-save-repository.ts` |
| ãƒ†ã‚¹ãƒˆ | `/tests/unit/infrastructure/repositories/local-storage-save-repository.test.ts` |

---

## é–¢é€£æ–‡æ›¸

- **ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ**: [../../design/atelier-guild-rank/data-schema-save.md](../../design/atelier-guild-rank/data-schema-save.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |
