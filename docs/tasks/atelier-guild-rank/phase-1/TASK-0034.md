# TASK-0034: Lefthookè¨­å®š

**ã‚¿ã‚¹ã‚¯ID**: TASK-0034
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: DIRECT
**æ¨å®šå·¥æ•°**: 2æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - åŸºç›¤æ§‹ç¯‰
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸ”µ *architecture-overview.md v2.2.0ã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](../overview.md)
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture-overview.md](../../../design/atelier-guild-rank/architecture-overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

Lefthookï¼ˆGit Hooksç®¡ç†ãƒ„ãƒ¼ãƒ«ï¼‰ã‚’è¨­å®šã—ã€ã‚³ãƒŸãƒƒãƒˆå‰ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã€‚Biomeã«ã‚ˆã‚‹lint/formatãƒã‚§ãƒƒã‚¯ã¨TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã€å“è³ªã®ä½ã„ã‚³ãƒ¼ãƒ‰ãŒã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’é˜²ãã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0033: pnpmç§»è¡Œã¨Biomeè¨­å®š](TASK-0033.md)
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: ãªã—ï¼ˆPhase 1ã®å“è³ªç®¡ç†åŸºç›¤ã¨ã—ã¦ä»–ã‚¿ã‚¹ã‚¯ã«å½±éŸ¿ï¼‰

## å®Œäº†æ¡ä»¶

- [ ] Lefthook 1.xãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] lefthook.ymlãŒè¨­å®šæ¸ˆã¿
- [ ] `git commit` æ™‚ã«pre-commitãƒ•ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- [ ] lint/formatã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹ã¨ã‚³ãƒŸãƒƒãƒˆãŒæ‹’å¦ã•ã‚Œã‚‹
- [ ] å‹ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹ã¨ã‚³ãƒŸãƒƒãƒˆãŒæ‹’å¦ã•ã‚Œã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. Lefthookã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *architecture-overview.md ã‚»ã‚¯ã‚·ãƒ§ãƒ³1.2ã‚ˆã‚Š*

```bash
pnpm add -D lefthook
```

### 2. lefthook.ymlä½œæˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *architecture-overview.md ã‚»ã‚¯ã‚·ãƒ§ãƒ³1.2, 1.6ã‚ˆã‚Š*

```yaml
# lefthook.yml
pre-commit:
  parallel: true
  commands:
    biome-check:
      glob: "*.{ts,tsx,js,jsx,json}"
      run: pnpm biome check --write --staged
      stage_fixed: true
    typecheck:
      glob: "*.{ts,tsx}"
      run: pnpm tsc --noEmit

commit-msg:
  commands:
    commitlint:
      run: |
        # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        # feat:, fix:, docs:, test:, refactor:, chore: ã§å§‹ã¾ã‚‹ã“ã¨ã‚’ç¢ºèª
        message=$(cat {1})
        if ! echo "$message" | grep -qE "^(feat|fix|docs|test|refactor|chore|style|perf|ci|build|revert)(\(.+\))?: .+"; then
          echo "ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯Conventional Commitså½¢å¼ã§è¨˜è¿°ã—ã¦ãã ã•ã„"
          echo "ä¾‹: feat: æ–°æ©Ÿèƒ½è¿½åŠ "
          echo "ä¾‹: fix(auth): ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚°ä¿®æ­£"
          exit 1
        fi
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `lefthook.yml`

### 3. Git Hooksã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *Lefthookæ¨™æº–æ‰‹é †*

```bash
# Git Hooksã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm lefthook install
```

### 4. package.jsonã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ  ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *åˆ©ä¾¿æ€§ã®ãŸã‚ã®è¿½åŠ *

```json
{
  "scripts": {
    "prepare": "lefthook install",
    "hooks:install": "lefthook install",
    "hooks:uninstall": "lefthook uninstall"
  }
}
```

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `package.json`

---

## ãƒ†ã‚¹ãƒˆè¦ä»¶

### å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *æ¨™æº–çš„ãªå‹•ä½œç¢ºèª*

1. **æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ**
   - lint/formatã‚¨ãƒ©ãƒ¼ã®ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã‚³ãƒŸãƒƒãƒˆ â†’ æˆåŠŸ
   - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ `feat: test` ã®å½¢å¼ â†’ æˆåŠŸ

2. **ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ**
   - lint/formatã‚¨ãƒ©ãƒ¼ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° â†’ è‡ªå‹•ä¿®æ­£ã•ã‚Œã¦ã‚³ãƒŸãƒƒãƒˆ
   - TypeScriptå‹ã‚¨ãƒ©ãƒ¼ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ â†’ ã‚³ãƒŸãƒƒãƒˆæ‹’å¦
   - ä¸æ­£ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ `test commit` â†’ ã‚³ãƒŸãƒƒãƒˆæ‹’å¦

---

## å®Ÿè£…æ‰‹é †

### DIRECTã‚¿ã‚¹ã‚¯

1. `/tsumiki:direct-setup` - Lefthookè¨­å®š
2. `/tsumiki:direct-verify` - å‹•ä½œç¢ºèª

---

## æ³¨æ„äº‹é …

- `pnpm install` å¾Œã« `prepare` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªå‹•çš„ã«hooksãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹
- ãƒãƒ¼ãƒ é–‹ç™ºæ™‚ã¯å…¨å“¡ãŒ `pnpm install` ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§hooksãŒæœ‰åŠ¹ã«ãªã‚‹
- CIã§ã¯ `--no-verify` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚‹

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| å®Ÿè£…è©³ç´° | 3 | 1 | 0 | 4 |
| ãƒ†ã‚¹ãƒˆè¦ä»¶ | 1 | 0 | 0 | 1 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 5é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 4é …ç›® (80%)
- ğŸŸ¡ **é»„ä¿¡å·**: 1é …ç›® (20%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
