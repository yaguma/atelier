# TASK-0013: ä¾é ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»QuestServiceå®Ÿè£…

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2026-01-16
**ãƒ•ã‚§ãƒ¼ã‚º**: 2 - ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãƒ»ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹
**è¦‹ç©æ™‚é–“**: 4æ™‚é–“ï¼ˆåŠæ—¥ï¼‰
**ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0003, TASK-0004

---

## 1. ã‚¿ã‚¹ã‚¯æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0013 |
| **ã‚¿ã‚¹ã‚¯å** | ä¾é ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»QuestServiceå®Ÿè£… |
| **ã‚«ãƒ†ã‚´ãƒª** | ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ |
| **å„ªå…ˆåº¦** | æœ€é«˜ |
| **æ‹…å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼** | Domain, Application |

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«

- ğŸ”µ **é’ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

---

## 2. å®Ÿè£…å†…å®¹

### 2.1 ä¾é ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ğŸ”µ

`src/domain/entities/Quest.ts`:

```typescript
export class Quest {
  constructor(
    public readonly id: QuestId,
    public readonly client: ClientMaster,
    public readonly requirements: QuestRequirement[],
    public readonly reward: QuestReward,
    public readonly deadline: number, // æ®‹ã‚Šæ—¥æ•°
    public status: QuestStatus = 'available',
  ) {}

  get clientType(): ClientType {
    return this.client.type;
  }

  // ç´å“å¯èƒ½ãƒã‚§ãƒƒã‚¯
  canDeliver(items: ItemInstance[]): boolean {
    return this.requirements.every(req =>
      this.checkRequirement(req, items)
    );
  }

  private checkRequirement(
    req: QuestRequirement,
    items: ItemInstance[],
  ): boolean {
    const matching = items.filter(item =>
      item.itemId === req.itemId &&
      compareQuality(item.quality, req.minQuality) >= 0
    );
    return matching.length >= req.quantity;
  }
}

export type QuestStatus = 'available' | 'accepted' | 'completed' | 'failed';

export interface QuestRequirement {
  itemId: ItemId;
  quantity: number;
  minQuality: Quality;
}

export interface QuestReward {
  gold: number;
  contribution: number;
}
```

### 2.2 QuestServiceã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸ”µ

`src/domain/interfaces/quest-service.interface.ts`:

```typescript
export interface IQuestService {
  // ä¾é ¼ç”Ÿæˆ
  generateDailyQuests(rank: GuildRank): Quest[];

  // ä¾é ¼å—æ³¨
  acceptQuest(questId: QuestId): void;

  // ç´å“
  deliver(questId: QuestId, items: ItemInstance[]): DeliveryResult;

  // çŠ¶æ…‹å–å¾—
  getAvailableQuests(): Quest[];
  getAcceptedQuests(): Quest[];

  // æ¡ä»¶ãƒã‚§ãƒƒã‚¯
  checkDeliveryCondition(questId: QuestId, items: ItemInstance[]): boolean;

  // æ—¥çµ‚äº†å‡¦ç†
  processEndOfDay(): FailedQuest[];
}

export interface DeliveryResult {
  success: boolean;
  reward: QuestReward;
  consumedItems: ItemInstance[];
  contribution: number;
}
```

### 2.3 QuestServiceå®Ÿè£… ğŸ”µ

`src/application/services/quest-service.ts`:

- æ—¥æ¬¡ä¾é ¼ç”Ÿæˆï¼ˆãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸé›£æ˜“åº¦ï¼‰
- ä¾é ¼å—æ³¨ç®¡ç†
- ç´å“å‡¦ç†ã¨å ±é…¬è¨ˆç®—
- æœŸé™åˆ‡ã‚Œå‡¦ç†

### 2.4 ä¾é ¼ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ ğŸ”µ

- ãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸä¾é ¼è€…ãƒ—ãƒ¼ãƒ«
- è¦æ±‚ã‚¢ã‚¤ãƒ†ãƒ ã®é›£æ˜“åº¦èª¿æ•´
- å ±é…¬ã®è‡ªå‹•è¨ˆç®—

---

## 3. å—ã‘å…¥ã‚ŒåŸºæº–

### 3.1 å¿…é ˆæ¡ä»¶ ğŸ”µ

- [ ] æ—¥æ¬¡ä¾é ¼ãŒç”Ÿæˆã•ã‚Œã‚‹
- [ ] ä¾é ¼ã‚’å—æ³¨ã§ãã‚‹
- [ ] æ¡ä»¶ã‚’æº€ãŸã™ã‚¢ã‚¤ãƒ†ãƒ ã§ç´å“ã§ãã‚‹
- [ ] å ±é…¬ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹

### 3.2 æ¨å¥¨æ¡ä»¶ ğŸŸ¡

- [ ] æœŸé™åˆ‡ã‚Œä¾é ¼ã®è‡ªå‹•å¤±æ•—å‡¦ç†
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 4.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0013-01 | æ—¥æ¬¡ä¾é ¼ç”Ÿæˆ | ãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸä¾é ¼ |
| T-0013-02 | ä¾é ¼å—æ³¨ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ |
| T-0013-03 | ç´å“æˆåŠŸ | å ±é…¬ç²å¾—ã€ä¾é ¼å®Œäº† |
| T-0013-04 | ç´å“å¤±æ•—ï¼ˆæ¡ä»¶æœªé”ï¼‰ | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ |
| T-0013-05 | æœŸé™åˆ‡ã‚Œå‡¦ç† | ä¾é ¼å¤±æ•— |

---

## 5. æˆæœç‰©

| æˆæœç‰© | ãƒ‘ã‚¹ |
|--------|------|
| ä¾é ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ | `/src/domain/entities/Quest.ts` |
| ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `/src/domain/interfaces/quest-service.interface.ts` |
| å®Ÿè£… | `/src/application/services/quest-service.ts` |
| ãƒ†ã‚¹ãƒˆ | `/tests/unit/application/services/quest-service.test.ts` |

---

## é–¢é€£æ–‡æ›¸

- **ã‚²ãƒ¼ãƒ ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹è¨­è¨ˆ**: [../../design/atelier-guild-rank/game-mechanics.md](../../design/atelier-guild-rank/game-mechanics.md)
- **ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹è¨­è¨ˆ**: [../../design/atelier-guild-rank/core-systems-core-services.md](../../design/atelier-guild-rank/core-systems-core-services.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |
