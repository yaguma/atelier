# TASK-0010: ç´ æã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»MaterialServiceå®Ÿè£… âœ… **å®Œäº†** (TDDé–‹ç™ºå®Œäº† - 43ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé)

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.1
**ä½œæˆæ—¥**: 2026-01-16
**å®Œäº†æ—¥**: 2026-01-16
**ãƒ•ã‚§ãƒ¼ã‚º**: 2 - ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãƒ»ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹
**è¦‹ç©æ™‚é–“**: 4æ™‚é–“ï¼ˆåŠæ—¥ï¼‰
**ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0003, TASK-0004

---

## 1. ã‚¿ã‚¹ã‚¯æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0010 |
| **ã‚¿ã‚¹ã‚¯å** | ç´ æã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»MaterialServiceå®Ÿè£… |
| **ã‚«ãƒ†ã‚´ãƒª** | ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ |
| **å„ªå…ˆåº¦** | é«˜ |
| **æ‹…å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼** | Domain, Application |

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«

- ğŸ”µ **é’ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

---

## 2. å®Ÿè£…å†…å®¹

### 2.1 ç´ æã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ğŸ”µ

`src/domain/entities/MaterialInstance.ts`:

```typescript
export class MaterialInstance {
  constructor(
    public readonly instanceId: string,
    public readonly master: MaterialMaster,
    public readonly quality: Quality,
  ) {}

  get materialId(): MaterialId {
    return this.master.id;
  }

  get name(): string {
    return this.master.name;
  }

  get category(): MaterialCategory {
    return this.master.category;
  }
}
```

### 2.2 å“è³ªå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ğŸ”µ

`src/domain/value-objects/Quality.ts`:

```typescript
export const QUALITY_ORDER: Record<Quality, number> = {
  'D': 1,
  'C': 2,
  'B': 3,
  'A': 4,
  'S': 5,
};

export function compareQuality(a: Quality, b: Quality): number {
  return QUALITY_ORDER[a] - QUALITY_ORDER[b];
}

export function getHigherQuality(a: Quality, b: Quality): Quality {
  return compareQuality(a, b) >= 0 ? a : b;
}
```

### 2.3 MaterialServiceã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸ”µ

`src/domain/interfaces/material-service.interface.ts`:

```typescript
export interface IMaterialService {
  // ç´ æç”Ÿæˆ
  createInstance(materialId: MaterialId, quality: Quality): MaterialInstance;
  generateRandomQuality(baseQuality: Quality): Quality;

  // å“è³ªè¨ˆç®—
  calculateAverageQuality(materials: MaterialInstance[]): Quality;

  // æ¤œç´¢
  getMaterialsByCategory(category: MaterialCategory): MaterialMaster[];
  getMaterialsByRank(rank: GuildRank): MaterialMaster[];
}
```

### 2.4 MaterialServiceå®Ÿè£… ğŸ”µ

`src/application/services/material-service.ts`:

- ç´ æã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯IDä»˜ä¸ï¼‰
- å“è³ªã®ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼ˆÂ±1æ®µéšã®å¤‰å‹•ï¼‰
- å¹³å‡å“è³ªè¨ˆç®—

---

## 3. å—ã‘å…¥ã‚ŒåŸºæº–

### 3.1 å¿…é ˆæ¡ä»¶ ğŸ”µ

- [x] ç´ æã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã§ãã‚‹
- [x] å“è³ªæ¯”è¼ƒãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [x] å¹³å‡å“è³ªè¨ˆç®—ãŒæ­£ã—ã„

### 3.2 æ¨å¥¨æ¡ä»¶ ğŸŸ¡

- [x] å“è³ªå¤‰å‹•ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆå“è³ªÂ±1æ®µéšã®ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆå®Ÿè£…æ¸ˆã¿ï¼‰
- [x] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šï¼ˆå®Ÿéš›: 97.92%é”æˆï¼‰

---

## 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 4.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0010-01 | ç´ æã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ | æ­£ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ |
| T-0010-02 | å“è³ªæ¯”è¼ƒ | S > A > B > C > D |
| T-0010-03 | å¹³å‡å“è³ªï¼ˆåŒä¸€å“è³ªï¼‰ | å…¥åŠ›ã¨åŒã˜å“è³ª |
| T-0010-04 | å¹³å‡å“è³ªï¼ˆæ··åˆï¼‰ | æ­£ã—ã„å¹³å‡ |
| T-0010-05 | ãƒ©ãƒ³ãƒ€ãƒ å“è³ªç”Ÿæˆ | åŸºæº–Â±1ä»¥å†… |

---

## 5. æˆæœç‰©

| æˆæœç‰© | ãƒ‘ã‚¹ |
|--------|------|
| ç´ æã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ | `/src/domain/entities/MaterialInstance.ts` |
| å“è³ªå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | `/src/domain/value-objects/Quality.ts` |
| ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `/src/domain/interfaces/material-service.interface.ts` |
| å®Ÿè£… | `/src/application/services/material-service.ts` |
| ãƒ†ã‚¹ãƒˆ | `/tests/unit/application/services/material-service.test.ts` |

---

## é–¢é€£æ–‡æ›¸

- **ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ**: [../../design/atelier-guild-rank/data-schema-master-game.md](../../design/atelier-guild-rank/data-schema-master-game.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |
| 2026-01-16 | 1.0.1 | TDDé–‹ç™ºå®Œäº†ã€43ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šéã€ã‚«ãƒãƒ¬ãƒƒã‚¸97.92%é”æˆ |
