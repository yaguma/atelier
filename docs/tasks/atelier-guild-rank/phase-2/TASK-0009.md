# TASK-0009: ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»DeckServiceå®Ÿè£… âœ… **å®Œäº†** (TDDé–‹ç™ºå®Œäº† - 38ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé)

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2026-01-16
**å®Œäº†æ—¥**: 2026-01-16
**ãƒ•ã‚§ãƒ¼ã‚º**: 2 - ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãƒ»ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹
**è¦‹ç©æ™‚é–“**: 4æ™‚é–“ï¼ˆåŠæ—¥ï¼‰
**ä¾å­˜ã‚¿ã‚¹ã‚¯**: TASK-0003, TASK-0004

---

## 1. ã‚¿ã‚¹ã‚¯æ¦‚è¦

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-0009 |
| **ã‚¿ã‚¹ã‚¯å** | ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»DeckServiceå®Ÿè£… |
| **ã‚«ãƒ†ã‚´ãƒª** | ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ |
| **å„ªå…ˆåº¦** | æœ€é«˜ |
| **æ‹…å½“ãƒ¬ã‚¤ãƒ¤ãƒ¼** | Domain, Application |

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«

- ğŸ”µ **é’ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: è¨­è¨ˆæ–‡æ›¸ã«ãªã„æ¨æ¸¬

---

## 2. å®Ÿè£…å†…å®¹

### 2.1 ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ğŸ”µ

`src/domain/entities/Card.ts`:

```typescript
export class Card {
  constructor(
    public readonly id: CardId,
    public readonly master: CardMaster,
  ) {}

  get name(): string {
    return this.master.name;
  }

  get type(): CardType {
    return this.master.type;
  }

  get cost(): number {
    return this.master.cost;
  }
}
```

### 2.2 DeckServiceã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸ”µ

`src/domain/interfaces/deck-service.interface.ts`:

```typescript
export interface IDeckService {
  // ãƒ‡ãƒƒã‚­æ“ä½œ
  shuffle(): void;
  draw(count: number): Card[];
  playCard(card: Card): void;
  discardHand(): void;
  refillHand(): void;

  // çŠ¶æ…‹å–å¾—
  getDeck(): Card[];
  getHand(): Card[];
  getDiscard(): Card[];
  getHandSize(): number;

  // ãƒ‡ãƒƒã‚­æ§‹ç¯‰
  addCard(cardId: CardId): void;
  removeCard(cardId: CardId): void;

  // åˆæœŸåŒ–
  initialize(cardIds: CardId[]): void;
  reset(): void;
}
```

### 2.3 DeckServiceå®Ÿè£… ğŸ”µ

`src/application/services/deck-service.ts`:

```typescript
export class DeckService implements IDeckService {
  private deck: Card[] = [];
  private hand: Card[] = [];
  private discard: Card[] = [];
  private readonly HAND_SIZE = 5;

  constructor(
    private masterDataRepo: IMasterDataRepository,
    private eventBus: IEventBus,
  ) {}

  shuffle(): void {
    // Fisher-Yatesã‚·ãƒ£ãƒƒãƒ•ãƒ«
    for (let i = this.deck.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
    }
  }

  draw(count: number): Card[] {
    const drawn: Card[] = [];
    for (let i = 0; i < count && this.deck.length > 0; i++) {
      const card = this.deck.pop()!;
      drawn.push(card);
      this.hand.push(card);
    }
    this.eventBus.emit(GameEventType.CARD_DRAWN, { cards: drawn });
    return drawn;
  }

  // ... ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
}
```

### 2.4 ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ ğŸ”µ

- Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- ãƒ‡ãƒƒã‚­ãŒç©ºã«ãªã£ãŸã‚‰æ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ãƒ‡ãƒƒã‚­ã«æˆ»ã™

---

## 3. å—ã‘å…¥ã‚ŒåŸºæº–

### 3.1 å¿…é ˆæ¡ä»¶ ğŸ”µ

- [x] ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [x] ãƒ‰ãƒ­ãƒ¼ã§æ‰‹æœ­ã«ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹
- [x] ãƒ—ãƒ¬ã‚¤ã§ã‚«ãƒ¼ãƒ‰ãŒæ¨ã¦æœ­ã«ç§»å‹•ã™ã‚‹
- [x] æ‰‹æœ­è£œå……ãŒæ­£ã—ãå‹•ä½œã™ã‚‹

### 3.2 æ¨å¥¨æ¡ä»¶ ğŸŸ¡

- [x] å„æ“ä½œã§ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹
- [x] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šï¼ˆå®Ÿéš›: 100%é”æˆï¼‰

---

## 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 4.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0009-01 | ã‚·ãƒ£ãƒƒãƒ•ãƒ« | é †åºãŒãƒ©ãƒ³ãƒ€ãƒ åŒ– |
| T-0009-02 | ãƒ‰ãƒ­ãƒ¼ | æ‰‹æœ­ã«è¿½åŠ ã€ãƒ‡ãƒƒã‚­ã‹ã‚‰æ¸›å°‘ |
| T-0009-03 | ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤ | æ‰‹æœ­ã‹ã‚‰å‰Šé™¤ã€æ¨ã¦æœ­ã«è¿½åŠ  |
| T-0009-04 | æ‰‹æœ­è£œå…… | 5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼ |
| T-0009-05 | ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®ãƒ‰ãƒ­ãƒ¼ | æ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ãƒ‡ãƒƒã‚­ã« |

---

## 5. æˆæœç‰©

| æˆæœç‰© | ãƒ‘ã‚¹ |
|--------|------|
| ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ | `/src/domain/entities/Card.ts` |
| ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `/src/domain/interfaces/deck-service.interface.ts` |
| å®Ÿè£… | `/src/application/services/deck-service.ts` |
| ãƒ†ã‚¹ãƒˆ | `/tests/unit/application/services/deck-service.test.ts` |

---

## é–¢é€£æ–‡æ›¸

- **ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹è¨­è¨ˆ**: [../../design/atelier-guild-rank/core-systems-core-services.md](../../design/atelier-guild-rank/core-systems-core-services.md)
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©**: [../../design/atelier-guild-rank/interfaces.ts](../../design/atelier-guild-rank/interfaces.ts)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |
| 2026-01-16 | 1.0.1 | TDDé–‹ç™ºå®Œäº†ã€38ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šéã€è¦ä»¶ç¶²ç¾…ç‡100%é”æˆ |
