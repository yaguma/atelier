# TASK-0059: rexUIå‹å®šç¾©è¿½åŠ 

**ã‚¿ã‚¹ã‚¯ID**: TASK-0059
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: DIRECT
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 7 - Presentationå±¤ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹èª¿æŸ»çµæœã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](../overview.md)
- **è¨­è¨ˆæ–‡æ›¸**: [ğŸ“ architecture-overview.md](../../design/atelier-guild-rank/architecture-overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

rexUIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¯¾ã™ã‚‹å‹å®šç¾©ã‚’ä½œæˆã—ã€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã§anyå‹ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã„ã‚‹rexUIé–¢é€£ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é©åˆ‡ãªå‹ã‚’ä»˜ä¸ã™ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0055](TASK-0055.md), [TASK-0056](TASK-0056.md)
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: [TASK-0060](TASK-0060.md)

## å®Œäº†æ¡ä»¶

- [ ] rexUIå‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ä¸»è¦ãªrexUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®anyå‹ãŒå‹å®šç¾©ã§ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ï¼ˆæœ€ä½5ç®‡æ‰€ï¼‰
- [ ] TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šéã™ã‚‹

---

## å®Ÿè£…è©³ç´°

### 1. rexUIå‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰æ¨æ¸¬*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/types/rexui.d.ts`

```typescript
declare module 'phaser3-rex-plugins/templates/ui/ui-plugin' {
  import Phaser from 'phaser';

  export interface RexUIConfig {
    // å…±é€šè¨­å®š
  }

  export default class UIPlugin extends Phaser.Plugins.ScenePlugin {
    add: UIFactory;
  }

  export interface UIFactory {
    sizer(config: SizerConfig): Sizer;
    gridSizer(config: GridSizerConfig): GridSizer;
    fixWidthSizer(config: FixWidthSizerConfig): FixWidthSizer;
    overlapSizer(config: OverlapSizerConfig): OverlapSizer;
    label(config: LabelConfig): Label;
    buttons(config: ButtonsConfig): Buttons;
    gridButtons(config: GridButtonsConfig): GridButtons;
    dialog(config: DialogConfig): Dialog;
    tabs(config: TabsConfig): Tabs;
    slider(config: SliderConfig): Slider;
    gridTable(config: GridTableConfig): GridTable;
    scrollablePanel(config: ScrollablePanelConfig): ScrollablePanel;
    textArea(config: TextAreaConfig): TextArea;
    numberBar(config: NumberBarConfig): NumberBar;
    badgeLabel(config: BadgeLabelConfig): BadgeLabel;
    pages(config: PagesConfig): Pages;
    toast(config: ToastConfig): Toast;
  }
}
```

### 2. Sizerç³»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‹å®šç¾© ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰æ¨æ¸¬*

```typescript
export interface SizerConfig {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  orientation?: 'left-to-right' | 'top-to-bottom' | 'x' | 'y' | 0 | 1;
  space?: {
    left?: number;
    right?: number;
    top?: number;
    bottom?: number;
    item?: number;
  };
  anchor?: {
    left?: string;
    right?: string;
    top?: string;
    bottom?: string;
    centerX?: string;
    centerY?: string;
  };
}

export interface Sizer extends Phaser.GameObjects.Container {
  add(
    gameObject: Phaser.GameObjects.GameObject,
    options?: {
      proportion?: number;
      align?: string;
      padding?: number | { left?: number; right?: number; top?: number; bottom?: number };
      expand?: boolean;
      key?: string;
      index?: number;
      minWidth?: number;
      minHeight?: number;
    }
  ): this;

  layout(): this;
  setMinSize(width: number, height: number): this;
  getElement(name: string): Phaser.GameObjects.GameObject | null;
  getChildrenWidth(): number;
  getChildrenHeight(): number;
}

export interface GridSizerConfig extends SizerConfig {
  column?: number;
  row?: number;
  columnProportions?: number | number[];
  rowProportions?: number | number[];
  space?: SizerConfig['space'] & {
    column?: number;
    row?: number;
  };
}

export interface GridSizer extends Sizer {
  add(
    gameObject: Phaser.GameObjects.GameObject,
    options?: {
      column?: number;
      row?: number;
      align?: string;
      padding?: number | { left?: number; right?: number; top?: number; bottom?: number };
      expand?: boolean;
      key?: string;
    }
  ): this;
}
```

### 3. UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‹å®šç¾© ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰æ¨æ¸¬*

```typescript
export interface LabelConfig {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  orientation?: 'left-to-right' | 'top-to-bottom' | 'x' | 'y' | 0 | 1;
  background?: Phaser.GameObjects.GameObject;
  icon?: Phaser.GameObjects.GameObject;
  text?: Phaser.GameObjects.GameObject | string;
  action?: Phaser.GameObjects.GameObject;
  space?: {
    left?: number;
    right?: number;
    top?: number;
    bottom?: number;
    icon?: number;
    text?: number;
  };
  align?: {
    text?: string;
    icon?: string;
    action?: string;
  };
}

export interface Label extends Sizer {
  setText(text: string): this;
  getText(): string;
  setTexture(key: string, frame?: string | number): this;
}

export interface ButtonsConfig {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  orientation?: 'left-to-right' | 'top-to-bottom' | 'x' | 'y' | 0 | 1;
  buttons?: Phaser.GameObjects.GameObject[];
  space?: {
    left?: number;
    right?: number;
    top?: number;
    bottom?: number;
    item?: number;
  };
  click?: {
    mode?: 'pointerdown' | 'pointerup' | 'release';
    clickInterval?: number;
  };
  type?: 'checkboxes' | 'radio';
}

export interface Buttons extends Sizer {
  on(event: 'button.click', callback: (button: Phaser.GameObjects.GameObject, index: number, pointer: Phaser.Input.Pointer, event: Phaser.Types.Input.EventData) => void): this;
  on(event: 'button.over', callback: (button: Phaser.GameObjects.GameObject, index: number, pointer: Phaser.Input.Pointer, event: Phaser.Types.Input.EventData) => void): this;
  on(event: 'button.out', callback: (button: Phaser.GameObjects.GameObject, index: number, pointer: Phaser.Input.Pointer, event: Phaser.Types.Input.EventData) => void): this;
  getButton(index: number): Phaser.GameObjects.GameObject | undefined;
  showButton(index: number): this;
  hideButton(index: number): this;
}

export interface DialogConfig {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  background?: Phaser.GameObjects.GameObject;
  title?: Phaser.GameObjects.GameObject | string;
  toolbar?: Phaser.GameObjects.GameObject[];
  leftToolbar?: Phaser.GameObjects.GameObject[];
  content?: Phaser.GameObjects.GameObject | string;
  description?: Phaser.GameObjects.GameObject | string;
  choices?: Phaser.GameObjects.GameObject[];
  actions?: Phaser.GameObjects.GameObject[];
  space?: {
    left?: number;
    right?: number;
    top?: number;
    bottom?: number;
    title?: number;
    titleLeft?: number;
    content?: number;
    description?: number;
    choices?: number;
    choicesLeft?: number;
    actionsLeft?: number;
    action?: number;
    toolbarItem?: number;
    leftToolbarItem?: number;
  };
  align?: {
    title?: string;
    content?: string;
    description?: string;
    choices?: string;
    actions?: string;
  };
  click?: {
    mode?: 'pointerdown' | 'pointerup' | 'release';
    clickInterval?: number;
  };
}

export interface Dialog extends Sizer {
  on(event: 'button.click', callback: (button: Phaser.GameObjects.GameObject, groupName: string, index: number, pointer: Phaser.Input.Pointer, event: Phaser.Types.Input.EventData) => void): this;
  setContent(content: string | Phaser.GameObjects.GameObject): this;
  setTitle(title: string | Phaser.GameObjects.GameObject): this;
}
```

### 4. ScrollablePanelå‹å®šç¾© ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *rexUIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰æ¨æ¸¬*

```typescript
export interface ScrollablePanelConfig {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  scrollMode?: 0 | 1 | 'vertical' | 'horizontal';
  background?: Phaser.GameObjects.GameObject;
  panel?: {
    child: Phaser.GameObjects.GameObject;
    mask?: {
      padding?: number | { left?: number; right?: number; top?: number; bottom?: number };
    };
  };
  slider?: {
    track?: Phaser.GameObjects.GameObject;
    thumb?: Phaser.GameObjects.GameObject;
    input?: 'drag' | 'pan' | 'click' | 'none';
    position?: 'right' | 'left' | 'top' | 'bottom';
  };
  mouseWheelScroller?: boolean | {
    focus?: boolean;
    speed?: number;
  };
  space?: {
    left?: number;
    right?: number;
    top?: number;
    bottom?: number;
    panel?: number;
  };
}

export interface ScrollablePanel extends Sizer {
  scrollToTop(): this;
  scrollToBottom(): this;
  scrollToLeft(): this;
  scrollToRight(): this;
  setT(t: number): this;
  getT(): number;
  setChildOY(y: number): this;
  getChildOY(): number;
}
```

### 5. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å‹é©ç”¨ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ä½œæ¥­*

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¾‹**:
- `src/presentation/ui/scenes/RankUpScene.ts`
- `src/presentation/ui/scenes/ShopScene.ts`
- `src/presentation/ui/phases/DeliveryPhaseUI.ts`

```typescript
// Before
private rexUI: any;
private scrollPanel: any;
private dialog: any;

// After
import type { RexUIPlugin, ScrollablePanel, Dialog } from '@presentation/types/rexui';

private rexUI: RexUIPlugin;
private scrollPanel: ScrollablePanel;
private dialog: Dialog;
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: å‹å®šç¾©ã®äº’æ›æ€§ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§æ¤œè¨¼*

**Given**: rexUIå‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«
**When**: TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
**Then**: å‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ ğŸ”µ

**ä¿¡é ¼æ€§**: ğŸ”µ *TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§æ¤œè¨¼*

**Given**: å‹å®šç¾©ã‚’é©ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰
**When**: TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
**Then**: å‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„

---

## å®Ÿè£…æ‰‹é †

### DIRECTã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:direct-setup` - ç›´æ¥å®Ÿè£…ãƒ»è¨­å®š
2. `/tsumiki:direct-verify` - å‹•ä½œç¢ºèªãƒ»å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- rexUIã®å…¬å¼å‹å®šç¾©ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã€ãã¡ã‚‰ã‚’å„ªå…ˆã—ã¦ä½¿ç”¨ã™ã‚‹
- å‹å®šç¾©ã¯æ®µéšçš„ã«è¿½åŠ ã—ã€å¿…è¦æœ€å°é™ã‹ã‚‰å§‹ã‚ã‚‹
- å®Ÿè¡Œæ™‚ã®å‹•ä½œã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†æ³¨æ„ã™ã‚‹ï¼ˆå‹å®šç¾©ã®ã¿ã®å¤‰æ›´ï¼‰
- `@types/phaser3-rex-plugins` ãŒ npm ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã™ã‚‹

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| å®Ÿè£…è©³ç´° | 0 | 5 | 0 | 5 |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | 2 | 0 | 0 | 2 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 7é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 2é …ç›® (28.6%)
- ğŸŸ¡ **é»„ä¿¡å·**: 5é …ç›® (71.4%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: è¦æ”¹å–„ï¼ˆrexUIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®ç…§åˆãŒå¿…è¦ï¼‰
