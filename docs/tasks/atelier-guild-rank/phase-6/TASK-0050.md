# TASK-0050: ShopScene実装

## 基本情報

| 項目 | 値 |
|------|-----|
| **タスクID** | TASK-0050 |
| **タスク名** | ShopScene実装 |
| **見積時間** | 8時間 |
| **依存タスク** | TASK-0048, TASK-0049 |
| **開発タイプ** | TDD |
| **状態** | 🔲 未着手 |

---

## 概要

### 背景

TASK-0026でShopSceneの実装が計画されていたが、実際にはファイルが存在しない。サイドバーの「ショップボタン」クリック時に遷移する先のシーンが必要。

### 目的

ショップ画面（ShopScene）を実装し、カード・アイテムの購入機能を提供する。

### 不足ファイル

- `src/presentation/scenes/ShopScene.ts` - 存在しない

---

## 要件

### 機能要件

| 要件ID | 要件 | 信頼性 |
|--------|------|--------|
| REQ-050-01 | ShopSceneが正しく初期化されること | 🔵 |
| REQ-050-02 | カード一覧が表示されること | 🔵 |
| REQ-050-03 | アイテム一覧が表示されること | 🔵 |
| REQ-050-04 | 所持金が表示されること | 🔵 |
| REQ-050-05 | カード購入ボタンをクリックで購入処理が実行されること | 🔵 |
| REQ-050-06 | 所持金不足時は購入ボタンが無効化されること | 🔵 |
| REQ-050-07 | 「戻る」ボタンでMainSceneに戻れること | 🔵 |
| REQ-050-08 | 購入成功時にEventBusでPURCHASE_COMPLETEイベントが発火すること | 🟡 |

### 非機能要件

| 要件ID | 要件 |
|--------|------|
| NFR-050-01 | 既存のアーキテクチャに従うこと（Clean Architecture） |
| NFR-050-02 | 他のシーンと一貫したUIスタイルを使用すること |
| NFR-050-03 | テストカバレッジ80%以上 |

---

## テストケース

### ShopScene基本テスト

```typescript
describe('ShopScene', () => {
  describe('create()', () => {
    it('シーンが正しく初期化されること', () => {});
    it('カード一覧が表示されること', () => {});
    it('アイテム一覧が表示されること', () => {});
    it('所持金が表示されること', () => {});
    it('「戻る」ボタンが表示されること', () => {});
  });

  describe('購入処理', () => {
    it('カード購入ボタンクリックで購入処理が実行されること', () => {});
    it('所持金が購入金額以上ある場合に購入可能であること', () => {});
    it('所持金不足時に購入ボタンが無効化されること', () => {});
    it('購入成功時に所持金が減少すること', () => {});
    it('購入成功時にデッキにカードが追加されること', () => {});
  });

  describe('シーン遷移', () => {
    it('「戻る」ボタンクリックでMainSceneに戻ること', () => {});
  });
});
```

---

## 実装計画

### ステップ1: 基本構造実装（2時間）

1. ShopScene.tsファイル作成
2. Phaser.Sceneを継承した基本クラス実装
3. create()メソッドで基本レイアウト作成

### ステップ2: カード表示実装（2時間）

1. 購入可能カード一覧の取得ロジック
2. カード表示UIコンポーネント作成
3. カード詳細情報の表示

### ステップ3: 購入処理実装（2時間）

1. 購入ボタンのインタラクション
2. StateManagerとの連携（所持金チェック・更新）
3. DeckServiceとの連携（カード追加）

### ステップ4: シーン遷移・仕上げ（2時間）

1. MainSceneへの戻る処理
2. EventBus連携
3. UIの調整とアニメーション

---

## 設計仕様

### UIレイアウト（TASK-0026より）

```
┌────────────────────────────────────────┐
│ ショップ                    [戻る]     │ ← ヘッダー
├────────────────────────────────────────┤
│                                        │
│  [カード1] [カード2] [カード3]         │
│  100G      150G      200G              │
│                                        │
│  [アイテム1] [アイテム2]               │
│  50G         80G                       │
│                                        │
├────────────────────────────────────────┤
│ 所持金: 500G                           │ ← フッター
└────────────────────────────────────────┘
```

### 依存サービス

- StateManager - 所持金管理
- DeckService - カード追加
- EventBus - イベント通知

---

## 受け入れ条件

- [ ] ShopScene.tsファイルが作成されている
- [ ] サイドバーのショップボタンからShopSceneに遷移できる
- [ ] カード・アイテム一覧が表示される
- [ ] 購入処理が正しく動作する
- [ ] 「戻る」ボタンでMainSceneに戻れる
- [ ] テストカバレッジ80%以上
- [ ] `pnpm lint`がエラーなしで完了する

---

## 関連ドキュメント

- **TASK-0026**: ShopScene/RankUpScene実装（元タスク）
- **StateManager**: `src/application/state/StateManager.ts`
- **DeckService**: `src/domain/services/DeckService.ts`
- **MainScene**: `src/presentation/scenes/MainScene.ts`

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-22 | 初版作成 |
