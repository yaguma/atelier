# TASK-0051: RankUpScene実装

## 基本情報

| 項目 | 値 |
|------|-----|
| **タスクID** | TASK-0051 |
| **タスク名** | RankUpScene実装 |
| **見積時間** | 8時間 |
| **依存タスク** | TASK-0048, TASK-0049 |
| **開発タイプ** | TDD |
| **状態** | 🔲 未着手 |

---

## 概要

### 背景

TASK-0026でRankUpSceneの実装が計画されていたが、実際にはファイルが存在しない。昇格試験フェーズで使用するシーンが必要。

### 目的

昇格試験画面（RankUpScene）を実装し、プレイヤーがランクアップするための試験システムを提供する。

### 不足ファイル

- `src/presentation/scenes/RankUpScene.ts` - 存在しない

---

## 要件

### 機能要件

| 要件ID | 要件 | 信頼性 |
|--------|------|--------|
| REQ-051-01 | RankUpSceneが正しく初期化されること | 🔵 |
| REQ-051-02 | 現在のランクと次のランクが表示されること | 🔵 |
| REQ-051-03 | 昇格試験の条件が表示されること | 🔵 |
| REQ-051-04 | 試験開始ボタンが表示されること | 🔵 |
| REQ-051-05 | 試験結果（合格/不合格）が表示されること | 🔵 |
| REQ-051-06 | 合格時にランクが更新されること | 🔵 |
| REQ-051-07 | 「戻る」/「次へ」ボタンでMainSceneに戻れること | 🔵 |
| REQ-051-08 | 昇格成功時にEventBusでRANK_UPイベントが発火すること | 🟡 |

### 非機能要件

| 要件ID | 要件 |
|--------|------|
| NFR-051-01 | 既存のアーキテクチャに従うこと（Clean Architecture） |
| NFR-051-02 | 他のシーンと一貫したUIスタイルを使用すること |
| NFR-051-03 | テストカバレッジ80%以上 |

---

## テストケース

### RankUpScene基本テスト

```typescript
describe('RankUpScene', () => {
  describe('create()', () => {
    it('シーンが正しく初期化されること', () => {});
    it('現在のランクが表示されること', () => {});
    it('次のランクが表示されること', () => {});
    it('昇格条件が表示されること', () => {});
    it('試験開始ボタンが表示されること', () => {});
  });

  describe('昇格試験', () => {
    it('試験開始ボタンクリックで試験が開始されること', () => {});
    it('合格条件を満たした場合に合格判定されること', () => {});
    it('合格条件を満たさない場合に不合格判定されること', () => {});
    it('合格時にランクが更新されること', () => {});
    it('合格時にRANK_UPイベントが発火すること', () => {});
  });

  describe('シーン遷移', () => {
    it('合格後「次へ」ボタンクリックでMainSceneに戻ること', () => {});
    it('不合格後「戻る」ボタンクリックでMainSceneに戻ること', () => {});
  });
});
```

---

## 実装計画

### ステップ1: 基本構造実装（2時間）

1. RankUpScene.tsファイル作成
2. Phaser.Sceneを継承した基本クラス実装
3. create()メソッドで基本レイアウト作成

### ステップ2: ランク情報表示実装（2時間）

1. 現在ランク・次ランクの取得と表示
2. 昇格条件の表示
3. 進捗状況の可視化

### ステップ3: 試験処理実装（2時間）

1. 試験ロジックの実装（条件判定）
2. 合格/不合格の結果表示
3. StateManagerとの連携（ランク更新）

### ステップ4: シーン遷移・仕上げ（2時間）

1. MainSceneへの戻る処理
2. EventBus連携（RANK_UPイベント）
3. 演出とアニメーション

---

## 設計仕様

### UIレイアウト

```
┌────────────────────────────────────────┐
│ 昇格試験                               │ ← ヘッダー
├────────────────────────────────────────┤
│                                        │
│      現在ランク: E                     │
│          ↓                             │
│      次ランク: D                       │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │ 昇格条件:                        │  │
│  │ ・納品達成率: 80%以上            │  │
│  │ ・合計貢献度: 1000以上           │  │
│  └──────────────────────────────────┘  │
│                                        │
│         [試験開始]                     │
│                                        │
├────────────────────────────────────────┤
│                              [戻る]    │ ← フッター
└────────────────────────────────────────┘
```

### ランクシステム

| ランク | 次ランク | 昇格条件（想定） |
|--------|---------|-----------------|
| E | D | 貢献度1000以上 |
| D | C | 貢献度3000以上 |
| C | B | 貢献度7000以上 |
| B | A | 貢献度15000以上 |
| A | S | 貢献度30000以上 |

### 依存サービス

- StateManager - ランク管理
- EventBus - イベント通知

---

## 受け入れ条件

- [ ] RankUpScene.tsファイルが作成されている
- [ ] 昇格条件達成時に自動的にRankUpSceneに遷移できる
- [ ] ランク情報と昇格条件が表示される
- [ ] 試験処理が正しく動作する
- [ ] 合格/不合格の結果が表示される
- [ ] 「戻る」/「次へ」ボタンでMainSceneに戻れる
- [ ] テストカバレッジ80%以上
- [ ] `pnpm lint`がエラーなしで完了する

---

## 関連ドキュメント

- **TASK-0026**: ShopScene/RankUpScene実装（元タスク）
- **StateManager**: `src/application/state/StateManager.ts`
- **MainScene**: `src/presentation/scenes/MainScene.ts`
- **ランクシステム設計**: `docs/design/atelier-guild-rank/systems/rank-system.md`

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-22 | 初版作成 |
