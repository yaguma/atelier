# TASK-0041: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ 

**ã‚¿ã‚¹ã‚¯ID**: TASK-0041
**ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—**: TDD
**æ¨å®šå·¥æ•°**: 4æ™‚é–“
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 5 - UIå¼·åŒ–ãƒ»ãƒãƒªãƒƒã‚·ãƒ¥
**ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«**: ğŸŸ¡ *TASK-0020ã®æ¨å¥¨æ¡ä»¶ã‚ˆã‚Š*

## é–¢é€£æ–‡æ›¸

- **æ¦‚è¦**: [ğŸ“‹ overview.md](../overview.md)
- **å…ƒã‚¿ã‚¹ã‚¯**: [ğŸ“‹ TASK-0020.md](../phase-3/TASK-0020.md) - MainSceneå…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¨å¥¨æ¡ä»¶
- **UIè¨­è¨ˆ**: [ğŸ“ ui-design/overview.md](../../design/atelier-guild-rank/ui-design/overview.md)

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

ã‚²ãƒ¼ãƒ å…¨ä½“ã§ä½¿ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ›ãƒãƒ¼æ™‚ã«ã‚¢ã‚¤ãƒ†ãƒ ã‚„è¦ç´ ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç†è§£ã‚’åŠ©ã‘ã‚‹ã€‚

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- **å‰æã‚¿ã‚¹ã‚¯**: [TASK-0018: å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŸºç›¤](../phase-3/TASK-0018.md) âœ…å®Œäº†
- **å¾Œç¶šã‚¿ã‚¹ã‚¯**: ãªã—ï¼ˆç‹¬ç«‹ã‚¿ã‚¹ã‚¯ï¼‰

## å®Œäº†æ¡ä»¶

- [x] TooltipManagerã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³å®Ÿè£…
- [x] ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º/éè¡¨ç¤ºæ©Ÿèƒ½
- [x] è¡¨ç¤ºä½ç½®ã®è‡ªå‹•èª¿æ•´ï¼ˆç”»é¢ç«¯å¯¾å¿œï¼‰
- [x] è¡¨ç¤ºé…å»¶è¨­å®šæ©Ÿèƒ½
- [x] å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…

---

## å®Ÿè£…è©³ç´°

### 1. TooltipManagerã‚¯ãƒ©ã‚¹ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªUIãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æ¨æ¸¬*

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/presentation/ui/components/TooltipManager.ts`

```typescript
export interface TooltipConfig {
  content: string;
  x: number;
  y: number;
  delay?: number;
  maxWidth?: number;
}

export class TooltipManager {
  private static instance: TooltipManager;
  private scene: Phaser.Scene | null = null;
  private tooltip: Phaser.GameObjects.Container | null = null;
  private showTimeout: number | null = null;

  static getInstance(): TooltipManager {
    if (!TooltipManager.instance) {
      TooltipManager.instance = new TooltipManager();
    }
    return TooltipManager.instance;
  }

  initialize(scene: Phaser.Scene): void {
    this.scene = scene;
    this.createTooltipContainer();
  }

  show(config: TooltipConfig): void {
    if (this.showTimeout) {
      clearTimeout(this.showTimeout);
    }

    const delay = config.delay ?? 500;
    this.showTimeout = setTimeout(() => {
      this.displayTooltip(config);
    }, delay);
  }

  hide(): void {
    if (this.showTimeout) {
      clearTimeout(this.showTimeout);
      this.showTimeout = null;
    }
    this.tooltip?.setVisible(false);
  }

  private displayTooltip(config: TooltipConfig): void {
    if (!this.tooltip || !this.scene) return;

    this.updateContent(config.content, config.maxWidth);
    this.updatePosition(config.x, config.y);
    this.tooltip.setVisible(true);
  }
}
```

### 2. è¡¨ç¤ºä½ç½®ã®è‡ªå‹•èª¿æ•´ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªUIãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æ¨æ¸¬*

```typescript
private updatePosition(x: number, y: number): void {
  if (!this.tooltip || !this.scene) return;

  const bounds = this.tooltip.getBounds();
  const camera = this.scene.cameras.main;

  // å³ç«¯ã‹ã‚‰ã¯ã¿å‡ºã™å ´åˆã¯å·¦ã«è¡¨ç¤º
  if (x + bounds.width > camera.width) {
    x = x - bounds.width - 10;
  }

  // ä¸‹ç«¯ã‹ã‚‰ã¯ã¿å‡ºã™å ´åˆã¯ä¸Šã«è¡¨ç¤º
  if (y + bounds.height > camera.height) {
    y = y - bounds.height - 10;
  }

  // ä¸Šç«¯ãƒ»å·¦ç«¯ã®ãƒã‚§ãƒƒã‚¯
  x = Math.max(10, x);
  y = Math.max(10, y);

  this.tooltip.setPosition(x, y);
}
```

### 3. ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ—¢å­˜UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰æ¨æ¸¬*

```typescript
private createTooltipContainer(): void {
  if (!this.scene) return;

  this.tooltip = this.scene.add.container(0, 0);

  // èƒŒæ™¯
  const background = this.scene.add.rectangle(
    0, 0, 100, 30,
    0x333333, 0.9
  ).setOrigin(0);

  // ãƒ†ã‚­ã‚¹ãƒˆ
  const text = this.scene.add.text(8, 8, '', {
    fontSize: '12px',
    color: '#FFFFFF',
    wordWrap: { width: 200 },
  });

  this.tooltip.add([background, text]);
  this.tooltip.setDepth(1000); // æœ€å‰é¢
  this.tooltip.setVisible(false);
}
```

---

## å˜ä½“ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: TooltipManagerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹
**When**: show()ã‚’å‘¼ã³å‡ºã™
**Then**: æŒ‡å®šä½ç½®ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: è¡¨ç¤ºä½ç½®è‡ªå‹•èª¿æ•´ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: ç”»é¢å³ç«¯ä»˜è¿‘ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¡¨ç¤º
**When**: show()ã‚’å‘¼ã³å‡ºã™
**Then**: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãŒç”»é¢å†…ã«åã¾ã‚‹ã‚ˆã†ä½ç½®èª¿æ•´ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: è¡¨ç¤ºé…å»¶ ğŸŸ¡

**ä¿¡é ¼æ€§**: ğŸŸ¡ *æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³*

**Given**: delay: 500msã§è¨­å®š
**When**: show()ã‚’å‘¼ã³å‡ºã—ã€300mså¾Œã«hide()
**Then**: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¯è¡¨ç¤ºã•ã‚Œãªã„

---

## å®Ÿè£…æ‰‹é †

### TDDã‚¿ã‚¹ã‚¯ã®å ´åˆ

1. `/tsumiki:tdd-requirements TASK-0041` - è©³ç´°è¦ä»¶å®šç¾©
2. `/tsumiki:tdd-testcases` - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
3. `/tsumiki:tdd-red` - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆå¤±æ•—ï¼‰
4. `/tsumiki:tdd-green` - æœ€å°å®Ÿè£…
5. `/tsumiki:tdd-refactor` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
6. `/tsumiki:tdd-verify-complete` - å“è³ªç¢ºèª

---

## æ³¨æ„äº‹é …

- ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚·ãƒ¼ãƒ³é–“ã§å†åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹
- Zã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æœ€å¤§å€¤ã«è¨­å®šã—ã¦æœ€å‰é¢è¡¨ç¤º
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€ä¸è¦ãªDOMæ“ä½œã‚’é¿ã‘ã‚‹

---

## ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã‚µãƒãƒªãƒ¼

### é …ç›®åˆ¥ä¿¡é ¼æ€§

| ã‚«ãƒ†ã‚´ãƒª | ğŸ”µ é’ | ğŸŸ¡ é»„ | ğŸ”´ èµ¤ | åˆè¨ˆ |
|---------|-------|-------|-------|------|
| å®Ÿè£…è©³ç´° | 0 | 3 | 0 | 3 |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | 0 | 3 | 0 | 3 |

### å…¨ä½“è©•ä¾¡

- **ç·é …ç›®æ•°**: 6é …ç›®
- ğŸ”µ **é’ä¿¡å·**: 0é …ç›® (0%)
- ğŸŸ¡ **é»„ä¿¡å·**: 6é …ç›® (100%)
- ğŸ”´ **èµ¤ä¿¡å·**: 0é …ç›® (0%)

**å“è³ªè©•ä¾¡**: é«˜å“è³ª
