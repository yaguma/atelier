# メイン画面 詳細設計

**バージョン**: 1.0.0
**作成日**: 2026-01-01
**画面ID**: SCR-002

---

## 1. 基本情報

| 項目 | 値 |
|------|-----|
| **画面ID** | SCR-002 |
| **画面名** | メイン画面 |
| **親画面** | タイトル画面（SCR-001） |
| **子画面** | ショップ画面（SCR-003）、昇格試験画面（SCR-004）、リザルト画面（SCR-005） |
| **責務** | メインゲームプレイ（4フェーズの進行） |

### 信頼性レベル

- 🔵 **青信号**: 要件定義書に記載
- 🟡 **黄信号**: 要件定義書から妥当な推測
- 🔴 **赤信号**: 要件定義書にない推測

---

## 2. 画面構成 🔵

メイン画面は4つのフェーズに応じて表示内容が変化する。

### 2.1 フェーズ一覧

| フェーズ | 説明 | 主要UI要素 |
|---------|------|-----------|
| **依頼受注フェーズ** | 依頼者から依頼を受注 | 依頼者表示、依頼リスト、受注ボタン |
| **採取フェーズ** | 採取地カードで素材獲得 | 手札（採取地）、素材獲得演出 |
| **調合フェーズ** | レシピカードでアイテム調合 | 手札（レシピ）、素材選択、品質プレビュー |
| **納品フェーズ** | 完成品を依頼者に納品 | 依頼リスト、アイテム選択、報酬カード選択 |

---

## 3. 基本レイアウト 🟡

### 3.1 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ┌───────────────────────────────────────────────────────────────────┐   │
│ │ ヘッダー                                                          │   │
│ │ [ランク: G] [HP: ████████ 85/100] [残り: 25日] [💰 130G] [⚡ 3/3] │   │
│ └───────────────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌───────────────────────────────────────────────────┐   │
│ │ サイドバー  │ │                                                   │   │
│ │             │ │                                                   │   │
│ │ 【受注依頼】│ │             メインコンテンツエリア                │   │
│ │ ・回復薬    │ │             （フェーズに応じて変化）              │   │
│ │   期限:3日  │ │                                                   │   │
│ │ ・薬×3     │ │                                                   │   │
│ │   期限:4日  │ │                                                   │   │
│ │             │ │                                                   │   │
│ │ 【素材】    │ │                                                   │   │
│ │ 薬草×4     │ │                                                   │   │
│ │ 清水×2     │ │                                                   │   │
│ │ 鉱石×1     │ │                                                   │   │
│ │ [12/20枠]  │ │                                                   │   │
│ │             │ │                                                   │   │
│ │ 【完成品】  │ │                                                   │   │
│ │ 回復薬(B)×1│ │                                                   │   │
│ │             │ │                                                   │   │
│ │ [ショップ] │ │                                                   │   │
│ └─────────────┘ └───────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────┐   │
│ │ フッター                                                          │   │
│ │ [依頼受注]●━━○[採取]━━○[調合]━━○[納品]                          │   │
│ │                                                                   │   │
│ │ 手札: [カード1][カード2][カード3][カード4][カード5]    [休憩][次へ]│   │
│ └───────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. ヘッダーUI 🔵

### 4.1 UI要素

| 要素ID | 種類 | 説明 |
|--------|------|------|
| `rank-display` | テキスト | 現在のギルドランク表示 |
| `hp-bar` | プログレスバー | ランクHP残量 |
| `day-counter` | テキスト | 残り日数（警告色対応） |
| `gold-display` | テキスト | 所持金 |
| `action-points` | アイコン群 | 行動ポイント（3つのアイコン） |

### 4.2 ランク表示 (`rank-display`)

| プロパティ | 値 |
|-----------|-----|
| **形式** | 「ランク: X」 |
| **フォント** | 游ゴシック, 16px, Bold |
| **色** | ランクに応じた色（G=白, F=緑, ... S=金） |

### 4.3 HPバー (`hp-bar`)

| プロパティ | 値 |
|-----------|-----|
| **幅** | 150px |
| **高さ** | 20px |
| **背景色** | #CCCCCC |
| **バー色** | #B22222（残量に応じてグラデーション） |
| **表示形式** | 「HP: [バー] 現在/最大」 |

### 4.4 日数カウンター (`day-counter`)

| 残り日数 | 表示スタイル |
|---------|-------------|
| 11日以上 | 通常（白/黒） |
| 6〜10日 | 黄色 + ⚠アイコン |
| 1〜5日 | 赤 + 点滅アニメーション |

### 4.5 行動ポイント (`action-points`)

| 残り | 表示 |
|------|------|
| 3 | ⚡⚡⚡ (全点灯) |
| 2 | ⚡⚡◯ |
| 1 | ⚡◯◯ (黄色警告) |
| 0 | ◯◯◯ (グレー) |

---

## 5. サイドバーUI 🔵

### 5.1 UI要素

| 要素ID | 種類 | 説明 |
|--------|------|------|
| `quest-list` | リスト | 受注中の依頼一覧 |
| `material-list` | リスト | 所持素材一覧 |
| `item-list` | リスト | 完成品一覧 |
| `storage-indicator` | テキスト | 保管枠使用状況 |
| `btn-shop` | ボタン | ショップへ移動 |

### 5.2 依頼リスト (`quest-list`)

```
┌─────────────────┐
│ 【受注依頼】    │
├─────────────────┤
│ ○ 回復薬       │
│   期限: 3日    │
│   報酬: 20貢献度│
├─────────────────┤
│ ○ 薬×3        │
│   期限: 4日    │
│   報酬: 25貢献度│
└─────────────────┘
```

| プロパティ | 値 |
|-----------|-----|
| **最大表示件数** | 3件（スクロール可能） |
| **アイテム高さ** | 60px |
| **期限表示** | 残り日数（3日以下で赤色） |

### 5.3 素材リスト (`material-list`)

```
┌─────────────────┐
│ 【素材】        │
├─────────────────┤
│ 🌿 薬草(C) ×4  │
│ 💧 清水(C) ×2  │
│ �ite 鉱石(B) ×1  │
├─────────────────┤
│ [12/20枠]       │
└─────────────────┘
```

| プロパティ | 値 |
|-----------|-----|
| **表示形式** | アイコン + 名前(品質) ×数量 |
| **保管枠表示** | 使用中/上限 |
| **満杯時** | 赤色 + 警告アイコン |

---

## 6. フェーズ別メインコンテンツ 🔵

### 6.1 依頼受注フェーズ

```
┌───────────────────────────────────────────────────────────┐
│                    今日の依頼者                           │
├───────────────────────────────────────────────────────────┤
│                                                           │
│   ┌─────────┐     ┌─────────┐     ┌─────────┐           │
│   │ 👤村人  │     │ 🗡冒険者│     │         │           │
│   │         │     │         │     │ (空き)  │           │
│   └─────────┘     └─────────┘     └─────────┘           │
│                                                           │
├───────────────────────────────────────────────────────────┤
│                   村人の依頼                              │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ 「何か薬が欲しいんだ」                              │ │
│  │                                                     │ │
│  │ タイプ: カテゴリ（薬）                              │ │
│  │ 報酬: 貢献度 15 + 30G                               │ │
│  │ 期限: 5日                                           │ │
│  │                                                     │ │
│  │          [受注する]    [断る]                       │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                           │
│              [次のフェーズへ]                             │
└───────────────────────────────────────────────────────────┘
```

#### UI要素

| 要素ID | 種類 | 説明 |
|--------|------|------|
| `client-slots` | カード群 | 今日の依頼者（1〜3人） |
| `quest-detail` | パネル | 選択中依頼者の依頼詳細 |
| `btn-accept` | プライマリボタン | 依頼を受注 |
| `btn-decline` | セカンダリボタン | 依頼を断る |
| `btn-next-phase` | ボタン | 次フェーズへ進む |

### 6.2 採取フェーズ

```
┌───────────────────────────────────────────────────────────┐
│                      採取フェーズ                         │
├───────────────────────────────────────────────────────────┤
│                                                           │
│   選択中の採取地: 近くの森                                │
│   コスト: ⚡1                                             │
│                                                           │
│   ┌───────────────────────────────────────────────────┐   │
│   │ 獲得可能な素材:                                   │   │
│   │  🌿 薬草 ×2 (100%)                               │   │
│   │  🍄 キノコ ×1 (50%)                              │   │
│   └───────────────────────────────────────────────────┘   │
│                                                           │
│   強化カード使用:                                         │
│   [ ] 精霊の導き（獲得素材+1）                           │
│                                                           │
│              [採取する]    [キャンセル]                   │
│                                                           │
├───────────────────────────────────────────────────────────┤
│              [フェーズをスキップ]                         │
└───────────────────────────────────────────────────────────┘
```

#### UI要素

| 要素ID | 種類 | 説明 |
|--------|------|------|
| `selected-card-detail` | パネル | 選択中カードの詳細 |
| `expected-materials` | リスト | 獲得予想素材 |
| `enhancement-checkboxes` | チェックボックス群 | 使用する強化カード |
| `btn-gather` | プライマリボタン | 採取実行 |
| `btn-cancel` | セカンダリボタン | キャンセル |
| `btn-skip-phase` | リンク | フェーズスキップ |

### 6.3 調合フェーズ

```
┌───────────────────────────────────────────────────────────┐
│                      調合フェーズ                         │
├───────────────────────────────────────────────────────────┤
│                                                           │
│   選択中のレシピ: 回復薬                                  │
│   コスト: ⚡1                                             │
│                                                           │
│   ┌───────────────────────────────────────────────────┐   │
│   │ 必要素材:                                         │   │
│   │  🌿 薬草 ×2  [✓選択済] [✓選択済]                 │   │
│   │  💧 清水 ×1  [✓選択済]                           │   │
│   └───────────────────────────────────────────────────┘   │
│                                                           │
│   ┌───────────────────────────────────────────────────┐   │
│   │ 品質プレビュー: B                                 │   │
│   │ 属性: 水+5                                        │   │
│   │ 効果: HP回復 30                                   │   │
│   └───────────────────────────────────────────────────┘   │
│                                                           │
│   強化カード使用:                                         │
│   [ ] 賢者の触媒（品質+1ランク）                         │
│                                                           │
│              [調合する]    [キャンセル]                   │
│                                                           │
├───────────────────────────────────────────────────────────┤
│              [フェーズをスキップ]                         │
└───────────────────────────────────────────────────────────┘
```

#### UI要素

| 要素ID | 種類 | 説明 |
|--------|------|------|
| `recipe-detail` | パネル | 選択中レシピの詳細 |
| `material-slots` | スロット群 | 素材選択スロット |
| `quality-preview` | パネル | 完成品のプレビュー |
| `enhancement-checkboxes` | チェックボックス群 | 使用する強化カード |
| `btn-craft` | プライマリボタン | 調合実行 |
| `btn-cancel` | セカンダリボタン | キャンセル |

### 6.4 納品フェーズ

```
┌───────────────────────────────────────────────────────────┐
│                      納品フェーズ                         │
├───────────────────────────────────────────────────────────┤
│                                                           │
│   納品可能な依頼:                                         │
│   ┌───────────────────────────────────────────────────┐   │
│   │ ○ 「回復薬が欲しい」 - 村人                       │   │
│   │    要求: 回復薬                                   │   │
│   │    報酬: 貢献度20 + 40G                          │   │
│   │                          [納品する]              │   │
│   └───────────────────────────────────────────────────┘   │
│                                                           │
│   納品するアイテム:                                       │
│   ┌───────────────────────────────────────────────────┐   │
│   │ [回復薬(B)] ← 選択中                              │   │
│   └───────────────────────────────────────────────────┘   │
│                                                           │
│   強化カード使用:                                         │
│   [ ] ギルド推薦状（貢献度+30%）                         │
│                                                           │
├───────────────────────────────────────────────────────────┤
│              [日を終了する]                               │
└───────────────────────────────────────────────────────────┘
```

#### UI要素

| 要素ID | 種類 | 説明 |
|--------|------|------|
| `deliverable-quests` | リスト | 納品可能な依頼一覧 |
| `item-selector` | セレクター | 納品するアイテム選択 |
| `enhancement-checkboxes` | チェックボックス群 | 使用する強化カード |
| `btn-deliver` | プライマリボタン | 納品実行 |
| `btn-end-day` | ボタン | 日終了 |

---

## 7. フッターUI 🔵

### 7.1 フェーズインジケーター

```
[依頼受注]●━━━[採取]○━━━[調合]○━━━[納品]○
```

| 状態 | 表示 |
|------|------|
| 完了 | ●（塗りつぶし） |
| 現在 | ●（塗りつぶし + ハイライト） |
| 未実行 | ○（枠のみ） |

### 7.2 手札表示

```
┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐
│ 近く │ │ 川辺 │ │ 回復 │ │ 解毒 │ │ 精霊 │
│ の森 │ │      │ │ 薬   │ │ 剤   │ │ の   │
│      │ │      │ │      │ │      │ │ 導き │
│ ⚡1  │ │ ⚡1  │ │ ⚡1  │ │ ⚡1  │ │ ⚡0  │
└──────┘ └──────┘ └──────┘ └──────┘ └──────┘
```

| プロパティ | 値 |
|-----------|-----|
| **カードサイズ** | 100x150px |
| **最大表示枚数** | 7枚 |
| **選択時** | 上に浮かび上がる + 枠線ハイライト |
| **使用不可時** | グレーアウト |

### 7.3 アクションボタン

| ボタン | 表示条件 | 動作 |
|--------|---------|------|
| `btn-rest` | 常時 | 休憩（手札2枚捨てて2枚ドロー） |
| `btn-next` | フェーズ終了可能時 | 次のフェーズへ |

---

## 8. 報酬カード選択ダイアログ 🔵

納品成功時に表示される。

```
┌─────────────────────────────────────────────────────────────┐
│                    報酬カードを選択                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │ ★コモン     │ │ ★★アンコ   │ │ ★コモン     │        │
│  │              │ │              │ │              │        │
│  │  近くの森+   │ │  精霊の導き  │ │  解毒剤      │        │
│  │              │ │              │ │              │        │
│  │ 採取地カード │ │ 強化カード   │ │ レシピカード │        │
│  │ 獲得素材+1   │ │ 採取時素材+1 │ │ 毒消し作成   │        │
│  │              │ │              │ │              │        │
│  │   [選択]     │ │   [選択]     │ │   [選択]     │        │
│  └──────────────┘ └──────────────┘ └──────────────┘        │
│                                                             │
│                     [選ばない]                              │
│                 （デッキ圧縮戦略）                          │
└─────────────────────────────────────────────────────────────┘
```

| UI要素 | 説明 |
|--------|------|
| `reward-cards` | 3枚の報酬カード候補 |
| `btn-select` | 各カードの選択ボタン |
| `btn-skip` | 選ばない（デッキに追加しない） |

---

## 9. 状態遷移 🔵

### 9.1 1日の状態遷移

```mermaid
stateDiagram-v2
    [*] --> DayStart: 日開始

    DayStart --> QuestAccept: 日開始処理完了

    state QuestAccept {
        [*] --> ClientDisplay
        ClientDisplay --> QuestDetail: 依頼者選択
        QuestDetail --> ClientDisplay: 受注/断る
        ClientDisplay --> [*]: 次フェーズへ
    }

    QuestAccept --> Gathering: 受注完了/スキップ

    state Gathering {
        [*] --> HandView
        HandView --> CardDetail: カード選択
        CardDetail --> GatherResult: 採取実行
        GatherResult --> HandView: 続ける
        HandView --> [*]: 次フェーズへ
    }

    Gathering --> Alchemy: 採取完了/スキップ

    state Alchemy {
        [*] --> RecipeSelect
        RecipeSelect --> MaterialSelect: レシピ選択
        MaterialSelect --> QualityPreview: 素材選択
        QualityPreview --> CraftResult: 調合実行
        CraftResult --> RecipeSelect: 続ける
        RecipeSelect --> [*]: 次フェーズへ
    }

    Alchemy --> Delivery: 調合完了/スキップ

    state Delivery {
        [*] --> DeliverableList
        DeliverableList --> ItemSelect: 依頼選択
        ItemSelect --> DeliverConfirm: アイテム選択
        DeliverConfirm --> RewardCardSelect: 納品成功
        RewardCardSelect --> DeliverableList: カード選択完了
        DeliverableList --> [*]: 日終了
    }

    Delivery --> DayEnd: 日終了

    DayEnd --> [*]: ゲーム終了判定
    DayEnd --> DayStart: 次の日へ
```

---

## 10. アニメーション 🟡

| トリガー | アニメーション | 時間 |
|----------|---------------|------|
| フェーズ切り替え | スライド + フェード | 0.5s |
| カード選択 | 上に浮かび上がる | 0.2s |
| カード使用 | 中央へ移動 → 消滅 | 0.3s |
| 素材獲得 | ポップアップ + スケール | 0.4s |
| 調合成功 | 光のエフェクト + 完成品表示 | 0.6s |
| 納品成功 | 貢献度加算演出 | 0.5s |
| HP減少 | バー減少 + ダメージ数値表示 | 0.3s |
| 日数減少 | カウンター変更 + 点滅 | 0.3s |

---

## 11. イベント 🟡

| イベント名 | トリガー | 処理内容 |
|-----------|----------|----------|
| `OnCardSelected` | 手札カードクリック | カード詳細表示、行動準備 |
| `OnGatherExecuted` | 採取ボタン押下 | 素材獲得処理、演出再生 |
| `OnCraftExecuted` | 調合ボタン押下 | アイテム生成処理、演出再生 |
| `OnDeliverExecuted` | 納品ボタン押下 | 貢献度計算、報酬カード選択へ |
| `OnRewardCardSelected` | 報酬カード選択 | デッキに追加、ダイアログ閉じる |
| `OnPhaseChanged` | フェーズ遷移 | UI切り替え、状態更新 |
| `OnDayEnded` | 日終了 | 期限更新、手札補充、HP判定 |
| `OnRankHpZero` | HP0到達 | 昇格試験画面へ遷移 |
| `OnGameOver` | 日数切れ | リザルト画面へ遷移 |

---

## 12. アクセシビリティ 🟡

### 12.1 キーボード操作

| キー | 動作 |
|------|------|
| `1-7` | 手札の該当位置のカードを選択 |
| `Enter` | 選択中のカードを使用/決定 |
| `Escape` | キャンセル/ダイアログ閉じる |
| `Tab` | フォーカス移動 |
| `R` | 休憩 |
| `N` | 次のフェーズへ |
| `S` | ショップを開く |

### 12.2 フォーカス順序

1. ヘッダー要素
2. サイドバー（依頼リスト → 素材リスト → アイテムリスト → ショップボタン）
3. メインコンテンツ（フェーズに応じた要素）
4. 手札カード群
5. アクションボタン

---

## 13. レスポンシブ対応 🟡

| 画面幅 | レイアウト変更 |
|--------|---------------|
| 〜599px | サイドバー非表示（ハンバーガーメニュー化）、手札横スクロール |
| 600〜1023px | サイドバー縮小、手札5枚表示 |
| 1024px〜 | フルレイアウト |

---

## 関連文書

- **UI設計概要**: [../overview.md](../overview.md)
- **入力システム設計**: [../input-system.md](../input-system.md)
- **コアシステム設計書**: [../../core-systems.md](../../core-systems.md)
- **ゲームメカニクス設計書**: [../../game-mechanics.md](../../game-mechanics.md)

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2026-01-01 | 1.0.0 | 初版作成 |
