# 設計ヒアリング記録

**作成日**: 2026-01-16
**対象**: アトリエ錬金術ゲーム（ギルドランク制）Phaser版
**ヒアリング実施者**: Claude (AI Assistant)

---

## 概要

本ドキュメントは、設計詳細化にあたり実施したヒアリング・調査の記録である。
既存の設計文書および要件定義書の分析結果に基づく設計判断を記録する。

---

## 1. アーキテクチャに関する確認事項

### 1.1 レイヤー構成

| 質問 | 確認結果 | 根拠文書 |
|------|----------|---------|
| Clean Architectureの4層構造で良いか？ | ○ 採用 | architecture-overview.md |
| Presentation層はPhaserに完全移行か？ | ○ Phaser + rexUI | architecture-phaser.md |
| Domain/Application/InfrastructureはHTML版から流用か？ | ○ 設計維持 | architecture-overview.md |

### 1.2 採用パターン

| パターン | 採用理由 | 備考 |
|---------|---------|------|
| Clean Architecture | テスタビリティ、フレームワーク非依存 | 既存設計を維持 |
| Scene-based Architecture | Phaserとの親和性 | 新規追加（🔴） |
| EventBus | 疎結合、拡張性 | Phaser間通信に適用 |
| State Machine | フェーズ遷移の厳密管理 | 既存設計を維持 |
| Repository Pattern | データアクセス抽象化 | 既存設計を維持 |

---

## 2. データモデルに関する確認事項

### 2.1 マスターデータ構造

| データ種別 | 確認結果 | 根拠文書 |
|-----------|----------|---------|
| カード（採取地/レシピ/強化） | 3種別、解禁ランク付き | data-schema-master-cards.md |
| 素材 | 品質・属性付きインスタンス | data-schema-master-game.md |
| アイテム | 品質グレード付き | data-schema-master-game.md |
| 依頼 | 8種別、5種の依頼者 | requirements.md |
| ランク | G-S（8段階）、昇格試験付き | requirements.md |
| アーティファクト | 効果タイプ付き | data-schema-master-game.md |

### 2.2 ゲーム状態構造

| 状態項目 | 型 | 備考 |
|---------|---|------|
| currentDay | number | 1-30（ランク内） |
| currentPhase | Phase | 4フェーズ |
| currentRank | RankId | G-S |
| gold | number | 所持金 |
| promotionGauge | number | 0-100 |
| deck/hand/discardPile | CardId[] | デッキ状態 |
| materials | MaterialInstance[] | 品質・属性付き |
| items | ItemInstance[] | 品質付き |
| artifacts | ArtifactId[] | 所持アーティファクト |
| availableQuests/acceptedQuests | Quest[] | 依頼状態 |

### 2.3 用語変更の反映

| 旧用語 | 新用語 | 変更日 |
|--------|--------|--------|
| ランクHP | 昇格ゲージ | 2026-01-02 |
| hp（RankMaster） | requiredContribution | 2026-01-02 |

---

## 3. 技術選定に関する確認事項

### 3.1 フレームワーク・ライブラリ

| 項目 | 選定結果 | 選定理由 |
|------|---------|---------|
| ゲームフレームワーク | Phaser 3.87+ | 2Dゲーム向け、成熟したエコシステム |
| UIプラグイン | rexUI | Dialog, Buttons等の豊富なコンポーネント |
| ビルドツール | Vite 5.x | 高速なHMR、TypeScriptサポート |
| 言語 | TypeScript 5.x | 型安全性、IDE支援 |

### 3.2 データ永続化

| 項目 | 選定結果 | 選定理由 |
|------|---------|---------|
| セーブデータ | localStorage | クライアントサイドのみ、シンプル |
| マスターデータ | JSON（バンドル） | 静的データ、ビルド時最適化 |
| スロット数 | 3スロット | 要件定義書より |

---

## 4. パフォーマンスに関する確認事項

### 4.1 目標値

| 項目 | 目標 | 根拠 |
|------|------|------|
| Boot時間 | < 2秒 | 一般的なゲーム基準 |
| シーン遷移 | < 500ms | UX要件 |
| フレームレート | 60fps | Phaserデフォルト |

### 4.2 最適化方針

| 対策 | 内容 |
|------|------|
| アセット管理 | スプライトシート、遅延ロード |
| UI更新 | 差分更新、オブジェクトプール |
| メモリ管理 | シーン終了時のイベント解除 |

---

## 5. セキュリティに関する確認事項

### 5.1 対象リスクと対策

| リスク | 対策 | 優先度 |
|--------|------|--------|
| セーブデータ改ざん | チェックサム検証（将来） | 低 |
| ローカルストレージ上限 | 容量チェック | 中 |
| XSS | 該当箇所なし | - |

### 5.2 判断根拠

- クライアントサイドのみのシングルプレイヤーゲーム
- ランキング等のオンライン機能なし
- チート対策は限定的で許容

---

## 6. 未確定事項・今後の検討課題

### 6.1 設計上の未確定事項

| 項目 | 現状 | 今後の方針 |
|------|------|-----------|
| サーバー連携 | 未実装 | 将来の拡張余地を確保 |
| マルチプラットフォーム | Web版のみ | Electronラッパー等で対応可能 |
| ローカライゼーション | 日本語のみ | 将来対応可能な設計 |

### 6.2 技術的負債の認識

| 項目 | 内容 | 対応時期 |
|------|------|---------|
| セーブデータマイグレーション | バージョン間互換 | リリース後 |
| テストカバレッジ | Domain層90%目標 | 実装フェーズ |
| パフォーマンス計測 | 実機検証必要 | 統合テスト時 |

---

## 7. 設計決定の履歴

| 日付 | 決定事項 | 理由 |
|------|---------|------|
| 2026-01-01 | Phaser採用 | 2Dゲーム表現力、既存エコシステム |
| 2026-01-01 | Clean Architecture維持 | テスタビリティ、既存設計の活用 |
| 2026-01-02 | 昇格ゲージへの用語変更 | ユーザー理解の改善 |
| 2026-01-14 | 設計文書の分割 | 可読性・保守性向上 |
| 2026-01-16 | architecture-overview.md詳細化 | サービス初期化、エラーハンドリング、テスト戦略追加 |
| 2026-01-16 | interfaces.ts作成 | 型定義の一元管理 |

---

## 8. 参照文書

- [要件定義書](../../spec/atelier-guild-rank-requirements.md)
- [受け入れ基準](../../spec/atelier-acceptance-criteria.md)
- [システムアーキテクチャ設計書](architecture-overview.md)
- [データスキーマ設計書](data-schema.md)
- [データフロー設計書](dataflow.md)
- [コアシステム設計書](core-systems-overview.md)
- [型定義ファイル](interfaces.ts)
