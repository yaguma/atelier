# データスキーマ設計書

**バージョン**: 1.2.0
**作成日**: 2026-01-01
**更新日**: 2026-01-02
**対象**: アトリエ錬金術ゲーム（ギルドランク制）HTML版

---

## 概要

# データスキーマ設計書 - データフロー

このドキュメントは [データスキーマ設計書](data-schema.md) の一部なのだ。

---

## 3. データフロー

### 3.1 ロードタイミング

| データ種別 | タイミング | 備考 |
|-----------|-----------|------|
| マスターデータ | ゲーム起動時 | 全データをメモリに保持 |
| セーブデータ（存在確認） | タイトル画面表示時 | コンティニュー可否判定 |
| セーブデータ（読み込み） | ゲーム開始時 | 選択されたスロットを読み込み |

### 3.2 セーブタイミング

| タイミング | トリガー | 備考 |
|-----------|----------|------|
| 日終了時 | フェーズ完了 | 自動セーブ |
| ランクアップ時 | 昇格試験クリア | 自動セーブ |
| 手動セーブ | メニューから | 任意タイミング |

### 3.3 バージョン管理

セーブデータのバージョンが異なる場合のマイグレーション戦略：

| 旧バージョン | 新バージョン | 対応 |
|-------------|-------------|------|
| 1.0.x | 1.0.x | 互換性あり |
| 1.0.x | 1.1.x | マイグレーション実行 |
| 1.x.x | 2.x.x | 非互換、新規作成を促す |

---

## 4. 初期デッキ構成

### 4.1 初期デッキ（15枚）🔵

| カードID | カード名 | 種別 | 枚数 |
|---------|---------|------|------|
| gathering_backyard | 裏庭 | 採取地 | 2 |
| gathering_nearby_forest | 近くの森 | 採取地 | 3 |
| gathering_riverside | 川辺 | 採取地 | 2 |
| recipe_healing_potion | 回復薬 | レシピ | 2 |
| recipe_nutrition | 栄養剤 | レシピ | 2 |
| recipe_antidote | 解毒剤 | レシピ | 1 |
| enhance_sage_catalyst | 賢者の触媒 | 強化 | 1 |
| enhance_spirit_guide | 精霊の導き | 強化 | 1 |
| enhance_guild_letter | ギルド推薦状 | 強化 | 1 |

**合計**: 採取地7枚 + レシピ5枚 + 強化3枚 = 15枚

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2026-01-01 | 1.0.0 | 初版作成 |
| 2026-01-01 | 1.1.0 | 採取地カード構造をドラフト採取方式に対応。baseCost/presentationCount/rareRate/materialPoolフィールドを追加。強化カード「精霊の導き」の効果をPRESENTATION_BONUS（提示回数+1）に変更。アーティファクト「古代の地図」の効果をPRESENTATION_BONUS（提示回数+1）に変更。 |
| 2026-01-02 | 1.2.0 | 「ランクHP」から「昇格ゲージ」への用語変更に対応。GameStateのrankHpフィールドをpromotionGaugeに変更し、requiredContributionフィールドを追加。guild_ranks.jsonのhpフィールドをrequiredContributionに変更。 |

---

## ナビゲーション

- [← ゲームマスターデータ](data-schema-master-game.md)
- [セーブデータ](data-schema-save.md)
- [カードマスターデータ](data-schema-master-cards.md)
