# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1.0
**ä½œæˆæ—¥**: 2026-01-01
**æœ€çµ‚æ›´æ–°**: 2026-01-16
**å¯¾è±¡**: ã‚¢ãƒˆãƒªã‚¨éŒ¬é‡‘è¡“ã‚²ãƒ¼ãƒ ï¼ˆã‚®ãƒ«ãƒ‰ãƒ©ãƒ³ã‚¯åˆ¶ï¼‰Phaserç‰ˆ

# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸ - æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸](architecture.md) ã®ä¸€éƒ¨ãªã®ã ã€‚

---

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€éŒ¬é‡‘è¡“ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸã‚®ãƒ«ãƒ‰ãƒ©ãƒ³ã‚¯åˆ¶ãƒ‡ãƒƒã‚­æ§‹ç¯‰RPGã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®šç¾©ã™ã‚‹ã€‚

### ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

> éŒ¬é‡‘è¡“å¸«ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ãŒã€æ¡å–åœ°ã‚«ãƒ¼ãƒ‰ã¨ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰ã®ãƒ‡ãƒƒã‚­ã‚’é§†ä½¿ã—ã€
> ä¾é ¼ã‚’é”æˆã—ã¦è²¢çŒ®åº¦ã‚’ç¨¼ãã€ã‚®ãƒ«ãƒ‰ãƒ©ãƒ³ã‚¯ã¨ã„ã†ã€Œæ•µã€ã‚’å€’ã—ã¦ã„ã
> ã€Œæˆ¦ç•¥çš„ãƒ‡ãƒƒã‚­æ§‹ç¯‰ã€ã¨ã€Œãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã®é”æˆæ„Ÿã€ã‚’å‘³ã‚ã†ã‚²ãƒ¼ãƒ 

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´

- **Clean Architectureï¼ˆ4å±¤æ§‹é€ ï¼‰** ã«ã‚ˆã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ç‹¬ç«‹æ€§ç¢ºä¿
- **Phaserãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** ã«ã‚ˆã‚‹æ´—ç·´ã•ã‚ŒãŸã‚²ãƒ¼ãƒ UIè¡¨ç¾
- **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆ** ã«ã‚ˆã‚‹ç–çµåˆãªé€šä¿¡
- Domain/Application/Infrastructureå±¤ã¯æ—¢å­˜è¨­è¨ˆã‚’ç¶­æŒã—ã€Presentationå±¤ã®ã¿Phaserã«ç½®ãæ›ãˆ

### ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«å‡¡ä¾‹

- ğŸ”µ **é’ä¿¡å·**: è¦ä»¶å®šç¾©æ›¸ãƒ»æ—¢å­˜è¨­è¨ˆæ›¸ã«è©³ç´°è¨˜è¼‰
- ğŸŸ¡ **é»„ä¿¡å·**: è¦ä»¶å®šç¾©æ›¸ãƒ»æ—¢å­˜è¨­è¨ˆã‹ã‚‰å¦¥å½“ãªæ¨æ¸¬
- ğŸ”´ **èµ¤ä¿¡å·**: Phaserå¯¾å¿œã®ãŸã‚ã®æ–°è¦è¿½åŠ 

---

## 1. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ ğŸ”´

### 1.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| TypeScript | 5.x | ãƒ¡ã‚¤ãƒ³è¨€èª |
| **Phaser** | 3.87+ | ã‚²ãƒ¼ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| **rexUI Plugin** | æœ€æ–° | UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€ãƒœã‚¿ãƒ³ç­‰ï¼‰ |
| Vite | 5.x | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« |

### 1.2 ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

| æŠ€è¡“ | ç”¨é€” | è©³ç´° |
|------|------|------|
| localStorage | ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ä¿å­˜ | 3ã‚¹ãƒ­ãƒƒãƒˆå¯¾å¿œã€è‡ªå‹•ã‚»ãƒ¼ãƒ– |
| JSON | ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å½¢å¼ | ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒãƒ³ãƒ‰ãƒ« |

### 1.3 ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç”¨é€” | å¿…é ˆ |
|-----------|------|------|
| phaser | ã‚²ãƒ¼ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | â—‹ |
| phaser3-rex-plugins | UIæ‹¡å¼µï¼ˆDialog, Buttons, Sizerç­‰ï¼‰ | â—‹ |

### 1.4 è¨­è¨ˆæ–¹é‡

- æ—¢å­˜ã®Domain/Application/Infrastructureå±¤ã¯ãã®ã¾ã¾ç¶­æŒ
- Presentationå±¤ã®ã¿Phaserã«ç½®ãæ›ãˆ
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯Phaserã«ä¾å­˜ã—ãªã„
- å¤–éƒ¨ä¾å­˜ã‚’å¿…è¦æœ€å°é™ã«æŠ‘ãˆã‚‹

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ ğŸŸ¡

### 2.1 æ¡ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | é©ç”¨ç¯„å›² | èª¬æ˜ |
|---------|---------|------|
| **Clean Architecture** | å…¨ä½“æ§‹é€  | 4å±¤æ§‹é€ ã«ã‚ˆã‚‹è²¬å‹™åˆ†é›¢ |
| **Scene-based Architecture** ğŸ”´ | Presentation | Phaserã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã‚’æ´»ç”¨ |
| **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆ** | å±¤é–“é€šä¿¡ | EventBusã«ã‚ˆã‚‹ç–çµåˆãªé€šä¿¡ |
| **State Machine** | ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç† | å³å¯†ãªçŠ¶æ…‹é·ç§»åˆ¶å¾¡ |
| **Repository Pattern** | ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ | ãƒ‡ãƒ¼ã‚¿å±¤ã®æŠ½è±¡åŒ– |
| **Service Locator** | ä¾å­˜è§£æ±º | ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ç®¡ç† |

### 2.2 é¸æŠç†ç”±

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ç†ç”± | ãƒ¡ãƒªãƒƒãƒˆ |
|---------|------|---------|
| Clean Architecture | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ç‹¬ç«‹æ€§ç¢ºä¿ | ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¤‰æ›´ã«å¼·ã„ |
| Scene-based | Phaserã®ç”»é¢ç®¡ç†ã¨ã®è¦ªå’Œæ€§ | ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã®çµ±ä¸€ |
| ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹• | UIãƒ»ãƒ­ã‚¸ãƒƒã‚¯é–“ã®ç–çµåˆåŒ– | æ‹¡å¼µæ€§ç¢ºä¿ã€ãƒ‡ãƒãƒƒã‚°å®¹æ˜“ |
| State Machine | ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»ã®å³å¯†ãªç®¡ç† | ä¸æ­£é·ç§»é˜²æ­¢ã€çŠ¶æ…‹è¿½è·¡ |

### 2.3 ãƒ‘ã‚¿ãƒ¼ãƒ³é–“ã®é–¢ä¿‚

```mermaid
graph TB
    subgraph "Presentation (Phaser)"
        Scene[Scene-based Architecture]
        UI[UI Components]
    end

    subgraph "Application"
        SM[State Machine]
        EB[Event Bus]
    end

    subgraph "Domain"
        SVC[Domain Services]
    end

    subgraph "Infrastructure"
        REPO[Repository Pattern]
    end

    Scene --> EB
    UI --> EB
    EB --> SM
    SM --> SVC
    SVC --> REPO
```

---

## 3. ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€  ğŸ”´

### 3.1 ãƒ¬ã‚¤ãƒ¤ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer (Phaser)                          â”‚
â”‚  (Phaser Scenes, GameObjects, rexUI Components)                         â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚BootScene    â”‚ â”‚ TitleScene   â”‚ â”‚ MainScene    â”‚ â”‚ ShopScene    â”‚   â”‚
â”‚  â”‚ãƒ»ã‚¢ã‚»ãƒƒãƒˆ   â”‚ â”‚ãƒ»æ–°è¦/ç¶šè¡Œ   â”‚ â”‚ãƒ»4ãƒ•ã‚§ãƒ¼ã‚ºUI â”‚ â”‚ãƒ»ã‚«ãƒ¼ãƒ‰è³¼å…¥  â”‚   â”‚
â”‚  â”‚  ãƒ­ãƒ¼ãƒ‰     â”‚ â”‚ãƒ»ã‚»ãƒ¼ãƒ–é¸æŠ  â”‚ â”‚ãƒ»æ‰‹æœ­/ãƒ‡ãƒƒã‚­ â”‚ â”‚ãƒ»ã‚¢ã‚¤ãƒ†ãƒ     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚RankUpScene  â”‚ â”‚GameOverScene â”‚ â”‚GameClearSceneâ”‚                     â”‚
â”‚  â”‚ãƒ»æ˜‡æ ¼è©¦é¨“   â”‚ â”‚ãƒ»å¤±æ•—æ¼”å‡º    â”‚ â”‚ãƒ»ã‚¯ãƒªã‚¢æ¼”å‡º  â”‚                     â”‚
â”‚  â”‚ãƒ»å ±é…¬é¸æŠ   â”‚ â”‚ãƒ»ãƒªãƒˆãƒ©ã‚¤    â”‚ â”‚ãƒ»çµ±è¨ˆè¡¨ç¤º    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              UI Components (rexUI + Custom)                     â”‚    â”‚
â”‚  â”‚  CardView, HandView, DeckView, QuestPanel, PhaseIndicator      â”‚    â”‚
â”‚  â”‚  Dialog, Buttons, Sizer, ProgressBar, ScrollablePanel          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘ Events / Method Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Application Layer                                 â”‚
â”‚  (ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡, çŠ¶æ…‹ç®¡ç†, ã‚¤ãƒ™ãƒ³ãƒˆèª¿æ•´)                               â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        GameFlowManager                            â”‚   â”‚
â”‚  â”‚  ãƒ»ã‚²ãƒ¼ãƒ å…¨ä½“ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†                                  â”‚   â”‚
â”‚  â”‚  ãƒ»ã‚·ãƒ¼ãƒ³é·ç§»ã®åˆ¶å¾¡                                                â”‚   â”‚
â”‚  â”‚  ãƒ»ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼/ã‚¯ãƒªã‚¢åˆ¤å®šã®ãƒˆãƒªã‚¬ãƒ¼                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚PhaseManager â”‚ â”‚ EventBus    â”‚ â”‚StateManager  â”‚ â”‚  UseCases    â”‚   â”‚
â”‚  â”‚ãƒ»ãƒ•ã‚§ãƒ¼ã‚º   â”‚ â”‚ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ   â”‚ â”‚ãƒ»ã‚²ãƒ¼ãƒ çŠ¶æ…‹  â”‚ â”‚ãƒ»ä¾é ¼å—æ³¨    â”‚   â”‚
â”‚  â”‚  é·ç§»åˆ¶å¾¡   â”‚ â”‚  é…ä¿¡       â”‚ â”‚  ä¸€å…ƒç®¡ç†    â”‚ â”‚ãƒ»æ¡å–å®Ÿè¡Œ    â”‚   â”‚
â”‚  â”‚ãƒ»ã‚¹ã‚­ãƒƒãƒ—   â”‚ â”‚ãƒ»è³¼èª­ç®¡ç†   â”‚ â”‚ãƒ»ä¸å¤‰æ›´æ–°    â”‚ â”‚ãƒ»èª¿åˆå®Ÿè¡Œ    â”‚   â”‚
â”‚  â”‚  åˆ¤å®š       â”‚ â”‚             â”‚ â”‚              â”‚ â”‚ãƒ»ç´å“å‡¦ç†    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘ Method Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Domain Layer                                    â”‚
â”‚  (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯, ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹, ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£)                       â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ DeckService â”‚ â”‚GatheringSvc â”‚ â”‚ AlchemySvc  â”‚ â”‚ QuestService â”‚   â”‚
â”‚  â”‚ãƒ»ãƒ‰ãƒ­ãƒ¼     â”‚ â”‚ãƒ»ãƒ‰ãƒ©ãƒ•ãƒˆ   â”‚ â”‚ãƒ»èª¿åˆè¨ˆç®—   â”‚ â”‚ãƒ»ä¾é ¼ç”Ÿæˆ    â”‚   â”‚
â”‚  â”‚ãƒ»ã‚·ãƒ£ãƒƒãƒ•ãƒ« â”‚ â”‚  æ¡å–       â”‚ â”‚ãƒ»å“è³ªæ±ºå®š   â”‚ â”‚ãƒ»æœŸé™ç®¡ç†    â”‚   â”‚
â”‚  â”‚ãƒ»æ¨ã¦æœ­å‡¦ç† â”‚ â”‚ãƒ»ç´ æç²å¾—   â”‚ â”‚ãƒ»ãƒ¬ã‚·ãƒ”é©ç”¨ â”‚ â”‚ãƒ»å ±é…¬è¨ˆç®—    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ContribCalc  â”‚ â”‚ ShopService â”‚ â”‚ RankService â”‚ â”‚ArtifactSvc   â”‚   â”‚
â”‚  â”‚ãƒ»è²¢çŒ®åº¦     â”‚ â”‚ãƒ»ã‚«ãƒ¼ãƒ‰è³¼å…¥ â”‚ â”‚ãƒ»æ˜‡æ ¼åˆ¤å®š   â”‚ â”‚ãƒ»åŠ¹æœé©ç”¨    â”‚   â”‚
â”‚  â”‚  ç®—å‡º       â”‚ â”‚ãƒ»ã‚¢ã‚¤ãƒ†ãƒ    â”‚ â”‚ãƒ»è©¦é¨“ç®¡ç†   â”‚ â”‚ãƒ»æ‰€æŒç®¡ç†    â”‚   â”‚
â”‚  â”‚ãƒ»ãƒœãƒ¼ãƒŠã‚¹   â”‚ â”‚  è³¼å…¥       â”‚ â”‚ãƒ»ãƒ©ãƒ³ã‚¯æ›´æ–° â”‚ â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚MaterialSvc  â”‚ â”‚InventorySvc â”‚   Entities:                           â”‚
â”‚  â”‚ãƒ»å“è³ªè¨ˆç®—   â”‚ â”‚ãƒ»ç´ æç®¡ç†   â”‚   Card, Material, Item, Quest,        â”‚
â”‚  â”‚ãƒ»å±æ€§æ±ºå®š   â”‚ â”‚ãƒ»ã‚¢ã‚¤ãƒ†ãƒ    â”‚   Artifact, Rank, Client              â”‚
â”‚  â”‚             â”‚ â”‚  ç®¡ç†       â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘ Data Access
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Infrastructure Layer                               â”‚
â”‚  (ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹, å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº, ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)                       â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚SaveDataRepo â”‚ â”‚MasterLoader â”‚ â”‚RandomGen     â”‚ â”‚StorageAdapterâ”‚   â”‚
â”‚  â”‚ãƒ»ã‚»ãƒ¼ãƒ–     â”‚ â”‚ãƒ»JSONèª­è¾¼   â”‚ â”‚ãƒ»ä¹±æ•°ç”Ÿæˆ    â”‚ â”‚ãƒ»localStorageâ”‚   â”‚
â”‚  â”‚ãƒ»ãƒ­ãƒ¼ãƒ‰     â”‚ â”‚ãƒ»ãƒãƒªãƒ‡ãƒ¼ãƒˆ â”‚ â”‚ãƒ»ã‚·ãƒ¼ãƒ‰ç®¡ç†  â”‚ â”‚  æŠ½è±¡åŒ–      â”‚   â”‚
â”‚  â”‚ãƒ»å‰Šé™¤       â”‚ â”‚ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ â”‚ â”‚              â”‚ â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™è©³ç´°

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | è²¬å‹™ | ä¾å­˜å¯èƒ½ | ç¦æ­¢äº‹é … |
|---------|------|---------|---------|
| **Presentation** | UIè¡¨ç¤ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å—ä»˜ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ | Application | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… |
| **Application** | ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã€çŠ¶æ…‹ç®¡ç†ã€ã‚¤ãƒ™ãƒ³ãƒˆèª¿æ•´ | Domain | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ç›´æ¥å‘¼ã³å‡ºã— |
| **Domain** | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«å®Ÿè£… | Infrastructure(IFçµŒç”±) | UI/ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¾å­˜ |
| **Infrastructure** | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã€å¤–éƒ¨é€£æºã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ | ãªã— | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… |

### 3.3 ä¾å­˜æ€§ã®æ–¹å‘

```mermaid
graph TD
    P[Presentation] --> A[Application]
    A --> D[Domain]
    D --> I[Infrastructure Interface]
    I -.-> II[Infrastructure Implementation]

    style P fill:#e1f5fe
    style A fill:#fff3e0
    style D fill:#e8f5e9
    style I fill:#fce4ec
    style II fill:#fce4ec
```

**ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼ˆDIPï¼‰é©ç”¨ç®‡æ‰€**:
- Domainå±¤ã¯Infrastructureå±¤ã®**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**ã«ã®ã¿ä¾å­˜
- å®Ÿè£…ã¯Infrastructureå±¤ã§è¡Œã„ã€èµ·å‹•æ™‚ã«æ³¨å…¥

---

## 4. ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« ğŸŸ¡

### 4.1 ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ

```typescript
// ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–é †åºã¨ä¾å­˜é–¢ä¿‚
class ServiceContainer {
  // Infrastructureå±¤ï¼ˆæœ€åˆã«åˆæœŸåŒ–ï¼‰
  private storageAdapter: IStorageAdapter;
  private masterLoader: IMasterDataLoader;
  private randomGenerator: IRandomGenerator;
  private saveDataRepository: ISaveDataRepository;

  // Domainå±¤ï¼ˆInfrastructureå±¤ã®å¾Œã«åˆæœŸåŒ–ï¼‰
  private deckService: IDeckService;
  private gatheringService: IGatheringService;
  private alchemyService: IAlchemyService;
  // ...

  // Applicationå±¤ï¼ˆDomainå±¤ã®å¾Œã«åˆæœŸåŒ–ï¼‰
  private stateManager: IStateManager;
  private eventBus: IEventBus;
  private phaseManager: IPhaseManager;
  private gameFlowManager: IGameFlowManager;
}
```

### 4.2 åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

```mermaid
sequenceDiagram
    participant Boot as BootScene
    participant SC as ServiceContainer
    participant Infra as Infrastructure
    participant Domain as Domain Services
    participant App as Application Services

    Boot->>SC: initialize()
    SC->>Infra: createStorageAdapter()
    SC->>Infra: createMasterLoader()
    Infra-->>SC: instances

    SC->>Infra: loadMasterData()
    Infra-->>SC: masterData

    SC->>Domain: createDeckService()
    SC->>Domain: createGatheringService()
    SC->>Domain: createAlchemyService()
    Domain-->>SC: instances

    SC->>App: createStateManager()
    SC->>App: createEventBus()
    SC->>App: createGameFlowManager()
    App-->>SC: instances

    SC-->>Boot: ready
```

---

## 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥ ğŸŸ¡

### 5.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡

| ã‚«ãƒ†ã‚´ãƒª | ä¾‹ | å¯¾å‡¦æ–¹é‡ |
|---------|---|---------|
| **è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼** | ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç ´æã€ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿èª­è¾¼å¤±æ•— | ã‚¨ãƒ©ãƒ¼ç”»é¢è¡¨ç¤ºã€å†èµ·å‹•ä¿ƒé€² |
| **å›å¾©å¯èƒ½ã‚¨ãƒ©ãƒ¼** | æ“ä½œä¸å¯ï¼ˆç´ æä¸è¶³ç­‰ï¼‰ã€ç„¡åŠ¹ãªé·ç§» | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸é€šçŸ¥ã€æ“ä½œã‚­ãƒ£ãƒ³ã‚»ãƒ« |
| **è­¦å‘Š** | éæ¨å¥¨æ“ä½œã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è­¦å‘Š | ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã€ç¶šè¡Œ |

### 5.2 ã‚¨ãƒ©ãƒ¼ä¼æ’­

```typescript
// Domainå±¤ã®ã‚¨ãƒ©ãƒ¼
class DomainError extends Error {
  constructor(
    public readonly code: string,
    message: string,
    public readonly details?: unknown
  ) {
    super(message);
  }
}

// Applicationå±¤ã§ã®å¤‰æ›
class ApplicationError extends Error {
  constructor(
    public readonly userMessage: string,
    public readonly originalError?: Error
  ) {
    super(userMessage);
  }
}
```

### 5.3 ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã‚¨ãƒ©ãƒ¼å‡¦ç†

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | è²¬å‹™ | å‡¦ç†å†…å®¹ |
|---------|------|---------|
| **Presentation** | ã‚¨ãƒ©ãƒ¼è¡¨ç¤º | ãƒ€ã‚¤ã‚¢ãƒ­ã‚°/ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºã€UIçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ |
| **Application** | ã‚¨ãƒ©ãƒ¼å¤‰æ› | Domainâ†’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¤‰æ›ã€ãƒ­ã‚®ãƒ³ã‚° |
| **Domain** | ã‚¨ãƒ©ãƒ¼ç”Ÿæˆ | ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•åã®æ¤œå‡ºã€è©³ç´°ã‚¨ãƒ©ãƒ¼ç”Ÿæˆ |
| **Infrastructure** | ã‚¨ãƒ©ãƒ¼ãƒ©ãƒƒãƒ— | å¤–éƒ¨ã‚¨ãƒ©ãƒ¼ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼å¤‰æ› |

---

## 6. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ ğŸ”µ

### 6.1 GameStateã®æ§‹é€ 

```typescript
interface GameState {
  // é€²è¡ŒçŠ¶æ…‹
  currentDay: number;           // ç¾åœ¨æ—¥æ•°ï¼ˆ1-30ï¼‰
  currentPhase: Phase;          // ç¾åœ¨ãƒ•ã‚§ãƒ¼ã‚º
  currentRank: RankId;          // ç¾åœ¨ãƒ©ãƒ³ã‚¯ï¼ˆG-Sï¼‰

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚½ãƒ¼ã‚¹
  gold: number;                 // æ‰€æŒé‡‘
  promotionGauge: number;       // æ˜‡æ ¼ã‚²ãƒ¼ã‚¸ï¼ˆ0-100ï¼‰
  requiredContribution: number; // å¿…è¦è²¢çŒ®åº¦

  // ãƒ‡ãƒƒã‚­çŠ¶æ…‹
  deck: CardId[];               // å±±æœ­
  hand: CardId[];               // æ‰‹æœ­
  discardPile: CardId[];        // æ¨ã¦æœ­

  // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª
  materials: MaterialInstance[]; // æ‰€æŒç´ æ
  items: ItemInstance[];         // æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ 
  artifacts: ArtifactId[];       // æ‰€æŒã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ

  // ä¾é ¼çŠ¶æ…‹
  availableQuests: Quest[];     // å—æ³¨å¯èƒ½ä¾é ¼
  acceptedQuests: Quest[];      // å—æ³¨æ¸ˆã¿ä¾é ¼

  // æ˜‡æ ¼è©¦é¨“çŠ¶æ…‹ï¼ˆRankUpSceneç”¨ï¼‰
  promotionTest?: PromotionTestState;
}
```

### 6.2 çŠ¶æ…‹æ›´æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³

```mermaid
sequenceDiagram
    participant UI as UI Component
    participant UC as UseCase
    participant SM as StateManager
    participant EB as EventBus

    UI->>UC: execute(params)
    UC->>UC: validate & process
    UC->>SM: updateState(changes)
    SM->>SM: create new state (immutable)
    SM->>EB: publish(STATE_UPDATED, newState)
    EB->>UI: notify
    UI->>UI: re-render
```

### 6.3 ä¸å¤‰æ€§ã®ä¿è¨¼

```typescript
class StateManager {
  private state: Readonly<GameState>;

  updateState(changes: Partial<GameState>): void {
    // æ–°ã—ã„çŠ¶æ…‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«æ›´æ–°ï¼‰
    this.state = Object.freeze({
      ...this.state,
      ...changes,
      // ãƒã‚¹ãƒˆã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚æ–°è¦ä½œæˆ
      materials: changes.materials
        ? [...changes.materials]
        : this.state.materials,
    });

    this.eventBus.publish('STATE_UPDATED', this.state);
  }
}
```

---

## 7. é€šä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³ ğŸ”´

### 7.1 ã‚¤ãƒ™ãƒ³ãƒˆã‚«ã‚¿ãƒ­ã‚°

| ã‚¤ãƒ™ãƒ³ãƒˆå | ç™ºè¡Œå…ƒ | è³¼èª­è€… | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ |
|-----------|--------|--------|-----------|
| `STATE_UPDATED` | StateManager | å…¨ã‚·ãƒ¼ãƒ³ | `GameState` |
| `PHASE_CHANGED` | PhaseManager | MainScene | `{ from, to }` |
| `QUEST_ACCEPTED` | QuestUseCase | QuestPanel | `Quest` |
| `GATHERING_COMPLETED` | GatheringUseCase | GatheringUI | `Material[]` |
| `ITEM_CRAFTED` | AlchemyUseCase | AlchemyUI | `Item` |
| `QUEST_DELIVERED` | DeliveryUseCase | QuestPanel | `DeliveryResult` |
| `RANK_UP_TRIGGERED` | RankService | GameFlowManager | `RankId` |
| `GAME_OVER` | GameFlowManager | MainScene | `GameOverReason` |
| `GAME_CLEAR` | GameFlowManager | MainScene | `ClearStats` |

### 7.2 ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ã®å®Ÿè£…

```typescript
interface IEventBus {
  publish<T>(event: string, payload: T): void;
  subscribe<T>(event: string, handler: (payload: T) => void): () => void;
  unsubscribe(event: string, handler: Function): void;
  unsubscribeAll(): void;
}
```

### 7.3 Scene-EventBusé€£æº

```typescript
abstract class BaseGameScene extends Phaser.Scene {
  protected eventBus: IEventBus;
  private subscriptions: (() => void)[] = [];

  create(): void {
    this.bindEvents();
  }

  protected bindEvents(): void {
    // ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
  }

  protected subscribe<T>(
    event: string,
    handler: (payload: T) => void
  ): void {
    const unsubscribe = this.eventBus.subscribe(event, handler);
    this.subscriptions.push(unsubscribe);
  }

  shutdown(): void {
    // å…¨è³¼èª­è§£é™¤
    this.subscriptions.forEach(unsub => unsub());
    this.subscriptions = [];
  }
}
```

---

## 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é … ğŸŸ¡

### 8.1 ãƒ¡ãƒ¢ãƒªç®¡ç†

| å¯¾è±¡ | æˆ¦ç•¥ | å®Ÿè£… |
|------|------|------|
| **ã‚·ãƒ¼ãƒ³** | é…å»¶ãƒ­ãƒ¼ãƒ‰ | å¿…è¦æ™‚ã«ã®ã¿ã‚·ãƒ¼ãƒ³é–‹å§‹ |
| **UIéƒ¨å“** | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ¼ãƒ« | CardViewç­‰ã®å†åˆ©ç”¨ |
| **ã‚¤ãƒ™ãƒ³ãƒˆ** | é©åˆ‡ãªè³¼èª­è§£é™¤ | ã‚·ãƒ¼ãƒ³çµ‚äº†æ™‚ã«å…¨è§£é™¤ |
| **ç”»åƒ** | ã‚¢ãƒˆãƒ©ã‚¹åŒ– | ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆä½¿ç”¨ |

### 8.2 ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–

```typescript
// å·®åˆ†æ›´æ–°ã®ä¾‹
class HandView {
  private cards: CardView[] = [];

  update(newHand: CardId[]): void {
    // å¤‰æ›´ãŒã‚ã£ãŸéƒ¨åˆ†ã®ã¿æ›´æ–°
    const changes = this.diffCards(this.currentHand, newHand);

    changes.removed.forEach(id => this.removeCard(id));
    changes.added.forEach(id => this.addCard(id));
    changes.moved.forEach(({ id, newIndex }) => {
      this.moveCard(id, newIndex);
    });
  }
}
```

### 8.3 ãƒ­ãƒ¼ãƒ‰æ™‚é–“ã®æœ€é©åŒ–

| ãƒ•ã‚§ãƒ¼ã‚º | å‡¦ç† | ç›®æ¨™æ™‚é–“ |
|---------|------|---------|
| **Boot** | å¿…é ˆã‚¢ã‚»ãƒƒãƒˆã®ã¿ | < 2ç§’ |
| **Titleè¡¨ç¤ºå¾Œ** | æ®‹ã‚Šã‚¢ã‚»ãƒƒãƒˆéåŒæœŸãƒ­ãƒ¼ãƒ‰ | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ |
| **ã‚·ãƒ¼ãƒ³é·ç§»** | ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ | < 500ms |

---

## 9. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ ğŸŸ¡

### 9.1 ãƒ†ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ†ã‚¹ãƒˆç¨®åˆ¥ | ãƒ„ãƒ¼ãƒ« | ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ |
|---------|-----------|--------|---------------|
| **Domain** | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | Vitest | 90%+ |
| **Application** | çµ±åˆãƒ†ã‚¹ãƒˆ | Vitest | 80%+ |
| **Presentation** | E2Eãƒ†ã‚¹ãƒˆ | Playwright | ä¸»è¦ãƒ•ãƒ­ãƒ¼ |
| **å…¨ä½“** | ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ | Vitest | çŠ¶æ…‹é·ç§» |

### 9.2 ãƒ¢ãƒƒã‚¯æˆ¦ç•¥

```typescript
// Infrastructureå±¤ã®ãƒ¢ãƒƒã‚¯
const mockMasterLoader: IMasterDataLoader = {
  loadCards: () => Promise.resolve(testCards),
  loadMaterials: () => Promise.resolve(testMaterials),
  // ...
};

// Domainå±¤ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
describe('DeckService', () => {
  let deckService: DeckService;

  beforeEach(() => {
    deckService = new DeckService(mockRandomGenerator);
  });

  test('ãƒ‰ãƒ­ãƒ¼ã§æ‰‹æœ­ãŒå¢—ãˆã‚‹', () => {
    const initialHand = [];
    const deck = ['card1', 'card2', 'card3'];

    const result = deckService.draw(deck, initialHand, 2);

    expect(result.hand).toHaveLength(2);
    expect(result.deck).toHaveLength(1);
  });
});
```

---

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é … ğŸŸ¡

### 10.1 ãƒ‡ãƒ¼ã‚¿ä¿è­·

| ãƒªã‚¹ã‚¯ | å¯¾ç­– |
|--------|------|
| **ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“** | ãƒã‚§ãƒƒã‚¯ã‚µãƒ æ¤œè¨¼ï¼ˆå°†æ¥å®Ÿè£…ï¼‰ |
| **XSS** | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆè©²å½“ç®‡æ‰€ãªã—ï¼‰ |
| **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šé™** | å®¹é‡ãƒã‚§ãƒƒã‚¯ã€å¤ã„ãƒ‡ãƒ¼ã‚¿å‰Šé™¤æ¡ˆå†… |

### 10.2 ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹ä¿è­·

- ä¹±æ•°ã‚·ãƒ¼ãƒ‰ã®éå…¬é–‹åŒ–
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã¿ã®ãŸã‚ãƒãƒ¼ãƒˆå¯¾ç­–ã¯é™å®šçš„
- å°†æ¥çš„ãªã‚µãƒ¼ãƒãƒ¼é€£æºæ™‚ã®è¨­è¨ˆä½™åœ°ã‚’ç¢ºä¿

---

## é–¢é€£æ–‡æ›¸

- [â†’ Phaserå®Ÿè£…è¨­è¨ˆ](architecture-phaser.md) - ã‚·ãƒ¼ãƒ³æ§‹æˆã€rexUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ãƒ•ã‚§ãƒ¼ã‚ºUI
- [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ](architecture-components.md) - ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
- [ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ](core-systems-overview.md)
- [ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ](data-schema.md)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ](dataflow.md)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-01 | 2.0.0 | Phaserç‰ˆã¨ã—ã¦åˆç‰ˆä½œæˆ |
| 2026-01-14 | 2.0.0 | é–¢é€£æ–‡æ›¸ãƒªãƒ³ã‚¯æ›´æ–° |
| 2026-01-16 | 2.1.0 | è©³ç´°åŒ–ï¼šã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€çŠ¶æ…‹ç®¡ç†ã€é€šä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¿½åŠ  |
