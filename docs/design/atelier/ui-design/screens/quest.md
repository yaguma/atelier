# 依頼（戦闘）画面 詳細設計

## 基本情報

| 項目 | 値 |
|------|-----|
| 画面ID | SCR-004 |
| 親画面 | マップ画面 |
| 子画面 | リザルト画面 |

---

## ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────┐
│ エネルギー: ⚡⚡⚡○○○○○○○   ターン: 3   [ポーズ]     │
├─────────────────────────────────────────────────────────┤
│                    【依頼ボード】                         │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ │
│  │ 村人A ★☆☆☆☆ │ │ 魔法使い ★★★☆☆ │ │ 騎士 ★★★★☆ │ │
│  │ 回復薬        │ │ 魔力の薬      │ │ 強化剤       │ │
│  ├───────────────┤ ├───────────────┤ ├───────────────┤ │
│  │ 水: 8/10     │ │ 火: 5/20     │ │ 地: 0/30     │ │
│  │ 品質: 5/5    │ │ 風: 10/15    │ │ 品質: 0/20   │ │
│  │ 安定: 3      │ │ 安定: -2     │ │ 安定: 5      │ │
│  │ ████████░░   │ │ ███░░░░░░░   │ │ ░░░░░░░░░░   │ │
│  │  [選択中]    │ │              │ │              │ │
│  └───────────────┘ └───────────────┘ └───────────────┘ │
├─────────────────────────────────────────────────────────┤
│                    【錬金釜エリア】                       │
│                   ┌─────────────┐                       │
│                   │    🔮      │                       │
│                   │  ここにカード │                       │
│                   │  をドロップ  │                       │
│                   └─────────────┘                       │
├─────────────────────────────────────────────────────────┤
│ 【手札】                                                 │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐              │
│ │火の鉱│ │水の草│ │混合 │ │加熱 │ │石炭 │   山札:12   │
│ │ 石  │ │     │ │     │ │     │ │     │   捨札: 3   │
│ │コスト1│ │コスト1│ │コスト0│ │コスト2│ │コスト0│              │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘              │
├─────────────────────────────────────────────────────────┤
│ [デッキ]  [捨て札]  [アンドゥ]       [ターン終了]        │
└─────────────────────────────────────────────────────────┘
```

---

## UI要素

| 要素ID | 種類 | 説明 | 状態 |
|--------|------|------|------|
| pnl-header | パネル | ヘッダー情報 | - |
| txt-energy | テキスト | 現在エネルギー | - |
| txt-turn | テキスト | 現在ターン数 | - |
| btn-pause | ボタン | ポーズメニュー | 常に有効 |
| pnl-quests | パネル | 依頼ボード（3件） | - |
| pnl-quest-* | パネル | 各依頼カード | クリックで選択 |
| pnl-cauldron | パネル | 錬金釜（ドロップエリア） | - |
| pnl-hand | パネル | 手札エリア | - |
| btn-card-* | ボタン | 手札カード | エネルギー足りる時有効 |
| txt-deck-count | テキスト | 山札枚数 | - |
| txt-discard-count | テキスト | 捨て札枚数 | - |
| btn-deck | ボタン | デッキ内容確認 | 常に有効 |
| btn-discard | ボタン | 捨て札内容確認 | 常に有効 |
| btn-undo | ボタン | アンドゥ実行 | アンドゥ可能時有効 |
| btn-end-turn | ボタン | ターン終了 | 常に有効 |

---

## 依頼カード表示

```
┌────────────────────┐
│ 顧客名    難易度    │  ← 顧客情報
├────────────────────┤
│ 依頼名              │  ← 依頼タイトル
├────────────────────┤
│ 火: 現在/必要       │
│ 水: 現在/必要       │  ← 属性進捗
│ 地: 現在/必要       │
│ 風: 現在/必要       │
│ 品質: 現在/必要     │
│ 安定値: 現在        │
├────────────────────┤
│ ██████████░░░░░░   │  ← 進捗バー
└────────────────────┘
```

---

## 状態遷移

### 初期状態
- ターン1開始
- エネルギー3付与
- 手札5枚ドロー
- 依頼3件生成・表示

### カード選択状態
- 選択中カードを拡大表示
- プレイ可能な依頼をハイライト

### カードプレイ状態
- カードを錬金釜へアニメーション移動
- 効果を適用
- 依頼進捗を更新

### 暴発状態
- 暴発エフェクト表示
- ペナルティ処理
- 依頼失敗処理

### 依頼達成状態
- 達成エフェクト表示
- 報酬選択画面表示

### ターン終了状態
- 残り手札を捨て札へ
- 次ターン開始処理

---

## アニメーション

| トリガー | アニメーション | 時間 | イージング |
|----------|---------------|------|-----------|
| カード選択 | カード拡大 | 0.1s | ease-out |
| カードプレイ | 手札→釜へ移動 | 0.3s | ease-in-out |
| 属性加算 | 数値カウントアップ | 0.3s | linear |
| 暴発発生 | 画面シェイク + 爆発エフェクト | 0.5s | - |
| 依頼達成 | キラキラエフェクト | 0.5s | - |
| ドロー | 山札→手札へ移動 | 0.2s | ease-out |

---

## イベント

| イベント名 | トリガー | 処理内容 |
|-----------|----------|----------|
| OnPauseClicked | btn-pause押下 / ESCキー | ポーズメニュー表示 |
| OnQuestSelected | pnl-quest-*クリック | 対象依頼を選択状態に |
| OnCardSelected | btn-card-*クリック | カードを選択状態に |
| OnCardPlayed | カードをドロップ / ダブルクリック | カードをプレイ |
| OnUndoClicked | btn-undo押下 / Ctrl+Z | 直前のカードプレイを取り消し |
| OnEndTurnClicked | btn-end-turn押下 / Spaceキー | ターンを終了 |
| OnExplosion | 安定値<0 | 暴発処理を実行 |
| OnQuestComplete | 依頼条件達成 | 達成処理・報酬表示 |

---

## ドラッグ＆ドロップ操作

1. 手札からカードをドラッグ
2. 依頼カードの上にドロップ → その依頼に対してプレイ
3. 錬金釜の上にドロップ → 選択中の依頼に対してプレイ

---

## キーボードショートカット

| キー | アクション |
|------|----------|
| 1-5 | 対応する手札カードを選択 |
| Tab | 次の依頼にフォーカス移動 |
| Enter | 選択中カードをプレイ |
| Ctrl+Z | アンドゥ |
| Space | ターン終了 |
| ESC | ポーズメニュー |

---

## アクセシビリティ

- [x] キーボード操作対応（数字キーでカード選択）
- [x] 属性を色とアイコンの両方で識別可能
- [x] 暴発危険時の警告表示（安定値が0に近い時）
- [x] カードホバーで詳細ツールチップ表示

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-12-20 | 1.0 | 初版作成 |
