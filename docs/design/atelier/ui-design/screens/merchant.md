# 商人画面 詳細設計

## 基本情報

| 項目 | 値 |
|------|-----|
| 画面ID | SCR-005 |
| 親画面 | マップ画面 |
| 子画面 | - |

---

## ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────┐
│ ゴールド: 250                              [マップへ戻る] │
├─────────────────────────────────────────────────────────┤
│                       商人の店                          │
│  「いらっしゃい。何をお探しかな？」                        │
├─────────────────────────────────────────────────────────┤
│  【購入】         【強化】         【削除】              │
│  [選択中]                                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│  │ 強化触媒 │ │ 水の結晶 │ │ 風の羽根 │ │ 地の石  │      │
│  │ 💎      │ │ 💧      │ │ 🍃      │ │ ⛰️      │      │
│  │         │ │         │ │         │ │         │      │
│  │ 100G    │ │ 80G     │ │ 70G     │ │ 60G     │      │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│                                                         │
│  ┌─────────┐ ┌─────────┐                              │
│  │ 秘伝書  │ │ 混合+   │                              │
│  │ 📜      │ │ 🔄      │                              │
│  │         │ │         │                              │
│  │ 150G    │ │ 120G    │                              │
│  └─────────┘ └─────────┘                              │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  選択中: 強化触媒                                        │
│  「触媒カード。属性値を1.5倍にする。安定値-1」           │
│                                                         │
│  火:0 水:0 地:0 風:0 品質:5 安定:-1 コスト:2           │
│                                                         │
│                              [購入する (100G)]          │
└─────────────────────────────────────────────────────────┘
```

---

## UI要素

| 要素ID | 種類 | 説明 | 状態 |
|--------|------|------|------|
| txt-gold | テキスト | 現在のゴールド | - |
| btn-back | ボタン | マップへ戻る | 常に有効 |
| txt-merchant | テキスト | 商人のセリフ | - |
| btn-tab-purchase | ボタン | 購入タブ | 常に有効 |
| btn-tab-upgrade | ボタン | 強化タブ | 常に有効 |
| btn-tab-remove | ボタン | 削除タブ | 常に有効 |
| pnl-items | パネル | 商品一覧 | - |
| btn-item-* | ボタン | 各商品カード | ゴールド足りる時有効 |
| pnl-detail | パネル | 選択中アイテム詳細 | - |
| btn-action | ボタン | 購入/強化/削除実行 | ゴールド足りる時有効 |

---

## タブ別表示

### 購入タブ
- 商人の在庫（5〜7枚のカード）
- 各カードに価格表示
- 購入可能なカードのみ有効化

### 強化タブ
- プレイヤーのデッキからカードを選択
- 強化可能なカード（レベル上限未満）のみ表示
- 強化費用: 75G

### 削除タブ
- プレイヤーのデッキからカードを選択
- 全カードが対象（ただし残り1枚は不可）
- 削除費用: 30G

---

## 状態遷移

### 初期状態
- 購入タブを選択状態で表示
- 商人の在庫を表示

### 商品選択状態
- 選択中商品の詳細を表示
- 購入ボタンを有効化（ゴールド足りる場合）

### 購入確認状態
- 確認ダイアログを表示
- 確定で購入処理

### 購入完了状態
- 成功メッセージ表示
- ゴールド減算
- 在庫から削除

---

## アニメーション

| トリガー | アニメーション | 時間 | イージング |
|----------|---------------|------|-----------|
| 画面表示時 | 商品順次表示 | 0.1s × n | ease-out |
| タブ切替 | フェード | 0.2s | ease-in-out |
| 商品選択 | 拡大 + 光沢 | 0.2s | ease-out |
| 購入成功 | 商品消失 + コイン減少 | 0.3s | ease-in |
| 強化成功 | カードレベルアップエフェクト | 0.5s | - |
| 削除成功 | カード消失エフェクト | 0.3s | ease-in |

---

## イベント

| イベント名 | トリガー | 処理内容 |
|-----------|----------|----------|
| OnBackClicked | btn-back押下 | マップ画面へ遷移 |
| OnTabChanged | タブボタン押下 | 表示内容を切り替え |
| OnItemSelected | btn-item-*押下 | 詳細パネルを更新 |
| OnActionClicked | btn-action押下 | 確認ダイアログ表示 |
| OnPurchaseConfirmed | 確認ダイアログOK | 購入処理実行 |
| OnUpgradeConfirmed | 確認ダイアログOK | 強化処理実行 |
| OnRemoveConfirmed | 確認ダイアログOK | 削除処理実行 |

---

## 価格設計

| アクション | 基本価格 | 備考 |
|-----------|---------|------|
| カード購入（Common） | 50G | - |
| カード購入（Uncommon） | 80G | - |
| カード購入（Rare） | 120G | - |
| カード購入（Epic） | 180G | - |
| カード強化 | 75G | レベル+1 |
| カード削除 | 30G | デッキ圧縮 |

---

## アクセシビリティ

- [x] キーボード操作対応（Tab切替、矢印キーで商品選択）
- [x] 購入不可商品の明示（グレーアウト + 「ゴールド不足」表示）
- [x] 価格の明確な表示

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-12-20 | 1.0 | 初版作成 |
