# TASK-0056 ShopSceneリファクタリング テストケース

**タスクID**: TASK-0056
**タスク名**: ShopSceneリファクタリング
**作成日**: 2026-01-23
**フェーズ**: TDDテストケース定義フェーズ

---

## 概要

本ドキュメントでは、ShopSceneリファクタリングで新規作成するコンポーネントのテストケースを定義する。

### 対象コンポーネント

1. **ShopHeader** - ヘッダーコンポーネント（タイトル、所持金表示、戻るボタン）
2. **ShopItemGrid** - 商品グリッドコンポーネント（グリッドレイアウト、スクロール管理）
3. **ShopItemCard** - 商品カードコンポーネント（商品情報表示、購入ボタン）
4. **types.ts** - 型定義

### 開発言語・フレームワーク

- **プログラミング言語**: TypeScript 5.x
  - **言語選択の理由**: プロジェクト標準言語であり、型安全性を確保できるため
  - **テストに適した機能**: 型推論、インターフェース、モック作成が容易
- **テストフレームワーク**: Vitest
  - **フレームワーク選択の理由**: Viteとの統合が優れており、高速なテスト実行が可能
  - **テスト実行環境**: Node.js環境でのユニットテスト
- 🔵 信頼性レベル: プロジェクト設定（vitest.config.ts, package.json）に基づく

### テスト配置

```
atelier-guild-rank/tests/unit/presentation/ui/scenes/components/shop/
├── ShopHeader.test.ts
├── ShopItemGrid.test.ts
├── ShopItemCard.test.ts
└── types.test.ts
```

---

## 1. ShopHeaderコンポーネント テストケース

### 1.1 正常系テストケース

#### TC-SH-001: 初期化テスト

- **テスト名**: シーンインスタンスでShopHeaderを初期化するとコンテナが作成される
  - **何をテストするか**: ShopHeaderコンストラクタが正しくインスタンスを生成し、内部コンテナが作成されること
  - **期待される動作**: BaseComponentを継承したShopHeaderが正常に初期化される
- **入力値**: `mockScene, x=0, y=0`
  - **入力データの意味**: Phaserシーンのモックと配置位置
- **期待される結果**: ShopHeaderインスタンスが生成され、getContainer()がコンテナを返す
  - **期待結果の理由**: BaseComponentの継承パターンに従っているため
- **テストの目的**: コンポーネント初期化が正常に動作することを確認
  - **確認ポイント**: constructor、getContainer()の動作
- 🔵 信頼性レベル: RankUpHeader.test.tsの同等テストパターンに基づく

#### TC-SH-002: タイトル表示テスト

- **テスト名**: create()が呼び出されると「ショップ」タイトルが表示される
  - **何をテストするか**: create()メソッド実行後にタイトルテキストが作成されること
  - **期待される動作**: scene.add.text()が「ショップ」で呼び出される
- **入力値**: `mockScene`
  - **入力データの意味**: Phaserシーンのモック
- **期待される結果**: mockScene.add.text()がタイトル「ショップ」で呼び出される
  - **期待結果の理由**: 要件定義REQ-056-002に明記
- **テストの目的**: タイトル表示機能の確認
  - **確認ポイント**: テキスト生成とスタイル適用
- 🔵 信頼性レベル: REQ-056-002（タイトルテキスト「ショップ」を表示）に基づく

#### TC-SH-003: 所持金表示テスト

- **テスト名**: setGold(500)が呼び出されると「所持金: 500G」と表示される
  - **何をテストするか**: 所持金の表示更新機能
  - **期待される動作**: setGold()で所持金テキストが更新される
- **入力値**: `gold=500`
  - **入力データの意味**: 所持金の初期値
- **期待される結果**: テキストが「所持金: 500G」形式で表示される
  - **期待結果の理由**: 要件定義REQ-056-002に明記
- **テストの目的**: 所持金表示機能の確認
  - **確認ポイント**: 数値フォーマット、単位表示
- 🔵 信頼性レベル: REQ-056-002（所持金を「所持金: XXX G」形式で表示）に基づく

#### TC-SH-004: 所持金更新テスト

- **テスト名**: updateGold(400)が呼び出されると所持金表示が更新される
  - **何をテストするか**: 所持金の動的更新
  - **期待される動作**: updateGold()で既存テキストが更新される
- **入力値**: `newGold=400`（500から400に減少）
  - **入力データの意味**: 購入後の残り所持金
- **期待される結果**: テキストが「所持金: 400G」に更新される
  - **期待結果の理由**: 購入処理後に所持金表示が更新される必要があるため
- **テストの目的**: 動的更新機能の確認
  - **確認ポイント**: setText()が呼び出されること
- 🟡 信頼性レベル: 現在のShopScene.tsのupdateGoldDisplay()パターンからの妥当な推測

#### TC-SH-005: 戻るボタン表示テスト

- **テスト名**: create()が呼び出されると「戻る」ボタンが表示される
  - **何をテストするか**: 戻るボタンのUI生成
  - **期待される動作**: rexUI.add.label()で戻るボタンが作成される
- **入力値**: `mockScene`
  - **入力データの意味**: rexUIプラグインを持つPhaserシーンのモック
- **期待される結果**: 戻るボタンUIが生成され、インタラクティブ状態になる
  - **期待結果の理由**: 要件定義REQ-056-002に明記
- **テストの目的**: 戻るボタン生成の確認
  - **確認ポイント**: rexUI.add.label()、setInteractive()の呼び出し
- 🔵 信頼性レベル: REQ-056-002（「戻る」ボタンを表示）に基づく

#### TC-SH-006: 戻るボタンクリックイベントテスト

- **テスト名**: 戻るボタンをクリックするとonBackClickコールバックが呼び出される
  - **何をテストするか**: 戻るボタンのクリックイベント発火
  - **期待される動作**: pointerdownイベントでコールバックが呼び出される
- **入力値**: `onBackClick=vi.fn()`
  - **入力データの意味**: クリック時のコールバック関数モック
- **期待される結果**: コールバック関数が1回呼び出される
  - **期待結果の理由**: 要件定義REQ-056-002（クリックイベントを発火）に基づく
- **テストの目的**: イベント発火機能の確認
  - **確認ポイント**: コールバック呼び出し回数
- 🔵 信頼性レベル: REQ-056-002に基づく

### 1.2 異常系テストケース

#### TC-SH-E01: nullシーンでエラー

- **テスト名**: nullシーンでコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 無効なシーン参照でのインスタンス生成
  - **エラー処理の重要性**: 早期エラー検出でデバッグを容易にするため
- **入力値**: `scene=null, x=0, y=0`
  - **不正な理由**: シーンはコンポーネント生成に必須
  - **実際の発生シナリオ**: DIコンテナ未初期化時
- **期待される結果**: Error('BaseComponent: scene is required')がスローされる
  - **エラーメッセージの内容**: 開発者向けの明確なエラーメッセージ
  - **システムの安全性**: 不正なインスタンス生成を防止
- **テストの目的**: 防御的プログラミングの確認
  - **品質保証の観点**: システムの堅牢性確保
- 🔵 信頼性レベル: BaseComponent.tsの実装に基づく

#### TC-SH-E02: undefinedシーンでエラー

- **テスト名**: undefinedシーンでコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 未定義シーン参照でのインスタンス生成
  - **エラー処理の重要性**: TypeScriptの厳格モードでも発生し得る
- **入力値**: `scene=undefined, x=0, y=0`
  - **不正な理由**: シーンは必須パラメータ
  - **実際の発生シナリオ**: 非同期初期化の順序問題
- **期待される結果**: Error('BaseComponent: scene is required')がスローされる
  - **エラーメッセージの内容**: null/undefined両方で同じメッセージ
  - **システムの安全性**: 予期しないnull参照エラーを防止
- **テストの目的**: 異なるnullish値での動作確認
  - **品質保証の観点**: 完全なエラーハンドリング
- 🔵 信頼性レベル: BaseComponent.tsの実装に基づく

#### TC-SH-E03: 無効な座標でエラー

- **テスト名**: NaN座標でコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 数値でない座標値の検出
  - **エラー処理の重要性**: UI配置の不具合を早期発見
- **入力値**: `scene=mockScene, x=NaN, y=NaN`
  - **不正な理由**: 座標は有限の数値でなければならない
  - **実際の発生シナリオ**: 計算エラー、文字列からの変換失敗
- **期待される結果**: Error('Invalid position: x=NaN, y=NaN')がスローされる
  - **エラーメッセージの内容**: 具体的な不正値を含む
  - **システムの安全性**: 描画エラーを防止
- **テストの目的**: 入力値バリデーションの確認
  - **品質保証の観点**: 数値の妥当性検証
- 🔵 信頼性レベル: BaseComponent.tsの実装に基づく

### 1.3 境界値テストケース

#### TC-SH-B01: 所持金0での表示

- **テスト名**: setGold(0)で「所持金: 0G」と表示される
  - **境界値の意味**: 所持金の最小値
  - **境界値での動作保証**: 0でも正常に表示される
- **入力値**: `gold=0`
  - **境界値選択の根拠**: 所持金の下限値
  - **実際の使用場面**: 全額使い切った後
- **期待される結果**: テキストが「所持金: 0G」と表示される
  - **境界での正確性**: 数値0が正しく文字列化される
  - **一貫した動作**: 他の値と同じフォーマット
- **テストの目的**: 最小値での動作確認
  - **堅牢性の確認**: エッジケースでの安定動作
- 🟡 信頼性レベル: 一般的なUI境界値テストパターン

#### TC-SH-B02: 大きな所持金での表示

- **テスト名**: setGold(9999999)で「所持金: 9999999G」と表示される
  - **境界値の意味**: 実運用での想定最大値付近
  - **境界値での動作保証**: 大きな数値でも正常表示
- **入力値**: `gold=9999999`
  - **境界値選択の根拠**: 7桁の数値（ゲーム内で現実的な最大値）
  - **実際の使用場面**: エンドゲームでの高額所持金
- **期待される結果**: テキストが「所持金: 9999999G」と正しく表示される
  - **境界での正確性**: 桁数が多くても正確に表示
  - **一貫した動作**: レイアウト崩れがないこと
- **テストの目的**: 大きな値での動作確認
  - **堅牢性の確認**: 数値オーバーフローがないこと
- 🟡 信頼性レベル: 一般的なUI境界値テストパターン

#### TC-SH-B03: 座標(0, 0)での配置

- **テスト名**: 座標(0, 0)でShopHeaderが正常に配置される
  - **境界値の意味**: 座標の最小値
  - **境界値での動作保証**: 原点配置でも正常動作
- **入力値**: `x=0, y=0`
  - **境界値選択の根拠**: 座標系の原点
  - **実際の使用場面**: 画面左上への配置
- **期待される結果**: コンテナが(0, 0)に配置される
  - **境界での正確性**: 位置計算が正確
  - **一貫した動作**: 他の座標と同じ配置ロジック
- **テストの目的**: 原点配置での動作確認
  - **堅牢性の確認**: 座標計算の正確性
- 🟡 信頼性レベル: 一般的なUI境界値テストパターン

### 1.4 破棄処理テストケース

#### TC-SH-D01: destroy()でリソース解放

- **テスト名**: destroy()が呼び出されるとコンテナと子要素が破棄される
  - **何をテストするか**: リソースの適切な解放
  - **期待される動作**: 全てのUIオブジェクトが破棄される
- **入力値**: ShopHeaderインスタンス
  - **入力データの意味**: 破棄対象のコンポーネント
- **期待される結果**: mockContainer.destroy()が呼び出される
  - **期待結果の理由**: メモリリーク防止のため
- **テストの目的**: リソース管理の確認
  - **確認ポイント**: destroy()メソッドの呼び出し
- 🔵 信頼性レベル: NFR-056-010（メモリリーク防止）に基づく

---

## 2. ShopItemGridコンポーネント テストケース

### 2.1 正常系テストケース

#### TC-SG-001: 初期化テスト

- **テスト名**: シーンインスタンスでShopItemGridを初期化するとコンテナが作成される
  - **何をテストするか**: ShopItemGridコンストラクタが正しくインスタンスを生成すること
  - **期待される動作**: BaseComponentを継承したShopItemGridが正常に初期化される
- **入力値**: `mockScene, x=0, y=100, config={ items: [], onItemSelect: vi.fn() }`
  - **入力データの意味**: Phaserシーンのモック、配置位置、設定
- **期待される結果**: ShopItemGridインスタンスが生成され、getContainer()がコンテナを返す
  - **期待結果の理由**: BaseComponentの継承パターンに従っているため
- **テストの目的**: コンポーネント初期化が正常に動作することを確認
  - **確認ポイント**: constructor、getContainer()の動作
- 🔵 信頼性レベル: RankUpコンポーネントの同等テストパターンに基づく

#### TC-SG-002: 空アイテムリストでの表示

- **テスト名**: 空のアイテムリストでcreate()を呼び出しても正常に動作する
  - **何をテストするか**: アイテムが0件の場合の処理
  - **期待される動作**: エラーなく空のグリッドが作成される
- **入力値**: `items=[]`
  - **入力データの意味**: 商品がないショップ状態
- **期待される結果**: グリッドコンテナが作成され、子要素は0
  - **期待結果の理由**: 空配列でも正常処理が必要
- **テストの目的**: エッジケースの動作確認
  - **確認ポイント**: エラーが発生しないこと
- 🟡 信頼性レベル: 一般的な配列処理の境界値テスト

#### TC-SG-003: 複数アイテムのグリッド配置

- **テスト名**: 3件のアイテムで3列1行のグリッドが作成される
  - **何をテストするか**: グリッドレイアウト計算
  - **期待される動作**: 3列グリッドで正しい位置に配置される
- **入力値**: `items=[item1, item2, item3]`（3件のIShopItem）
  - **入力データの意味**: 1行分のアイテム
- **期待される結果**: 各アイテムが横並びに配置される
  - **期待結果の理由**: LAYOUT.GRID_COLS=3に基づく
- **テストの目的**: レイアウト計算の確認
  - **確認ポイント**: X座標の計算が正しいこと
- 🔵 信頼性レベル: REQ-056-003（3列グリッドレイアウト）に基づく

#### TC-SG-004: 6件アイテムで2行グリッド

- **テスト名**: 6件のアイテムで3列2行のグリッドが作成される
  - **何をテストするか**: 複数行のグリッドレイアウト
  - **期待される動作**: 2行目のアイテムが正しいY座標に配置される
- **入力値**: `items=[item1, item2, item3, item4, item5, item6]`
  - **入力データの意味**: 2行分のアイテム
- **期待される結果**: 4-6番目のアイテムが2行目に配置される
  - **期待結果の理由**: Math.floor(index / 3)で行を計算
- **テストの目的**: 複数行レイアウトの確認
  - **確認ポイント**: Y座標の計算が正しいこと
- 🔵 信頼性レベル: REQ-056-003（グリッドレイアウト）に基づく

#### TC-SG-005: アイテム選択イベント

- **テスト名**: アイテムカードがクリックされるとonItemSelectが呼び出される
  - **何をテストするか**: アイテム選択イベントの伝播
  - **期待される動作**: クリックされたアイテムの情報でコールバックが呼び出される
- **入力値**: `onItemSelect=vi.fn()`、クリック対象のアイテム
  - **入力データの意味**: 選択イベントのコールバック
- **期待される結果**: onItemSelectが選択されたアイテムで呼び出される
  - **期待結果の理由**: 要件定義REQ-056-003に明記
- **テストの目的**: イベント伝播の確認
  - **確認ポイント**: コールバック引数の正確性
- 🔵 信頼性レベル: REQ-056-003（商品選択時にイベントを発火）に基づく

#### TC-SG-006: アイテムリスト更新

- **テスト名**: updateItems()で新しいアイテムリストに更新される
  - **何をテストするか**: アイテムリストの動的更新
  - **期待される動作**: 既存のカードが破棄され、新しいカードが作成される
- **入力値**: `newItems=[newItem1, newItem2]`
  - **入力データの意味**: 更新後のアイテムリスト
- **期待される結果**: グリッドが新しいアイテムで再描画される
  - **期待結果の理由**: 購入後のリスト更新に必要
- **テストの目的**: 動的更新機能の確認
  - **確認ポイント**: 既存カードの破棄、新規カード生成
- 🟡 信頼性レベル: refreshItemList()の動作からの妥当な推測

### 2.2 異常系テストケース

#### TC-SG-E01: nullシーンでエラー

- **テスト名**: nullシーンでコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 無効なシーン参照
  - **エラー処理の重要性**: 早期エラー検出
- **入力値**: `scene=null`
  - **不正な理由**: シーンは必須
  - **実際の発生シナリオ**: DIコンテナ未初期化時
- **期待される結果**: Error('BaseComponent: scene is required')がスローされる
  - **エラーメッセージの内容**: 明確なエラーメッセージ
  - **システムの安全性**: 不正なインスタンス生成を防止
- **テストの目的**: 防御的プログラミングの確認
  - **品質保証の観点**: システムの堅牢性確保
- 🔵 信頼性レベル: BaseComponent.tsの実装に基づく

#### TC-SG-E02: nullアイテムリストでエラー

- **テスト名**: nullアイテムリストでコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 無効なアイテムリスト
  - **エラー処理の重要性**: 配列操作前のバリデーション
- **入力値**: `items=null`
  - **不正な理由**: forEach等の配列操作でエラーになる
  - **実際の発生シナリオ**: API呼び出し失敗時
- **期待される結果**: Error('ShopItemGrid: items is required')がスローされる
  - **エラーメッセージの内容**: 開発者向けの明確なメッセージ
  - **システムの安全性**: null参照エラーを防止
- **テストの目的**: 入力バリデーションの確認
  - **品質保証の観点**: 堅牢なエラーハンドリング
- 🟡 信頼性レベル: 一般的な入力バリデーションパターン

### 2.3 境界値テストケース

#### TC-SG-B01: 1件アイテムでのグリッド

- **テスト名**: 1件のアイテムで単一カードが正しく配置される
  - **境界値の意味**: アイテム数の最小有効値
  - **境界値での動作保証**: 1件でも正常にグリッド作成
- **入力値**: `items=[singleItem]`
  - **境界値選択の根拠**: 最小の有効アイテム数
  - **実際の使用場面**: ランク制限で1件のみ表示
- **期待される結果**: 1つのShopItemCardが作成される
  - **境界での正確性**: 配置計算が正確
  - **一貫した動作**: 複数件と同じロジック
- **テストの目的**: 最小アイテム数での動作確認
  - **堅牢性の確認**: エッジケースでの安定動作
- 🟡 信頼性レベル: 一般的な境界値テストパターン

#### TC-SG-B02: 大量アイテム（50件）でのパフォーマンス

- **テスト名**: 50件のアイテムでも正常にグリッドが作成される
  - **境界値の意味**: 実運用での想定最大値
  - **境界値での動作保証**: 大量データでも動作
- **入力値**: `items=[...50 items]`
  - **境界値選択の根拠**: ショップの想定最大アイテム数
  - **実際の使用場面**: 全アイテム解放時
- **期待される結果**: 50件のShopItemCardが作成される
  - **境界での正確性**: 全件が正しく配置される
  - **一貫した動作**: スクロール可能な状態
- **テストの目的**: 大量データでの動作確認
  - **堅牢性の確認**: パフォーマンス劣化がないこと
- 🟡 信頼性レベル: NFR-056-011（描画最適化）からの妥当な推測

### 2.4 破棄処理テストケース

#### TC-SG-D01: destroy()で全カード破棄

- **テスト名**: destroy()が呼び出されると全てのShopItemCardが破棄される
  - **何をテストするか**: 子コンポーネントの適切な破棄
  - **期待される動作**: 全てのShopItemCardのdestroy()が呼び出される
- **入力値**: 3件のアイテムを持つShopItemGridインスタンス
  - **入力データの意味**: 破棄対象の複数カード
- **期待される結果**: 3回のカードdestroy()が呼び出される
  - **期待結果の理由**: メモリリーク防止
- **テストの目的**: リソース管理の確認
  - **確認ポイント**: 子コンポーネントの破棄
- 🔵 信頼性レベル: NFR-056-010（メモリリーク防止）に基づく

---

## 3. ShopItemCardコンポーネント テストケース

### 3.1 正常系テストケース

#### TC-SC-001: 初期化テスト

- **テスト名**: シーンとアイテム情報でShopItemCardを初期化するとコンテナが作成される
  - **何をテストするか**: ShopItemCardコンストラクタが正しくインスタンスを生成すること
  - **期待される動作**: BaseComponentを継承したShopItemCardが正常に初期化される
- **入力値**: `mockScene, config={ item: mockShopItem, x: 0, y: 0, onPurchase: vi.fn() }`
  - **入力データの意味**: Phaserシーン、商品情報、配置位置、購入コールバック
- **期待される結果**: ShopItemCardインスタンスが生成される
  - **期待結果の理由**: BaseComponentの継承パターンに従う
- **テストの目的**: コンポーネント初期化の確認
  - **確認ポイント**: constructor、getContainer()の動作
- 🔵 信頼性レベル: 既存コンポーネントテストパターンに基づく

#### TC-SC-002: 商品名表示テスト

- **テスト名**: create()で商品名が正しく表示される
  - **何をテストするか**: 商品名テキストの生成
  - **期待される動作**: item.nameがテキストとして表示される
- **入力値**: `item={ name: '強化ポーション', ... }`
  - **入力データの意味**: 表示する商品情報
- **期待される結果**: 「強化ポーション」がテキストとして表示される
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: 商品名表示機能の確認
  - **確認ポイント**: scene.add.text()の呼び出し
- 🔵 信頼性レベル: REQ-056-004（商品名を表示）に基づく

#### TC-SC-003: タイプ表示テスト（カード）

- **テスト名**: type='card'の商品で「[カード]」と表示される
  - **何をテストするか**: 商品タイプの日本語変換
  - **期待される動作**: タイプが日本語ラベルに変換される
- **入力値**: `item={ type: 'card', ... }`
  - **入力データの意味**: カードタイプの商品
- **期待される結果**: 「[カード]」がテキストとして表示される
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: タイプ表示の確認
  - **確認ポイント**: タイプ変換ロジック
- 🔵 信頼性レベル: REQ-056-004（タイプを表示）、現在のShopScene.tsの実装に基づく

#### TC-SC-004: タイプ表示テスト（素材）

- **テスト名**: type='material'の商品で「[素材]」と表示される
  - **何をテストするか**: 素材タイプの日本語変換
  - **期待される動作**: 'material'が「素材」に変換される
- **入力値**: `item={ type: 'material', ... }`
  - **入力データの意味**: 素材タイプの商品
- **期待される結果**: 「[素材]」がテキストとして表示される
  - **期待結果の理由**: 現在のShopScene.tsの実装に基づく
- **テストの目的**: タイプ変換の網羅確認
  - **確認ポイント**: 全タイプの変換
- 🔵 信頼性レベル: 現在のShopScene.tsの実装に基づく

#### TC-SC-005: タイプ表示テスト（アーティファクト）

- **テスト名**: type='artifact'の商品で「[アーティファクト]」と表示される
  - **何をテストするか**: アーティファクトタイプの日本語変換
  - **期待される動作**: 'artifact'が「アーティファクト」に変換される
- **入力値**: `item={ type: 'artifact', ... }`
  - **入力データの意味**: アーティファクトタイプの商品
- **期待される結果**: 「[アーティファクト]」がテキストとして表示される
  - **期待結果の理由**: 現在のShopScene.tsの実装に基づく
- **テストの目的**: タイプ変換の網羅確認
  - **確認ポイント**: 全タイプの変換
- 🔵 信頼性レベル: 現在のShopScene.tsの実装に基づく

#### TC-SC-006: 価格表示テスト

- **テスト名**: price=100の商品で「100G」と表示される
  - **何をテストするか**: 価格表示のフォーマット
  - **期待される動作**: 数値+単位で表示される
- **入力値**: `item={ price: 100, ... }`
  - **入力データの意味**: 100ゴールドの商品
- **期待される結果**: 「100G」がゴールド色で表示される
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: 価格表示の確認
  - **確認ポイント**: 数値フォーマット、色
- 🔵 信頼性レベル: REQ-056-004（価格を表示）に基づく

#### TC-SC-007: 在庫表示テスト（有限）

- **テスト名**: stock=3の商品で「在庫: 3」と表示される
  - **何をテストするか**: 有限在庫の表示
  - **期待される動作**: 在庫数が表示される
- **入力値**: `item={ stock: 3, ... }`
  - **入力データの意味**: 在庫3の商品
- **期待される結果**: 「在庫: 3」がテキストとして表示される
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: 在庫表示の確認
  - **確認ポイント**: 在庫数のフォーマット
- 🔵 信頼性レベル: REQ-056-004（在庫を表示）に基づく

#### TC-SC-008: 在庫表示テスト（無制限）

- **テスト名**: stock=-1の商品で「∞」と表示される
  - **何をテストするか**: 無制限在庫の表示
  - **期待される動作**: -1が無限記号に変換される
- **入力値**: `item={ stock: -1, ... }`
  - **入力データの意味**: 無制限在庫の商品
- **期待される結果**: 「∞」が表示される
  - **期待結果の理由**: 現在のShopScene.tsの実装（TEXT.STOCK_UNLIMITED）に基づく
- **テストの目的**: 特殊値の表示確認
  - **確認ポイント**: -1の変換ロジック
- 🔵 信頼性レベル: 現在のShopScene.tsの実装に基づく

#### TC-SC-009: 購入ボタン表示テスト

- **テスト名**: 購入可能な商品で「購入」ボタンが有効状態で表示される
  - **何をテストするか**: 購入ボタンの有効状態
  - **期待される動作**: インタラクティブなボタンが表示される
- **入力値**: `item={ stock: 3, price: 100 }, canPurchase=true`
  - **入力データの意味**: 購入可能な商品
- **期待される結果**: ボタンが有効状態（alpha=1）で表示される
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: ボタン状態の確認
  - **確認ポイント**: setInteractive()の呼び出し
- 🔵 信頼性レベル: REQ-056-004（購入可否に応じてボタンの有効/無効）に基づく

#### TC-SC-010: 購入ボタン無効化テスト

- **テスト名**: 所持金不足で購入ボタンが無効化される
  - **何をテストするか**: 購入不可時のボタン状態
  - **期待される動作**: ボタンが無効状態になる
- **入力値**: `item={ price: 1000 }, currentGold=100`（所持金不足）
  - **入力データの意味**: 購入不可能な状態
- **期待される結果**: ボタンがalpha=0.5で非インタラクティブになる
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: ボタン無効化の確認
  - **確認ポイント**: setAlpha(0.5)の呼び出し
- 🔵 信頼性レベル: REQ-056-004に基づく

#### TC-SC-011: 在庫切れ表示テスト

- **テスト名**: stock=0で「売切」ボタンが表示される
  - **何をテストするか**: 在庫切れ時の表示
  - **期待される動作**: ボタンテキストが「売切」に変わる
- **入力値**: `item={ stock: 0 }`
  - **入力データの意味**: 在庫切れの商品
- **期待される結果**: 「売切」テキストのボタンが無効状態で表示される
  - **期待結果の理由**: 要件定義REQ-056-004に明記
- **テストの目的**: 在庫切れ表示の確認
  - **確認ポイント**: ボタンテキスト、無効状態
- 🔵 信頼性レベル: REQ-056-004（在庫切れ時に「売切」表示）に基づく

#### TC-SC-012: 購入ボタンクリックイベント

- **テスト名**: 購入ボタンをクリックするとonPurchaseコールバックが呼び出される
  - **何をテストするか**: 購入イベントの発火
  - **期待される動作**: コールバックがアイテムIDで呼び出される
- **入力値**: `onPurchase=vi.fn()`, 購入可能なアイテム
  - **入力データの意味**: 購入コールバックとアイテム
- **期待される結果**: onPurchase(item.id)が呼び出される
  - **期待結果の理由**: 要件定義REQ-056-030に基づく
- **テストの目的**: イベント発火の確認
  - **確認ポイント**: コールバック引数
- 🔵 信頼性レベル: REQ-056-030（コンポーネント間通信）に基づく

#### TC-SC-013: UIBackgroundBuilder使用テスト

- **テスト名**: create()でUIBackgroundBuilderを使用してカード背景が作成される
  - **何をテストするか**: 共通ユーティリティの使用
  - **期待される動作**: UIBackgroundBuilderが呼び出される
- **入力値**: `mockScene`
  - **入力データの意味**: Phaserシーンのモック
- **期待される結果**: UIBackgroundBuilderのbuild()が呼び出される
  - **期待結果の理由**: 要件定義REQ-056-011に明記
- **テストの目的**: 共通ユーティリティ使用の確認
  - **確認ポイント**: UIBackgroundBuilderのインスタンス化
- 🔵 信頼性レベル: REQ-056-011（UIBackgroundBuilderの使用）に基づく

#### TC-SC-014: applyHoverAnimation使用テスト

- **テスト名**: create()でapplyHoverAnimationがカードに適用される
  - **何をテストするか**: ホバーアニメーションの適用
  - **期待される動作**: applyHoverAnimationが呼び出される
- **入力値**: `mockScene`
  - **入力データの意味**: tweensを持つPhaserシーン
- **期待される結果**: applyHoverAnimationがカードコンテナで呼び出される
  - **期待結果の理由**: 要件定義REQ-056-013に明記
- **テストの目的**: ホバーアニメーション適用の確認
  - **確認ポイント**: applyHoverAnimation呼び出し
- 🔵 信頼性レベル: REQ-056-013（applyHoverAnimationの使用）に基づく

### 3.2 異常系テストケース

#### TC-SC-E01: nullシーンでエラー

- **テスト名**: nullシーンでコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 無効なシーン参照
  - **エラー処理の重要性**: 早期エラー検出
- **入力値**: `scene=null`
  - **不正な理由**: シーンは必須
  - **実際の発生シナリオ**: DIコンテナ未初期化時
- **期待される結果**: Error('BaseComponent: scene is required')がスローされる
  - **エラーメッセージの内容**: 明確なエラーメッセージ
  - **システムの安全性**: 不正なインスタンス生成を防止
- **テストの目的**: 防御的プログラミングの確認
  - **品質保証の観点**: システムの堅牢性確保
- 🔵 信頼性レベル: BaseComponent.tsの実装に基づく

#### TC-SC-E02: nullアイテムでエラー

- **テスト名**: nullアイテムでコンストラクタを呼び出すとエラーがスローされる
  - **エラーケースの概要**: 無効なアイテム参照
  - **エラー処理の重要性**: プロパティアクセス前のバリデーション
- **入力値**: `config.item=null`
  - **不正な理由**: item.name等のアクセスでエラー
  - **実際の発生シナリオ**: API呼び出し失敗時
- **期待される結果**: Error('ShopItemCard: item is required')がスローされる
  - **エラーメッセージの内容**: 開発者向けの明確なメッセージ
  - **システムの安全性**: null参照エラーを防止
- **テストの目的**: 入力バリデーションの確認
  - **品質保証の観点**: 堅牢なエラーハンドリング
- 🟡 信頼性レベル: CardUIのconfig.cardバリデーションパターンに基づく

### 3.3 境界値テストケース

#### TC-SC-B01: 価格0の商品

- **テスト名**: price=0の商品で「0G」と表示される
  - **境界値の意味**: 価格の最小値（無料商品）
  - **境界値での動作保証**: 0でも正常表示
- **入力値**: `item={ price: 0 }`
  - **境界値選択の根拠**: 価格の下限値
  - **実際の使用場面**: 無料配布アイテム
- **期待される結果**: 「0G」が表示される
  - **境界での正確性**: 0が正しく表示
  - **一貫した動作**: 他の価格と同じフォーマット
- **テストの目的**: 最小価格での動作確認
  - **堅牢性の確認**: エッジケースでの安定動作
- 🟡 信頼性レベル: 一般的な境界値テストパターン

#### TC-SC-B02: 長い商品名の表示

- **テスト名**: 50文字の商品名が正しく表示される
  - **境界値の意味**: 商品名の想定最大長
  - **境界値での動作保証**: 長い名前でもレイアウト崩れなし
- **入力値**: `item={ name: 'あ'.repeat(50) }`
  - **境界値選択の根拠**: UIの幅を考慮した最大長
  - **実際の使用場面**: 長い名前のアイテム
- **期待される結果**: テキストが表示される（wordWrap適用）
  - **境界での正確性**: 折り返しまたは省略が正しく動作
  - **一貫した動作**: レイアウトが崩れない
- **テストの目的**: 長い文字列での動作確認
  - **堅牢性の確認**: UI安定性
- 🟡 信頼性レベル: 一般的なUI境界値テスト

#### TC-SC-B03: 在庫1（最小有効値）

- **テスト名**: stock=1の商品で「在庫: 1」と表示され購入可能
  - **境界値の意味**: 有限在庫の最小値
  - **境界値での動作保証**: 最後の1個でも購入可能
- **入力値**: `item={ stock: 1 }`
  - **境界値選択の根拠**: 在庫の最小有効値
  - **実際の使用場面**: 最後の1個
- **期待される結果**: 「在庫: 1」と表示され、ボタンが有効
  - **境界での正確性**: 在庫判定が正確
  - **一貫した動作**: 他の在庫数と同じ動作
- **テストの目的**: 最小在庫での動作確認
  - **堅牢性の確認**: 境界での正確な判定
- 🟡 信頼性レベル: 一般的な境界値テストパターン

### 3.4 破棄処理テストケース

#### TC-SC-D01: destroy()でリソース解放

- **テスト名**: destroy()が呼び出されるとUIオブジェクトが破棄される
  - **何をテストするか**: リソースの適切な解放
  - **期待される動作**: 全てのUIオブジェクトが破棄される
- **入力値**: ShopItemCardインスタンス
  - **入力データの意味**: 破棄対象のコンポーネント
- **期待される結果**: mockContainer.destroy()が呼び出される
  - **期待結果の理由**: メモリリーク防止
- **テストの目的**: リソース管理の確認
  - **確認ポイント**: destroy()メソッドの呼び出し
- 🔵 信頼性レベル: NFR-056-010（メモリリーク防止）に基づく

#### TC-SC-D02: removeHoverAnimationの呼び出し

- **テスト名**: destroy()でremoveHoverAnimationが呼び出される
  - **何をテストするか**: ホバーアニメーションの解除
  - **期待される動作**: イベントリスナーが解除される
- **入力値**: ホバーアニメーション適用済みのShopItemCard
  - **入力データの意味**: 破棄対象のコンポーネント
- **期待される結果**: removeHoverAnimationが呼び出される
  - **期待結果の理由**: イベントリスナーの解除が必要
- **テストの目的**: イベントリスナー解除の確認
  - **確認ポイント**: removeHoverAnimation呼び出し
- 🔵 信頼性レベル: NFR-056-010（イベントリスナーの解除）に基づく

---

## 4. types.ts 型定義テストケース

### 4.1 正常系テストケース

#### TC-TY-001: ShopHeaderConfig型チェック

- **テスト名**: ShopHeaderConfigが必須プロパティを持つ
  - **何をテストするか**: 型定義の正確性
  - **期待される動作**: TypeScriptコンパイルが成功する
- **入力値**: 正しいShopHeaderConfigオブジェクト
  - **入力データの意味**: 型に準拠したオブジェクト
- **期待される結果**: コンパイルエラーなし
  - **期待結果の理由**: 型定義が正しいため
- **テストの目的**: 型定義の検証
  - **確認ポイント**: プロパティの存在確認
- 🟡 信頼性レベル: 新規作成する型のため妥当な推測

#### TC-TY-002: ShopItemCardConfig型チェック

- **テスト名**: ShopItemCardConfigが必須プロパティを持つ
  - **何をテストするか**: 型定義の正確性
  - **期待される動作**: TypeScriptコンパイルが成功する
- **入力値**: 正しいShopItemCardConfigオブジェクト
  - **入力データの意味**: 型に準拠したオブジェクト
- **期待される結果**: コンパイルエラーなし
  - **期待結果の理由**: 型定義が正しいため
- **テストの目的**: 型定義の検証
  - **確認ポイント**: プロパティの存在確認
- 🟡 信頼性レベル: 新規作成する型のため妥当な推測

#### TC-TY-003: コールバック型の型安全性

- **テスト名**: onPurchaseコールバックが正しい型シグネチャを持つ
  - **何をテストするか**: コールバック型の定義
  - **期待される動作**: any型でないコールバック定義
- **入力値**: `(itemId: string) => void`型のコールバック
  - **入力データの意味**: 型安全なコールバック
- **期待される結果**: 型チェックが成功する
  - **期待結果の理由**: 要件定義REQ-056-030に基づく
- **テストの目的**: any型排除の確認
  - **確認ポイント**: コールバック引数の型
- 🔵 信頼性レベル: REQ-056-030（any型の関数シグネチャ不可）に基づく

---

## 5. 統合テストケース

### 5.1 コンポーネント連携テスト

#### TC-INT-001: ShopItemGrid→ShopItemCard連携

- **テスト名**: ShopItemGridがShopItemCardを正しく生成する
  - **何をテストするか**: 親子コンポーネントの連携
  - **期待される動作**: アイテム数分のShopItemCardが生成される
- **入力値**: `items=[item1, item2, item3]`
  - **入力データの意味**: グリッドに表示するアイテム
- **期待される結果**: 3つのShopItemCardインスタンスが生成される
  - **期待結果の理由**: 各アイテムに対応するカードが必要
- **テストの目的**: コンポーネント連携の確認
  - **確認ポイント**: 子コンポーネントの生成数
- 🔵 信頼性レベル: 要件定義7.2（商品一覧表示）に基づく

#### TC-INT-002: ShopItemCard→親コンポーネントへのイベント伝播

- **テスト名**: ShopItemCardの購入クリックがShopItemGridを経由して親に伝播する
  - **何をテストするか**: イベント伝播チェーン
  - **期待される動作**: クリックイベントが親まで伝播する
- **入力値**: ShopItemCard内の購入ボタンクリック
  - **入力データの意味**: ユーザーアクション
- **期待される結果**: 親コンポーネントのonPurchaseが呼び出される
  - **期待結果の理由**: 要件定義REQ-056-030に基づく
- **テストの目的**: イベント伝播の確認
  - **確認ポイント**: コールバックチェーン
- 🔵 信頼性レベル: REQ-056-030に基づく

#### TC-INT-003: 購入後の所持金更新連携

- **テスト名**: 購入成功後にShopHeaderの所持金表示が更新される
  - **何をテストするか**: 状態更新の伝播
  - **期待される動作**: 購入後に所持金が減少表示
- **入力値**: 購入前gold=500、price=100
  - **入力データの意味**: 購入処理のパラメータ
- **期待される結果**: ShopHeader.updateGold(400)が呼び出される
  - **期待結果の理由**: 購入金額分の減少
- **テストの目的**: 状態同期の確認
  - **確認ポイント**: updateGold呼び出し
- 🔵 信頼性レベル: 要件定義7.2（所持金更新）に基づく

#### TC-INT-004: 購入後のアイテムリスト更新

- **テスト名**: 購入成功後にShopItemGridのアイテムリストが更新される
  - **何をテストするか**: グリッド更新処理
  - **期待される動作**: 購入後に購入ボタン状態が更新される
- **入力値**: 購入処理実行
  - **入力データの意味**: 購入アクション
- **期待される結果**: ShopItemGrid.updateItems()または各カードの状態更新が呼び出される
  - **期待結果の理由**: 要件定義7.2（購入フロー）に基づく
- **テストの目的**: 状態同期の確認
  - **確認ポイント**: カード状態の更新
- 🟡 信頼性レベル: 現在のrefreshItemList()からの妥当な推測

#### TC-INT-005: 戻るボタンでのシーン遷移

- **テスト名**: ShopHeaderの戻るボタンクリックでMainSceneに遷移する
  - **何をテストするか**: シーン遷移処理
  - **期待される動作**: scene.start('MainScene')が呼び出される
- **入力値**: 戻るボタンクリック
  - **入力データの意味**: ユーザーアクション
- **期待される結果**: フェードアウト後にMainSceneに遷移
  - **期待結果の理由**: 要件定義7.2（シーン遷移）に基づく
- **テストの目的**: シーン遷移の確認
  - **確認ポイント**: scene.start()呼び出し
- 🔵 信頼性レベル: 要件定義7.2に基づく

---

## 6. 要件定義との対応関係

### 参照した機能概要
- REQ-056-001: ShopSceneメインクラス
- REQ-056-002: ShopHeaderコンポーネント
- REQ-056-003: ShopItemGridコンポーネント
- REQ-056-004: ShopItemCardコンポーネント
- REQ-056-010: Colors定数の使用
- REQ-056-011: UIBackgroundBuilderの使用
- REQ-056-012: AnimationPresetsの使用
- REQ-056-013: HoverAnimationMixinの使用
- REQ-056-020: any型の排除
- REQ-056-030: コンポーネント間通信

### 参照した制約条件
- CON-001: BaseComponentを継承
- CON-002: rexUIプラグインの使用
- NFR-056-001: 行数制限
- NFR-056-002: テストカバレッジ80%以上
- NFR-056-010: メモリリーク防止

### 参照した使用例
- 現在のShopScene.ts実装
- RankUpHeader.test.ts等の既存テストパターン
- UIBackgroundBuilder.test.ts、HoverAnimationMixin.test.tsの共通ユーティリティテスト

---

## 7. 品質判定結果

### テストケース分類

| 分類 | 件数 | カバレッジ |
|------|------|-----------|
| ShopHeader正常系 | 6件 | 100% |
| ShopHeader異常系 | 3件 | 100% |
| ShopHeader境界値 | 3件 | 100% |
| ShopHeader破棄 | 1件 | 100% |
| ShopItemGrid正常系 | 6件 | 100% |
| ShopItemGrid異常系 | 2件 | 100% |
| ShopItemGrid境界値 | 2件 | 100% |
| ShopItemGrid破棄 | 1件 | 100% |
| ShopItemCard正常系 | 14件 | 100% |
| ShopItemCard異常系 | 2件 | 100% |
| ShopItemCard境界値 | 3件 | 100% |
| ShopItemCard破棄 | 2件 | 100% |
| types.ts | 3件 | 100% |
| 統合テスト | 5件 | 100% |
| **合計** | **53件** | - |

### 信頼性レベル分布

| レベル | 件数 | 割合 |
|--------|------|------|
| 🔵 青信号（資料に基づく） | 39件 | 74% |
| 🟡 黄信号（妥当な推測） | 14件 | 26% |
| 🔴 赤信号（推測のみ） | 0件 | 0% |

### 品質判定

✅ **高品質**
- テストケース分類: 正常系・異常系・境界値が網羅されている
- 期待値定義: 各テストケースの期待値が明確
- 技術選択: TypeScript + Vitestが確定
- 実装可能性: 既存のテストパターンを踏襲しており実現可能
- 信頼性レベル: 🔵（青信号）が74%を占め高い

---

*生成日時: 2026-01-23*
*タスクID: TASK-0056*
*TDDフェーズ: テストケース定義（tdd-testcases）*
