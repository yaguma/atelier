# TASK-0020: MainScene共通レイアウト - 要件定義書

**タスクID**: TASK-0020
**タスク名**: MainScene共通レイアウト（ヘッダー・サイドバー・フッター）
**フェーズ**: Phase 3 - UI層
**作成日**: 2026-01-18
**バージョン**: 1.0.0

---

## 1. 概要

本要件定義書は、メイン画面（MainScene）の共通レイアウトコンポーネント（HeaderUI、SidebarUI、FooterUI）の実装要件を定義する。EARS（Easy Approach to Requirements Syntax）記法を使用し、テスト可能な要件を明確化する。

### 1.1 目的

- メイン画面の共通レイアウト（ヘッダー・サイドバー・フッター）を提供する
- ゲーム状態（IGameState）をリアルタイムに表示する
- フェーズ間で共通利用できる再利用性の高いUIコンポーネントを実装する

### 1.2 スコープ

- HeaderUIクラスの実装（ランク表示、昇格ゲージ、残り日数、所持金、行動ポイント）
- SidebarUIクラスの実装（受注依頼リスト、素材リスト、完成品リスト、保管容量、ショップボタン）
- FooterUIクラスの実装（フェーズインジケーター、手札表示、休憩ボタン、次へボタン）
- IGameStateに基づく状態更新機能

### 1.3 信頼性レベル

- 🔵 **青信号**: 設計文書に記載
- 🟡 **黄信号**: 設計文書から妥当な推測
- 🔴 **赤信号**: 設計文書にない推測

---

## 2. 機能要件（EARS記法）

### 2.1 HeaderUI要件

#### REQ-0020-001: HeaderUIコンテナ生成 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUIがインスタンス化された時、システムは画面上部（Y座標: 0）に高さ60pxのヘッダーコンテナを生成しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-001-1 | HeaderUIがインスタンス化された時 | ヘッダーコンテナが生成される |
| AC-001-2 | コンテナの位置 | Y座標0、画面幅全体（1280px）に配置される |
| AC-001-3 | コンテナの高さ | 60pxである |
| AC-001-4 | コンテナのdepth | 200に設定される |

---

#### REQ-0020-002: ランク表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUIが表示されている間、システムはヘッダー左側に現在のギルドランク（G〜S）をランク別カラーで表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-002-1 | HeaderUIが表示された時 | ランク表示が左側に配置される |
| AC-002-2 | ランクGの場合 | グレー（0x808080）で表示される |
| AC-002-3 | ランクFの場合 | ブロンズ（0xCD7F32）で表示される |
| AC-002-4 | ランクEの場合 | シルバー（0xC0C0C0）で表示される |
| AC-002-5 | ランクDの場合 | ゴールド（0xFFD700）で表示される |
| AC-002-6 | ランクCの場合 | ターコイズ（0x00CED1）で表示される |
| AC-002-7 | ランクBの場合 | パープル（0x9400D3）で表示される |
| AC-002-8 | ランクAの場合 | オレンジレッド（0xFF4500）で表示される |
| AC-002-9 | ランクSの場合 | ホワイト（0xFFFFFF）で表示される |
| AC-002-10 | 表示形式 | 「ランク: X」の形式で表示される |

---

#### REQ-0020-003: 昇格ゲージ表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUIが表示されている間、システムは昇格ゲージ（プログレスバー）と現在値/最大値を表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-003-1 | HeaderUIが表示された時 | 昇格ゲージが表示される |
| AC-003-2 | ゲージの進捗 | promotionGaugeの値（0-100）に応じた長さで表示される |
| AC-003-3 | 進捗30%未満 | ゲージ色が赤系（0xFF6B6B）で表示される |
| AC-003-4 | 進捗30-60% | ゲージ色が黄系（0xFFD93D）で表示される |
| AC-003-5 | 進捗60%以上 | ゲージ色が緑系（0x6BCB77）で表示される |
| AC-003-6 | 進捗100% | ゲージ色が（0x4ECDC4）で表示される |
| AC-003-7 | 表示形式 | 「昇格ゲージ XX/100」の形式で表示される |

---

#### REQ-0020-004: 残り日数表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUIが表示されている間、システムは残り日数を表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-004-1 | HeaderUIが表示された時 | 残り日数が表示される |
| AC-004-2 | 表示形式 | 「残り: XX日」の形式で表示される |
| AC-004-3 | 残り11日以上 | 通常色（白：0xFFFFFF）で表示される |
| AC-004-4 | 残り10日以下 | 警告色（黄：0xFFD93D）で表示される |
| AC-004-5 | 残り5日以下 | 緊急色（赤：0xFF6B6B）で表示される |
| AC-004-6 | 残り3日以下 | 危機色（点滅赤：0xFF0000）で表示される |

---

#### REQ-0020-005: 所持金表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUIが表示されている間、システムは所持ゴールドを表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-005-1 | HeaderUIが表示された時 | 所持金が表示される |
| AC-005-2 | 表示形式 | 「XXX G」の形式で表示される |
| AC-005-3 | アイコン | ゴールドアイコン（💰または独自アイコン）が表示される |

---

#### REQ-0020-006: 行動ポイント表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUIが表示されている間、システムは現在の行動ポイント（AP）を表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-006-1 | HeaderUIが表示された時 | 行動ポイントが表示される |
| AC-006-2 | 表示形式 | 「X/Y AP」の形式で表示される（Xは現在値、Yは最大値） |
| AC-006-3 | アイコン | APアイコン（⚡または独自アイコン）が表示される |
| AC-006-4 | AP 0の場合 | 警告色で表示される |

---

#### REQ-0020-007: HeaderUI状態更新 🔵

**EARS形式**: Event-driven（イベント駆動要件）

> update(state: IGameState)メソッドが呼び出された時、システムはHeaderUIの全表示要素を新しい状態で更新しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-007-1 | updateメソッド呼び出し時 | ランク表示が更新される |
| AC-007-2 | updateメソッド呼び出し時 | 昇格ゲージが更新される |
| AC-007-3 | updateメソッド呼び出し時 | 残り日数が更新される |
| AC-007-4 | updateメソッド呼び出し時 | 所持金が更新される |
| AC-007-5 | updateメソッド呼び出し時 | 行動ポイントが更新される |
| AC-007-6 | 値が変わっていない場合 | 不要な再描画は行われない |

---

### 2.2 SidebarUI要件

#### REQ-0020-008: SidebarUIコンテナ生成 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> SidebarUIがインスタンス化された時、システムは画面左側に幅200pxのサイドバーコンテナを生成しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-008-1 | SidebarUIがインスタンス化された時 | サイドバーコンテナが生成される |
| AC-008-2 | コンテナの位置 | X座標0、Y座標60（ヘッダー下）に配置される |
| AC-008-3 | コンテナの幅 | 200pxである |
| AC-008-4 | コンテナの高さ | 画面高さ - ヘッダー高さ - フッター高さ（500px）である |
| AC-008-5 | コンテナのdepth | 150に設定される |

---

#### REQ-0020-009: 受注依頼リスト表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> SidebarUIが表示されている間、システムは「受注依頼」セクションを折りたたみ可能な形式で表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-009-1 | SidebarUIが表示された時 | 「【受注依頼】」ヘッダーが表示される |
| AC-009-2 | セクションヘッダー | 折りたたみアイコン（▼/▶）が表示される |
| AC-009-3 | 依頼がある場合 | 各依頼がカード形式で表示される |
| AC-009-4 | 依頼カード内容 | アイテム名、必要数、期限、報酬が表示される |
| AC-009-5 | 期限間近（2日以下） | 依頼カードが警告色で表示される |
| AC-009-6 | スクロール | 依頼が多い場合はスクロール可能である |

---

#### REQ-0020-010: 受注依頼リスト折りたたみ 🔵

**EARS形式**: Event-driven（イベント駆動要件）

> 「受注依頼」セクションヘッダーがクリックされた時、システムはセクションの展開/折りたたみ状態を切り替えなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-010-1 | 展開状態でヘッダークリック時 | セクションが折りたたまれる |
| AC-010-2 | 折りたたみ状態でヘッダークリック時 | セクションが展開される |
| AC-010-3 | 折りたたみアイコン | 状態に応じてアイコンが変化する（▼⇔▶） |
| AC-010-4 | 折りたたみ時 | リスト内容が非表示になる |

---

#### REQ-0020-011: 素材リスト表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> SidebarUIが表示されている間、システムは「素材」セクションを折りたたみ可能な形式で表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-011-1 | SidebarUIが表示された時 | 「【素材】」ヘッダーが表示される |
| AC-011-2 | セクションヘッダー | 折りたたみアイコン（▼/▶）が表示される |
| AC-011-3 | 素材がある場合 | 各素材がリスト形式で表示される |
| AC-011-4 | 素材表示内容 | 名前、数量、品質が表示される |
| AC-011-5 | 品質表示形式 | 「素材名 xN (品質)」の形式で表示される |
| AC-011-6 | スクロール | 素材が多い場合はスクロール可能である |

---

#### REQ-0020-012: 完成品リスト表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> SidebarUIが表示されている間、システムは「完成品」セクションを折りたたみ可能な形式で表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-012-1 | SidebarUIが表示された時 | 「【完成品】」ヘッダーが表示される |
| AC-012-2 | セクションヘッダー | 折りたたみアイコン（▼/▶）が表示される |
| AC-012-3 | 完成品がある場合 | 各完成品がリスト形式で表示される |
| AC-012-4 | 完成品表示内容 | 名前、数量、品質が表示される |
| AC-012-5 | 表示形式 | 「アイテム名 xN (品質)」の形式で表示される |
| AC-012-6 | スクロール | 完成品が多い場合はスクロール可能である |

---

#### REQ-0020-013: 保管容量表示 🟡

**EARS形式**: Ubiquitous（普遍的要件）

> SidebarUIが表示されている間、システムは現在の保管容量を表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-013-1 | SidebarUIが表示された時 | 保管容量が表示される |
| AC-013-2 | 表示形式 | 「保管: XX/YY」の形式で表示される |
| AC-013-3 | 容量80%以上 | 警告色で表示される |
| AC-013-4 | 容量100% | 危険色で表示される |

---

#### REQ-0020-014: ショップボタン表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> SidebarUIが表示されている間、システムはショップボタンをサイドバー下部に表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-014-1 | SidebarUIが表示された時 | ショップボタンが下部に表示される |
| AC-014-2 | ボタンのラベル | 「ショップ」と表示される |
| AC-014-3 | ボタンのアイコン | ショップアイコン（🛒または独自アイコン）が表示される |

---

#### REQ-0020-015: ショップボタン押下 🔵

**EARS形式**: Event-driven（イベント駆動要件）

> ショップボタンがクリックされた時、システムはSHOP_REQUESTEDイベントを発行しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-015-1 | ショップボタンクリック時 | SHOP_REQUESTEDイベントが発行される |
| AC-015-2 | イベントペイロード | 空オブジェクト({})が送信される |

---

### 2.3 FooterUI要件

#### REQ-0020-016: FooterUIコンテナ生成 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> FooterUIがインスタンス化された時、システムは画面下部に高さ160pxのフッターコンテナを生成しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-016-1 | FooterUIがインスタンス化された時 | フッターコンテナが生成される |
| AC-016-2 | コンテナの位置 | Y座標560（720-160）に配置される |
| AC-016-3 | コンテナの幅 | 画面幅全体（1280px）である |
| AC-016-4 | コンテナの高さ | 160pxである |
| AC-016-5 | コンテナのdepth | 200に設定される |

---

#### REQ-0020-017: フェーズインジケーター表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> FooterUIが表示されている間、システムは4フェーズ（依頼受注、採取、調合、納品）のインジケーターを表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-017-1 | FooterUIが表示された時 | 4つのフェーズノードが横並びで表示される |
| AC-017-2 | フェーズ名表示 | 各ノードに「依頼受注」「採取」「調合」「納品」が表示される |
| AC-017-3 | ノード間接続 | 各ノードが線で接続されている |
| AC-017-4 | 現在フェーズ | ハイライト表示される |
| AC-017-5 | 完了フェーズ | チェックマーク付きで表示される |
| AC-017-6 | 未到達フェーズ | グレーアウトで表示される |

---

#### REQ-0020-018: フェーズインジケーター状態 🔵

**EARS形式**: State-driven（状態駆動要件）

> 各フェーズノードは、pending（未到達）、current（現在）、completed（完了）、skipped（スキップ）のいずれかの状態で表示されなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-018-1 | pending状態 | グレーアウト表示される |
| AC-018-2 | current状態 | ハイライト（プライマリカラー）表示される |
| AC-018-3 | completed状態 | チェックマーク付きで表示される |
| AC-018-4 | skipped状態 | 斜線付きで表示される |

---

#### REQ-0020-019: 手札表示エリア 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> FooterUIが表示されている間、システムは最大5枚のカードを横並びで表示する手札エリアを表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-019-1 | FooterUIが表示された時 | 手札エリアが表示される |
| AC-019-2 | カード表示 | 最大5枚のカードが横並びで表示される |
| AC-019-3 | カード間隔 | 適切な間隔（8px）で配置される |
| AC-019-4 | 既存コンポーネント | HandDisplayコンポーネントを活用する |

---

#### REQ-0020-020: 休憩ボタン表示 🟡

**EARS形式**: Ubiquitous（普遍的要件）

> FooterUIが表示されている間、システムはフッター右側に「休憩」ボタンを表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-020-1 | FooterUIが表示された時 | 休憩ボタンが右側に表示される |
| AC-020-2 | ボタンのラベル | 「休憩」と表示される |
| AC-020-3 | APが最大の場合 | ボタンが無効化される |
| AC-020-4 | APが最大未満の場合 | ボタンが有効になる |

---

#### REQ-0020-021: 休憩ボタン押下 🟡

**EARS形式**: Event-driven（イベント駆動要件）

> 休憩ボタンがクリックされた時、システムはREST_REQUESTEDイベントを発行しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-021-1 | 休憩ボタンクリック時 | REST_REQUESTEDイベントが発行される |
| AC-021-2 | イベントペイロード | 空オブジェクト({})が送信される |

---

#### REQ-0020-022: 次へボタン表示 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> FooterUIが表示されている間、システムはフッター右側に「次へ」ボタンを表示しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-022-1 | FooterUIが表示された時 | 次へボタンが右側に表示される |
| AC-022-2 | QUEST_ACCEPTフェーズ | 「採取へ」と表示される |
| AC-022-3 | GATHERINGフェーズ | 「調合へ」と表示される |
| AC-022-4 | ALCHEMYフェーズ | 「納品へ」と表示される |
| AC-022-5 | DELIVERYフェーズ | 「日終了」と表示される |

---

#### REQ-0020-023: 次へボタン押下 🔵

**EARS形式**: Event-driven（イベント駆動要件）

> 次へボタンがクリックされた時、システムはNEXT_PHASE_REQUESTEDイベントを発行しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-023-1 | 次へボタンクリック時 | NEXT_PHASE_REQUESTEDイベントが発行される |
| AC-023-2 | イベントペイロード | 現在のフェーズ（currentPhase）が含まれる |

---

#### REQ-0020-024: FooterUI状態更新 🔵

**EARS形式**: Event-driven（イベント駆動要件）

> update(state: IGameState)メソッドが呼び出された時、システムはFooterUIの全表示要素を新しい状態で更新しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-024-1 | updateメソッド呼び出し時 | フェーズインジケーターが更新される |
| AC-024-2 | updateメソッド呼び出し時 | 次へボタンのラベルが更新される |
| AC-024-3 | updateメソッド呼び出し時 | 休憩ボタンの有効/無効状態が更新される |

---

### 2.4 共通要件

#### REQ-0020-025: BaseComponent継承 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> HeaderUI、SidebarUI、FooterUIは、BaseComponentを継承して実装しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-025-1 | 各コンポーネント | BaseComponentを継承している |
| AC-025-2 | createメソッド | 実装されている |
| AC-025-3 | destroyメソッド | 実装されている |

---

#### REQ-0020-026: リソース解放 🔵

**EARS形式**: Event-driven（イベント駆動要件）

> destroy()メソッドが呼び出された時、システムは全GameObjectsとイベントリスナーを解放しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-026-1 | destroyメソッド呼び出し時 | 全テキストオブジェクトが破棄される |
| AC-026-2 | destroyメソッド呼び出し時 | 全グラフィックスオブジェクトが破棄される |
| AC-026-3 | destroyメソッド呼び出し時 | 全イベントリスナーが削除される |
| AC-026-4 | destroyメソッド呼び出し時 | コンテナが破棄される |

---

#### REQ-0020-027: テーマ定義の使用 🔵

**EARS形式**: Ubiquitous（普遍的要件）

> 全UIコンポーネントは、THEMEからカラー、フォント、スペーシングを取得して使用しなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-027-1 | 色の使用 | THEME.colorsから取得する |
| AC-027-2 | フォントの使用 | THEME.fontsから取得する |
| AC-027-3 | スペーシングの使用 | THEME.spacingから取得する |

---

### 2.5 アニメーション要件 🟡

#### REQ-0020-028: 昇格ゲージアニメーション

**EARS形式**: Event-driven（イベント駆動要件）

> 昇格ゲージの値が変化した時、システムはゲージをスムーズにアニメーションで更新すべきである（SHOULD）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-028-1 | ゲージ値が増加した時 | ゲージがスムーズに伸びる |
| AC-028-2 | ゲージ値が減少した時 | ゲージがスムーズに縮む |
| AC-028-3 | アニメーション時間 | 約300msで完了する |

---

#### REQ-0020-029: フェーズ遷移アニメーション

**EARS形式**: Event-driven（イベント駆動要件）

> フェーズが変更された時、システムはフェーズインジケーターをアニメーションで更新すべきである（SHOULD）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-029-1 | フェーズ変更時 | 現在のノードがハイライトされる |
| AC-029-2 | 前フェーズ | 完了状態に変化する |
| AC-029-3 | アニメーション | 移動がスムーズに行われる |

---

#### REQ-0020-030: 折りたたみアニメーション

**EARS形式**: Event-driven（イベント駆動要件）

> サイドバーセクションが折りたたみ/展開された時、システムはスムーズなアニメーションで表示すべきである（SHOULD）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-030-1 | 展開時 | コンテンツがスムーズに表示される |
| AC-030-2 | 折りたたみ時 | コンテンツがスムーズに非表示になる |
| AC-030-3 | アニメーション時間 | 約200msで完了する |

---

### 2.6 キーボードナビゲーション要件 🟡

#### REQ-0020-031: 手札カード選択

**EARS形式**: Event-driven（イベント駆動要件）

> 数字キー（1-5）が押された時、システムは対応する手札カードを選択すべきである（SHOULD）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-031-1 | キー1押下時 | 1番目のカードが選択される |
| AC-031-2 | キー5押下時 | 5番目のカードが選択される |
| AC-031-3 | カードがない場合 | 何も起きない |

---

## 3. 非機能要件

### 3.1 パフォーマンス要件

#### REQ-0020-032: 更新頻度制御 🔵

> UIの更新は値変更時のみ行い、毎フレーム更新は避けなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-032-1 | 値が変わった時のみ | UIが更新される |
| AC-032-2 | 同じ値の場合 | 再描画は行われない |

---

#### REQ-0020-033: メモリ管理 🔵

> destroy時に全オブジェクトが適切に解放され、メモリリークが発生しないこと（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-033-1 | destroy後 | 全GameObjectsが破棄される |
| AC-033-2 | destroy後 | 全イベントリスナーが削除される |
| AC-033-3 | destroy後 | 参照が解放される |

---

### 3.2 保守性要件

#### REQ-0020-034: コンポーネント分離 🔵

> HeaderUI、SidebarUI、FooterUIは独立したコンポーネントとして実装し、単体テストが可能でなければならない（SHALL）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-034-1 | 各コンポーネント | 独立してインスタンス化できる |
| AC-034-2 | 各コンポーネント | 単体テストが可能である |
| AC-034-3 | 各コンポーネント | モックを使用してテストできる |

---

### 3.3 テスト容易性要件

#### REQ-0020-035: 依存性注入対応 🟡

> 各コンポーネントは、依存するサービスを外部から注入可能にすべきである（SHOULD）。

**受け入れ基準**:
| ID | 条件 | 期待結果 |
|-----|------|---------|
| AC-035-1 | 依存関係 | コンストラクタで注入できる |
| AC-035-2 | テスト時 | モックに差し替え可能である |

---

## 4. テストケース対応表

| テストID | 要件ID | テスト内容 | 期待結果 |
|---------|--------|----------|---------|
| T-0020-01 | REQ-0020-001〜006 | HeaderUI表示 | 全ステータス要素が正しく表示される |
| T-0020-02 | REQ-0020-002 | ランク別カラー | 各ランクに対応する色で表示される |
| T-0020-03 | REQ-0020-003 | ゲージ閾値カラー | 進捗に応じた色で表示される |
| T-0020-04 | REQ-0020-004 | 日数警告色 | 残り日数に応じた色で表示される |
| T-0020-05 | REQ-0020-007 | HeaderUI状態更新 | updateで全要素が更新される |
| T-0020-06 | REQ-0020-008〜014 | SidebarUI表示 | 全セクションが正しく表示される |
| T-0020-07 | REQ-0020-010 | 折りたたみ動作 | セクションの展開/折りたたみが動作する |
| T-0020-08 | REQ-0020-015 | ショップボタン | イベントが正しく発行される |
| T-0020-09 | REQ-0020-016〜019 | FooterUI表示 | フェーズとカードが正しく表示される |
| T-0020-10 | REQ-0020-017〜018 | フェーズインジケーター | 現在フェーズがハイライトされる |
| T-0020-11 | REQ-0020-022 | 次へボタンラベル | フェーズに応じたラベルが表示される |
| T-0020-12 | REQ-0020-023 | 次へボタン | イベントが正しく発行される |
| T-0020-13 | REQ-0020-026 | リソース解放 | destroy後に全オブジェクトが解放される |

---

## 5. 依存関係

### 5.1 使用するコンポーネント

| コンポーネント | ファイルパス | 用途 |
|--------------|-------------|------|
| BaseComponent | `src/presentation/ui/components/BaseComponent.ts` | コンポーネント基底クラス |
| HandDisplay | `src/presentation/ui/components/HandDisplay.ts` | 手札表示 |
| CardUI | `src/presentation/ui/components/CardUI.ts` | カード表示 |
| THEME | `src/presentation/ui/theme.ts` | スタイル定義 |

### 5.2 使用するインターフェース

| インターフェース | ファイルパス | 用途 |
|----------------|-------------|------|
| IGameState | `src/shared/types/game-state.ts` | ゲーム状態参照 |
| GamePhase | `src/shared/types/common.ts` | フェーズ定義 |
| GuildRank | `src/shared/types/common.ts` | ランク定義 |

### 5.3 依存タスク

| タスクID | タスク名 | 状態 |
|---------|---------|-----|
| TASK-0017 | ゲーム状態管理（GameStateService） | 完了 |
| TASK-0018 | 共通UIコンポーネント基盤 | 完了 |
| TASK-0021 | カードUIコンポーネント | 完了 |

---

## 6. 用語定義

| 用語 | 説明 |
|-----|------|
| HeaderUI | 画面上部に表示されるステータス表示コンポーネント |
| SidebarUI | 画面左側に表示されるリスト表示コンポーネント |
| FooterUI | 画面下部に表示されるフェーズ/手札表示コンポーネント |
| IGameState | ゲーム状態を表すインターフェース |
| GamePhase | ゲームのフェーズ（依頼受注、採取、調合、納品） |
| GuildRank | ギルドランク（G〜S） |
| 昇格ゲージ | ランク昇格までの進捗を表す数値（0-100） |
| 行動ポイント（AP） | 1日に使用できるアクション数 |

---

## 7. レイアウト座標定義

```typescript
// 画面サイズ
const SCREEN_WIDTH = 1280;
const SCREEN_HEIGHT = 720;

// ヘッダー
const HEADER_HEIGHT = 60;
const HEADER_Y = 0;
const HEADER_DEPTH = 200;

// サイドバー
const SIDEBAR_WIDTH = 200;
const SIDEBAR_X = 0;
const SIDEBAR_Y = HEADER_HEIGHT;  // 60
const SIDEBAR_DEPTH = 150;

// フッター
const FOOTER_HEIGHT = 160;
const FOOTER_Y = SCREEN_HEIGHT - FOOTER_HEIGHT;  // 560
const FOOTER_DEPTH = 200;

// メインコンテンツエリア（参考）
const CONTENT_X = SIDEBAR_WIDTH;  // 200
const CONTENT_Y = HEADER_HEIGHT;  // 60
const CONTENT_WIDTH = SCREEN_WIDTH - SIDEBAR_WIDTH;  // 1080
const CONTENT_HEIGHT = SCREEN_HEIGHT - HEADER_HEIGHT - FOOTER_HEIGHT;  // 500
```

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2026-01-18 | 1.0.0 | 初版作成 |
