# TASK-0102: ゲームフローマネージャー テストケース

**タスクID**: TASK-0102
**機能名**: ゲームフローマネージャー（GameFlowManager）
**種別**: TDD
**作成日**: 2026-01-05
**要件名**: atelier-guild-rank
**出力ファイル**: `docs/implements/atelier-guild-rank/TASK-0102/testcases.md`

---

## 信頼性レベル凡例

- 🔵 **青信号**: 元の資料（要件定義、設計文書、タスクノート）を参考にしてほぼ推測していない
- 🟡 **黄信号**: 元の資料から妥当な推測
- 🔴 **赤信号**: 元の資料にない推測

---

## 1. 正常系テストケース（基本的な動作）

### 1.1 ゲーム初期化

#### TC-001: ゲームを初期化できる 🔵

- **テスト名**: ゲームを初期化できる
  - **何をテストするか**: `initializeGame()` メソッドがGameStateとPlayerStateを正しく初期化すること
  - **期待される動作**: GameFlowManagerのinitializeGameメソッドが呼ばれると、ゲーム状態が初期化される
- **入力値**: `initializeGame()` （オプションなし）
  - **入力データの意味**: デフォルト設定での新規ゲーム開始
- **期待される結果**:
  - GameStateが生成される
  - PlayerStateが生成される
  - currentPhaseがQUEST_ACCEPTになる
  - currentDayが1になる
  - **期待結果の理由**: 設計文書（architecture.md）で定義されたゲーム開始時の初期状態
- **テストの目的**: ゲーム初期化機能の基本動作確認
  - **確認ポイント**: 初期状態が設計通りに設定されていること

#### TC-002: 初期状態が正しく設定される 🔵

- **テスト名**: 初期状態が正しく設定される
  - **何をテストするか**: 初期化後のGameState/PlayerStateの各フィールドが正しい値を持つこと
  - **期待される動作**: デフォルト値が設計文書通りに設定される
- **入力値**: `initializeGame()` （オプションなし）
  - **入力データの意味**: デフォルト設定での初期化
- **期待される結果**:
  - `getCurrentPhase()` === `GamePhase.QUEST_ACCEPT`
  - `getCurrentDay()` === 1
  - `isInPromotionTest()` === false
  - PlayerState.rank === GuildRank.G
  - PlayerState.gold === 100
  - PlayerState.actionPoints === 3
  - **期待結果の理由**: 設計文書（data-schema.md）で定義されたデフォルト値
- **テストの目的**: 初期値の正確性確認
  - **確認ポイント**: 全フィールドがデフォルト値と一致すること

#### TC-003: オプションで初期値をカスタマイズできる 🔵

- **テスト名**: オプションで初期値をカスタマイズできる
  - **何をテストするか**: GameInitOptionsを指定して初期値を変更できること
  - **期待される動作**: 指定したオプションが初期状態に反映される
- **入力値**:
  ```typescript
  initializeGame({
    rank: GuildRank.E,
    gold: 500,
    day: 5
  })
  ```
  - **入力データの意味**: カスタム初期値でのゲーム開始（コンティニュー想定）
- **期待される結果**:
  - PlayerState.rank === GuildRank.E
  - PlayerState.gold === 500
  - GameState.currentDay === 5
  - **期待結果の理由**: 要件定義書で指定されたオプションパラメータ
- **テストの目的**: 初期化オプションの動作確認
  - **確認ポイント**: 指定値が正しく反映されること

---

### 1.2 フェーズ遷移

#### TC-004: フェーズを順番に進行できる 🔵

- **テスト名**: フェーズを順番に進行できる
  - **何をテストするか**: `advanceToNextPhase()` で正しい順序でフェーズが遷移すること
  - **期待される動作**: QUEST_ACCEPT → GATHERING → ALCHEMY → DELIVERY の順に遷移
- **入力値**: 初期状態から `advanceToNextPhase()` を4回呼び出し
  - **入力データの意味**: 1日分のフェーズ遷移を実行
- **期待される結果**:
  - 1回目: GATHERING
  - 2回目: ALCHEMY
  - 3回目: DELIVERY
  - 4回目: QUEST_ACCEPT（次の日の開始）
  - **期待結果の理由**: 設計文書（architecture.md）で定義されたフェーズ遷移順序
- **テストの目的**: フェーズ遷移の順序確認
  - **確認ポイント**: 遷移順序が固定であること

#### TC-005: QUEST_ACCEPT から GATHERING に遷移できる 🔵

- **テスト名**: QUEST_ACCEPTからGATHERINGに遷移できる
  - **何をテストするか**: 最初のフェーズ遷移が正しく動作すること
  - **期待される動作**: QUEST_ACCEPTフェーズでadvanceToNextPhaseを呼ぶとGATHERINGに遷移
- **入力値**: currentPhase === QUEST_ACCEPT の状態で `advanceToNextPhase()`
  - **入力データの意味**: 依頼受注後の採取フェーズへの遷移
- **期待される結果**: `getCurrentPhase()` === `GamePhase.GATHERING`
  - **期待結果の理由**: 設計文書で定義された遷移ルール
- **テストの目的**: 個別フェーズ遷移の確認
  - **確認ポイント**: 正しいフェーズに遷移すること

#### TC-006: GATHERING から ALCHEMY に遷移できる 🔵

- **テスト名**: GATHERINGからALCHEMYに遷移できる
  - **何をテストするか**: 採取フェーズから調合フェーズへの遷移
  - **期待される動作**: GATHERINGフェーズでadvanceToNextPhaseを呼ぶとALCHEMYに遷移
- **入力値**: currentPhase === GATHERING の状態で `advanceToNextPhase()`
  - **入力データの意味**: 採取完了後の調合フェーズへの遷移
- **期待される結果**: `getCurrentPhase()` === `GamePhase.ALCHEMY`
  - **期待結果の理由**: 設計文書で定義された遷移ルール
- **テストの目的**: 個別フェーズ遷移の確認
  - **確認ポイント**: 正しいフェーズに遷移すること

#### TC-007: ALCHEMY から DELIVERY に遷移できる 🔵

- **テスト名**: ALCHEMYからDELIVERYに遷移できる
  - **何をテストするか**: 調合フェーズから納品フェーズへの遷移
  - **期待される動作**: ALCHEMYフェーズでadvanceToNextPhaseを呼ぶとDELIVERYに遷移
- **入力値**: currentPhase === ALCHEMY の状態で `advanceToNextPhase()`
  - **入力データの意味**: 調合完了後の納品フェーズへの遷移
- **期待される結果**: `getCurrentPhase()` === `GamePhase.DELIVERY`
  - **期待結果の理由**: 設計文書で定義された遷移ルール
- **テストの目的**: 個別フェーズ遷移の確認
  - **確認ポイント**: 正しいフェーズに遷移すること

#### TC-008: DELIVERY から QUEST_ACCEPT に戻る（日をまたぐ） 🔵

- **テスト名**: DELIVERYからQUEST_ACCEPTに戻る
  - **何をテストするか**: 納品フェーズから次の日の依頼受注フェーズへの遷移
  - **期待される動作**: DELIVERYフェーズでadvanceToNextPhaseを呼ぶとQUEST_ACCEPTに戻る
- **入力値**: currentPhase === DELIVERY の状態で `advanceToNextPhase()`
  - **入力データの意味**: 1日の終了と次の日の開始
- **期待される結果**: `getCurrentPhase()` === `GamePhase.QUEST_ACCEPT`
  - **期待結果の理由**: 設計文書で定義されたサイクル
- **テストの目的**: 日またぎのフェーズ遷移確認
  - **確認ポイント**: サイクルが正しく回ること

---

### 1.3 イベント発行

#### TC-009: フェーズ遷移時にイベントを発行する 🔵

- **テスト名**: フェーズ遷移時にPHASE_CHANGEDイベントを発行する
  - **何をテストするか**: フェーズ遷移時にEventBusにPHASE_CHANGEDイベントが発行されること
  - **期待される動作**: advanceToNextPhaseが呼ばれるとPHASE_CHANGEDイベントが発行される
- **入力値**: イベントハンドラを登録後、`advanceToNextPhase()` を実行
  - **入力データの意味**: フェーズ遷移のイベント監視
- **期待される結果**:
  - PHASE_CHANGEDイベントがpublishされる
  - イベントペイロードに新しいフェーズ情報が含まれる
  - **期待結果の理由**: 設計文書（architecture.md）で定義されたイベント駆動設計
- **テストの目的**: イベント発行の動作確認
  - **確認ポイント**: イベントタイプとペイロードが正しいこと

#### TC-010: 日数進行時にイベントを発行する 🔵

- **テスト名**: 日数進行時にDAY_ADVANCEDイベントを発行する
  - **何をテストするか**: 日終了処理でDAY_ADVANCEDイベントが発行されること
  - **期待される動作**: endDayが呼ばれるとDAY_ADVANCEDイベントが発行される
- **入力値**: イベントハンドラを登録後、`endDay()` を実行
  - **入力データの意味**: 日終了処理のイベント監視
- **期待される結果**:
  - DAY_ADVANCEDイベントがpublishされる
  - ペイロードに現在日数が含まれる
  - **期待結果の理由**: 設計文書で定義されたイベント
- **テストの目的**: 日数進行イベントの確認
  - **確認ポイント**: 正しい日数がペイロードに含まれること

---

### 1.4 日数経過

#### TC-011: 日数経過を管理できる 🔵

- **テスト名**: 日数経過を管理できる
  - **何をテストするか**: `endDay()` で日数が正しく進むこと
  - **期待される動作**: endDayを呼ぶと日数が1増加する
- **入力値**: currentDay === 1 の状態で `endDay()`
  - **入力データの意味**: 1日目の終了
- **期待される結果**: `getCurrentDay()` === 2
  - **期待結果の理由**: 設計文書で定義された日終了処理
- **テストの目的**: 日数管理の基本動作確認
  - **確認ポイント**: 日数が正確に1増加すること

#### TC-012: 日終了時に行動ポイントがリセットされる 🔵

- **テスト名**: 日終了時に行動ポイントがリセットされる
  - **何をテストするか**: `endDay()` で行動ポイントが最大値にリセットされること
  - **期待される動作**: 行動ポイントが消費された状態からmaxにリセット
- **入力値**: actionPoints === 1, actionPointsMax === 3 の状態で `endDay()`
  - **入力データの意味**: 行動ポイントを一部消費した日の終了
- **期待される結果**: PlayerState.actionPoints === 3 (max)
  - **期待結果の理由**: 設計文書（日終了処理）で定義
- **テストの目的**: 行動ポイントリセットの確認
  - **確認ポイント**: actionPointsMaxと同値になること

#### TC-013: 日終了時にランク残り日数が減る 🔵

- **テスト名**: 日終了時にランク残り日数が減る
  - **何をテストするか**: `endDay()` でランク維持残り日数が1減ること
  - **期待される動作**: rankDaysRemainingが1デクリメントされる
- **入力値**: rankDaysRemaining === 30 の状態で `endDay()`
  - **入力データの意味**: ランク維持期間中の日終了
- **期待される結果**: PlayerState.rankDaysRemaining === 29
  - **期待結果の理由**: 設計文書（日終了処理）で定義
- **テストの目的**: ランク残り日数管理の確認
  - **確認ポイント**: 日数が正確に1減ること

---

### 1.5 昇格試験

#### TC-014: 昇格試験の開始可能判定ができる 🔵

- **テスト名**: 昇格ゲージ満タンで昇格試験開始可能と判定できる
  - **何をテストするか**: `canStartPromotionTest()` が正しく判定すること
  - **期待される動作**: 昇格ゲージがmaxに達している場合trueを返す
- **入力値**: promotionGauge === 100, promotionGaugeMax === 100 の状態
  - **入力データの意味**: 昇格ゲージが満タンの状態
- **期待される結果**: `canStartPromotionTest()` === true
  - **期待結果の理由**: 設計文書で定義された昇格条件
- **テストの目的**: 昇格試験開始条件の確認
  - **確認ポイント**: 昇格ゲージ満タン判定が正しいこと

#### TC-015: 昇格試験モードに切り替えできる 🔵

- **テスト名**: 昇格試験モードに切り替えできる
  - **何をテストするか**: `startPromotionTest()` で昇格試験モードに入ること
  - **期待される動作**: 昇格試験フラグがtrueになり、試験日数が設定される
- **入力値**: canStartPromotionTest() === true の状態で `startPromotionTest()`
  - **入力データの意味**: 昇格試験の開始
- **期待される結果**:
  - `isInPromotionTest()` === true
  - promotionTestDaysRemaining が設定される
  - **期待結果の理由**: 設計文書（昇格試験システム）で定義
- **テストの目的**: 昇格試験開始機能の確認
  - **確認ポイント**: 試験モードフラグと日数が設定されること

#### TC-016: 昇格試験開始時にイベントを発行する 🔵

- **テスト名**: 昇格試験開始時にRANK_UP_TEST_STARTEDイベントを発行する
  - **何をテストするか**: startPromotionTest()でイベントが発行されること
  - **期待される動作**: RANK_UP_TEST_STARTEDイベントが発行される
- **入力値**: イベントハンドラを登録後、`startPromotionTest()` を実行
  - **入力データの意味**: 昇格試験開始のイベント監視
- **期待される結果**:
  - RANK_UP_TEST_STARTEDイベントがpublishされる
  - ペイロードにfromRank, toRankが含まれる
  - **期待結果の理由**: 設計文書（イベント定義）で定義
- **テストの目的**: 昇格試験イベントの確認
  - **確認ポイント**: ランク情報がペイロードに含まれること

#### TC-017: 昇格試験中に試験日数が減る 🔵

- **テスト名**: 昇格試験中に日終了で試験日数が減る
  - **何をテストするか**: 昇格試験中の日終了で試験残り日数が減ること
  - **期待される動作**: promotionTestDaysRemainingが1デクリメントされる
- **入力値**: isInPromotionTest === true, promotionTestDaysRemaining === 5 の状態で `endDay()`
  - **入力データの意味**: 昇格試験中の日終了
- **期待される結果**: promotionTestDaysRemaining === 4
  - **期待結果の理由**: 設計文書（日終了処理）で定義
- **テストの目的**: 昇格試験日数管理の確認
  - **確認ポイント**: 試験日数が正確に1減ること

---

### 1.6 ゲーム終了条件

#### TC-018: ゲーム終了条件を監視できる 🔵

- **テスト名**: ゲーム終了条件を監視できる
  - **何をテストするか**: `checkGameEndCondition()` が正しく判定すること
  - **期待される動作**: ゲーム継続中はnullを返す
- **入力値**: 通常プレイ中の状態（終了条件未達成）
  - **入力データの意味**: ゲーム進行中の状態
- **期待される結果**: `checkGameEndCondition()` === null
  - **期待結果の理由**: 設計文書で定義された終了条件チェック
- **テストの目的**: ゲーム終了判定の基本動作確認
  - **確認ポイント**: 終了条件なしの場合nullが返ること

#### TC-019: Sランク到達でゲームクリア 🔵

- **テスト名**: Sランク到達でGAME_CLEARを返す
  - **何をテストするか**: Sランク到達時にゲームクリア条件が検出されること
  - **期待される動作**: checkGameEndConditionが'GAME_CLEAR'を返す
- **入力値**: PlayerState.rank === GuildRank.S の状態
  - **入力データの意味**: 最高ランク到達状態
- **期待される結果**: `checkGameEndCondition()` === 'GAME_CLEAR'
  - **期待結果の理由**: 設計文書で定義されたゲームクリア条件
- **テストの目的**: ゲームクリア判定の確認
  - **確認ポイント**: Sランクでクリア判定されること

#### TC-020: 昇格ゲージ満タンでPROMOTION_READYを返す 🔵

- **テスト名**: 昇格ゲージ満タンでPROMOTION_READYを返す
  - **何をテストするか**: 昇格ゲージ満タン時に昇格準備状態が検出されること
  - **期待される動作**: checkGameEndConditionが'PROMOTION_READY'を返す
- **入力値**: promotionGauge >= promotionGaugeMax の状態
  - **入力データの意味**: 昇格試験開始可能状態
- **期待される結果**: `checkGameEndCondition()` === 'PROMOTION_READY'
  - **期待結果の理由**: 設計文書で定義された昇格条件
- **テストの目的**: 昇格準備状態判定の確認
  - **確認ポイント**: ゲージ満タンで昇格準備と判定されること

---

## 2. 異常系テストケース（エラーハンドリング）

### 2.1 初期化関連

#### TC-021: 初期化前のフェーズ遷移は失敗する 🟡

- **テスト名**: 初期化前のフェーズ遷移はエラーまたは無視される
  - **エラーケースの概要**: ゲーム未初期化状態でのフェーズ遷移試行
  - **エラー処理の重要性**: 不正な操作順序からゲーム状態を保護
- **入力値**: initializeGame() を呼ばずに `advanceToNextPhase()`
  - **不正な理由**: ゲーム状態が存在しない
  - **実際の発生シナリオ**: バグや誤った呼び出し順序
- **期待される結果**:
  - エラーがスローされる、または
  - 何も起こらない（静かに失敗）
  - **エラーメッセージの内容**: "ゲームが初期化されていません" など
  - **システムの安全性**: 状態の整合性が保たれる
- **テストの目的**: 不正な操作順序の防止
  - **品質保証の観点**: 予期しない状態遷移を防ぐ

#### TC-022: 初期化前の日終了処理は失敗する 🟡

- **テスト名**: 初期化前の日終了処理はエラーまたは無視される
  - **エラーケースの概要**: ゲーム未初期化状態での日終了試行
  - **エラー処理の重要性**: 不正な操作からゲームデータを保護
- **入力値**: initializeGame() を呼ばずに `endDay()`
  - **不正な理由**: ゲーム状態が存在しない
  - **実際の発生シナリオ**: バグや誤った呼び出し順序
- **期待される結果**:
  - エラーがスローされる、または
  - 何も起こらない
  - **エラーメッセージの内容**: "ゲームが初期化されていません" など
  - **システムの安全性**: 状態の整合性が保たれる
- **テストの目的**: 不正な操作順序の防止
  - **品質保証の観点**: 予期しない日数進行を防ぐ

### 2.2 フェーズ遷移関連

#### TC-023: 無効なフェーズからの遷移は適切に処理される 🟡

- **テスト名**: 未知のフェーズからの遷移は適切に処理される
  - **エラーケースの概要**: 予期しないフェーズ値が設定された状態での遷移試行
  - **エラー処理の重要性**: 不正な状態からの回復または検出
- **入力値**: 不正なcurrentPhase値（存在しないenum値など）
  - **不正な理由**: 型システムを迂回した不正なデータ
  - **実際の発生シナリオ**: データ破損やセーブデータの改ざん
- **期待される結果**:
  - 明確なエラーがスローされる
  - **エラーメッセージの内容**: "無効なフェーズです" など
  - **システムの安全性**: 不整合状態を検出
- **テストの目的**: 不正データの検出
  - **品質保証の観点**: データ整合性チェック

### 2.3 昇格試験関連

#### TC-024: 昇格ゲージ不足で昇格試験開始不可 🔵

- **テスト名**: 昇格ゲージが足りない場合は昇格試験を開始できない
  - **エラーケースの概要**: 条件未達成での昇格試験開始試行
  - **エラー処理の重要性**: ゲームルールの強制
- **入力値**: promotionGauge < promotionGaugeMax の状態で `startPromotionTest()`
  - **不正な理由**: 昇格条件を満たしていない
  - **実際の発生シナリオ**: UIのバグや不正な操作
- **期待される結果**:
  - 昇格試験が開始されない
  - canStartPromotionTest() === false
  - **エラーメッセージの内容**: "昇格ゲージが満タンではありません" など
  - **システムの安全性**: ゲームルールが維持される
- **テストの目的**: 昇格条件の強制
  - **品質保証の観点**: ゲームルールの整合性

#### TC-025: 既に昇格試験中は再開始できない 🟡

- **テスト名**: 昇格試験中に再度開始はできない
  - **エラーケースの概要**: 二重に昇格試験を開始しようとする
  - **エラー処理の重要性**: 状態の一貫性維持
- **入力値**: isInPromotionTest === true の状態で `startPromotionTest()`
  - **不正な理由**: 既に試験中
  - **実際の発生シナリオ**: UIの連打や不正操作
- **期待される結果**:
  - 新たな試験は開始されない
  - 既存の試験状態が維持される
  - **エラーメッセージの内容**: "既に昇格試験中です" など
  - **システムの安全性**: 試験状態が上書きされない
- **テストの目的**: 状態の一貫性確認
  - **品質保証の観点**: 重複操作の防止

---

## 3. 境界値テストケース

### 3.1 日数関連

#### TC-026: 1日目（最小日数）からの日終了 🔵

- **テスト名**: 1日目から日終了処理ができる
  - **境界値の意味**: ゲーム開始直後の最小日数
  - **境界値での動作保証**: 最小値からの増加が正しく動作すること
- **入力値**: currentDay === 1 の状態で `endDay()`
  - **境界値選択の根拠**: 日数の最小値
  - **実際の使用場面**: 新規ゲーム開始直後の日終了
- **期待される結果**: `getCurrentDay()` === 2
  - **境界での正確性**: 1から2への正確な増加
  - **一貫した動作**: 他の日数からの増加と同じ動作
- **テストの目的**: 最小日数での動作確認
  - **堅牢性の確認**: 最小値での正常動作

#### TC-027: ランク残り日数0での日終了 🔵

- **テスト名**: ランク残り日数0でゲームオーバー判定される
  - **境界値の意味**: ランク維持期限の境界
  - **境界値での動作保証**: 0日でゲームオーバーになること
- **入力値**: rankDaysRemaining === 0 の状態で `checkGameEndCondition()`
  - **境界値選択の根拠**: 残り日数の下限
  - **実際の使用場面**: ランク維持期間終了時
- **期待される結果**: `checkGameEndCondition()` === 'GAME_OVER'
  - **境界での正確性**: 0日で正確にゲームオーバー判定
  - **一貫した動作**: 負数にならずにゲームオーバー
- **テストの目的**: ゲームオーバー境界の確認
  - **堅牢性の確認**: 期限切れ検出の正確性

#### TC-028: ランク残り日数1での日終了後の判定 🔵

- **テスト名**: ランク残り日数1で日終了後ゲームオーバー
  - **境界値の意味**: ゲームオーバー直前の境界
  - **境界値での動作保証**: 1→0でゲームオーバーになること
- **入力値**: rankDaysRemaining === 1 の状態で `endDay()` 後 `checkGameEndCondition()`
  - **境界値選択の根拠**: ゲームオーバー直前
  - **実際の使用場面**: 最後の1日のプレイ
- **期待される結果**:
  - rankDaysRemaining === 0
  - `checkGameEndCondition()` === 'GAME_OVER'
  - **境界での正確性**: 1から0への遷移でゲームオーバー
  - **一貫した動作**: 日終了とゲームオーバー判定が連動
- **テストの目的**: 連続操作での境界動作確認
  - **堅牢性の確認**: 期限直前の動作

### 3.2 昇格ゲージ関連

#### TC-029: 昇格ゲージがちょうど最大値で昇格準備 🔵

- **テスト名**: 昇格ゲージが最大値ちょうどでPROMOTION_READY
  - **境界値の意味**: 昇格条件達成の境界
  - **境界値での動作保証**: 最大値ちょうどで昇格準備と判定
- **入力値**: promotionGauge === promotionGaugeMax (例: 100 === 100)
  - **境界値選択の根拠**: 条件達成の閾値
  - **実際の使用場面**: 昇格ゲージ満タン達成時
- **期待される結果**:
  - `canStartPromotionTest()` === true
  - `checkGameEndCondition()` === 'PROMOTION_READY'
  - **境界での正確性**: ===で正確に判定
  - **一貫した動作**: 超過時と同じ動作
- **テストの目的**: 昇格条件境界の確認
  - **堅牢性の確認**: 条件達成判定の正確性

#### TC-030: 昇格ゲージが最大値-1で昇格不可 🔵

- **テスト名**: 昇格ゲージが最大値-1では昇格不可
  - **境界値の意味**: 昇格条件未達成の境界
  - **境界値での動作保証**: 1足りないと昇格不可
- **入力値**: promotionGauge === promotionGaugeMax - 1 (例: 99/100)
  - **境界値選択の根拠**: 条件達成の閾値直前
  - **実際の使用場面**: あと少しで昇格の状態
- **期待される結果**:
  - `canStartPromotionTest()` === false
  - `checkGameEndCondition()` !== 'PROMOTION_READY'
  - **境界での正確性**: 1足りないと正確に判定
  - **一貫した動作**: 他の未達成値と同じ動作
- **テストの目的**: 昇格条件境界の確認
  - **堅牢性の確認**: 閾値判定の厳密性

### 3.3 昇格試験日数関連

#### TC-031: 昇格試験日数0でゲームオーバー 🔵

- **テスト名**: 昇格試験日数が0でゲームオーバー
  - **境界値の意味**: 昇格試験期限の境界
  - **境界値での動作保証**: 試験日数0でゲームオーバー
- **入力値**: isInPromotionTest === true, promotionTestDaysRemaining === 0
  - **境界値選択の根拠**: 試験日数の下限
  - **実際の使用場面**: 昇格試験失敗時
- **期待される結果**: `checkGameEndCondition()` === 'GAME_OVER'
  - **境界での正確性**: 0日で正確にゲームオーバー
  - **一貫した動作**: ランク残り日数切れと同様のゲームオーバー
- **テストの目的**: 昇格試験失敗境界の確認
  - **堅牢性の確認**: 試験期限切れ検出

#### TC-032: 昇格試験日数1で日終了後ゲームオーバー 🔵

- **テスト名**: 昇格試験日数1で日終了後ゲームオーバー
  - **境界値の意味**: 試験失敗直前の境界
  - **境界値での動作保証**: 1→0でゲームオーバー
- **入力値**: isInPromotionTest === true, promotionTestDaysRemaining === 1 で `endDay()`
  - **境界値選択の根拠**: 試験失敗直前
  - **実際の使用場面**: 昇格試験最終日のプレイ
- **期待される結果**:
  - promotionTestDaysRemaining === 0
  - `checkGameEndCondition()` === 'GAME_OVER'
  - **境界での正確性**: 試験日数減少とゲームオーバー判定の連動
  - **一貫した動作**: 日終了処理の一環として試験日数も減少
- **テストの目的**: 試験期限処理の確認
  - **堅牢性の確認**: 連続操作での境界動作

---

## 4. 追加テストケース（エッジケース）

### 4.1 状態取得

#### TC-033: ゲーム状態を取得できる 🔵

- **テスト名**: getGameState()でGameStateオブジェクトを取得できる
  - **何をテストするか**: 現在のゲーム状態の取得
  - **期待される動作**: 初期化後に正しいGameStateが返される
- **入力値**: `initializeGame()` 後に `getGameState()`
  - **入力データの意味**: 状態取得の基本操作
- **期待される結果**: 有効なGameStateオブジェクトが返される
  - **期待結果の理由**: 設計文書で定義されたインターフェース
- **テストの目的**: 状態取得APIの確認
  - **確認ポイント**: 返されるオブジェクトの型と内容

#### TC-034: プレイヤー状態を取得できる 🔵

- **テスト名**: getPlayerState()でPlayerStateオブジェクトを取得できる
  - **何をテストするか**: 現在のプレイヤー状態の取得
  - **期待される動作**: 初期化後に正しいPlayerStateが返される
- **入力値**: `initializeGame()` 後に `getPlayerState()`
  - **入力データの意味**: 状態取得の基本操作
- **期待される結果**: 有効なPlayerStateオブジェクトが返される
  - **期待結果の理由**: 設計文書で定義されたインターフェース
- **テストの目的**: 状態取得APIの確認
  - **確認ポイント**: 返されるオブジェクトの型と内容

### 4.2 イミュータブル性

#### TC-035: 状態更新はイミュータブルに行われる 🔵

- **テスト名**: 状態更新は新しいオブジェクトを返す
  - **何をテストするか**: 状態更新がイミュータブルに行われること
  - **期待される動作**: 各操作で元のオブジェクトが変更されない
- **入力値**: 各種状態変更操作の実行
  - **入力データの意味**: 複数の状態変更操作
- **期待される結果**:
  - 操作前後で元のオブジェクト参照が保持される
  - 新しいオブジェクトが返される
  - **期待結果の理由**: 設計文書で定義されたイミュータブル設計
- **テストの目的**: イミュータブル設計の確認
  - **確認ポイント**: 状態オブジェクトの参照が変わらないこと

### 4.3 ゲームクリア・ゲームオーバー

#### TC-036: ゲームクリア時にGAME_CLEARイベントを発行する 🔵

- **テスト名**: Sランク到達時にGAME_CLEARイベントが発行される
  - **何をテストするか**: ゲームクリア時のイベント発行
  - **期待される動作**: checkGameEndConditionでGAME_CLEARが検出されるとイベント発行
- **入力値**: rank === GuildRank.S の状態でゲーム終了チェック
  - **入力データの意味**: ゲームクリア条件の達成
- **期待される結果**: GAME_CLEARイベントが発行される
  - **期待結果の理由**: 設計文書で定義されたイベント
- **テストの目的**: ゲームクリアイベントの確認
  - **確認ポイント**: イベントタイプが正しいこと

#### TC-037: ゲームオーバー時にGAME_OVERイベントを発行する 🔵

- **テスト名**: 日数切れ時にGAME_OVERイベントが発行される
  - **何をテストするか**: ゲームオーバー時のイベント発行
  - **期待される動作**: checkGameEndConditionでGAME_OVERが検出されるとイベント発行
- **入力値**: rankDaysRemaining === 0 の状態でゲーム終了チェック
  - **入力データの意味**: ゲームオーバー条件の達成
- **期待される結果**:
  - GAME_OVERイベントが発行される
  - ペイロードにreasonが含まれる（例: "ランク維持日数超過"）
  - **期待結果の理由**: 設計文書で定義されたイベント
- **テストの目的**: ゲームオーバーイベントの確認
  - **確認ポイント**: イベントタイプとreasonが正しいこと

---

## 5. 開発言語・フレームワーク

- **プログラミング言語**: TypeScript
  - **言語選択の理由**: プロジェクトの技術スタック（CLAUDE.md、package.json）で指定
  - **テストに適した機能**: 型安全性、インターフェース定義、discriminated union
- **テストフレームワーク**: Vitest
  - **フレームワーク選択の理由**: プロジェクトの技術スタック（vitest.config.ts）で指定
  - **テスト実行環境**: Node.js（npm run test）

🔵 この内容の信頼性レベル: 設計文書（note.md、CLAUDE.md）を参照

---

## 6. テストケース実装時の日本語コメント指針

### テストケース開始時のコメント

```typescript
// 【テスト目的】: ゲーム初期化機能が正しく動作することを確認
// 【テスト内容】: initializeGame()を呼び出し、初期状態を検証
// 【期待される動作】: GameStateとPlayerStateが正しいデフォルト値で生成される
// 🔵 設計文書（architecture.md, data-schema.md）を参照
```

### Given（準備フェーズ）のコメント

```typescript
// 【テストデータ準備】: EventBusのモックを用意してイベント発行を監視
// 【初期条件設定】: GameFlowManagerをデフォルト設定でインスタンス化
// 【前提条件確認】: ゲームが未初期化の状態
```

### When（実行フェーズ）のコメント

```typescript
// 【実際の処理実行】: initializeGame()メソッドを呼び出し
// 【処理内容】: ゲームの初期化処理を実行
// 【実行タイミング】: テスト対象機能の呼び出し
```

### Then（検証フェーズ）のコメント

```typescript
// 【結果検証】: 初期化後のゲーム状態を検証
// 【期待値確認】: currentPhaseがQUEST_ACCEPT、currentDayが1であること
// 【品質保証】: 設計文書通りの初期状態であることを保証
```

---

## 7. 要件定義との対応関係

| テストケース | 参照した要件/設計文書 |
|------------|---------------------|
| TC-001〜TC-003 | requirements.md (REQ-001), architecture.md (GameFlowManager設計) |
| TC-004〜TC-008 | requirements.md (REQ-001 フェーズ制), core-systems.md (フェーズ遷移図) |
| TC-009〜TC-010 | architecture.md (イベント駆動設計), GameEvents.ts |
| TC-011〜TC-013 | requirements.md (REQ-002 日数制限), architecture.md (日終了フロー) |
| TC-014〜TC-017 | requirements.md (REQ-003 昇格試験), core-systems.md (RankService) |
| TC-018〜TC-020 | requirements.md (制約条件), architecture.md (ゲーム終了条件) |
| TC-021〜TC-025 | 妥当な推測（エラーハンドリング） |
| TC-026〜TC-032 | requirements.md (制約条件), data-schema.md (境界値) |
| TC-033〜TC-037 | requirements.md (インターフェース), architecture.md |

---

## 8. テストケースサマリー

| カテゴリ | テストケース数 | 信頼性 |
|---------|---------------|--------|
| ゲーム初期化 | 3 | 🔵🔵🔵 |
| フェーズ遷移 | 5 | 🔵🔵🔵🔵🔵 |
| イベント発行 | 2 | 🔵🔵 |
| 日数経過 | 3 | 🔵🔵🔵 |
| 昇格試験 | 4 | 🔵🔵🔵🔵 |
| ゲーム終了条件 | 3 | 🔵🔵🔵 |
| 異常系 | 5 | 🟡🟡🟡🔵🟡 |
| 境界値 | 7 | 🔵🔵🔵🔵🔵🔵🔵 |
| エッジケース | 5 | 🔵🔵🔵🔵🔵 |
| **合計** | **37** | 🔵32 / 🟡5 / 🔴0 |

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-05 | 初版作成 |
