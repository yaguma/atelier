# TASK-0018 Phase 2: Button と Dialog コンポーネント - テストケース仕様書

**作成日**: 2026-01-17
**タスクID**: TASK-0018 Phase 2
**要件名**: atelier-guild-rank
**機能名**: Button と Dialog コンポーネント
**バージョン**: 1.0.0

---

## 目次

1. [テスト戦略](#1-テスト戦略)
2. [Buttonコンポーネントのテストケース](#2-buttonコンポーネントのテストケース)
3. [Dialogコンポーネントのテストケース](#3-dialogコンポーネントのテストケース)
4. [統合テスト](#4-統合テスト)
5. [開発言語・フレームワーク](#5-開発言語フレームワーク)
6. [テストケース実装時の日本語コメント指針](#6-テストケース実装時の日本語コメント指針)
7. [要件定義との対応関係](#7-要件定義との対応関係)

---

## 1. テスト戦略

### 1.1 テストレベル

| レベル | 目的 | ツール |
|--------|------|--------|
| **単体テスト** | 個別コンポーネントの動作検証 | Vitest |
| **統合テスト** | コンポーネント間の連携検証 | Vitest + Phaser Test Utils |

### 1.2 テスト対象コンポーネント

1. **Buttonコンポーネント** (`src/presentation/ui/components/Button.ts`)
2. **Dialogコンポーネント** (`src/presentation/ui/components/Dialog.ts`)

### 1.3 信頼性レベル凡例

- 🔵 **青信号**: 元の資料（要件定義、設計文書）を参考にしてほぼ推測していない
- 🟡 **黄信号**: 元の資料から妥当な推測
- 🔴 **赤信号**: 元の資料にない推測

---

## 2. Buttonコンポーネントのテストケース

### 2.1 正常系テストケース（基本的な動作）

#### T-0018-BTN-01: プライマリボタンの生成と表示 🔵

- **テスト名**: プライマリボタンの生成と表示
  - **何をテストするか**: プライマリボタンが正しいスタイルで生成され、Phaserシーンに追加されることを確認
  - **期待される動作**: rexUI.add.labelが呼ばれ、正しい背景色・テキスト色でボタンが生成される
- **入力値**:
  ```typescript
  {
    text: '確定',
    type: ButtonType.PRIMARY,
    onClick: mockCallback
  }
  ```
  - **入力データの意味**: 確定アクション用のプライマリボタンを生成する最小限の設定
- **期待される結果**:
  - rexUI.add.labelが呼ばれる
  - 背景色がTHEME.colors.primary (0x8B4513) である
  - テキストが白色 (0xFFFFFF) である
  - 角丸が4pxである
  - パディングがTHEME.spacing.md (16px) である
  - **期待結果の理由**: UI設計書（overview.md セクション 5.1）に明記されたプライマリボタンのスタイル仕様に基づく
- **テストの目的**: プライマリボタンが設計書通りのスタイルで生成されることを確認
  - **確認ポイント**: rexUIコンポーネントの生成パラメータが正しいこと、テーマ定義が使用されていること
- **信頼性レベル**: 🔵（UI設計書 overview.md セクション 5.1 に明記）

#### T-0018-BTN-02: セカンダリボタンの生成と表示 🔵

- **テスト名**: セカンダリボタンの生成と表示
  - **何をテストするか**: セカンダリボタンが正しいスタイルで生成されることを確認
  - **期待される動作**: 透明な背景とグレーの枠線でボタンが生成される
- **入力値**:
  ```typescript
  {
    text: 'キャンセル',
    type: ButtonType.SECONDARY,
    onClick: mockCallback
  }
  ```
  - **入力データの意味**: キャンセル・戻るアクション用のセカンダリボタンを生成する設定
- **期待される結果**:
  - 背景が透明である
  - 枠線の色がグレー (0x666666) である
  - テキスト色がTHEME.colors.text (0x333333) である
  - **期待結果の理由**: UI設計書に明記されたセカンダリボタンのスタイル仕様に基づく
- **テストの目的**: セカンダリボタンが設計書通りのスタイルで生成されることを確認
  - **確認ポイント**: 透明背景と枠線スタイルが正しく設定されていること
- **信頼性レベル**: 🔵（UI設計書 overview.md セクション 5.1 に明記）

#### T-0018-BTN-03: テキストボタンの生成と表示 🟡

- **テスト名**: テキストボタンの生成と表示
  - **何をテストするか**: テキストボタンが背景なし・枠線なしで生成されることを確認
  - **期待される動作**: テキストのみのシンプルなボタンが生成される
- **入力値**:
  ```typescript
  {
    text: 'スキップ',
    type: ButtonType.TEXT,
    onClick: mockCallback
  }
  ```
  - **入力データの意味**: 軽微なアクション用のテキストボタンを生成する設定
- **期待される結果**:
  - 背景が透明である
  - 枠線がない
  - テキスト色がTHEME.colors.textLight (0x666666) である
  - **期待結果の理由**: 一般的なUIパターンから推測（設計書に詳細スタイルの記載なし）
- **テストの目的**: テキストボタンがシンプルなスタイルで生成されることを確認
  - **確認ポイント**: 背景と枠線が存在しないこと
- **信頼性レベル**: 🟡（TASK-0018.md にテキストボタンの存在は記載あり、詳細スタイルは推測）

#### T-0018-BTN-04: アイコンボタンの生成と表示 🟡

- **テスト名**: アイコンボタンの生成と表示
  - **何をテストするか**: アイコンのみのボタンが生成されることを確認
  - **期待される動作**: アイコン画像を含むボタンが生成される
- **入力値**:
  ```typescript
  {
    text: '',
    icon: 'close-icon',
    type: ButtonType.ICON,
    onClick: mockCallback
  }
  ```
  - **入力データの意味**: アイコンのみのボタンを生成する設定（テキストは空）
- **期待される結果**:
  - アイコン画像が表示される
  - テキストラベルは表示されない（または省略可能）
  - ボタンのサイズがアイコンに合わせて調整される
  - **期待結果の理由**: 一般的なUIパターンから推測
- **テストの目的**: アイコンボタンが正しく生成されることを確認
  - **確認ポイント**: アイコン画像が適切に配置されること
- **信頼性レベル**: 🟡（TASK-0018.md にアイコンボタンの存在は記載あり、詳細スタイルは推測）

#### T-0018-BTN-05: ボタンのクリックイベント実行 🔵

- **テスト名**: ボタンのクリックイベント実行
  - **何をテストするか**: ボタンをクリックしたときにonClickコールバックが実行されることを確認
  - **期待される動作**: ボタンクリック時に登録されたコールバック関数が呼ばれる
- **入力値**:
  ```typescript
  {
    text: 'テスト',
    onClick: mockCallback  // Vitestのvi.fn()でモック化
  }
  ```
  - **入力データの意味**: クリックイベントをテストするためのボタン設定
- **期待される結果**:
  - ボタンをクリックしたときにmockCallbackが1回呼ばれる
  - コールバックが正しい引数なしで呼ばれる
  - **期待結果の理由**: UI設計書とPhase 2要件定義書に記載
- **テストの目的**: クリックイベントが正しく動作することを確認
  - **確認ポイント**: rexUIのpointerdownイベントが正しくバインドされていること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 2.1.2 に明記）

#### T-0018-BTN-06: メソッドチェーンの動作確認 🔵

- **テスト名**: メソッドチェーンの動作確認
  - **何をテストするか**: setVisible、setPosition、setEnabledメソッドがthisを返し、チェーン可能であることを確認
  - **期待される動作**: 連続してメソッド呼び出しができる
- **入力値**:
  ```typescript
  button.setVisible(true).setPosition(100, 200).setEnabled(true);
  ```
  - **入力データの意味**: 複数のメソッドを連続して呼び出すFluent Interfaceパターン
- **期待される結果**:
  - 各メソッドがthisを返す
  - エラーなく実行される
  - 最終的な状態が正しく設定される
  - **期待結果の理由**: BaseComponentから継承したメソッドチェーンパターン
- **テストの目的**: Fluent Interfaceパターンが正しく実装されていることを確認
  - **確認ポイント**: BaseComponentの機能が継承されていること
- **信頼性レベル**: 🔵（Phase 1で実装済みのBaseComponentを継承）

### 2.2 異常系テストケース（エラーハンドリング）

#### T-0018-BTN-07: 空文字列のテキストでボタン生成 🟡

- **テスト名**: 空文字列のテキストでボタン生成
  - **エラーケースの概要**: textプロパティに空文字列が渡された場合の動作
  - **エラー処理の重要性**: ユーザーのミス入力に対して適切に対応し、システムの堅牢性を保つ
- **入力値**:
  ```typescript
  {
    text: '',
    onClick: mockCallback
  }
  ```
  - **不正な理由**: ボタンにはテキストが必要であるため、空文字列は不適切
  - **実際の発生シナリオ**: 動的にボタンを生成する際、テキスト取得に失敗した場合
- **期待される結果**:
  - エラーをスローする: 'Button: text is required'
  - または、デフォルトテキスト（例: 'ボタン'）を表示する
  - **エラーメッセージの内容**: 開発者が問題を特定しやすい明確なメッセージ
  - **システムの安全性**: ボタン生成は失敗するが、アプリケーション全体はクラッシュしない
- **テストの目的**: 空文字列入力時のエラーハンドリングを確認
  - **品質保証の観点**: 不正入力に対する適切な処理でシステムの信頼性を向上
- **信頼性レベル**: 🟡（Phase 2要件定義書 セクション 4.4.1 にエラーケースとして記載）

#### T-0018-BTN-08: onClickコールバックがnullの場合 🟡

- **テスト名**: onClickコールバックがnullの場合
  - **エラーケースの概要**: onClick コールバックが null または undefined の場合の動作
  - **エラー処理の重要性**: 必須パラメータの検証を行い、実行時エラーを防ぐ
- **入力値**:
  ```typescript
  {
    text: 'ボタン',
    onClick: null as any
  }
  ```
  - **不正な理由**: onClickコールバックは必須パラメータ
  - **実際の発生シナリオ**: イベントハンドラのバインドミス、型キャストミス
- **期待される結果**:
  - エラーをスローする: 'Button: onClick callback is required'
  - **エラーメッセージの内容**: コールバックが必須であることを明示
  - **システムの安全性**: ボタン生成時に検証し、実行時の予期しないエラーを防ぐ
- **テストの目的**: 必須パラメータの検証を確認
  - **品質保証の観点**: 早期エラー検出でデバッグ効率を向上
- **信頼性レベル**: 🟡（Phase 2要件定義書 セクション 4.4.1 にエラーケースとして記載）

#### T-0018-BTN-09: 無効化されたボタンのクリック 🔵

- **テスト名**: 無効化されたボタンのクリック
  - **エラーケースの概要**: setEnabled(false)で無効化されたボタンをクリックした場合
  - **エラー処理の重要性**: 条件が満たされていない状態でアクションを実行させない
- **入力値**:
  ```typescript
  button.setEnabled(false);
  // ボタンクリック
  ```
  - **不正な理由**: ボタンが無効状態のため、クリックイベントは発火すべきでない
  - **実際の発生シナリオ**: アイテムが不足している、権限がない、などの条件で無効化
- **期待される結果**:
  - onClickコールバックが呼ばれない
  - ボタンがグレーアウト表示される
  - クリック時の視覚的なフィードバックがない
  - **エラーメッセージの内容**: エラーメッセージは不要（正常な動作）
  - **システムの安全性**: 無効なアクションの実行を防ぐ
- **テストの目的**: 無効化状態でのクリック防止を確認
  - **品質保証の観点**: ユーザー操作の制約により、誤操作を防止
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 4.3.1 にエッジケースとして記載）

#### T-0018-BTN-10: rexUIが未初期化の場合 🟡

- **テスト名**: rexUIが未初期化の場合
  - **エラーケースの概要**: Phaserシーンの rexUI プラグインが未初期化の状態でButtonを生成
  - **エラー処理の重要性**: 依存関係の初期化を確認し、適切なエラーメッセージを表示
- **入力値**:
  ```typescript
  scene.rexUI = undefined;
  new Button(scene, 100, 100, { text: 'ボタン', onClick: () => {} });
  ```
  - **不正な理由**: rexUIプラグインが必須だが、初期化されていない
  - **実際の発生シナリオ**: プラグイン設定のミス、main.tsでの初期化忘れ
- **期待される結果**:
  - エラーをスローする、または警告を出力する
  - エラーメッセージ: 'Button: rexUI plugin is not initialized'
  - **エラーメッセージの内容**: プラグインの初期化が必要であることを明示
  - **システムの安全性**: 早期にエラーを検出し、デバッグを容易にする
- **テストの目的**: 依存関係の検証を確認
  - **品質保証の観点**: セットアップミスを早期に発見
- **信頼性レベル**: 🟡（Phase 2要件定義書 セクション 4.4.2 にエラーケースとして記載）

### 2.3 境界値テストケース（最小値、最大値、null等）

#### T-0018-BTN-11: 最小幅のボタン生成 🟡

- **テスト名**: 最小幅のボタン生成
  - **境界値の意味**: ボタンの最小サイズを設定し、レイアウトが崩れないことを確認
  - **境界値での動作保証**: 極端に小さいサイズでも正しく表示される
- **入力値**:
  ```typescript
  {
    text: 'OK',
    width: 50
  }
  ```
  - **境界値選択の根拠**: 短いテキスト + 最小パディングで実用的な最小幅
  - **実際の使用場面**: アイコンボタンや短いラベルのボタン
- **期待される結果**:
  - ボタンが最小幅で生成される
  - テキストが収まりきらない場合は省略記号が表示される
  - レイアウトが崩れない
  - **境界での正確性**: パディングとテキストが正しく計算される
  - **一貫した動作**: 小さいサイズでも通常のボタンと同じ動作
- **テストの目的**: 最小サイズでの動作を確認
  - **堅牢性の確認**: 極端な設定でもシステムが正常動作
- **信頼性レベル**: 🟡（Phase 2要件定義書 セクション 4.3.3 にエッジケースとして記載）

#### T-0018-BTN-12: 非常に長いテキストのボタン生成 🟡

- **テスト名**: 非常に長いテキストのボタン生成
  - **境界値の意味**: 長いテキストでもレイアウトが崩れないことを確認
  - **境界値での動作保証**: テキストが適切に処理される
- **入力値**:
  ```typescript
  {
    text: 'これは非常に長いボタンテキストでレイアウトテストを行います'.repeat(3),
    width: 200
  }
  ```
  - **境界値選択の根拠**: 一般的なボタン幅を大きく超えるテキスト長
  - **実際の使用場面**: 多言語対応、動的なテキスト生成のミス
- **期待される結果**:
  - テキストが折り返される、または省略記号が表示される
  - ボタンのレイアウトが崩れない
  - 指定した幅を超えない
  - **境界での正確性**: テキストオーバーフロー処理が正しく動作
  - **一貫した動作**: 長いテキストでも視覚的に問題なし
- **テストの目的**: テキストオーバーフロー処理を確認
  - **堅牢性の確認**: 異常な入力でも表示が破綻しない
- **信頼性レベル**: 🟡（Phase 2要件定義書 セクション 4.3.3 にエッジケースとして記載）

#### T-0018-BTN-13: ボタンの無効化と再有効化 🔵

- **テスト名**: ボタンの無効化と再有効化
  - **境界値の意味**: enabled状態の切り替えが正しく動作することを確認
  - **境界値での動作保証**: 状態切り替えが確実に反映される
- **入力値**:
  ```typescript
  button.setEnabled(false);
  button.setEnabled(true);
  button.setEnabled(false);
  ```
  - **境界値選択の根拠**: 有効/無効の境界を複数回切り替え
  - **実際の使用場面**: フォームの入力状態に応じた有効/無効切り替え
- **期待される結果**:
  - setEnabled(false)でボタンが無効化される
  - setEnabled(true)でボタンが再び有効化される
  - 状態切り替えが即座に反映される
  - **境界での正確性**: 状態管理が正しく行われる
  - **一貫した動作**: 何度切り替えても正しく動作
- **テストの目的**: 状態切り替えの動作を確認
  - **堅牢性の確認**: 状態管理の正確性を保証
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 2.1.3 に公開メソッドとして記載）

---

## 3. Dialogコンポーネントのテストケース

### 3.1 正常系テストケース（基本的な動作）

#### T-0018-DLG-01: 確認ダイアログの生成と表示 🔵

- **テスト名**: 確認ダイアログの生成と表示
  - **何をテストするか**: 確認ダイアログが正しいスタイルで生成され、表示されることを確認
  - **期待される動作**: タイトル、メッセージ、「はい」「いいえ」ボタンを含むダイアログが生成される
- **入力値**:
  ```typescript
  {
    title: '確認',
    content: '本当にこの操作を実行しますか？',
    type: DialogType.CONFIRM,
    actions: [
      { label: 'はい', type: ButtonType.PRIMARY, callback: mockYes },
      { label: 'いいえ', type: ButtonType.SECONDARY, callback: mockNo }
    ]
  }
  ```
  - **入力データの意味**: ユーザーに確認を求める標準的なダイアログ設定
- **期待される結果**:
  - rexUI.add.dialogが呼ばれる
  - タイトルが「確認」である
  - メッセージが正しく表示される
  - 「はい」ボタンがプライマリスタイルである
  - 「いいえ」ボタンがセカンダリスタイルである
  - 背景色がTHEME.colors.background (0xF5F5DC) である
  - 角丸が12pxである
  - **期待結果の理由**: UI設計書（overview.md セクション 5.3）に明記
- **テストの目的**: 確認ダイアログが設計書通りに生成されることを確認
  - **確認ポイント**: rexUIコンポーネントの生成パラメータが正しいこと
- **信頼性レベル**: 🔵（UI設計書 overview.md セクション 5.3 に明記）

#### T-0018-DLG-02: 情報ダイアログの生成と表示 🔵

- **テスト名**: 情報ダイアログの生成と表示
  - **何をテストするか**: 情報ダイアログが正しく生成されることを確認
  - **期待される動作**: タイトル、メッセージ、「閉じる」ボタンを含むダイアログが生成される
- **入力値**:
  ```typescript
  {
    title: '情報',
    content: 'アイテムを入手しました！',
    type: DialogType.INFO,
    actions: [
      { label: '閉じる', type: ButtonType.PRIMARY, callback: mockClose }
    ]
  }
  ```
  - **入力データの意味**: ユーザーに情報を通知する標準的なダイアログ設定
- **期待される結果**:
  - タイトルが「情報」である
  - メッセージが正しく表示される
  - 「閉じる」ボタンが1つである
  - **期待結果の理由**: UI設計書に明記
- **テストの目的**: 情報ダイアログが設計書通りに生成されることを確認
  - **確認ポイント**: ボタンが1つだけであること
- **信頼性レベル**: 🔵（UI設計書 overview.md セクション 5.3 に明記）

#### T-0018-DLG-03: 選択ダイアログの生成と表示 🔵

- **テスト名**: 選択ダイアログの生成と表示
  - **何をテストするか**: 選択ダイアログが複数のボタンを含んで生成されることを確認
  - **期待される動作**: タイトル、メッセージ、複数の選択肢ボタンを含むダイアログが生成される
- **入力値**:
  ```typescript
  {
    title: '選択',
    content: '以下から選択してください',
    type: DialogType.CHOICE,
    actions: [
      { label: 'オプション1', type: ButtonType.PRIMARY, callback: mockOpt1 },
      { label: 'オプション2', type: ButtonType.SECONDARY, callback: mockOpt2 },
      { label: 'オプション3', type: ButtonType.SECONDARY, callback: mockOpt3 }
    ]
  }
  ```
  - **入力データの意味**: ユーザーに複数の選択肢を提示するダイアログ設定
- **期待される結果**:
  - 3つのボタンが表示される
  - 各ボタンが正しいラベルを持つ
  - **期待結果の理由**: UI設計書に明記
- **テストの目的**: 選択ダイアログが正しく生成されることを確認
  - **確認ポイント**: 可変数のボタンが正しく配置されること
- **信頼性レベル**: 🔵（UI設計書 overview.md セクション 5.3 に明記）

#### T-0018-DLG-04: ダイアログの表示アニメーション 🔵

- **テスト名**: ダイアログの表示アニメーション
  - **何をテストするか**: show()メソッドでダイアログがアニメーション付きで表示されることを確認
  - **期待される動作**: popUpアニメーション（スケール: 0→1）で表示される
- **入力値**:
  ```typescript
  dialog.show();  // durationはデフォルト（200-300ms）
  ```
  - **入力データの意味**: ダイアログを表示する標準的な呼び出し
- **期待される結果**:
  - rexUIのpopUpメソッドが呼ばれる
  - アニメーション時間が200-300msである
  - オーバーレイ（背景）も同時に表示される
  - depthが400に設定される
  - **期待結果の理由**: UI設計書に明記されたアニメーション仕様
- **テストの目的**: 表示アニメーションが正しく動作することを確認
  - **確認ポイント**: rexUIのアニメーションメソッドが正しく呼ばれること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 2.2.3 に公開メソッドとして記載）

#### T-0018-DLG-05: ダイアログの非表示アニメーション 🔵

- **テスト名**: ダイアログの非表示アニメーション
  - **何をテストするか**: hide()メソッドでダイアログがアニメーション付きで非表示になることを確認
  - **期待される動作**: scaleDownアニメーション（スケール: 1→0）で非表示になる
- **入力値**:
  ```typescript
  dialog.hide();  // durationはデフォルト（200-300ms）
  ```
  - **入力データの意味**: ダイアログを非表示にする標準的な呼び出し
- **期待される結果**:
  - rexUIのscaleDownメソッドが呼ばれる
  - アニメーション時間が200-300msである
  - オーバーレイ（背景）も同時に非表示になる
  - **期待結果の理由**: UI設計書に明記されたアニメーション仕様
- **テストの目的**: 非表示アニメーションが正しく動作することを確認
  - **確認ポイント**: アニメーション完了後にダイアログが非表示になること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 2.2.3 に公開メソッドとして記載）

#### T-0018-DLG-06: ダイアログボタンのクリックとコールバック実行 🔵

- **テスト名**: ダイアログボタンのクリックとコールバック実行
  - **何をテストするか**: ダイアログのボタンをクリックしたときに正しいコールバックが実行されることを確認
  - **期待される動作**: ボタンクリック時に対応するコールバックが呼ばれ、ダイアログが閉じる
- **入力値**:
  ```typescript
  // 確認ダイアログの「はい」ボタンをクリック
  ```
  - **入力データの意味**: ユーザーがダイアログのボタンをクリックする操作
- **期待される結果**:
  - 「はい」ボタンのコールバックが1回呼ばれる
  - ダイアログが非表示になる（hide()が呼ばれる）
  - 「いいえ」ボタンのコールバックは呼ばれない
  - **期待結果の理由**: Phase 2要件定義書に記載
- **テストの目的**: ボタンクリックが正しく動作することを確認
  - **確認ポイント**: 正しいコールバックが実行され、ダイアログが自動で閉じること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 4.1.3 に使用例として記載）

#### T-0018-DLG-07: ダイアログの深度（depth）設定 🔵

- **テスト名**: ダイアログの深度（depth）設定
  - **何をテストするか**: ダイアログとオーバーレイが正しいdepthで表示されることを確認
  - **期待される動作**: オーバーレイがdepth 300、ダイアログがdepth 400で表示される
- **入力値**:
  ```typescript
  dialog.show();
  ```
  - **入力データの意味**: ダイアログを表示し、depthを確認
- **期待される結果**:
  - オーバーレイのdepthが300である
  - ダイアログのdepthが400である
  - 他のUI要素（Header: 200, Content: 100）より前面に表示される
  - **期待結果の理由**: UI設計書のレイヤー構成に明記
- **テストの目的**: 深度設定が正しいことを確認
  - **確認ポイント**: ダイアログが最前面に表示されること
- **信頼性レベル**: 🔵（UI設計書 overview.md セクション 4.2 に明記）

### 3.2 異常系テストケース（エラーハンドリング）

#### T-0018-DLG-08: タイトルが空の場合 🟡

- **テスト名**: タイトルが空の場合
  - **エラーケースの概要**: titleプロパティが空文字列の場合の動作
  - **エラー処理の重要性**: 必須情報の欠落を検出し、適切に処理する
- **入力値**:
  ```typescript
  {
    title: '',
    content: 'メッセージ',
    type: DialogType.INFO
  }
  ```
  - **不正な理由**: ダイアログにはタイトルが必要（または推奨）
  - **実際の発生シナリオ**: データ取得失敗、設定ミス
- **期待される結果**:
  - エラーをスローする、またはデフォルトタイトル（例: '通知'）を表示する
  - **エラーメッセージの内容**: 'Dialog: title is required'
  - **システムの安全性**: ダイアログ生成は失敗するが、アプリケーションはクラッシュしない
- **テストの目的**: タイトル検証を確認
  - **品質保証の観点**: 必須情報の欠落を早期に検出
- **信頼性レベル**: 🟡（Phase 2要件定義書から推測）

#### T-0018-DLG-09: actionsが空配列の場合 🟡

- **テスト名**: actionsが空配列の場合
  - **エラーケースの概要**: actionsプロパティが空配列の場合の動作
  - **エラー処理の重要性**: ユーザーがダイアログを閉じる手段がないことを防ぐ
- **入力値**:
  ```typescript
  {
    title: '通知',
    content: 'メッセージ',
    actions: []
  }
  ```
  - **不正な理由**: 少なくとも1つのボタンが必要（ダイアログを閉じる手段が必要）
  - **実際の発生シナリオ**: 設定ミス、動的生成のバグ
- **期待される結果**:
  - エラーをスローする、またはデフォルトボタン（例: '閉じる'）を追加する
  - **エラーメッセージの内容**: 'Dialog: at least one action is required'
  - **システムの安全性**: ユーザーがダイアログを閉じられない状態を防ぐ
- **テストの目的**: ボタンの存在を確認
  - **品質保証の観点**: UXの問題を防止
- **信頼性レベル**: 🟡（Phase 2要件定義書から推測）

#### T-0018-DLG-10: 既に表示中のダイアログをshow()で呼ぶ 🟡

- **テスト名**: 既に表示中のダイアログをshow()で呼ぶ
  - **エラーケースの概要**: 既に表示されているダイアログに対してshow()を再度呼ぶ
  - **エラー処理の重要性**: 多重表示を防ぎ、一貫した状態を保つ
- **入力値**:
  ```typescript
  dialog.show();
  dialog.show();  // 2回目の呼び出し
  ```
  - **不正な理由**: ダイアログは既に表示中
  - **実際の発生シナリオ**: イベントハンドラの多重登録、非同期処理のタイミング問題
- **期待される結果**:
  - 2回目のshow()呼び出しは無視される
  - エラーは発生しない（警告ログのみ）
  - **エラーメッセージの内容**: 'Dialog: already visible' （警告レベル）
  - **システムの安全性**: 多重表示を防ぎ、画面の整合性を保つ
- **テストの目的**: 多重表示防止を確認
  - **品質保証の観点**: 状態管理の正確性を保証
- **信頼性レベル**: 🟡（Phase 2要件定義書 セクション 4.3.2 にエッジケースとして記載）

### 3.3 境界値テストケース（最小値、最大値、null等）

#### T-0018-DLG-11: 最小幅のダイアログ生成 🟡

- **テスト名**: 最小幅のダイアログ生成
  - **境界値の意味**: ダイアログの最小サイズを設定し、レイアウトが崩れないことを確認
  - **境界値での動作保証**: 小さいサイズでも正しく表示される
- **入力値**:
  ```typescript
  {
    title: 'OK',
    content: 'OK',
    width: 200,  // 最小幅
    actions: [{ label: 'OK', type: ButtonType.PRIMARY, callback: mockOk }]
  }
  ```
  - **境界値選択の根拠**: 短いタイトル・メッセージ + 1つのボタンで必要な最小幅
  - **実際の使用場面**: シンプルな通知ダイアログ
- **期待される結果**:
  - ダイアログが最小幅で生成される
  - レイアウトが崩れない
  - ボタンが正しく配置される
  - **境界での正確性**: 最小幅でも全ての要素が表示される
  - **一貫した動作**: 小さいサイズでも通常のダイアログと同じ動作
- **テストの目的**: 最小サイズでの動作を確認
  - **堅牢性の確認**: 極端な設定でもシステムが正常動作
- **信頼性レベル**: 🟡（Phase 2要件定義書から推測）

#### T-0018-DLG-12: 長いメッセージのダイアログ生成 🟡

- **テスト名**: 長いメッセージのダイアログ生成
  - **境界値の意味**: 長いメッセージでもレイアウトが崩れないことを確認
  - **境界値での動作保証**: テキストが適切にスクロールまたは折り返される
- **入力値**:
  ```typescript
  {
    title: '情報',
    content: 'これは非常に長いメッセージです。'.repeat(20),  // 長いメッセージ
    actions: [{ label: '閉じる', type: ButtonType.PRIMARY, callback: mockClose }]
  }
  ```
  - **境界値選択の根拠**: 一般的なダイアログの高さを超えるメッセージ長
  - **実際の使用場面**: 詳細な説明、利用規約の表示
- **期待される結果**:
  - メッセージがスクロール可能である、または適切に折り返される
  - ダイアログのレイアウトが崩れない
  - ボタンが常に表示される（スクロールしても固定）
  - **境界での正確性**: 長いテキストでも全体のレイアウトが保たれる
  - **一貫した動作**: スクロールバーが表示され、ユーザーが全文を読める
- **テストの目的**: 長いメッセージでのレイアウトを確認
  - **堅牢性の確認**: コンテンツ量に応じた適切な表示
- **信頼性レベル**: 🟡（Phase 2要件定義書から推測）

#### T-0018-DLG-13: 多数のアクションボタン 🟡

- **テスト名**: 多数のアクションボタン
  - **境界値の意味**: 多数のボタンを含むダイアログでもレイアウトが崩れないことを確認
  - **境界値での動作保証**: ボタンが適切に配置される
- **入力値**:
  ```typescript
  {
    title: '選択',
    content: '以下から選択してください',
    actions: Array.from({ length: 10 }, (_, i) => ({
      label: `オプション${i + 1}`,
      type: ButtonType.SECONDARY,
      callback: mockCallbacks[i]
    }))
  }
  ```
  - **境界値選択の根拠**: 通常3-4個のボタンが想定されるが、10個の極端なケース
  - **実際の使用場面**: 複雑な選択肢、カスタマイズ可能な設定
- **期待される結果**:
  - 10個のボタンが全て表示される
  - ボタンが折り返される、またはスクロール可能である
  - レイアウトが崩れない
  - **境界での正確性**: ボタンが適切に配置され、全て操作可能
  - **一貫した動作**: 多数のボタンでも各ボタンが正しく動作
- **テストの目的**: 多数のボタンでのレイアウトを確認
  - **堅牢性の確認**: ボタン数に制限がない場合の動作
- **信頼性レベル**: 🟡（Phase 2要件定義書から推測）

---

## 4. 統合テスト

### T-0018-INT-01: ボタンとテーマの統合検証 🔵

- **テスト名**: ボタンとテーマの統合検証
  - **何をテストするか**: ボタンがテーマ定義を正しく使用していることを確認
  - **期待される動作**: ボタンのスタイルがTHEMEオブジェクトから取得されている
- **入力値**:
  ```typescript
  const button = new Button(scene, 100, 100, {
    text: 'テスト',
    type: ButtonType.PRIMARY
  });
  ```
  - **入力データの意味**: テーマ統合をテストする標準的なボタン
- **期待される結果**:
  - ボタンの背景色がTHEME.colors.primaryである
  - テキストフォントがTHEME.fonts.primaryである
  - パディングがTHEME.spacing.mdである
  - **期待結果の理由**: テーマの一貫性を保つため
- **テストの目的**: テーマとコンポーネントの統合を確認
  - **確認ポイント**: ハードコードされた値ではなく、THEMEオブジェクトを使用していること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 1.1 に明記）

### T-0018-INT-02: ダイアログとテーマの統合検証 🔵

- **テスト名**: ダイアログとテーマの統合検証
  - **何をテストするか**: ダイアログがテーマ定義を正しく使用していることを確認
  - **期待される動作**: ダイアログのスタイルがTHEMEオブジェクトから取得されている
- **入力値**:
  ```typescript
  const dialog = new Dialog(scene, 640, 360, {
    title: 'テスト',
    content: 'メッセージ',
    type: DialogType.INFO
  });
  ```
  - **入力データの意味**: テーマ統合をテストする標準的なダイアログ
- **期待される結果**:
  - ダイアログの背景色がTHEME.colors.backgroundである
  - スペーシングがTHEME.spacingを使用している
  - **期待結果の理由**: テーマの一貫性を保つため
- **テストの目的**: テーマとコンポーネントの統合を確認
  - **確認ポイント**: テーマ定義が正しく参照されていること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 1.1 に明記）

### T-0018-INT-03: BaseComponentの継承検証 🔵

- **テスト名**: BaseComponentの継承検証
  - **何をテストするか**: ButtonとDialogがBaseComponentを正しく継承していることを確認
  - **期待される動作**: setVisible(), setPosition()メソッドが使用可能
- **入力値**:
  ```typescript
  button.setVisible(false).setPosition(200, 300);
  dialog.setVisible(true).setPosition(640, 360);
  ```
  - **入力データの意味**: BaseComponentから継承したメソッドの動作確認
- **期待される結果**:
  - ButtonでsetVisible(), setPosition()が正しく動作する
  - DialogでsetVisible(), setPosition()が正しく動作する
  - メソッドチェーンが可能である
  - **期待結果の理由**: 継承関係が正しく実装されている
- **テストの目的**: 継承の正確性を確認
  - **確認ポイント**: BaseComponentの全ての機能が利用可能であること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 1.4 に明記）

### T-0018-INT-04: ダイアログ内のボタン動作検証 🔵

- **テスト名**: ダイアログ内のボタン動作検証
  - **何をテストするか**: ダイアログ内のButtonコンポーネントが正しく動作することを確認
  - **期待される動作**: ダイアログのactionボタンがButtonコンポーネントとして実装され、正しく動作する
- **入力値**:
  ```typescript
  const dialog = new Dialog(scene, 640, 360, {
    title: '確認',
    content: 'テスト',
    actions: [
      { label: 'はい', type: ButtonType.PRIMARY, callback: mockYes }
    ]
  });
  // ダイアログ内のボタンをクリック
  ```
  - **入力データの意味**: ダイアログとボタンの統合をテスト
- **期待される結果**:
  - ダイアログのactionボタンがButtonコンポーネントのスタイルを持つ
  - ボタンクリックでコールバックが実行される
  - **期待結果の理由**: コンポーネントの再利用性を確認
- **テストの目的**: コンポーネント間の統合を確認
  - **確認ポイント**: Dialogが内部的にButtonを使用していること
- **信頼性レベル**: 🔵（Phase 2要件定義書 セクション 2.2 に明記）

---

## 5. 開発言語・フレームワーク

### 5.1 プログラミング言語

- **言語**: TypeScript
  - **言語選択の理由**: 型安全性による品質向上、Phaser 3との親和性、Phase 1で使用済み
  - **テストに適した機能**: 型チェックによるコンパイル時エラー検出、インターフェースによる明確な契約定義
- **信頼性レベル**: 🔵（Phase 1で確定済み）

### 5.2 テストフレームワーク

- **フレームワーク**: Vitest
  - **フレームワーク選択の理由**: Viteとの統合、高速な実行、Phase 1で使用済み、モック機能が充実
  - **テスト実行環境**: Node.js環境でのユニットテスト、Phaserシーンのモック化
- **信頼性レベル**: 🔵（Phase 1で確定済み）

### 5.3 モック戦略

- **Phaserシーン**: vi.fn()でモック化、必要なプロパティのみ実装
- **rexUIプラグイン**: モックオブジェクトで代替、メソッド呼び出しを検証
- **信頼性レベル**: 🔵（Phase 1のテスト実装パターンを踏襲）

---

## 6. テストケース実装時の日本語コメント指針

### 6.1 テストケース開始時のコメント

```typescript
describe('T-0018-BTN-01: プライマリボタンの生成と表示', () => {
  // 【テスト目的】: プライマリボタンが設計書通りのスタイルで生成されることを確認
  // 【テスト内容】: rexUI.add.labelが呼ばれ、正しい背景色・テキスト色でボタンが生成されることを検証
  // 【期待される動作】: テーマ定義を使用したボタンが正しく生成される
  // 🔵 信頼性レベル: UI設計書 overview.md セクション 5.1 に明記

  test('ボタンが正しいスタイルで生成される', () => {
    // テスト実装
  });
});
```

### 6.2 Given（準備フェーズ）のコメント

```typescript
beforeEach(() => {
  // 【テストデータ準備】: 各テスト実行前にPhaserシーンとrexUIプラグインをモック化し、一貫したテスト条件を保証
  // 【初期条件設定】: ButtonコンポーネントがrexUIプラグインに依存するため、適切なモックを用意
  // 【前提条件確認】: scene.rexUIが存在し、add.labelメソッドが利用可能であることを前提とする

  scene = {
    add: {
      container: vi.fn().mockReturnValue(mockContainer),
    },
    rexUI: {
      add: {
        label: vi.fn().mockReturnValue(mockLabel),
      },
    },
  } as unknown as Phaser.Scene;
});
```

### 6.3 When（実行フェーズ）のコメント

```typescript
test('ボタンをクリックするとコールバックが実行される', () => {
  // 【実際の処理実行】: Buttonコンポーネントを生成し、クリックイベントをシミュレート
  // 【処理内容】: rexUIのpointerdownイベントを発火させ、onClickコールバックの呼び出しを検証
  // 【実行タイミング】: Buttonインスタンス生成後、イベントリスナーが登録されたタイミングで実行

  const button = new Button(scene, 100, 100, {
    text: 'テスト',
    onClick: mockCallback,
  });

  // ボタンクリックをシミュレート
  const labelComponent = scene.rexUI.add.label.mock.results[0].value;
  labelComponent.emit('pointerdown');
});
```

### 6.4 Then（検証フェーズ）のコメント

```typescript
test('ボタンが正しいスタイルで生成される', () => {
  const button = new Button(scene, 100, 100, {
    text: '確定',
    type: ButtonType.PRIMARY,
    onClick: mockCallback,
  });

  // 【結果検証】: rexUI.add.labelが正しいパラメータで呼ばれたことを確認
  // 【期待値確認】: 背景色がTHEME.colors.primaryであり、テーマ定義が使用されていることを検証
  // 【品質保証】: テーマの一貫性を保ち、デザイン規約に準拠したボタンが生成されることを保証

  // 【検証項目】: rexUI.add.labelが呼ばれたこと
  expect(scene.rexUI.add.label).toHaveBeenCalled(); // 🔵

  // 【確認内容】: 背景色がプライマリカラー（0x8B4513）であることを確認
  const callArgs = scene.rexUI.add.label.mock.calls[0][0];
  expect(callArgs.background.fillColor).toBe(THEME.colors.primary); // 🔵
});
```

### 6.5 セットアップ・クリーンアップのコメント

```typescript
beforeEach(() => {
  // 【テスト前準備】: 各テスト実行前にPhaserシーンとコンポーネントを初期化し、一貫したテスト条件を保証
  // 【環境初期化】: 前のテストの影響を受けないよう、新しいシーンとコンポーネントインスタンスを生成

  scene = createMockScene();
  mockCallback = vi.fn();
});

afterEach(() => {
  // 【テスト後処理】: モックのクリアとコンポーネントの破棄を行い、メモリリークを防ぐ
  // 【状態復元】: 次のテストに影響しないよう、全てのモックをリセット

  vi.clearAllMocks();
});
```

---

## 7. 要件定義との対応関係

### 7.1 参照した機能概要

- **Phase 2要件定義書 セクション 1**: 機能の概要
  - ButtonとDialogコンポーネントの目的と役割
  - 解決する問題と効果

### 7.2 参照した入力・出力仕様

- **Phase 2要件定義書 セクション 2.1**: Buttonコンポーネントの仕様
  - ButtonConfig インターフェース
  - 公開メソッド（setText, setEnabled, setOnClick, isEnabled）
- **Phase 2要件定義書 セクション 2.2**: Dialogコンポーネントの仕様
  - DialogConfig インターフェース
  - 公開メソッド（show, hide, setTitle, setContent, isVisible）

### 7.3 参照した制約条件

- **Phase 2要件定義書 セクション 3.1**: パフォーマンス要件
  - ボタンのホバー・クリックレスポンス: 16ms以内（60fps）
  - ダイアログのアニメーション: スムーズな表示・非表示（200-300ms）
- **Phase 2要件定義書 セクション 3.5**: rexUIの制約
  - レイアウト後に `.layout()` を必ず呼ぶ
  - 深度 (depth) の設定: ボタンは親コンテナに従う、ダイアログは400

### 7.4 参照した使用例

- **Phase 2要件定義書 セクション 4.1**: 基本的な使用パターン
  - プライマリボタンの作成
  - 確認ダイアログの表示
- **Phase 2要件定義書 セクション 4.3**: エッジケース
  - 無効化されたボタンのクリック
  - ダイアログの多重表示防止
- **Phase 2要件定義書 セクション 4.4**: エラーケース
  - 不正なパラメータ
  - rexUIが未初期化

### 7.5 参照した設計文書

- **UI設計書 overview.md セクション 5.1**: ボタン（rexUIボタン）
  - ボタンの種類とスタイル
  - rexUIの実装例
- **UI設計書 overview.md セクション 5.3**: ダイアログ（rexUIダイアログ）
  - ダイアログの種類とスタイル
  - rexUIの実装例
- **UI設計書 overview.md セクション 4.2**: UIレイヤー構成
  - depth設定（Overlay: 300, Dialog: 400）

---

## 8. テストカバレッジ目標

| 項目 | 目標 |
|------|------|
| **コードカバレッジ** | 100% |
| **ブランチカバレッジ** | 100% |
| **テスト成功率** | 100% |

---

## 9. 成果物

| 成果物 | パス |
|--------|------|
| Buttonテスト | `atelier-guild-rank/src/presentation/ui/components/Button.spec.ts` |
| Dialogテスト | `atelier-guild-rank/src/presentation/ui/components/Dialog.spec.ts` |

---

## 10. 受け入れ基準

### 10.1 必須条件 🔵

- [ ] すべての単体テストが成功する（Button: 13テスト、Dialog: 13テスト）
- [ ] すべての統合テストが成功する（4テスト）
- [ ] コードカバレッジが100%
- [ ] テスト成功率が100%
- [ ] Phase 2要件定義書の全ての仕様がテストされている

---

**作成日**: 2026-01-17
**作成者**: Claude (Zundamon)
**バージョン**: 1.0.0
