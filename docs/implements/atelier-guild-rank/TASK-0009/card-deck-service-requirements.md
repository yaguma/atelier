# TDDè¦ä»¶å®šç¾©æ›¸: ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»DeckServiceå®Ÿè£…

**æ©Ÿèƒ½å**: ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»DeckService
**ã‚¿ã‚¹ã‚¯ID**: TASK-0009
**è¦ä»¶å**: atelier-guild-rank
**ä½œæˆæ—¥**: 2026-01-16
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0

---

## 1. æ©Ÿèƒ½ã®æ¦‚è¦

### 1.1 æ©Ÿèƒ½ã®ç›®çš„ ğŸ”µ

æœ¬æ©Ÿèƒ½ã¯ã€ã‚¢ãƒˆãƒªã‚¨éŒ¬é‡‘è¡“ã‚²ãƒ¼ãƒ ï¼ˆã‚®ãƒ«ãƒ‰ãƒ©ãƒ³ã‚¯åˆ¶ï¼‰ã«ãŠã‘ã‚‹ **ãƒ‡ãƒƒã‚­æ§‹ç¯‰ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­æ ¸** ã‚’æ‹…ã†ã‚‚ã®ã§ã™ã€‚

- **ä½•ã‚’ã™ã‚‹æ©Ÿèƒ½ã‹**:
  - ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆ`Card`ï¼‰ã«ã‚ˆã‚‹ã‚«ãƒ¼ãƒ‰æƒ…å ±ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–
  - ãƒ‡ãƒƒã‚­ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`DeckService`ï¼‰ã«ã‚ˆã‚‹å±±æœ­ãƒ»æ‰‹æœ­ãƒ»æ¨ã¦æœ­ã®çŠ¶æ…‹ç®¡ç†
  - ã‚«ãƒ¼ãƒ‰ã®ãƒ‰ãƒ­ãƒ¼ã€ãƒ—ãƒ¬ã‚¤ã€ç ´æ£„ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ©Ÿèƒ½ã®æä¾›

- **ã©ã®ã‚ˆã†ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ã‹**:
  - ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã®åŸºæœ¬ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹ã‚’æä¾›ã—ã€ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ã®åœŸå°ã‚’æ§‹ç¯‰
  - ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®è‡ªå‹•ãƒªã‚·ãƒ£ãƒƒãƒ•ãƒ«ã«ã‚ˆã‚Šã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½“é¨“ã‚’ç¶­æŒ
  - Clean Architectureã«åŸºã¥ã„ãŸç–çµåˆãªè¨­è¨ˆã«ã‚ˆã‚Šã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã¨æ‹¡å¼µæ€§ã‚’ç¢ºä¿

- **æƒ³å®šã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼**:
  - **å†…éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ä»–ã®ã‚²ãƒ¼ãƒ ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGatheringServiceã€AlchemyServiceã€QuestServiceãªã©ï¼‰
  - **é–“æ¥çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚²ãƒ¼ãƒ UIçµŒç”±ã§ã‚«ãƒ¼ãƒ‰ã‚’æ“ä½œï¼‰

- **ã‚·ã‚¹ãƒ†ãƒ å†…ã§ã®ä½ç½®ã¥ã‘**:
  - **Domainå±¤**: `Card`ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–ï¼‰
  - **Applicationå±¤**: `DeckService`ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…ï¼‰
  - **ä¾å­˜é–¢ä¿‚**: EventBusï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œï¼‰ã€MasterDataRepositoryï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰

### 1.2 å‚ç…§ã—ãŸEARSè¦ä»¶ ğŸ”µ

- **è¨­è¨ˆæ–‡æ›¸**: `docs/design/atelier-guild-rank/core-systems-core-services.md` - 7. DeckService
- **ã‚¿ã‚¹ã‚¯å®šç¾©**: `docs/tasks/atelier-guild-rank/phase-2/TASK-0009.md`
- **å‹å®šç¾©**: `docs/design/atelier-guild-rank/interfaces.ts` - IDeckService, CardMaster
- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ**: `docs/implements/atelier-guild-rank/TASK-0009/note.md`

---

## 2. å…¥åŠ›ãƒ»å‡ºåŠ›ã®ä»•æ§˜

### 2.1 Cardã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ğŸ”µ

#### å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|-----------|-----|------|------|
| id | `CardId` | å¿…é ˆã€æ–‡å­—åˆ—ã€ãƒ–ãƒ©ãƒ³ãƒ‰å‹ | ã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID |
| master | `CardMaster` | å¿…é ˆã€ãƒ¦ãƒ‹ã‚ªãƒ³å‹ | ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆ`GatheringCardMaster \| RecipeCardMaster \| EnhancementCardMaster`ï¼‰ |

#### å‡ºåŠ›å€¤ï¼ˆGetterï¼‰
| ãƒ¡ã‚½ãƒƒãƒ‰ | æˆ»ã‚Šå€¤å‹ | èª¬æ˜ |
|---------|---------|------|
| `get name()` | `string` | ã‚«ãƒ¼ãƒ‰åï¼ˆmaster.nameã‚’è¿”ã™ï¼‰ |
| `get type()` | `CardType` | ã‚«ãƒ¼ãƒ‰ç¨®åˆ¥ï¼ˆmaster.typeã‚’è¿”ã™ï¼‰ |
| `get cost()` | `number` | ã‚³ã‚¹ãƒˆï¼ˆmaster.costã‚’è¿”ã™ï¼‰ |

#### å‹ã‚¬ãƒ¼ãƒ‰ãƒ¡ã‚½ãƒƒãƒ‰
| ãƒ¡ã‚½ãƒƒãƒ‰ | æˆ»ã‚Šå€¤å‹ | èª¬æ˜ |
|---------|---------|------|
| `isGatheringCard()` | `this is Card & { master: IGatheringCardMaster }` | æ¡å–åœ°ã‚«ãƒ¼ãƒ‰ã‹åˆ¤å®š |
| `isRecipeCard()` | `this is Card & { master: IRecipeCardMaster }` | ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰ã‹åˆ¤å®š |
| `isEnhancementCard()` | `this is Card & { master: IEnhancementCardMaster }` | å¼·åŒ–ã‚«ãƒ¼ãƒ‰ã‹åˆ¤å®š |

### 2.2 DeckServiceã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ğŸ”µ

#### ãƒ‡ãƒƒã‚­æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰
| ãƒ¡ã‚½ãƒƒãƒ‰ | å…¥åŠ› | å‡ºåŠ› | èª¬æ˜ |
|---------|------|------|------|
| `shuffle()` | ãªã— | `void` | å±±æœ­ã‚’Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚·ãƒ£ãƒƒãƒ•ãƒ« |
| `draw(count: number)` | æšæ•°ï¼ˆ1ä»¥ä¸Šï¼‰ | `Card[]` | å±±æœ­ã‹ã‚‰æŒ‡å®šæšæ•°ãƒ‰ãƒ­ãƒ¼ã€‚ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã¯æ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦è£œå…… |
| `playCard(card: Card)` | ãƒ—ãƒ¬ã‚¤ã™ã‚‹ã‚«ãƒ¼ãƒ‰ | `void` | æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã€æ¨ã¦æœ­ã«ç§»å‹• |
| `discardHand()` | ãªã— | `void` | æ‰‹æœ­ã‚’å…¨ã¦æ¨ã¦æœ­ã«ç§»å‹• |
| `refillHand()` | ãªã— | `void` | æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼ |

#### çŠ¶æ…‹å–å¾—ãƒ¡ã‚½ãƒƒãƒ‰
| ãƒ¡ã‚½ãƒƒãƒ‰ | å…¥åŠ› | å‡ºåŠ› | èª¬æ˜ |
|---------|------|------|------|
| `getDeck()` | ãªã— | `readonly Card[]` | å±±æœ­ã®å†…å®¹ã‚’å–å¾—ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ |
| `getHand()` | ãªã— | `readonly Card[]` | æ‰‹æœ­ã®å†…å®¹ã‚’å–å¾—ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ |
| `getDiscard()` | ãªã— | `readonly Card[]` | æ¨ã¦æœ­ã®å†…å®¹ã‚’å–å¾—ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ |
| `getHandSize()` | ãªã— | `number` | æ‰‹æœ­ã®æšæ•°ã‚’å–å¾— |

#### ãƒ‡ãƒƒã‚­æ§‹ç¯‰ãƒ¡ã‚½ãƒƒãƒ‰
| ãƒ¡ã‚½ãƒƒãƒ‰ | å…¥åŠ› | å‡ºåŠ› | èª¬æ˜ |
|---------|------|------|------|
| `addCard(cardId: CardId)` | ã‚«ãƒ¼ãƒ‰ID | `void` | ãƒ‡ãƒƒã‚­ã«ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ï¼ˆãƒ‡ãƒƒã‚­ä¸Šé™30æšãƒã‚§ãƒƒã‚¯ï¼‰ |
| `removeCard(cardId: CardId)` | ã‚«ãƒ¼ãƒ‰ID | `void` | ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ˆå­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼‰ |

#### åˆæœŸåŒ–ãƒ¡ã‚½ãƒƒãƒ‰
| ãƒ¡ã‚½ãƒƒãƒ‰ | å…¥åŠ› | å‡ºåŠ› | èª¬æ˜ |
|---------|------|------|------|
| `initialize(cardIds: CardId[])` | åˆæœŸãƒ‡ãƒƒã‚­ã®ã‚«ãƒ¼ãƒ‰IDé…åˆ— | `void` | åˆæœŸãƒ‡ãƒƒã‚­ã‚’æ§‹ç¯‰ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ« |
| `reset()` | ãªã— | `void` | å±±æœ­ãƒ»æ‰‹æœ­ãƒ»æ¨ã¦æœ­ã‚’ã‚¯ãƒªã‚¢ |

### 2.3 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ ğŸ”µ

```mermaid
sequenceDiagram
    participant Client
    participant DeckService
    participant Deck
    participant Hand
    participant Discard

    Client->>DeckService: initialize(cardIds)
    DeckService->>Deck: ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
    DeckService->>DeckService: shuffle()

    Client->>DeckService: draw(5)
    alt Deck is not empty
        DeckService->>Deck: pop card
        DeckService->>Hand: push card
    else Deck is empty
        DeckService->>Discard: get all cards
        DeckService->>Deck: add cards
        DeckService->>Discard: clear
        DeckService->>DeckService: shuffle()
        DeckService->>Deck: pop card
        DeckService->>Hand: push card
    end

    Client->>DeckService: playCard(card)
    DeckService->>Hand: remove card
    DeckService->>Discard: add card
```

### 2.4 å‚ç…§ã—ãŸEARSè¦ä»¶ãƒ»è¨­è¨ˆæ–‡æ›¸ ğŸ”µ

- **å‹å®šç¾©**: `docs/design/atelier-guild-rank/interfaces.ts`
  - `IDeckService` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆLine 496-515ï¼‰
  - `CardMaster` ãƒ¦ãƒ‹ã‚ªãƒ³å‹ï¼ˆLine 155-159ï¼‰
  - `CardId` ãƒ–ãƒ©ãƒ³ãƒ‰å‹ï¼ˆLine 85ï¼‰
- **è¨­è¨ˆæ–‡æ›¸**: `docs/design/atelier-guild-rank/core-systems-core-services.md`
  - DeckService ã‚¯ãƒ©ã‚¹å›³ï¼ˆLine 22-61ï¼‰
  - ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ï¼ˆLine 65-74ï¼‰
  - å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³ï¼ˆLine 78-100ï¼‰
- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ**: `docs/implements/atelier-guild-rank/TASK-0009/note.md`
  - Cardã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è¨­è¨ˆï¼ˆLine 120-160ï¼‰
  - DeckServiceã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆï¼ˆLine 162-195ï¼‰

---

## 3. åˆ¶ç´„æ¡ä»¶

### 3.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ ğŸ”µ

| é …ç›® | è¦ä»¶ | æ ¹æ‹  |
|------|------|------|
| ã‚·ãƒ£ãƒƒãƒ•ãƒ«å‡¦ç† | O(n) | Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚Šç·šå½¢æ™‚é–“ã§å®Œäº† |
| ãƒ‰ãƒ­ãƒ¼å‡¦ç† | O(1) | é…åˆ—ã®pop/pushã«ã‚ˆã‚‹å®šæ•°æ™‚é–“ |
| ã‚«ãƒ¼ãƒ‰æ¤œç´¢ | O(n) | æ‰‹æœ­å†…ã®ã‚«ãƒ¼ãƒ‰æ¤œç´¢ã¯ç·šå½¢æ™‚é–“ï¼ˆæ‰‹æœ­ã¯5æšä¸Šé™ãªã®ã§å®Ÿè³ªå®šæ•°æ™‚é–“ï¼‰ |

### 3.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ¶ç´„ ğŸ”µ

- **Clean Architectureæº–æ‹ **:
  - Domainå±¤ï¼ˆ`Card`ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„
  - Applicationå±¤ï¼ˆ`DeckService`ï¼‰ã¯Phaserã«ä¾å­˜ã—ãªã„
  - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä»‹ã—ãŸä¾å­˜æ€§é€†è»¢ï¼ˆDIPï¼‰
- **ä¸å¤‰æ€§**:
  - `getDeck()`, `getHand()`, `getDiscard()`ã¯`readonly`é…åˆ—ã‚’è¿”ã™
  - ã‚«ãƒ¼ãƒ‰æƒ…å ±ã®å¤‰æ›´ã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
- **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•**:
  - çŠ¶æ…‹å¤‰åŒ–æ™‚ã«EventBusã‚’ä»‹ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œ
  - ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„UIã¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­ã—ã¦çŠ¶æ…‹ã‚’åŒæœŸ

### 3.3 ãƒ‡ãƒ¼ã‚¿åˆ¶ç´„ ğŸ”µ

| åˆ¶ç´„é …ç›® | å€¤ | èª¬æ˜ |
|---------|-----|------|
| æ‰‹æœ­ä¸Šé™ï¼ˆ`HAND_SIZE`ï¼‰ | 5æš | æ‰‹æœ­ã¯æœ€å¤§5æšã¾ã§ |
| ãƒ‡ãƒƒã‚­ä¸Šé™ï¼ˆ`MAX_DECK_SIZE`ï¼‰ | 30æš | ãƒ‡ãƒƒã‚­ã¯æœ€å¤§30æšã¾ã§ |
| ã‚«ãƒ¼ãƒ‰IDå½¢å¼ | ãƒ–ãƒ©ãƒ³ãƒ‰å‹æ–‡å­—åˆ— | `CardId`å‹ã‚’ä½¿ç”¨ |

### 3.4 æŠ€è¡“åˆ¶ç´„ ğŸ”µ

- **ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: Fisher-Yatesï¼ˆå…¬å¹³æ€§ã®ãŸã‚ï¼‰
- **ä¹±æ•°ç”Ÿæˆ**: `Math.random()`ã‚’ä½¿ç”¨ï¼ˆå°†æ¥çš„ã«ã¯ã‚·ãƒ¼ãƒ‰å€¤æŒ‡å®šå¯èƒ½ãª`IRandomGenerator`ã«ç§»è¡Œï¼‰
- **TypeScript strict mode**: å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯
- **Biomeã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†**: ãƒªãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè‡ªå‹•åŒ–

### 3.5 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°åˆ¶ç´„ ğŸ”µ

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | ç™ºç”Ÿæ¡ä»¶ | èª¬æ˜ |
|------------|---------|------|
| `ErrorCodes.INVALID_CARD_ID` | å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã‚’æŒ‡å®š | ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ãŸ |
| `ErrorCodes.DECK_FULL` | ãƒ‡ãƒƒã‚­ãŒ30æšã‚’è¶…ãˆã‚‹ | ãƒ‡ãƒƒã‚­ä¸Šé™è¶…é |
| `ErrorCodes.CARD_NOT_IN_HAND` | æ‰‹æœ­ã«ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤ | æ‰‹æœ­ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã—ãŸ |
| `ErrorCodes.DATA_NOT_LOADED` | ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿æœªèª­ã¿è¾¼ã¿ | ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§æ“ä½œ |

### 3.6 å‚ç…§ã—ãŸEARSè¦ä»¶ãƒ»è¨­è¨ˆæ–‡æ›¸ ğŸ”µ

- **è¨­è¨ˆæ–‡æ›¸**: `docs/design/atelier-guild-rank/core-systems-core-services.md`
  - DeckServiceã‚¯ãƒ©ã‚¹å®šç¾©ï¼ˆLine 39-58ï¼‰
- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ**: `docs/implements/atelier-guild-rank/TASK-0009/note.md`
  - æŠ€è¡“çš„åˆ¶ç´„ï¼ˆLine 262-269ï¼‰
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆLine 270-276ï¼‰
- **ã‚¨ãƒ©ãƒ¼å‹å®šç¾©**: `atelier-guild-rank/src/shared/types/errors.ts`
  - `ErrorCodes`å®šæ•°

---

## 4. æƒ³å®šã•ã‚Œã‚‹ä½¿ç”¨ä¾‹

### 4.1 åŸºæœ¬çš„ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ ğŸ”µ

#### ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã®åˆæœŸåŒ–
```typescript
// åˆæœŸãƒ‡ãƒƒã‚­æ§‹ç¯‰
const initialDeckIds: CardId[] = [
  toCardId('card-gathering-01'),
  toCardId('card-gathering-02'),
  toCardId('card-recipe-01'),
  // ... 30æš
];

deckService.initialize(initialDeckIds); // åˆæœŸãƒ‡ãƒƒã‚­æ§‹ç¯‰ & ã‚·ãƒ£ãƒƒãƒ•ãƒ«
const hand = deckService.draw(5); // åˆæœŸæ‰‹æœ­5æšãƒ‰ãƒ­ãƒ¼
```

#### ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ•ãƒ­ãƒ¼
```typescript
// æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ
const selectedCard = deckService.getHand()[0];

// ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤ï¼ˆæ‰‹æœ­ â†’ æ¨ã¦æœ­ï¼‰
deckService.playCard(selectedCard);

// ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã«æ‰‹æœ­ã‚’è£œå……
deckService.refillHand(); // 5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼
```

#### ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†
```typescript
// æ‰‹æœ­ã‚’å…¨ã¦ç ´æ£„
deckService.discardHand();

// æ–°ã—ã„æ‰‹æœ­ã‚’ãƒ‰ãƒ­ãƒ¼
const newHand = deckService.draw(5);
```

### 4.2 ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ ğŸ”µ

#### ã‚±ãƒ¼ã‚¹1: ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®ãƒ‰ãƒ­ãƒ¼
```typescript
// ãƒ‡ãƒƒã‚­ãŒæ®‹ã‚Š2æšã€æ¨ã¦æœ­ãŒ10æšã®çŠ¶æ…‹ã§5æšãƒ‰ãƒ­ãƒ¼
const drawnCards = deckService.draw(5);

// æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:
// 1. ãƒ‡ãƒƒã‚­ã‹ã‚‰2æšãƒ‰ãƒ­ãƒ¼
// 2. æ¨ã¦æœ­10æšã‚’å±±æœ­ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«
// 3. ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ãŸå±±æœ­ã‹ã‚‰æ®‹ã‚Š3æšãƒ‰ãƒ­ãƒ¼
// çµæœ: drawnCards.length === 5
```

#### ã‚±ãƒ¼ã‚¹2: æ‰‹æœ­è£œå……æ™‚ã®ãƒ‡ãƒƒã‚­æ¯æ¸‡
```typescript
// æ‰‹æœ­3æšã€ãƒ‡ãƒƒã‚­1æšã€æ¨ã¦æœ­5æš
deckService.refillHand();

// æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:
// 1. ãƒ‡ãƒƒã‚­ã‹ã‚‰1æšãƒ‰ãƒ­ãƒ¼ï¼ˆæ‰‹æœ­4æšï¼‰
// 2. æ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å±±æœ­ã«
// 3. å±±æœ­ã‹ã‚‰1æšãƒ‰ãƒ­ãƒ¼ï¼ˆæ‰‹æœ­5æšï¼‰
```

#### ã‚±ãƒ¼ã‚¹3: å®Œå…¨ã«ã‚«ãƒ¼ãƒ‰ãŒå°½ããŸå ´åˆ
```typescript
// ãƒ‡ãƒƒã‚­0æšã€æ‰‹æœ­0æšã€æ¨ã¦æœ­0æš
const drawnCards = deckService.draw(5);

// æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:
// drawnCards.length === 0ï¼ˆãƒ‰ãƒ­ãƒ¼ã§ããªã„ï¼‰
```

### 4.3 ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ ğŸ”´

#### ã‚±ãƒ¼ã‚¹1: å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã®è¿½åŠ 
```typescript
try {
  deckService.addCard(toCardId('non-existent-card'));
} catch (error) {
  // ApplicationError with ErrorCodes.INVALID_CARD_ID
  console.error(error.code); // 'INVALID_CARD_ID'
}
```

#### ã‚±ãƒ¼ã‚¹2: ãƒ‡ãƒƒã‚­ä¸Šé™è¶…é
```typescript
try {
  // æ—¢ã«30æšã®ãƒ‡ãƒƒã‚­ã«è¿½åŠ 
  deckService.addCard(toCardId('card-gathering-99'));
} catch (error) {
  // ApplicationError with ErrorCodes.DECK_FULL
  console.error(error.code); // 'DECK_FULL'
}
```

#### ã‚±ãƒ¼ã‚¹3: æ‰‹æœ­ã«ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤
```typescript
try {
  const cardNotInHand = new Card(toCardId('card-recipe-01'), recipeCardMaster);
  deckService.playCard(cardNotInHand);
} catch (error) {
  // ApplicationError with ErrorCodes.CARD_NOT_IN_HAND
  console.error(error.code); // 'CARD_NOT_IN_HAND'
}
```

### 4.4 å‚ç…§ã—ãŸEARSè¦ä»¶ãƒ»è¨­è¨ˆæ–‡æ›¸ ğŸ”µ

- **è¨­è¨ˆæ–‡æ›¸**: `docs/design/atelier-guild-rank/core-systems-core-services.md`
  - å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³ï¼ˆLine 78-100ï¼‰
- **ã‚¿ã‚¹ã‚¯å®šç¾©**: `docs/tasks/atelier-guild-rank/phase-2/TASK-0009.md`
  - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆLine 148-157ï¼‰
- **ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ**: `docs/implements/atelier-guild-rank/TASK-0009/note.md`
  - ãƒ‰ãƒ­ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆLine 220-243ï¼‰
  - ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆLine 494-513ï¼‰

---

## 5. EARSè¦ä»¶ãƒ»è¨­è¨ˆæ–‡æ›¸ã¨ã®å¯¾å¿œé–¢ä¿‚

### 5.1 å‚ç…§ã—ãŸè¨­è¨ˆæ–‡æ›¸

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/design/atelier-guild-rank/architecture-overview.md`
- **è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³**: Clean Architecture 4å±¤æ§‹é€ 
- **å¯¾å¿œé–¢ä¿‚**: Domainå±¤ï¼ˆCardï¼‰ã€Applicationå±¤ï¼ˆDeckServiceï¼‰ã®é…ç½®

#### ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹è¨­è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/design/atelier-guild-rank/core-systems-core-services.md`
- **è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
  - 7. DeckServiceï¼ˆLine 14-102ï¼‰
  - ã‚¯ãƒ©ã‚¹å›³ï¼ˆLine 22-61ï¼‰
  - ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆLine 65-74ï¼‰
  - å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆLine 78-100ï¼‰

#### å‹å®šç¾©
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/design/atelier-guild-rank/interfaces.ts`
- **è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
  - CardIdå‹ï¼ˆLine 85ï¼‰
  - CardMasterå‹ï¼ˆLine 155-159ï¼‰
  - IDeckServiceå‹ï¼ˆLine 496-515ï¼‰

### 5.2 å‚ç…§ã—ãŸã‚¿ã‚¹ã‚¯å®šç¾©

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/tasks/atelier-guild-rank/phase-2/TASK-0009.md`
- **è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
  - ã‚¿ã‚¹ã‚¯æ¦‚è¦ï¼ˆLine 11-20ï¼‰
  - å®Ÿè£…å†…å®¹ï¼ˆLine 29-128ï¼‰
  - å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆLine 131-144ï¼‰
  - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆLine 147-157ï¼‰
  - æˆæœç‰©ï¼ˆLine 161-168ï¼‰

### 5.3 å‚ç…§ã—ãŸã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆ

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/implements/atelier-guild-rank/TASK-0009/note.md`
- **è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
  - æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆLine 9-34ï¼‰
  - é–‹ç™ºãƒ«ãƒ¼ãƒ«ï¼ˆLine 37-63ï¼‰
  - é–¢é€£å®Ÿè£…ï¼ˆLine 66-114ï¼‰
  - è¨­è¨ˆæ–‡æ›¸ï¼ˆLine 117-257ï¼‰
  - æ³¨æ„äº‹é …ï¼ˆLine 260-295ï¼‰

### 5.4 ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã®è©•ä¾¡

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ä¿¡é ¼æ€§ | æ ¹æ‹  |
|----------|--------|------|
| 1. æ©Ÿèƒ½ã®æ¦‚è¦ | ğŸ”µ | ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜ç¢ºã«è¨˜è¼‰ |
| 2. å…¥åŠ›ãƒ»å‡ºåŠ›ã®ä»•æ§˜ | ğŸ”µ | interfaces.tsã€è¨­è¨ˆæ–‡æ›¸ã«å‹å®šç¾©ã‚ã‚Š |
| 3. åˆ¶ç´„æ¡ä»¶ | ğŸ”µ | ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆãƒ»è¨­è¨ˆæ–‡æ›¸ã«æ˜è¨˜ |
| 4. æƒ³å®šã•ã‚Œã‚‹ä½¿ç”¨ä¾‹ | ğŸ”µ | ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãƒˆã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¨ã—ã¦è¨˜è¼‰ |

---

## 6. å—ã‘å…¥ã‚ŒåŸºæº–

### 6.1 å¿…é ˆæ¡ä»¶ï¼ˆMustï¼‰ ğŸ”µ

- [ ] **T-0009-01**: ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
  - Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹å…¬å¹³ãªãƒ©ãƒ³ãƒ€ãƒ åŒ–
  - å…ƒã®é…åˆ—ã¨ç•°ãªã‚‹é †åºã«ãªã‚‹
- [ ] **T-0009-02**: ãƒ‰ãƒ­ãƒ¼ã§æ‰‹æœ­ã«ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹
  - å±±æœ­ã‹ã‚‰æŒ‡å®šæšæ•°ãŒæ¸›å°‘
  - æ‰‹æœ­ã«æŒ‡å®šæšæ•°ãŒè¿½åŠ 
  - `CARD_DRAWN`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
- [ ] **T-0009-03**: ãƒ—ãƒ¬ã‚¤ã§ã‚«ãƒ¼ãƒ‰ãŒæ¨ã¦æœ­ã«ç§»å‹•ã™ã‚‹
  - æ‰‹æœ­ã‹ã‚‰æŒ‡å®šã‚«ãƒ¼ãƒ‰ãŒå‰Šé™¤
  - æ¨ã¦æœ­ã«æŒ‡å®šã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ 
  - `CARD_PLAYED`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«
- [ ] **T-0009-04**: æ‰‹æœ­è£œå……ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
  - æ‰‹æœ­ãŒ5æšæœªæº€ã®å ´åˆã€5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼
  - æ‰‹æœ­ãŒæ—¢ã«5æšã®å ´åˆã€ãƒ‰ãƒ­ãƒ¼ã—ãªã„
- [ ] **T-0009-05**: ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®ãƒ‰ãƒ­ãƒ¼ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
  - å±±æœ­ãŒç©ºã®å ´åˆã€æ¨ã¦æœ­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å±±æœ­ã«æˆ»ã™
  - ãã®å¾Œã€ãƒ‰ãƒ­ãƒ¼å‡¦ç†ã‚’ç¶™ç¶š
  - æ¨ã¦æœ­ã‚‚ç©ºã®å ´åˆã€ãƒ‰ãƒ­ãƒ¼å¯èƒ½ãªæšæ•°ã¾ã§å–å¾—

### 6.2 æ¨å¥¨æ¡ä»¶ï¼ˆShouldï¼‰ ğŸŸ¡

- [ ] å„æ“ä½œã§ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹
  - `CARD_DRAWN`: ãƒ‰ãƒ­ãƒ¼æ™‚
  - `CARD_PLAYED`: ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤æ™‚
  - `CARD_DISCARDED`: ã‚«ãƒ¼ãƒ‰ç ´æ£„æ™‚
  - `HAND_REFILLED`: æ‰‹æœ­è£œå……æ™‚
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
  - `ErrorCodes.INVALID_CARD_ID`
  - `ErrorCodes.DECK_FULL`
  - `ErrorCodes.CARD_NOT_IN_HAND`
  - `ErrorCodes.DATA_NOT_LOADED`

### 6.3 å‚ç…§ã—ãŸEARSè¦ä»¶ ğŸ”µ

- **ã‚¿ã‚¹ã‚¯å®šç¾©**: `docs/tasks/atelier-guild-rank/phase-2/TASK-0009.md`
  - å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆLine 131-144ï¼‰
  - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆLine 148-157ï¼‰

---

## 7. å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### 7.1 ä½œæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

#### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- `atelier-guild-rank/src/domain/entities/Card.ts` - **æ–°è¦**

#### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- `atelier-guild-rank/src/domain/interfaces/deck-service.interface.ts` - **æ–°è¦**

#### å®Ÿè£…
- `atelier-guild-rank/src/application/services/deck-service.ts` - **æ–°è¦**

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
- `atelier-guild-rank/src/domain/entities/index.ts` - **æ›´æ–°**ï¼ˆCardã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¿½åŠ ï¼‰
- `atelier-guild-rank/src/domain/interfaces/index.ts` - **æ›´æ–°**ï¼ˆIDeckServiceã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¿½åŠ ï¼‰
- `atelier-guild-rank/src/application/services/index.ts` - **æ›´æ–°**ï¼ˆDeckServiceã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¿½åŠ ï¼‰

#### ãƒ†ã‚¹ãƒˆ
- `atelier-guild-rank/tests/unit/domain/entities/Card.test.ts` - **æ–°è¦**ï¼ˆæ¨å¥¨ï¼‰
- `atelier-guild-rank/tests/unit/application/services/deck-service.test.ts` - **æ–°è¦**

### 7.2 ä¾å­˜é–¢ä¿‚

#### æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‚ç…§ï¼‰
- `atelier-guild-rank/src/shared/types/cards.ts` - ã‚«ãƒ¼ãƒ‰å‹å®šç¾©
- `atelier-guild-rank/src/shared/types/ids.ts` - CardIdå‹
- `atelier-guild-rank/src/shared/types/master-data.ts` - CardMasterå‹
- `atelier-guild-rank/src/shared/types/common.ts` - CardTypeå‹
- `atelier-guild-rank/src/shared/types/events.ts` - GameEventTypeå‹
- `atelier-guild-rank/src/shared/types/errors.ts` - ApplicationErrorã€ErrorCodes
- `atelier-guild-rank/src/domain/interfaces/master-data-repository.interface.ts` - IMasterDataRepository
- `atelier-guild-rank/src/application/events/event-bus.interface.ts` - IEventBus

---

## 8. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§

### 8.1 Cardã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-CARD-01 | ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§Cardã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ | idã€masterãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ |
| T-CARD-02 | `get name()`ã§ã‚«ãƒ¼ãƒ‰åã‚’å–å¾— | master.nameãŒè¿”ã•ã‚Œã‚‹ |
| T-CARD-03 | `get type()`ã§ã‚«ãƒ¼ãƒ‰ç¨®åˆ¥ã‚’å–å¾— | master.typeãŒè¿”ã•ã‚Œã‚‹ |
| T-CARD-04 | `get cost()`ã§ã‚³ã‚¹ãƒˆã‚’å–å¾— | master.costãŒè¿”ã•ã‚Œã‚‹ |
| T-CARD-05 | `isGatheringCard()`ã§æ¡å–åœ°ã‚«ãƒ¼ãƒ‰åˆ¤å®š | typeãŒGATHERINGã®å ´åˆtrueã‚’è¿”ã™ |
| T-CARD-06 | `isRecipeCard()`ã§ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰åˆ¤å®š | typeãŒRECIPEã®å ´åˆtrueã‚’è¿”ã™ |
| T-CARD-07 | `isEnhancementCard()`ã§å¼·åŒ–ã‚«ãƒ¼ãƒ‰åˆ¤å®š | typeãŒENHANCEMENTã®å ´åˆtrueã‚’è¿”ã™ |

### 8.2 DeckServiceã®ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-0009-01 | ã‚·ãƒ£ãƒƒãƒ•ãƒ« | Fisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚Šé †åºãŒãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚Œã‚‹ |
| T-0009-02 | ãƒ‰ãƒ­ãƒ¼ | å±±æœ­ã‹ã‚‰æŒ‡å®šæšæ•°ãŒæ¸›å°‘ã—ã€æ‰‹æœ­ã«è¿½åŠ ã•ã‚Œã‚‹ |
| T-0009-03 | ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤ | æ‰‹æœ­ã‹ã‚‰å‰Šé™¤ã•ã‚Œã€æ¨ã¦æœ­ã«è¿½åŠ ã•ã‚Œã‚‹ |
| T-0009-04 | æ‰‹æœ­è£œå…… | æ‰‹æœ­ãŒ5æšã«ãªã‚‹ã¾ã§ãƒ‰ãƒ­ãƒ¼ã•ã‚Œã‚‹ |
| T-0009-05 | ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®ãƒ‰ãƒ­ãƒ¼ | æ¨ã¦æœ­ãŒã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã¦å±±æœ­ã«æˆ»ã‚Šã€ãƒ‰ãƒ­ãƒ¼ãŒç¶™ç¶šã•ã‚Œã‚‹ |
| T-DECK-06 | initialize()ã§åˆæœŸãƒ‡ãƒƒã‚­æ§‹ç¯‰ | æŒ‡å®šã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰IDã§ãƒ‡ãƒƒã‚­ãŒæ§‹ç¯‰ã•ã‚Œã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚Œã‚‹ |
| T-DECK-07 | addCard()ã§ã‚«ãƒ¼ãƒ‰è¿½åŠ  | ãƒ‡ãƒƒã‚­ã«ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹ |
| T-DECK-08 | removeCard()ã§ã‚«ãƒ¼ãƒ‰å‰Šé™¤ | ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã‚‹ |
| T-DECK-09 | reset()ã§çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ | å±±æœ­ãƒ»æ‰‹æœ­ãƒ»æ¨ã¦æœ­ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹ |
| T-DECK-10 | getDeck()ã§å±±æœ­å–å¾— | readonlyé…åˆ—ã¨ã—ã¦å±±æœ­ãŒè¿”ã•ã‚Œã‚‹ |
| T-DECK-11 | getHand()ã§æ‰‹æœ­å–å¾— | readonlyé…åˆ—ã¨ã—ã¦æ‰‹æœ­ãŒè¿”ã•ã‚Œã‚‹ |
| T-DECK-12 | getDiscard()ã§æ¨ã¦æœ­å–å¾— | readonlyé…åˆ—ã¨ã—ã¦æ¨ã¦æœ­ãŒè¿”ã•ã‚Œã‚‹ |
| T-DECK-13 | getHandSize()ã§æ‰‹æœ­æšæ•°å–å¾— | æ‰‹æœ­ã®æšæ•°ãŒè¿”ã•ã‚Œã‚‹ |
| T-DECK-14 | å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰IDã‚’è¿½åŠ  | `ErrorCodes.INVALID_CARD_ID`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ |
| T-DECK-15 | ãƒ‡ãƒƒã‚­ä¸Šé™è¶…éæ™‚ã«ã‚«ãƒ¼ãƒ‰è¿½åŠ  | `ErrorCodes.DECK_FULL`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ |
| T-DECK-16 | æ‰‹æœ­ã«ãªã„ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤ | `ErrorCodes.CARD_NOT_IN_HAND`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ |

### 8.3 ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œã®ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆID | ãƒ†ã‚¹ãƒˆå†…å®¹ | æœŸå¾…çµæœ |
|---------|----------|----------|
| T-EVENT-01 | ãƒ‰ãƒ­ãƒ¼æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ | `CARD_DRAWN`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ |
| T-EVENT-02 | ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ | `CARD_PLAYED`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ |
| T-EVENT-03 | æ‰‹æœ­ç ´æ£„æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ | `CARD_DISCARDED`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ |
| T-EVENT-04 | æ‰‹æœ­è£œå……æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ | `HAND_REFILLED`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œã‚‹ |

---

## 9. å“è³ªåˆ¤å®šçµæœ

### 9.1 åˆ¤å®šåŸºæº–

| é …ç›® | çŠ¶æ…‹ | è©•ä¾¡ |
|------|------|------|
| è¦ä»¶ã®æ›–æ˜§ã• | ãªã— | âœ… |
| å…¥å‡ºåŠ›å®šç¾© | å®Œå…¨ | âœ… |
| åˆ¶ç´„æ¡ä»¶ | æ˜ç¢º | âœ… |
| å®Ÿè£…å¯èƒ½æ€§ | ç¢ºå®Ÿ | âœ… |
| ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ« | ğŸ”µï¼ˆé’ä¿¡å·ï¼‰ãŒå¤šã„ | âœ… |

### 9.2 ç·åˆè©•ä¾¡

**âœ… é«˜å“è³ª**

- è¨­è¨ˆæ–‡æ›¸ãƒ»ã‚¿ã‚¹ã‚¯å®šç¾©ã«åŸºã¥ã„ãŸæ˜ç¢ºãªè¦ä»¶å®šç¾©
- å‹å®šç¾©ã€åˆ¶ç´„æ¡ä»¶ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæ˜ç¢º
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒç¶²ç¾…çš„ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹
- ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã¯å…¨ã¦ğŸ”µï¼ˆé’ä¿¡å·ï¼‰
- å®Ÿè£…å¯èƒ½æ€§ãŒé«˜ãã€æ›–æ˜§ãªéƒ¨åˆ†ãŒãªã„

---

## 10. è£œè¶³æƒ…å ±

### 10.1 Fisher-Yatesã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```typescript
/**
 * Fisher-Yatesã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
 * æ™‚é–“è¨ˆç®—é‡: O(n)
 * ç©ºé–“è¨ˆç®—é‡: O(1)
 */
shuffle(): void {
  for (let i = this.deck.length - 1; i > 0; i--) {
    // 0ã‹ã‚‰iã¾ã§ã®ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
    const j = Math.floor(Math.random() * (i + 1));
    // è¦ç´ ã‚’äº¤æ›
    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
  }
}
```

### 10.2 ãƒ‡ãƒƒã‚­æ¯æ¸‡æ™‚ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant Client
    participant DeckService
    participant Discard
    participant Deck

    Client->>DeckService: draw(3)
    DeckService->>Deck: check length
    alt Deck is empty
        DeckService->>Discard: get all cards
        DeckService->>Deck: add cards from discard
        DeckService->>Discard: clear
        DeckService->>DeckService: shuffle()
    end
    DeckService->>Deck: pop card
    DeckService->>Client: return drawn cards
```

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|----------|---------|
| 2026-01-16 | 1.0.0 | åˆç‰ˆä½œæˆ |

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: `/tsumiki:tdd-testcases atelier-guild-rank TASK-0009` ã§ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ´—ã„å‡ºã—ã‚’è¡Œã„ã¾ã™ã€‚
