# アトリエ錬金術ゲーム 受け入れ基準

**バージョン**: 2.0
**作成日**: 2025-11-08
**更新日**: 2026-02-24
**対象**: アトリエ錬金術ゲーム（ギルドランク制）Phaser 3版

---

## 概要

このドキュメントは、錬金術をテーマにしたギルドランク制デッキ構築RPG「アトリエ」の受け入れ基準とテスト項目を記載する。

**ジャンル**: 錬金術 x デッキ構築 x ギルドランク制RPG
**プラットフォーム**: Webブラウザ（Phaser 3 + TypeScript）
**プレイ時間**: 1ランク攻略 10~20分 / 全ランク攻略 60~90分

---

## 信頼性レベル凡例

- 🔵 **青信号**: 要件定義書・設計文書・ユーザヒアリングを参考にした確実なテスト基準
- 🟡 **黄信号**: 要件定義書・設計文書から妥当な推測によるテスト基準
- 🔴 **赤信号**: 要件定義書・設計文書にない推測によるテスト基準

---

## 機能テスト基準

### 1. プラットフォーム・起動テスト

#### REQ-001~008: プラットフォーム基盤の受け入れ基準 🔵

**Given（前提条件）**:
- モダンブラウザ（Chrome、Firefox、Edge、Safari）がインストールされたPC
- 推奨スペック: 一般的なPC（メモリ4GB以上）

**When（実行条件）**:
- ブラウザでゲームURLにアクセスする

**Then（期待結果）**:
- 5秒以内にタイトル画面が表示される
- 960x640ピクセルのキャンバスでゲームが描画される
- マウスクリックでUIを操作可能
- オフライン状態でもローカルサーバーからプレイ可能

**テストケース**:
- [ ] 正常系: Chrome最新版での起動確認
- [ ] 正常系: Firefox最新版での起動確認
- [ ] 正常系: Edge最新版での起動確認
- [ ] 正常系: アセットロード完了後5秒以内にタイトル画面が表示される
- [ ] 異常系: アセット読み込み失敗時にエラーメッセージが表示される
- [ ] 境界値: 低速回線（3G相当）でのアセットロード完了確認

**テスト方法**:
- Playwright E2Eテスト: ブラウザ起動・タイトル画面表示の自動検証
- Chrome DevTools Network: アセットロード時間の計測
- Chrome DevTools Performance: 起動時のCPU・メモリ使用量を計測

---

### 2. セーブ・ロードシステム

#### REQ-010~013: データ管理の受け入れ基準 🔵

**Given（前提条件）**:
- ゲームがプレイ中の状態
- ブラウザのローカルストレージが使用可能

**When（実行条件）**:
- セーブ操作を実行、またはゲーム状態が自動セーブされる

**Then（期待結果）**:
- ローカルストレージにセーブデータが保存される
- ゲーム進行データ（ランク、ゴールド、デッキ、インベントリ等）が永続保存される
- ブラウザリロード後に続きからプレイ可能

**テストケース**:
- [ ] 正常系: プレイ途中でセーブ→ブラウザリロード→ロードして続行
- [ ] 正常系: ゴールドを獲得→ブラウザリロード→ゴールドが保持されている
- [ ] 正常系: 複数のセーブスロットが使用可能
- [ ] 異常系: ローカルストレージ無効時のエラーハンドリング
- [ ] 異常系: セーブデータ破損時の復旧またはエラー表示
- [ ] 境界値: セーブデータサイズが1MB以下

**テスト方法**:
- Vitestユニットテスト: セーブ/ロードロジックの検証
- Playwright E2Eテスト: ブラウザリロード後の状態復元確認
- Chrome DevTools Application: ローカルストレージの内容確認

---

### 3. ゲーム開始

#### REQ-014: ゲーム開始の受け入れ基準 🔵

**Given（前提条件）**:
- タイトル画面が表示されている
- セーブスロットが選択可能

**When（実行条件）**:
- 「はじめから」を選択して新規ゲームを開始する

**Then（期待結果）**:
- 初期デッキ（15枚: 採取地カード7枚、レシピカード5枚、強化カード3枚）が設定される
- 初期所持金100Gが設定される
- Gランク（見習い）から開始される
- メインシーンに遷移する

**テストケース**:
- [ ] 正常系: 新規ゲーム開始→初期デッキが正しく構成される
- [ ] 正常系: 初期パラメータ（ゴールド100G、Gランク、行動ポイント3）が正しい
- [ ] 正常系: セーブデータ選択→続きからプレイ可能
- [ ] 異常系: セーブスロット未選択時のエラー処理

---

### 4. メインゲームループ（4フェーズ制）

#### REQ-015~020: 4フェーズ制の受け入れ基準 🔵

**Given（前提条件）**:
- メインシーンが表示されている
- タブUIで4フェーズ（依頼受注/採取/調合/納品）が表示されている

**When（実行条件）**:
- プレイヤーがタブUIで任意のフェーズを選択する

**Then（期待結果）**:
- 選択したフェーズの画面に即座に切り替わる
- フッターのアクティブタブが切り替わる
- StateManagerの`currentPhase`が更新される
- `PHASE_CHANGED`イベントが発行される

**テストケース**:
- [ ] 正常系: 依頼受注→採取→調合→納品の順序でフェーズ遷移
- [ ] 正常系: 任意のフェーズから任意のフェーズへの直接遷移（全12パターン）
- [ ] 正常系: 各フェーズの画面が正しく表示される
- [ ] 正常系: フェーズ切り替え時にアクティブタブが視覚的に強調される
- [ ] 正常系: 日終了ボタンで残りAPを破棄して翌日に進行
- [ ] 異常系: ドラフト採取セッション中のフェーズ切り替えで確認ダイアログ表示

**テスト方法**:
- Vitestユニットテスト: StateManagerのフェーズ遷移ロジック検証
- Vitestユニットテスト: EventBusのフェーズ変更イベント発行検証
- Playwright E2Eテスト: タブUI操作による画面遷移の自動検証

> **関連**: フェーズ自由遷移の詳細テストは [free-phase-navigation/acceptance-criteria.md](free-phase-navigation/acceptance-criteria.md) を参照

---

### 5. 依頼システム

#### REQ-021~027: 依頼システムの受け入れ基準 🔵

**Given（前提条件）**:
- 依頼受注フェーズが表示されている
- 掲示板依頼および訪問依頼が表示されている

**When（実行条件）**:
- 依頼を確認し受注する
- 受注した依頼に対してアイテムを納品する

**Then（期待結果）**:
- 掲示板の累積依頼と訪問依頼が両方表示される
- 期限切れの依頼は掲示板から自動削除される
- 訪問依頼は3日ごとに更新される
- 同時受注上限3件まで受注可能
- 依頼達成時に貢献度・ゴールド・報酬カードが獲得できる
- 8種類の依頼タイプ（具体的指定、カテゴリ、品質条件、数量重視、属性条件、効果ベース、素材消費、複合条件）が正しく判定される

**テストケース**:
- [ ] 正常系: 掲示板依頼の累積表示（期限内の依頼が残る）
- [ ] 正常系: 期限切れ依頼の自動削除
- [ ] 正常系: 訪問依頼の3日ごとの更新
- [ ] 正常系: 依頼の受注（同時3件まで）
- [ ] 正常系: 各依頼タイプの判定ロジック（8タイプ）
- [ ] 正常系: 依頼達成時の貢献度計算（品質補正・依頼タイプ補正・コンボ補正・依頼者補正）
- [ ] 正常系: 報酬カード選択（3枚から1枚）
- [ ] 正常系: 品質S納品時のレア枠確定追加（4枚から選択）
- [ ] 異常系: 同時受注上限3件超過時のエラー表示
- [ ] 異常系: 依頼失敗時のペナルティ処理
- [ ] 境界値: 受注中依頼0件/3件での受注操作

**テスト方法**:
- Vitestユニットテスト: QuestService / ContributionCalculator の計算ロジック検証
- Vitestユニットテスト: 依頼タイプ判定ロジックの全8タイプ検証
- Vitest統合テスト: 依頼受注→調合→納品→報酬のフロー検証

---

### 6. デッキ・カードシステム

#### REQ-028~034: デッキ・カードの受け入れ基準 🔵

**Given（前提条件）**:
- プレイヤーがデッキを所持している
- 手札にカードがある

**When（実行条件）**:
- カードを使用する（採取地カード/レシピカード/強化カード）
- 日終了時に手札を補充する
- 休憩アクションで手札を入れ替える

**Then（期待結果）**:
- 3系統のカード（採取地カード、レシピカード、強化カード）が正しく機能する
- デッキ上限30枚、手札上限7枚、初期手札5枚が守られる
- 日終了時に手札が5枚になるまで補充される
- 山札0枚時に捨て札がリシャッフルされる
- 休憩アクション（コスト0）で手札2枚捨てて2枚ドロー

**テストケース**:
- [ ] 正常系: 採取地カード使用→ドラフト採取が開始される
- [ ] 正常系: レシピカード使用→調合が開始される
- [ ] 正常系: 強化カード使用→対象行動が強化される
- [ ] 正常系: デッキ上限30枚が維持される
- [ ] 正常系: 手札上限7枚が維持される
- [ ] 正常系: 日終了時に手札5枚まで補充
- [ ] 正常系: 山札0枚→捨て札リシャッフル→ドロー
- [ ] 正常系: 休憩アクション→手札2枚捨て+2枚ドロー（コスト0）
- [ ] 異常系: 手札0枚での操作
- [ ] 境界値: デッキ30枚ちょうどでのカード追加

**テスト方法**:
- Vitestユニットテスト: DeckServiceのドロー・シャッフル・手札管理ロジック検証
- Vitestユニットテスト: カード系統別の使用効果検証

---

### 7. 採取システム

#### REQ-035~040: 採取の受け入れ基準 🔵

**Given（前提条件）**:
- 採取フェーズが表示されている
- 手札に採取地カードがある
- 行動ポイントが1以上残っている

**When（実行条件）**:
- 場所選択画面で採取地を選択する
- ドラフト採取で素材を選択する

**Then（期待結果）**:
- 場所選択画面がマップ形式で表示される
- 手札の採取地カードに対応する場所のみ選択可能（それ以外はグレーアウト）
- 各採取地に移動APコストと採取可能素材プレビューが表示される
- ドラフト採取: 素材3つ提示→1つ選択を提示回数分繰り返し
- 採取コスト = 基本コスト（採取地距離）+ 追加コスト（選択個数）

**採取地カード一覧**:

| 採取地 | 基本コスト | 提示回数 | レア出現率 |
|--------|-----------|---------|-----------|
| 裏庭 | 0 | 2回 | 0% |
| 近くの森 | 0 | 3回 | 10% |
| 川辺 | 0 | 3回 | 10% |
| 山麓の岩場 | 1 | 4回 | 15% |
| 奥地の洞窟 | 1 | 4回 | 20% |
| 火山地帯 | 2 | 5回 | 25% |
| 古代遺跡 | 2 | 5回 | 30% |

**テストケース**:
- [ ] 正常系: 場所選択画面の表示（手札の採取地カードに対応する場所が選択可能）
- [ ] 正常系: 移動APコストの表示
- [ ] 正常系: 採取可能素材プレビューの表示
- [ ] 正常系: ドラフト採取（3つ提示→1つ選択 x 提示回数）
- [ ] 正常系: 0個採取（偵察のみ）→追加コスト0
- [ ] 正常系: 1~2個採取→追加コスト1
- [ ] 正常系: 3~4個採取→追加コスト2
- [ ] 正常系: 5~6個採取→追加コスト3
- [ ] 正常系: 7個以上採取→追加コスト4
- [ ] 正常系: 素材がインベントリに追加される
- [ ] 異常系: 手札に採取地カード0枚→メッセージ表示とショップ誘導
- [ ] 異常系: インベントリ上限（20枠）到達時の処理
- [ ] 境界値: 基本コスト0の採取地で0個採取→コスト0

**テスト方法**:
- Vitestユニットテスト: GatheringServiceの採取コスト計算検証
- Vitestユニットテスト: ドラフト採取の素材プール・提示回数検証
- Vitestユニットテスト: 素材品質・レア出現率の検証

---

### 8. 調合システム

#### REQ-041~046: 調合の受け入れ基準 🔵

**Given（前提条件）**:
- 調合フェーズが表示されている
- 手札にレシピカードがある
- インベントリに必要素材がある
- 行動ポイントが1以上残っている

**When（実行条件）**:
- レシピカードを選択し調合を実行する

**Then（期待結果）**:
- 素材が消費され（永続消費）、アイテムが生成される
- アイテムの品質は素材平均品質 + 強化カードボーナス + アーティファクトボーナスで決定
- 行動ポイントが消費される（1~3: レシピの複雑さによる）
- 生成アイテムがインベントリに追加される

**テストケース**:
- [ ] 正常系: 基本レシピ調合（コスト1）→アイテム生成
- [ ] 正常系: 中級レシピ調合（コスト2）→アイテム生成
- [ ] 正常系: 高級レシピ調合（コスト3）→アイテム生成
- [ ] 正常系: 品質計算（素材平均品質 + 強化ボーナス + アーティファクトボーナス）
- [ ] 正常系: 素材の永続消費（調合後に素材が減少）
- [ ] 正常系: 強化カード使用時の品質上昇
- [ ] 異常系: 素材不足時のエラー表示
- [ ] 異常系: 行動ポイント不足時のエラー表示
- [ ] 境界値: 品質Dの素材のみで調合→品質D
- [ ] 境界値: 品質A以上の素材で調合→品質A~S

**テスト方法**:
- Vitestユニットテスト: AlchemyServiceの調合ロジック・品質計算検証
- Vitestユニットテスト: 素材消費・アイテム生成のインベントリ操作検証

---

### 9. 行動ポイント・日進行システム

#### REQ-047~052: AP・日進行の受け入れ基準 🔵

**Given（前提条件）**:
- メインシーンでゲームが進行中
- 1日の行動ポイント（AP）は3

**When（実行条件）**:
- 採取・調合・買い物でAPを消費する
- AP消費が上限を超過する
- 「日終了」ボタンを押す

**Then（期待結果）**:
- 採取・調合・買い物で共有APが消費される
- AP超過時に自動的に日が進行する（翌日AP = 3 - 超過分）
- 「日終了」ボタンで残りAPを破棄して翌日AP=3で開始
- 日終了時に依頼期限-1、手札補充、ランク判定が実行される

**テストケース**:
- [ ] 正常系: AP消費3（上限ちょうど）→日は進行しない
- [ ] 正常系: AP消費4（超過1）→自動日進行、翌日AP=2
- [ ] 正常系: AP消費5（超過2）→自動日進行、翌日AP=1
- [ ] 正常系: 「日終了」ボタン→残りAP破棄、翌日AP=3
- [ ] 正常系: 各フェーズからの「日終了」が正常に実行される
- [ ] 正常系: 自動日進行時に日終了処理（依頼期限-1、手札補充、ランク判定）実行
- [ ] 正常系: 複数日分のAP超過（AP7消費→2日進行）
- [ ] 正常系: 何も行動せず日終了→ペナルティなし
- [ ] 異常系: 自動日進行で残り日数0→ゲームオーバー判定
- [ ] 異常系: AP0で行動試行→AP不足メッセージと日終了誘導表示（参照: [EDGE-101](free-phase-navigation/acceptance-criteria.md#edge-101-ap残量0での行動試行-)）
- [ ] 境界値: AP消費6（上限x2 = 最大コスト）→1日進行、翌日AP=0
- [ ] 境界値: AP残量0で日終了→翌日AP=3

**テスト方法**:
- Vitestユニットテスト: AP消費・超過計算ロジックの検証
- Vitestユニットテスト: 日終了処理（依頼期限更新、手札補充、ランク判定）の検証
- Vitest統合テスト: AP超過→自動日進行→状態更新の連携検証

> **関連**: AP超過・日進行の詳細テストは [free-phase-navigation/acceptance-criteria.md](free-phase-navigation/acceptance-criteria.md) REQ-003/REQ-004 を参照

---

### 10. ランクシステム

#### REQ-053~060: ランクの受け入れ基準 🔵

**Given（前提条件）**:
- ゲームが進行中
- 現在のランクでプレイしている

**When（実行条件）**:
- 依頼を達成して貢献度を獲得する
- 昇格ゲージが満タンになる
- 昇格試験を受ける

**Then（期待結果）**:
- 貢献度が昇格ゲージに反映される
- 昇格ゲージ満タンで昇格試験が解放される
- 昇格試験クリアで次のランクに昇格
- ランクごとの特殊ルールが適用される
- 制限日数超過でゲームオーバー

**ランク一覧**:

| ランク | 必要貢献度 | 制限日数 | 特殊ルール |
|--------|-----------|----------|-----------|
| G（見習い） | 100 | 30日 | なし |
| F（新人） | 200 | 30日 | なし※ |
| E（一人前） | 350 | 35日 | 品質D以下は貢献度半減 |
| D（中堅） | 500 | 35日 | 全依頼の期限-1日 |
| C（熟練） | 700 | 35日 | 品質C以上でないと受理されない |
| B（上級） | 1000 | 35日 | 品質B以上必須、期限-1日 |
| A（最上級） | 1500 | 35日 | 品質A以上必須、期限-2日 |
| S（伝説） | - | 無制限 | 最終ランク（ゲームクリア） |

> ※同時受注制限はG~S全ランク共通3件

**テストケース**:
- [ ] 正常系: 貢献度獲得→昇格ゲージに反映
- [ ] 正常系: 昇格ゲージ満タン→昇格試験解放
- [ ] 正常系: 昇格試験クリア→次ランクに昇格
- [ ] 正常系: 昇格報酬（アーティファクト選択、ボーナスゴールド、新規カード解放）
- [ ] 正常系: Sランク到達→ゲームクリア
- [ ] 正常系: ランクごとの特殊ルール適用（E: 品質D半減、D: 期限-1、C: 品質C必須、B: 品質B+期限-1、A: 品質A+期限-2）
- [ ] 異常系: 制限日数超過→ゲームオーバー
- [ ] 異常系: 昇格試験失敗→ゲームオーバー
- [ ] 境界値: 昇格ゲージがちょうど満タンになるケース
- [ ] 境界値: 制限日数の最終日での操作

**テスト方法**:
- Vitestユニットテスト: RankServiceの昇格判定・貢献度計算検証
- Vitestユニットテスト: 特殊ルール適用ロジックの検証
- Vitest統合テスト: 全ランク通過フローの検証

---

### 11. ショップシステム

#### REQ-061~064: ショップの受け入れ基準 🔵

**Given（前提条件）**:
- ショップ画面が表示されている
- ゴールドを所持している
- 行動ポイントが1以上残っている

**When（実行条件）**:
- カード、素材、アーティファクトを購入する

**Then（期待結果）**:
- ゴールドが消費される
- 購入品がデッキまたはインベントリに追加される
- 行動ポイント1が消費される

**ショップ種類**:

| ショップ | 取扱商品 | 価格帯 |
|---------|---------|--------|
| カードショップ | 採取地・レシピカード | 50~500G |
| 素材ショップ | 素材 | 10~100G |
| 強化カードショップ | 強化カード | 80~200G |
| アーティファクトショップ | アーティファクト | 300~500G |

**テストケース**:
- [ ] 正常系: カード購入→デッキに追加、ゴールド消費
- [ ] 正常系: 素材購入→インベントリに追加、ゴールド消費
- [ ] 正常系: アーティファクト購入→所持品に追加、ゴールド消費
- [ ] 正常系: 買い物でAP1消費
- [ ] 異常系: ゴールド不足時のエラー表示
- [ ] 異常系: 行動ポイント不足時のエラー表示
- [ ] 境界値: ゴールド0で購入不可

**テスト方法**:
- Vitestユニットテスト: ShopServiceの購入ロジック・ゴールド計算検証

---

### 12. アーティファクトシステム

#### REQ-065~068: アーティファクトの受け入れ基準 🔵

**Given（前提条件）**:
- アーティファクトを所持している、または入手可能な状態

**When（実行条件）**:
- ランクアップ報酬でアーティファクトを選択する
- ショップでアーティファクトを購入する

**Then（期待結果）**:
- 永続パッシブ効果が適用される
- 所持上限なし
- ランク昇格後も引き継ぎ

**テストケース**:
- [ ] 正常系: ランクアップ時に3つから1つアーティファクト選択
- [ ] 正常系: アーティファクト効果が常時適用される（品質+1、採取+1、貢献度+20%等）
- [ ] 正常系: 複数アーティファクトの効果が累積する
- [ ] 正常系: ランク昇格後もアーティファクトが引き継がれる
- [ ] 異常系: 不正なアーティファクトデータの場合のエラー処理

**テスト方法**:
- Vitestユニットテスト: ArtifactServiceの効果適用ロジック検証

---

### 13. UI/UX

#### REQ-069~074: UI/UXの受け入れ基準 🟡

**Given（前提条件）**:
- ゲーム画面が表示されている

**When（実行条件）**:
- 各フェーズの画面を表示する
- タブUIで遷移する
- 各種情報を確認する

**Then（期待結果）**:
- フッターに4フェーズタブ（依頼/採取/調合/納品）が表示される
- 現在のフェーズタブが視覚的に強調される
- ヘッダーに日数・AP・ゴールド・ランクが常時表示される
- カードにホバーすると詳細が表示される
- 日本語UIで全画面が表示される

**テストケース**:
- [ ] 正常系: 4フェーズタブの表示とアクティブ状態の強調
- [ ] 正常系: ヘッダー情報（日数、AP、ゴールド、ランク）の常時表示
- [ ] 正常系: カード詳細のツールチップ/モーダル表示
- [ ] 正常系: 依頼一覧の掲示板+訪問依頼表示
- [ ] 正常系: インベントリ画面の表示
- [ ] ユーザビリティ: 初見で操作方法が理解できる

**テスト方法**:
- Playwright E2Eテスト: UI要素の表示・操作の自動検証
- 手動テスト: ユーザビリティの確認

---

### 14. サウンド

#### REQ-075~076: サウンドの受け入れ基準 🟡

**Given（前提条件）**:
- ゲームが起動している
- ブラウザのオーディオが有効

**When（実行条件）**:
- ゲームをプレイする
- 設定でBGM・SEの音量を調整する

**Then（期待結果）**:
- BGMが再生される
- SE（効果音）が再生される
- 音量調整が反映される

**テストケース**:
- [ ] 正常系: タイトル画面でBGMが再生される
- [ ] 正常系: カード使用時にSEが鳴る
- [ ] 正常系: BGM音量を50%に設定→音量が半分になる
- [ ] 正常系: SE音量を0%に設定→SEが鳴らない
- [ ] 異常系: ブラウザのAutoplay Policyでブロックされた場合のフォールバック

**テスト方法**:
- 手動テスト: 各場面でのBGM・SE再生確認
- Playwright E2Eテスト: 音量設定の状態保持確認

---

## 非機能テスト基準

### パフォーマンステスト

#### NFR-001~003: パフォーマンス要件 🔵

**Given（前提条件）**:
- 一般的なPC（メモリ4GB以上）
- モダンブラウザ（Chrome最新版）
- ゲームが起動している

**When（実行条件）**:
- ゲームを起動する
- フェーズ切り替え操作を行う
- 長時間プレイする

**Then（期待結果）**:
- 起動から5秒以内にタイトル画面表示
- ゲームプレイ中に60FPS以上を維持
- フェーズ切り替えの応答時間が200ms以内
- カード操作の応答時間が100ms以内

**テストケース**:
- [ ] 応答時間: 起動時間を10回計測→平均5秒以内
- [ ] スループット: 60FPS以上を維持
- [ ] フェーズ切り替え: 全12パターンの遷移で200ms以内
- [ ] リソース使用量: CPU使用率50%以下、メモリ使用量500MB以下
- [ ] 長時間プレイ: 30分連続プレイでメモリリークなし

**テスト方法**:
- Chrome DevTools Performance: FPS計測、CPU・メモリ使用量のモニタリング
- Chrome DevTools Memory: ヒープスナップショット比較によるメモリリーク検出
- Chrome DevTools Performance Monitor: 長時間実行時のリソース推移確認
- Playwright E2Eテスト: フェーズ切り替え応答時間の自動計測
- Vitestユニットテスト: 計算ロジックのパフォーマンスベンチマーク

---

### セキュリティテスト

#### NFR-004: セキュリティ要件 🔵

**Given（前提条件）**:
- Webブラウザ上で動作するオフラインゲーム
- セーブデータはローカルストレージに保存

**When（実行条件）**:
- セーブデータを手動編集する
- 不正なデータをローカルストレージに注入する

**Then（期待結果）**:
- 不正データでもクラッシュしない
- セーブデータの整合性検証が行われる
- 改ざん検出時に警告メッセージを表示

**テストケース**:
- [ ] セーブデータ編集: ローカルストレージのデータを手動編集→ゲームがクラッシュしない
- [ ] データ改ざん: 不正な値（負のゴールド、存在しないランク等）でもクラッシュしない
- [ ] XSS防止: ユーザー入力（プレイヤー名等）がサニタイズされる

**テスト方法**:
- Vitestユニットテスト: セーブデータバリデーションロジックの検証
- 手動テスト: Chrome DevTools Applicationでローカルストレージの直接操作

---

### ユーザビリティテスト

#### NFR-005~007: ユーザビリティ要件 🟡

**Given（前提条件）**:
- 新規プレイヤー

**When（実行条件）**:
- チュートリアルを受講する
- ヘルプを参照する

**Then（期待結果）**:
- 30分以内に基本操作を習得できる
- 日本語UIで操作可能
- ヘルプで操作方法を確認できる

**テストケース**:
- [ ] 直感的操作性: テストプレイヤーが30分以内に基本操作（依頼受注→採取→調合→納品→日終了）を習得
- [ ] 日本語UI: すべてのUIが日本語で表示される
- [ ] ヘルプ機能: ヘルプ画面で操作方法を確認可能
- [ ] エラーメッセージ: エラー発生時に分かりやすい日本語メッセージが表示される

**テスト方法**:
- 手動テスト: テストプレイヤーによる初回プレイ観察
- Playwright E2Eテスト: 全UI要素の日本語表示確認

---

### 保守性テスト

#### NFR-008~009: 保守性要件 🟡

**Given（前提条件）**:
- 開発環境が整っている（Node.js、pnpm）

**When（実行条件）**:
- マスターデータ（JSON）を編集する
- テストを実行する
- コードをリントする

**Then（期待結果）**:
- JSONマスターデータの編集がゲームに反映される
- 全ユニットテストが通過する
- Biomeリンターで警告0件

**テストケース**:
- [ ] マスターデータ編集: JSONファイルでカードデータを変更→ゲームに反映
- [ ] テスト実行: `pnpm test` で全ユニットテスト通過
- [ ] リント: `pnpm lint` で警告0件
- [ ] ビルド: `pnpm build` でエラーなくビルド成功
- [ ] 型チェック: TypeScriptの厳密型チェックが通過

**テスト方法**:
- CI/CD: GitHub Actions等での自動テスト実行
- `pnpm test -- --run`: Vitestによる全テスト実行
- `pnpm lint`: Biomeによるコード品質チェック
- `pnpm build`: Viteによるプロダクションビルド

---

### 互換性テスト

#### NFR-010: 互換性要件 🟡

**Given（前提条件）**:
- Phaser 3 + TypeScriptでの開発
- Webブラウザでの動作

**When（実行条件）**:
- 各ブラウザで動作確認を実施する

**Then（期待結果）**:
- Chrome、Firefox、Edge、Safariで動作する
- モバイルブラウザでの基本動作（将来対応）

**テストケース**:
- [ ] Chrome最新版: 全機能動作確認
- [ ] Firefox最新版: 全機能動作確認
- [ ] Edge最新版: 全機能動作確認
- [ ] Safari最新版: 基本動作確認
- [ ] 画面サイズ: 960x640以上の解像度で正常表示

**テスト方法**:
- Playwright E2Eテスト: 複数ブラウザでの自動テスト実行（Chromium, Firefox, WebKit）
- 手動テスト: 各ブラウザでの目視確認

---

## Edgeケーステスト基準

### エラー処理

#### EDGE-001~002: エラーハンドリング 🟡

**テストシナリオ**:
- セーブデータ破損
- ローカルストレージ容量超過

**期待されるエラーハンドリング**:
- エラーメッセージを表示
- ゲームがクラッシュしない
- 新規ゲームとして起動可能

**合格基準**:
- [ ] システムがクラッシュしない
- [ ] 適切なエラーメッセージが日本語で表示される
- [ ] データの整合性が保たれる
- [ ] 復旧可能な状態を維持する

**テストケース**:
- [ ] セーブデータを手動で破損→エラーメッセージ表示、新規ゲームとして起動
- [ ] ローカルストレージ容量超過でセーブ→エラーメッセージ表示、セーブ中止

---

### 境界値テスト

#### EDGE-003~005: 境界値処理 🟡

**テストシナリオ**:
- デッキ枚数30枚（上限）
- APが0
- 制限日数の最終日

**期待される動作**:
- 上限値で適切な処理が行われる
- 不正な状態にならない

**合格基準**:
- [ ] デッキ30枚で新カード追加→上限メッセージ表示
- [ ] AP0で行動→AP超過計算が正しく動作（自動日進行）
- [ ] 制限日数最終日→翌日にゲームオーバー判定

**テストケース**:
- [ ] デッキ30枚: カード追加時に上限メッセージ、パフォーマンス問題なし
- [ ] AP0での行動: 正常にAP超過として処理される
- [ ] 制限日数最終日: 日終了でゲームオーバー判定が実行される

---

### データ整合性テスト

#### EDGE-006~007: データ整合性 🟡

**テストシナリオ**:
- 依頼が同時受注上限の3件に到達
- 調合中にインベントリ枠が不足
- 素材品質の範囲外の値

**期待される動作**:
- データの整合性を保つ
- エラー発生時は安全な状態に復旧

**合格基準**:
- [ ] 同時受注上限3件で追加受注不可
- [ ] 調合失敗時に素材が保持される
- [ ] データの不整合が発生しない

**テストケース**:
- [ ] 同時受注4件目: エラーメッセージが表示され受注できない
- [ ] 調合中にインベントリ枠不足: 調合中止、素材が保持される
- [ ] 品質範囲外の値: バリデーションで弾かれる

---

## 統合テスト基準

### システム間連携テスト

- [ ] デッキシステム⇔採取システム: 採取地カードによるドラフト採取の実行
- [ ] デッキシステム⇔調合システム: レシピカードによる調合の実行
- [ ] 採取システム⇔インベントリ: 採取した素材がインベントリに追加される
- [ ] 調合システム⇔インベントリ: 素材消費とアイテム生成がインベントリに反映
- [ ] 依頼システム⇔ランクシステム: 貢献度獲得が昇格ゲージに反映
- [ ] 依頼システム⇔デッキシステム: 報酬カードがデッキに追加される
- [ ] ショップ⇔デッキ/インベントリ: 購入品が正しく追加される
- [ ] AP管理⇔日進行: AP超過による自動日進行が正しく動作
- [ ] StateManager⇔EventBus: 状態変更時にイベントが正しく発行される

**テスト方法**:
- Vitest統合テスト: 複数サービス間の連携フロー検証
- Playwright E2Eテスト: 1日のフルサイクル（依頼受注→採取→調合→納品→日終了）の自動検証

---

## リグレッションテスト基準

### 既存機能影響確認

- [ ] 新機能追加後: 既存の依頼達成機能が動作する
- [ ] パフォーマンス: 新機能追加後も60FPS維持
- [ ] セーブ互換性: 旧バージョンのセーブデータが読み込める（マイグレーション含む）

**テスト方法**:
- Vitestユニットテスト: 全テストスイートの実行
- Playwright E2Eテスト: クリティカルパスの自動検証
- `pnpm test -- --run`: CI/CDパイプラインでの自動実行

---

## 受け入れテスト実行チェックリスト

### テスト実行前

- [ ] テスト環境の準備完了（Node.js、pnpm、モダンブラウザ）
- [ ] テストデータの準備完了（正常データ、異常データ、境界値データ）
- [ ] テストツールの準備完了（Vitest、Playwright、Chrome DevTools）
- [ ] `pnpm install` で依存関係が最新であることを確認

### テスト実行中

- [ ] 全ユニットテスト実行: `pnpm test -- --run`
- [ ] 全E2Eテスト実行: `pnpm test:e2e`
- [ ] パフォーマンス計測: Chrome DevTools Performanceで計測
- [ ] 手動テスト: UI/UX、サウンド、ユーザビリティの確認
- [ ] 問題発見時の記録（GitHub Issueに登録）
- [ ] 修正後の再テスト

### テスト完了後

- [ ] テスト結果の記録（合格/不合格、問題点の整理）
- [ ] テストカバレッジの確認: `pnpm test:coverage`（目標: 80%以上）
- [ ] 残存問題の整理（既知の問題のリスト化）
- [ ] 受け入れ可否の判定（全Must Have要件が合格）

---

## MVP（最小限の製品）の受け入れ基準

### MVP合格条件

以下のすべてのテストに合格すること:

1. **プラットフォーム基盤**: Webブラウザでの起動・表示
2. **データ管理**: ローカルストレージへのセーブ/ロード
3. **4フェーズ制**: 依頼受注→採取→調合→納品の基本ループ
4. **デッキシステム**: 3系統カード（採取地/レシピ/強化）の基本操作
5. **依頼システム**: 依頼受注・判定・貢献度計算
6. **採取システム**: ドラフト採取の基本動作
7. **調合システム**: レシピによるアイテム生成
8. **ランクシステム**: Gランクからの昇格フロー
9. **パフォーマンス**: 60FPS維持、5秒以内起動

### MVP除外項目（正式リリースでテスト）

- チュートリアル機能
- アーティファクトシステムの全効果
- 全ランク（B/A/S）の昇格試験内容
- サウンドシステム
- 難易度モード
- ニューゲーム+

---

## テスト優先順位

### P0（最優先 - MVP必須）

- プラットフォーム基盤テスト（ブラウザ起動・表示）
- 4フェーズ制テスト（タブUI遷移・日進行）
- デッキ・カードシステムテスト（3系統カード）
- 依頼システムテスト（受注・判定・報酬）
- 採取システムテスト（ドラフト採取・コスト計算）
- 調合システムテスト（品質計算・素材消費）
- パフォーマンステスト（60FPS、起動時間）

### P1（高優先 - 正式リリース必須）

- ランクシステムテスト（全ランク昇格フロー）
- ショップシステムテスト
- アーティファクトシステムテスト
- セーブ/ロードテスト
- UI/UXテスト
- 統合テスト

### P2（中優先）

- Edgeケーステスト
- リグレッションテスト
- ユーザビリティテスト
- サウンドテスト

### P3（低優先 - あれば良い）

- 全ランク攻略の通しプレイテスト
- 難易度モードテスト
- ニューゲーム+テスト

---

## 自動テスト vs 手動テスト

### 自動テスト対象

| テスト種別 | ツール | 対象 |
|-----------|--------|------|
| ユニットテスト | Vitest | ビジネスロジック（サービス層の純粋関数）、計算式、バリデーション |
| 統合テスト | Vitest | サービス間連携、StateManager + EventBus連携 |
| E2Eテスト | Playwright | ゲームフロー、UI操作、ブラウザ互換性 |
| リントチェック | Biome | コードスタイル、型安全性 |
| 型チェック | TypeScript | 型の整合性 |

### 手動テスト対象

| テスト項目 | 確認内容 |
|-----------|---------|
| UI/UXテスト | 視覚的な確認、アニメーション、レイアウト |
| ユーザビリティテスト | 操作性の評価、初見プレイの観察 |
| サウンドテスト | BGM・SEの再生確認、音量調整 |
| パフォーマンス詳細 | Chrome DevToolsでの詳細プロファイリング |
| バランステスト | ゲームプレイを通じた難易度・経済バランスの確認 |

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-11-08 | 1.0 | 初版作成（Unity版ローグライク前提） |
| 2026-02-24 | 2.0 | ギルドランク制+Phaser 3版に全面改訂。ゲーム設計をローグライク→ギルドランク制4フェーズに変更。テスト方法をUnity Profiler→Chrome DevTools/Vitest/Playwrightに更新。プラットフォームをWindows実行ファイル→Webブラウザに変更。カード系統を6系統→3系統に変更。敗北条件をデッキ0枚→日数制限超過に変更。free-phase-navigation/acceptance-criteria.mdとの整合性を確保。 |
